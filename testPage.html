<html>
  <script type="text/javascript">
    var subscriptionType = "type";
    var customerLifeCycle = "Not available";
    var platform = "xyz";
    var customerCode = "zc";
    var customerId = "123";
    var site = "whatever";
    var uiLanguage = "xasdas";
  </script>
  <body>
    <h1>hallo</h1>
  </body>
  <script type="text/javascript" async>
    function CallbackManager() {
      function a(a) {
        var b = d[a.toLowerCase()];
        if ("function" == typeof b) {
          var c = Array.prototype.slice.call(arguments);
          b.apply(null, c.slice(1));
        }
      }
      function b(a, b) {
        var c = a.toLowerCase();
        return d[c]
          ? "function" != typeof b
            ? void console.info("Callback must be a function.")
            : void (d[c] = b)
          : void console.info("Invalid callback event: ", a);
      }
      function c(a) {
        var b = {};
        for (var c in a)
          if (a.hasOwnProperty(c)) {
            var d = a[c].toLowerCase();
            b[d] = function () {};
          }
        return b;
      }
      (this.set = b),
        (this.trigger = a),
        (this.events = {
          INLINE_BUTTON_CLICKED: "InlineButtonClicked",
          CLOSE: "Close",
        });
      var d = c(this.events);
      Object.freeze(this.events);
    }
    window.statusCodes = {
      SUCCESS: 1,
      NO_DATA: 3,
      DUPLICATE: 2201,
      INVALID: 2201,
      RETRY: 5008,
    };
    var SnapABug = (function () {
      var baseURL = "https://www.snapengage.com",
        staticBaseURL = "https://storage.googleapis.com/code.snapengage.com",
        newCaseJSON = {},
        webCapture = !0,
        ready = !0,
        chatInProgress = !1,
        previousProactiveRulesJSON = null,
        widgetId = "36db38bd-8855-4729-b20c-7d824244aef7",
        dbCaseId = "",
        caseId = "",
        jsvars = "",
        buttonImgUrl = "",
        buttonPosition = "left",
        buttonOffset = "55%",
        buttonWidth = 35,
        buttonHeight = 73,
        email = "",
        userName = "",
        emailLocked = !1,
        description = "",
        vval = "",
        cvval = {},
        cvvalRequired = "",
        locale = "en",
        buttonPos = "-4px",
        formTopPos = 0,
        chatFormPos = "",
        logoLinkEnabled = !0,
        errorCode = -1,
        sshot = 0,
        domain = "",
        jre = "",
        labelColor = "",
        lightboxColor = "white",
        requiredColor = "",
        requiredMarker = "",
        fbkText = "",
        fbkLink = "",
        fbkLinkText = "",
        chatDescriptionRequired = 1,
        agentStatus = 0,
        chatSound = !0,
        bgURL = staticBaseURL + "/wbg/snapengage_form.png",
        waitImgLoaded = !1,
        dragFromX = 0,
        dragFromY = 0,
        formPosX = -1,
        formPosY = -1,
        dragging = !1,
        onmouseupPrev = null,
        onmousemovePrev = null,
        onmouseupInstalled = !1,
        onmousemoveInstalled = !1,
        formWidth,
        formHeight,
        rpcUrl = "",
        rpcStack,
        rpcStackInitialLength = 0,
        rpcSendOfflineMessage = !1,
        proactiveMsg = "",
        proactiveCommands = [],
        proactiveNotify = !1,
        proactiveAgentNumber = "",
        proactiveOfflineFallback = !1,
        proactiveAutocloseTimerDelay = 2,
        callmeButton = "",
        useCustomCallMeButton = !1,
        callmePhone = "",
        noProactiveChatDelay = 30,
        visitorCookieLifeTime = 0,
        offlineAllowed = !0,
        chatAllowed = !0,
        proactiveChatAllowed = !0,
        startChatMessage = "",
        startChatOptions = void 0,
        pageChangeNotificationAllowed = !0,
        visitorChatHistoryCookie = !0,
        startChatRequested = !1,
        direction = "",
        callbackOpen = null,
        callbackOpenProactive = null,
        callbackClose = null,
        callbackMessageSubmit = null,
        callbackStartChat = null,
        callbackChatMessageSent = null,
        callbackChatMessageReceived = null,
        callbackBeforeCallme = null,
        callbackStartCallme = null,
        callbackAgentOnline = null,
        callbackAgentCommand = null,
        callbackManager = new CallbackManager(),
        callCallbackOpen = !1,
        historyCookieEnabled = !0,
        country = "",
        fromUrlOverride = "",
        expiredAccount = !1,
        agentStatusLastCheck = 0,
        agentStatusCheckInterval = 110,
        mobileUI = null,
        mobileStyle = null,
        customDesignUI = null,
        customDesignStyle = null,
        hideButtonAPIUsed = !1,
        showButtonAPIUsed = !1,
        enableInternationalPhoneCalls = !1,
        agentTags = "",
        ruleSetArray = null,
        visitorClicks = 0,
        visitorLocalTime = 0,
        visitorCountry = "",
        visitorRegion = "",
        visitorCity = "",
        visitorLanguages = "",
        geoRPCSent = !1,
        isInstanceProactiveV2 = !1,
        currentEvaluationStep = 0,
        routingAvailabilityCache = {},
        routingAvailabilityCacheLifetime = 3e4,
        routingList = [],
        proactiveChatAgentRoutingRuleSetIndex = -1,
        waitingRPCResponce = !1,
        proactiveChatEvaluationFinishedCallback = null,
        openProactiveChatAPIRule = null,
        styleTag = null,
        menuButtonIconSpriteSheetURL = null,
        menuIconSpriteSheetURL = null,
        menuButtonStylesAdded = !1,
        menuStylesAdded = !1,
        preChatSearchStatus = -1,
        preChatSearchQuestion = "",
        visitorFirstMessage = "",
        animating = !1,
        entryPageRefOverride = null,
        entryPageOverride = null,
        minimizedProactiveChatBox = !1,
        chatHandledByBot = !1,
        sendGetProactiveChatAgentForIsBotOnly = !1,
        proactiveEventListenersAdded = !1;
      return {
        callbacks: callbackManager.events,
        pendingXHR: !1,
        rpcRetries: {},
        offlineRpcArray: [],
        RPC_ERROR_CALLBACK: {
          sendGetWidgetConfig: !1,
          sendGetProactiveChatAgent: !1,
          sendUpdateCase: !1,
          sendCheckPhone: !1,
          sendGetProactiveGeoData: !1,
          sendGetAvailableAgentList: !1,
          sendProactiveRoutingHashAndNumber: !1,
          preChatSearchSubmit: !1,
          callAssignNewAgent: !1,
          pollChat: !1,
          sendChatMessage: !0,
          sendChatAgentSurveyRating: !1,
          trackConversion: !1,
          sendClickToCall: !1,
          sendGetCallConfig: !1,
        },
        setBaseURL: function (a) {
          baseURL = a;
        },
        setStaticBaseURL: function (a) {
          staticBaseURL = a;
        },
        setLocale: function (a) {
          a && ((locale = a), a.length > 6 && (locale = a.substr(0, 5)));
        },
        startLink: function () {
          return (
            "proactive" !== SnapABug.getTypeOfChat() && SnapABug.startPreChat(),
            !1
          );
        },
        startChat: function (a) {
          return (
            (SnapABug._isReactiveChat = !0),
            expiredAccount
              ? void SnapABug.populateFormStatus(-2)
              : (this.preventProactiveChat(),
                this._hideButton(),
                chatInProgress ||
                  this.handleChatInProgress() ||
                  ((startChatRequested = !0),
                  (proactiveMsg = a),
                  this.sendGetWidgetConfig(!1)),
                !1)
          );
        },
        startCall: function () {
          return (
            (SnapABug._isReactiveChat = !0),
            expiredAccount
              ? void SnapABug.populateFormStatus(-2)
              : (this.preventProactiveChat(),
                chatInProgress ||
                  (this.showLoading(), this.sendGetCallConfig()),
                !1)
          );
        },
        setUserEmail: function (a, b) {
          if (a && "invalid@example.com" != a)
            try {
              email = a.replace(/^[\s\+]+|[\s\+]+$/g, "");
            } catch (a) {}
          1 == b && (emailLocked = !0),
            SnapABug.isCustomDesignEnabled() &&
              SnapABug.getCustomDesignUI().setUserEmail(email, b);
        },
        setDescription: function (a) {
          (description = a),
            SnapABug.isCustomDesignEnabled() &&
              SnapABug.getCustomDesignUI().setDescription(a);
        },
        setCustomField: function (a, b) {
          SnapABug.isCustomDesignEnabled() &&
            SnapABug.getCustomDesignUI().setCustomField(a, b);
        },
        setUserName: function (a) {
          if (a)
            try {
              userName = a.replace(/^[\s\+]+|[\s\+]+$/g, "");
            } catch (a) {}
          SnapABugChat.setUserAliasCookie(userName),
            SnapABug.isCustomDesignEnabled() &&
              SnapABug.getCustomDesignUI().setUserName(userName);
        },
        setButtonEffect: function (a) {
          (buttonPos = a), this.buttonOut();
        },
        setFormTopPosition: function (a) {
          formTopPos = a;
        },
        setChatFormPosition: function (a) {
          chatFormPos = a;
        },
        getChatFormPosition: function () {
          return SnapABug.isMobileEnabled()
            ? ""
            : SnapABug.isCustomDesignEnabled()
            ? ""
            : chatFormPos;
        },
        setDomain: function (a) {
          if ("" == widgetId)
            for (
              var b = a.replace(/\s+/g, "").split(","), c = 0;
              c < b.length;
              c++
            )
              if (b[c].length && document.location.href.indexOf(b[c]) != -1)
                return void (domain = b[c]);
        },
        setStartChat: function (a) {
          if ("string" == typeof a) startChatMessage = decodeURIComponent(a);
          else if (Array.isArray(a)) {
            var b,
              c = a.filter(function (a) {
                return a.type === MESSAGE_TYPES.TEXT;
              });
            c.length > 0 && (b = c[0]);
            var d = a.filter(function (a) {
                return a.type === MESSAGE_TYPES.BUTTON;
              }),
              e = b.text || "";
            (startChatMessage = e),
              (startChatOptions = {
                buttons: d,
              });
          } else console.warn("Invalid parameter");
        },
        getStartChat: function () {
          return startChatMessage;
        },
        getStartChatOptions: function () {
          return startChatOptions || {};
        },
        allowOffline: function (a) {
          offlineAllowed = a;
        },
        allowChat: function (a) {
          (chatAllowed = a), chatAllowed || (agentStatus = !1);
        },
        allowProactiveChat: function (a) {
          proactiveChatAllowed = a;
        },
        setWidgetId: function (a) {
          widgetId = a;
        },
        switchWidget: function (a, b) {
          return a
            ? (b &&
                SnapEngage.setCallback("agentOnline", function () {
                  b();
                }),
              this.setWidgetId(a),
              void this.sendGetWidgetConfig(!1))
            : (console.warn(
                'Please provide required parameter "newWidget" when using this API.'
              ),
              !1);
        },
        setMobileUI: function (a) {
          SnapEngage.isCustomDesignEnabled() &&
            SnapEngage.getCustomDesignUI().setMobileUI(a);
        },
        allowChatSound: function (a) {
          chatSound = 1 == a;
        },
        allowPageChangeNotification: function (a) {
          pageChangeNotificationAllowed = a;
        },
        allowChatHistory: function (a) {
          historyCookieEnabled = a;
        },
        clearAllCookies: function () {
          SnapABugChat.deleteChatCookies(),
            SnapABugChat.setCookie("SnapABugRef", "", 0),
            SnapABugChat.deleteCookie("SnapABugRef"),
            SnapABugChat.setCookie("SnapABugNoProactiveChat", "", 0),
            SnapABugChat.deleteCookie("SnapABugNoProactiveChat"),
            SnapABugChat.setCookie("SnapABugUserEmail", "", 0),
            SnapABugChat.deleteCookie("SnapABugUserEmail"),
            SnapABugChat.setCookie("SnapABugVisit", "", 0),
            SnapABugChat.deleteCookie("SnapABugVisit"),
            SnapABugChat.setCookie("SnapABugHistory", "", 0),
            SnapABugChat.deleteCookie("SnapABugHistory"),
            SnapABugChat.setCookie("SnapABugUserName", "", 0),
            SnapABugChat.deleteCookie("SnapABugUserName"),
            SnapABugChat.setCookie("SnapABugUserAlias", "", 0),
            SnapABugChat.deleteCookie("SnapABugUserAlias"),
            SnapABugChat.setCookie("isProactiveInvite", "", 0),
            SnapABugChat.deleteCookie("isProactiveInvite"),
            SnapABugChat.setCookie("SnapABugApproval", "", 0),
            SnapABugChat.deleteCookie("SnapABugApproval"),
            (email = ""),
            (userName = "");
        },
        sendTextToChat: function (a, b) {
          if (chatInProgress) {
            if ("visitor" !== b) return SnapABugChat.sendChatMessage(6, a), !0;
            (systemMsgId = "API_SYSTEM_MSG"),
              SnapABugChat.appendTextToChat("", a, !1, systemMsgId, !1, !0);
          }
          return !1;
        },
        openProactiveChat: function (a, b, c) {
          SnapABug.isCustomDesignEnabled() &&
            SnapABugChat.setIsForcedProactive(a),
            SnapEngage.getIsInstanceProactiveV2()
              ? SnapABug.openProactiveV2APICall(a, b, c)
              : SnapABug.openProactiveChatDo(a, b, c);
        },
        setNoProactiveChatDelay: function (a) {
          noProactiveChatDelay = a;
        },
        setVisitorCookieLifeTime: function (a) {
          visitorCookieLifeTime = a;
        },
        getVisitorCookieLifeTime: function () {
          return visitorCookieLifeTime;
        },
        getProactiveAutocloseDelay: function () {
          return proactiveAutocloseTimerDelay;
        },
        setProactiveAutocloseDelay: function (a) {
          proactiveAutocloseTimerDelay = a;
        },
        getIsInstanceProactiveV2: function () {
          return isInstanceProactiveV2;
        },
        setIsInstanceProactiveV2: function (a) {
          isInstanceProactiveV2 = a;
        },
        setChatHandledByBot: function (a) {
          chatHandledByBot = a;
        },
        getChatHandledByBot: function () {
          return chatHandledByBot;
        },
        setCallback: function (a, b) {
          switch (a.toLowerCase()) {
            case "open":
              callbackOpen = b;
              break;
            case "openproactive":
              callbackOpenProactive = b;
              break;
            case "messagesubmit":
              callbackMessageSubmit = b;
              break;
            case "startchat":
              callbackStartChat = b;
              break;
            case "chatmessagesent":
              callbackChatMessageSent = b;
              break;
            case "chatmessagereceived":
              callbackChatMessageReceived = b;
              break;
            case "beforecallme":
              callbackBeforeCallme = b;
              break;
            case "startcallme":
              callbackStartCallme = b;
              break;
            case "agentonline":
              null != b
                ? (callbackAgentOnline || (callbackAgentOnline = new Array()),
                  callbackAgentOnline.push(b))
                : (callbackAgentOnline = null);
              break;
            case "agentcommand":
              callbackAgentCommand = b;
              break;
            case "minimize":
              SnapEngage.getCustomDesignUI().callbackStore.setCallback(
                "minimize",
                b
              );
              break;
            case "switchwidget":
              SnapEngage.getCustomDesignUI().callbackStore.setCallback(
                "switchwidget",
                b
              );
              break;
            default:
              callbackManager.set(a, b);
          }
        },
        getAgentStatusAsync: function (a) {
          if (
            (this.setCallback("agentOnline", a), agentStatusLastCheck != -1)
          ) {
            var b = new Date(),
              c = b.getTime();
            0 == agentStatusLastCheck ||
            agentStatusLastCheck + 1e3 * agentStatusCheckInterval < c
              ? ((agentStatusLastCheck = -1), this.sendGetWidgetConfig(!1))
              : (this.callCallback("agentOnline", !!SnapABug.getAgentStatus()),
                this.setCallback("agentOnline", null));
          }
        },
        trackConversion: function (a) {
          var b = "ci=" + encodeURIComponent(dbCaseId);
          "" == dbCaseId && (b = "c=" + encodeURIComponent(caseId)),
            (b += "&a=" + encodeURIComponent(a)),
            this.rpc(
              baseURL + "/chatjs/ServiceTrackConversion?" + b,
              3,
              "trackConversion"
            );
        },
        setHideButtonAPIUsed: function (a) {
          hideButtonAPIUsed = a;
        },
        getHideButtonAPIUsed: function () {
          return hideButtonAPIUsed;
        },
        setShowButtonAPIUsed: function (a) {
          showButtonAPIUsed = a;
        },
        getShowButtonAPIUsed: function () {
          return showButtonAPIUsed;
        },
        _hideButton: function () {
          SnapABug.hideButton(!0);
        },
        hideButton: function (a) {
          if (SnapABug.isMobileEnabled() && !SnapABug.isChatInProgress())
            SnapABug.getMobileUI().hideTab();
          else if (SnapABug.isCustomDesignEnabled())
            return (
              a || SnapABug.setHideButtonAPIUsed(!0),
              SnapABug.getCustomDesignUI().hideTab()
            );
          var b = document.getElementById("SnapABug_bImg");
          b && (b.style.display = "none");
        },
        _showButton: function () {
          SnapABug.showButton(!0);
        },
        showButton: function (a) {
          SnapABug.isCustomDesignEnabled() &&
            (a ||
              (SnapABug.setHideButtonAPIUsed(!1),
              SnapABug.setShowButtonAPIUsed(!0)),
            SnapABug.getCustomDesignUI().checkStatusShowButton());
          var b = document.getElementById("SnapABug_bImg");
          b && (b.style.display = "inline");
        },
        disableLightbox: function () {
          lightboxColor = "";
        },
        updateCase: function (a) {
          this.sendUpdateCase(a);
        },
        getAgentStatus: function () {
          return agentStatus;
        },
        setLanguage: function (a) {
          var b = "en";
          a.indexOf("Dansk") !== -1
            ? (b = "da")
            : a.indexOf("Deutsch") !== -1
            ? (b = "de")
            : a.indexOf("Espa") !== -1
            ? (b = "es")
            : a.indexOf("Italiano") !== -1
            ? (b = "it")
            : a.indexOf("Suomi") !== -1
            ? (b = "fi")
            : a.indexOf("Fran") !== -1
            ? (b = "es")
            : a.indexOf("Hungarian") !== -1
            ? (b = "hu")
            : a.indexOf("Italiano") !== -1
            ? (b = "it")
            : a.indexOf("Hebrew") !== -1
            ? (b = "iw")
            : a.indexOf("Japanese") !== -1
            ? (b = "ja")
            : a.indexOf("Norsk") !== -1
            ? (b = "nb")
            : a.indexOf("Nederlands") !== -1
            ? (b = "nl")
            : a.indexOf("Polish") !== -1
            ? (b = "pl")
            : a.indexOf("Portugu") !== -1
            ? (b = "pt")
            : a.indexOf("Romana") !== -1
            ? (b = "ro")
            : a.indexOf("Slovak") !== -1
            ? (b = "sk")
            : a.indexOf("Svenska") !== -1
            ? (b = "sv")
            : a.indexOf("Turkish") !== -1
            ? (b = "tr")
            : a.indexOf("Simplified Chinese") !== -1 && (b = "zh"),
            this.setLocale(b);
        },
        isMobile: function () {
          try {
            return "undefined" != typeof window.snapengage_mobile
              ? navigator.userAgent.match(
                  /(iPhone|iPod|BlackBerry|Android|IEMobile)/
                )
              : navigator.userAgent.match(
                  /(iPhone|iPod|iPad|BlackBerry|Android|IEMobile)/
                );
          } catch (a) {
            return !1;
          }
        },
        init: function (a) {
          this.initWidget(a, !1, !1);
        },
        initAsync: function (a) {
          this.initWidget(a, !0, !1);
        },
        addButton: function (a, b, c, d) {
          if (
            "undefined" != typeof b &&
            "undefined" != typeof c &&
            !SnapABug.useMobileOptimized() &&
            !SnapABug.useCustomDesign()
          ) {
            switch (b) {
              case "0":
                buttonPosition = "left";
                break;
              case "1":
                buttonPosition = "right";
                break;
              case "2":
                buttonPosition = "top";
                break;
              case "3":
                buttonPosition = "bottom";
                break;
              default:
                buttonPosition = "left";
            }
            buttonOffset = c;
          }
          this.injectButton(a, d), this.init(a);
        },
        add: function (a, b, c, d, e, f, g) {
          if (
            ("function" == typeof window.__SUPER_SECRET_SETUP_FUNCTION &&
              window.__SUPER_SECRET_SETUP_FUNCTION(),
            this.setLocale(b),
            c &&
              d &&
              !SnapABug.useMobileOptimized() &&
              !SnapABug.useCustomDesign())
          ) {
            switch (c) {
              case "0":
                buttonPosition = "left";
                break;
              case "1":
                buttonPosition = "right";
                break;
              case "2":
                buttonPosition = "top";
                break;
              case "3":
                buttonPosition = "bottom";
                break;
              default:
                buttonPosition = "left";
            }
            (buttonOffset = d), this.injectButton(a, !1, !0, e, f);
          }
          this.initWidget(a, !0, g);
        },
        setButton: function (a, b, c) {
          (buttonImgUrl = a),
            (buttonWidth = b),
            (buttonHeight = c),
            (buttonPos = "0px");
        },
        getRpcErrorCallBack: function (a) {
          return SnapABug.RPC_ERROR_CALLBACK[a];
        },
        getBrowserIsOnline: function () {
          return window.navigator.onLine;
        },
        handleOfflineResend: function () {
          rpcSendOfflineMessage = !0;
          for (var a = 0; a < SnapABug.offlineRpcArray.length; a++)
            SnapABug.rpc(
              SnapABug.offlineRpcArray[a][0],
              SnapABug.offlineRpcArray[a][1],
              SnapABug.offlineRpcArray[a][2]
            );
          (SnapABug.offlineRpcArray = []), (rpcSendOfflineMessage = !1);
        },
        rpc: function (a, b, c) {
          return (
            (rpcUrl = a),
            a && a.length > 2e3 && (rpcUrl = a.substring(0, 2e3)),
            (SnapABug.rpcRetries[c] = b),
            this.getBrowserIsOnline() || "pollChat" === c
              ? (SnapABug.offlineRpcArray.length &&
                  "sendChatMessage" === c &&
                  !rpcSendOfflineMessage &&
                  SnapABug.offlineRpcArray.push([a, b, c]),
                this.getBrowserIsOnline() &&
                  SnapABug.offlineRpcArray.length &&
                  !rpcSendOfflineMessage &&
                  this.handleOfflineResend(),
                void this.doRpc(c))
              : void SnapABug.offlineRpcArray.push([a, b, c])
          );
        },
        doRpc: function (a, b) {
          b && (rpcUrl = b),
            YAHOO.util.Get.script(rpcUrl, {
              onFailure: function (b) {
                SnapABug.callbackError(!0, a, b.nodes[0].src);
              },
              onTimeout: function (b) {
                SnapABug.callbackError(!0, a, b.nodes[0].src);
              },
              timeout: 55e3,
            });
        },
        callbackError: function (a, b, c) {
          a && SnapABug.rpcRetries[b] > 0
            ? ((SnapABug.rpcRetries[b] = SnapABug.rpcRetries[b] - 1),
              this.doRpc(b, c))
            : SnapABug.getRpcErrorCallBack(b) && this.populateFormStatus(6);
        },
        getWindowWidth: function () {
          var a = 0;
          return (
            window.innerWidth
              ? (a = window.innerWidth)
              : self.innerWidth
              ? (a = self.innerWidth)
              : document.documentElement && document.documentElement.clientWidth
              ? (a = document.documentElement.clientWidth)
              : document.body && (a = document.body.clientWidth),
            a
          );
        },
        getWindowHeight: function () {
          var a = 0;
          return (
            window.innerHeight
              ? (a = window.innerHeight)
              : self.innerHeight
              ? (a = self.innerHeight)
              : document.documentElement &&
                document.documentElement.clientHeight
              ? (a = document.documentElement.clientHeight)
              : document.body && (a = document.body.clientHeight),
            a
          );
        },
        getOSBarHeight: function () {
          try {
            if (navigator.appVersion.indexOf("Win") !== -1) return 28;
            if (navigator.appVersion.indexOf("Mac") !== -1) return 75;
          } catch (a) {}
          return 0;
        },
        isIE6: function () {
          try {
            return navigator.userAgent.toLowerCase().indexOf("msie 6") !== -1;
          } catch (a) {
            return !1;
          }
        },
        isIE7: function () {
          try {
            return navigator.userAgent.toLowerCase().indexOf("msie 7") !== -1;
          } catch (a) {
            return !1;
          }
        },
        isIE8: function () {
          try {
            return navigator.userAgent.toLowerCase().indexOf("msie 8") !== -1;
          } catch (a) {
            return !1;
          }
        },
        isIE: function () {
          try {
            return navigator.appVersion.indexOf("MSIE") !== -1;
          } catch (a) {
            return !1;
          }
        },
        isIE11: function () {
          try {
            return (
              navigator.appVersion.indexOf("Trident") !== -1 &&
              navigator.userAgent.indexOf("rv:11") !== -1
            );
          } catch (a) {
            return !1;
          }
        },
        isQuirksMode: function () {
          return "CSS1Compat" !== document.compatMode;
        },
        isFirefox: function () {
          try {
            return navigator.userAgent.indexOf("Firefox") !== -1;
          } catch (a) {
            return !1;
          }
        },
        isSafari: function () {
          try {
            var a = navigator.userAgent.toLowerCase();
            return a.indexOf("safari") != -1 && a.indexOf("chrome") == -1;
          } catch (a) {
            return !1;
          }
        },
        useMobileOptimized: function () {
          return (
            "undefined" != typeof window.snapengage_mobile &&
            navigator.userAgent.match(
              /(iPhone|iPod|BlackBerry|Android|IEMobile)/
            )
          );
        },
        getMobileUI: function () {
          return mobileUI;
        },
        isMobileEnabled: function () {
          return null !== mobileUI;
        },
        useCustomDesign: function () {
          return "undefined" != typeof window.chat_custom_design;
        },
        getCustomDesignUI: function () {
          return customDesignUI;
        },
        isCustomDesignEnabled: function () {
          return null !== customDesignUI;
        },
        getCustomDesignIframe: function () {
          return document.getElementById(
            SnapABug.getCustomDesignUI().helpers.getIframeId()
          ).contentWindow.document;
        },
        isInArray: function (a, b) {
          if (a && b)
            for (var c = 0; c < b.length; c++) if (b[c] == a) return !0;
          return !1;
        },
        trim: function (a) {
          return a.replace(/^\s+|\s+$/g, "");
        },
        getDisplayInlineBlockCSS: function () {
          return SnapABug.isIE7()
            ? "display: inline;"
            : "display: inline-block;";
        },
        setChatInProgress: function (a) {
          chatInProgress = a;
        },
        isChatInProgess: function () {
          return SnapABug.isChatInProgress();
        },
        isChatInProgress: function () {
          return chatInProgress;
        },
        setCursorPosition: function (a, b) {
          try {
            if (!a) return !1;
            if (a.createTextRange) {
              var c = a.createTextRange();
              return (
                c.collapse(!0), c.moveEnd(b), c.moveStart(b), c.select(), !0
              );
            }
            if (a.setSelectionRange) return a.setSelectionRange(b, b), !0;
          } catch (a) {}
        },
        getBaseURL: function () {
          return baseURL;
        },
        getStaticBaseURL: function () {
          return staticBaseURL;
        },
        getUserEmail: function () {
          return email;
        },
        getEmailLocked: function () {
          return emailLocked;
        },
        getUserName: function () {
          return userName;
        },
        getCaseId: function () {
          return caseId;
        },
        setCaseId: function (a) {
          caseId = a;
        },
        getDbCaseId: function () {
          return dbCaseId;
        },
        getWidgetId: function () {
          return widgetId;
        },
        getCallMeButton: function () {
          return callmeButton;
        },
        setCallMePhone: function (a) {
          callmePhone = a;
        },
        getCallMePhone: function () {
          return callmePhone;
        },
        setEntryPageRefOverride: function (a) {
          entryPageRefOverride = a;
        },
        getEntryPageRef: function (a) {
          var b = decodeURIComponent(SnapABugChat.getCookie("SnapABugRef"));
          try {
            if (b && "" != b) {
              var c = b.split(" ")[1];
              return (
                !a && entryPageRefOverride && (c = entryPageRefOverride), c
              );
            }
          } catch (a) {}
          return "";
        },
        setEntryPageUrlOverride: function (a) {
          entryPageOverride = a;
        },
        getEntryPageUrl: function (a) {
          var b = decodeURIComponent(SnapABugChat.getCookie("SnapABugRef"));
          try {
            if (b && "" != b) {
              var c = b.split(" ")[0];
              return !a && entryPageOverride && (c = entryPageOverride), c;
            }
          } catch (a) {}
          return "";
        },
        getChatSoundAllowed: function () {
          return chatSound;
        },
        setEnableInternationalPhoneCalls: function (a) {
          SnapABug.enableInternationalPhoneCalls = a;
        },
        getEnableInternationalPhoneCalls: function () {
          return SnapABug.enableInternationalPhoneCalls;
        },
        preventProactiveChat: function () {
          SnapABugChat.proactiveRulesTimers.proactiveTimer &&
            (clearTimeout(SnapABugChat.proactiveRulesTimers.proactiveTimer),
            (proactiveMsg = ""),
            (proactiveNotify = !1),
            (SnapABugChat.proactiveRulesTimers.proactiveTimer = null)),
            (proactiveAgentNumber = ""),
            SnapABugChat &&
              (SnapABugChat.setNoProactiveChatCookie(),
              SnapABugChat.clearProactive());
        },
        getNoProactiveChatDelay: function () {
          return noProactiveChatDelay;
        },
        setCvval: function (a, b) {
          cvval[a] = b;
        },
        getLocale: function () {
          return locale;
        },
        getDirection: function () {
          return direction;
        },
        setDirection: function (a) {
          direction = a;
        },
        getTags: function () {
          return SnapABug.hasOptionsProperty("tags")
            ? SnapEngageOptions.tags
            : agentTags;
        },
        setTags: function (a) {
          agentTags = a;
        },
        appendTagsParameter: function (a) {
          return (
            SnapABug.hasOptionsProperty("tags")
              ? (a += "&tags=" + encodeURIComponent(SnapEngageOptions.tags))
              : null !== SnapABug.getTags() &&
                SnapABug.getTags().length > 0 &&
                (a += "&tags=" + encodeURIComponent(SnapABug.getTags())),
            a
          );
        },
        hasOptionsProperty: function (a) {
          return (
            "undefined" != typeof SnapEngageOptions &&
            Object.prototype.hasOwnProperty.call(SnapEngageOptions, a)
          );
        },
        callCallback: function (a, b, c, d) {
          try {
            switch (a.toLowerCase()) {
              case "open":
                return callbackOpen(b);
              case "openproactive":
                return callbackOpenProactive(b, c);
              case "messagesubmit":
                return callbackMessageSubmit(b, c);
              case "startchat":
                return callbackStartChat(b, c, d);
              case "chatmessagesent":
                return callbackChatMessageSent(b);
              case "chatmessagereceived":
                return callbackChatMessageReceived(b, c);
              case "beforecallme":
                return callbackBeforeCallme(b);
              case "startcallme":
                return callbackStartCallme(b);
              case "agentonline":
                for (var e = 0; e < callbackAgentOnline.length; e++)
                  callbackAgentOnline[e](b);
                return;
              case "agentcommand":
                return callbackAgentCommand(b);
              default:
                return callbackManager.trigger(a, b, c, d);
            }
          } catch (a) {}
        },
        openProactiveChatDo: function (a, b, c, d) {
          "1" != SnapABugChat.getBannedCookie() &&
            chatAllowed &&
            (chatInProgress ||
              (1 != a &&
                (SnapABugChat.isNoProactiveChatCookie() ||
                  SnapABugChat.getCookie("isProactiveInvite"))) ||
              (SnapABugChat.reInit(),
              SnapABugChat.proactiveRulesTimers.proactiveTimer &&
                clearTimeout(SnapABugChat.proactiveRulesTimers.proactiveTimer),
              (proactiveOfflineFallback = b),
              c && (proactiveMsg = c),
              SnapABug.sendGetProactiveChatAgent(!1, d)));
        },
        openProactiveV2APICall: function (a, b, c) {
          "1" != SnapABugChat.getBannedCookie() &&
            chatAllowed &&
            (chatInProgress ||
              (1 != a &&
                (SnapABugChat.isNoProactiveChatCookie() ||
                  SnapABugChat.getCookie("isProactiveInvite"))) ||
              (SnapABugChat.reInit(),
              (proactiveOfflineFallback = b),
              c
                ? ((proactiveMsg = c),
                  SnapABug.sendGetProactiveChatAgent(!1, -1))
                : null !== openProactiveChatAPIRule
                ? SnapABug.executeOpenProactiveChatAPIRule(
                    a,
                    b,
                    openProactiveChatAPIRule
                  )
                : currentEvaluationStep < 3 &&
                  SnapABug.setProactiveChatEvaluationFinishedCallback(
                    function () {
                      SnapABug.executeOpenProactiveChatAPIRule(
                        a,
                        b,
                        openProactiveChatAPIRule
                      );
                    }
                  )));
        },
        setProactiveChatEvaluationFinishedCallback: function (a) {
          proactiveChatEvaluationFinishedCallback = a;
        },
        clearProactiveChatEvaluationFinishedCallback: function (a) {
          proactiveChatEvaluationFinishedCallback = null;
        },
        executeProactiveChatEvaluationFinishedCallback: function () {
          "function" == typeof proactiveChatEvaluationFinishedCallback &&
            proactiveChatEvaluationFinishedCallback();
        },
        executeOpenProactiveChatAPIRule: function (a, b, c) {
          if (!waitingRPCResponce) {
            waitingRPCResponce = !0;
            var d = c && c.id ? c.id : -1;
            SnapABug.openProactiveChatDo(
              a,
              b,
              decodeURIComponent(c.message),
              d
            );
          }
        },
        initWidget: function (a, b, c) {
          if (
            ((widgetId = a),
            "undefined" != typeof SnapABugSecureCookies &&
              SnapABugChat.setSecureCookies(),
            SnapABug.useMobileOptimized()
              ? SnapABug.initMobile()
              : SnapABug.useCustomDesign()
              ? SnapABug.initCustomDesign()
              : this.injectDialog(b),
            !this.handleChatInProgress())
          ) {
            var d = decodeURIComponent(
              SnapABugChat.getCookie("SnapABugChatWindow")
            );
            "" !== d && SnapABugChat.setChatWindowCookieData("isMinimized", !1),
              SnapABugChat.proactiveRulesTimers.proactiveTimer ||
                c ||
                (SnapABugChat.proactiveRulesTimers.proactiveTimer = setTimeout(
                  "SnapABug.sendGetWidgetConfig(true);",
                  14e3
                ));
          }
          try {
            var e = SnapABugChat.getCookie("SnapABugRef");
            (e && "" != e) ||
              SnapABugChat.setCookie(
                "SnapABugRef",
                encodeURIComponent(
                  document.location.href + " " + document.referrer
                ),
                120
              );
          } catch (a) {}
          SnapABugChat.getVisitCookie() ||
            (SnapABugChat.setHistoryCookieIncrementVisits(),
            SnapABugChat.setInitialVisitCookie()),
            SnapABugChat.getCookie("isProactiveInvite") &&
              SnapABugChat.deleteCookie("isProactiveInvite"),
            (email = SnapABugChat.getUserEmailCookie()),
            SnapABug.setUserEmail(email),
            SnapABug.setUserName(SnapABugChat.getUserAliasCookie()),
            SnapABug.addOnResizeHandler(),
            SnapABugChat.incrementVisitCookie();
        },
        startPreChat: function () {
          if ((this.preventProactiveChat(), SnapABug.isMobileEnabled())) {
            if (expiredAccount) return;
            this.isChatInProgress()
              ? SnapABug.getMobileUI().showChat()
              : (SnapABug.getMobileUI().showPrechat(),
                SnapABug.callCallback("Open", "offline"));
          } else if (SnapABug.isCustomDesignEnabled()) {
            if (expiredAccount) return;
            SnapABug.getCustomDesignUI().minimizeView.isViewVisible()
              ? (SnapABug.getCustomDesignUI().minimizeChatBoxToggle(),
                SnapABug.getCustomDesignUI().minimizeController.minimizeClickToMaximize())
              : this.isChatInProgress() ||
                SnapABug.getCustomDesignUI().buttonController.buttonClick();
          } else {
            if (expiredAccount) return void SnapABug.populateFormStatus(-2);
            if (!this.isChatInProgress()) {
              if (
                this.getPreChatSearchEnabled() &&
                1 == this.getPreChatSearch()
              )
                return void SnapABug.startPreChatSearch();
              this.handleChatInProgress() ||
                ("" == startChatMessage
                  ? this.loadForm()
                  : this.startChat(startChatMessage),
                this.handleChatInProgress(),
                (callCallbackOpen = !0));
            }
          }
        },
        isSneakPeek: function () {
          return !1;
        },
        allowVisitorChatHistory: function (a) {
          visitorChatHistoryCookie = a;
        },
        getPreChatSearch: function () {
          return preChatSearchStatus;
        },
        setPreChatSearch: function (a) {
          preChatSearchStatus = a;
        },
        getDomain: function () {
          return domain;
        },
        getPageChangeNotificationAllowed: function () {
          return pageChangeNotificationAllowed;
        },
        setCountry: function (a) {
          country = a;
        },
        getCountry: function () {
          return country;
        },
        setProactiveChatAutocloseTimeout: function () {
          SnapABugChat.proactiveRulesTimers.proactiveAutocloseTimer &&
            clearTimeout(
              SnapABugChat.proactiveRulesTimers.proactiveAutocloseTimer
            );
          var a = SnapABug.isCustomDesignEnabled()
            ? "SnapABug.getCustomDesignUI().proactiveTimeout();"
            : "SnapABug.slideFormOut();";
          try {
            proactiveAutocloseTimerDelay &&
              (SnapABugChat.proactiveRulesTimers.proactiveAutocloseTimer = setTimeout(
                a,
                60 * proactiveAutocloseTimerDelay * 1e3
              ));
          } catch (a) {}
        },
        clearProactiveChatAutocloseTimeout: function () {
          SnapABugChat.proactiveRulesTimers.proactiveAutocloseTimer &&
            (clearTimeout(
              SnapABugChat.proactiveRulesTimers.proactiveAutocloseTimer
            ),
            (SnapABugChat.proactiveRulesTimers.proactiveAutocloseTimer = null));
        },
        handleChatInProgress: function () {
          if (SnapABugChat) {
            var a = SnapABugChat.getCaseIdCookie();
            if (null != a && "" != a && "closed" != a)
              return this.continueChat(a), !0;
          }
          return !1;
        },
        continueChat: function (a) {
          "" == caseId &&
            "" == dbCaseId &&
            ((chatInProgress = !0),
            (caseId = a),
            SnapABugChat.restartChat(caseId, baseURL),
            this._hideButton());
        },
        getVisitorCountry: function () {
          return visitorCountry ? visitorCountry : "";
        },
        setVisitorCountry: function (a) {
          visitorCountry = a;
        },
        setUseCustomCallMeButton: function (a) {
          SnapABug.useCustomCallMeButton = a;
        },
        getUseCustomCallMeButton: function () {
          return SnapABug.useCustomCallMeButton;
        },
        enableCallMe: function () {
          if (SnapABug.isCustomDesignEnabled())
            this.getCustomDesignUI().enableCallMeOption();
          else {
            callmeButton =
              '<div style="' +
              this.getCSS(
                void 0,
                void 0,
                78,
                16,
                "overflow:hidden;cursor:pointer;cursor:hand;"
              ) +
              '"  onclick="SnapABug.clickedCallMe(); return true;"><img style="position:relative;margin:0;border:none;padding:0;" src="' +
              SnapABug.getStaticBaseURL() +
              '/wbg/callme_en.png" border="0" alt="Call me now" width="72" height="32" onmouseover="this.style.top=\'-16px\';" onmouseout="this.style.top=\'0px\';" /></div>';
            var a = document.getElementById("SnapABug_CallMe");
            a &&
              (SnapABug.getUseCustomCallMeButton()
                ? (a.style.display = "block")
                : (a.innerHTML = callmeButton));
          }
        },
        disableCallMe: function () {
          if (SnapABug.isCustomDesignEnabled())
            SnapABug.getCustomDesignUI().removeCallMeOption();
          else {
            callmeButton = "";
            var a = document.getElementById("SnapABug_CallMe");
            a &&
              (SnapABug.getUseCustomCallMeButton()
                ? (a.style.display = "none")
                : (a.innerHTML = callmeButton));
          }
        },
        clickedCallMe: function () {
          this.callCallback("BeforeCallme", "") ||
            SnapABugChat.populateCallMeForm();
        },
        disableButton: function (a) {
          document.getElementById(a) &&
            (document.getElementById(a).disabled = !0);
        },
        injectDialog: function (a) {
          var b = "";
          if (
            ((SnapABug.styleTag = document.getElementById("SnapABug_Style")),
            !SnapABug.styleTag)
          ) {
            (SnapABug.styleTag = document.createElement("style")),
              (SnapABug.styleTag.id = "SnapABug_Style"),
              (SnapABug.styleTag.type = "text/css"),
              SnapABug.styleTag.styleSheet
                ? (SnapABug.styleTag.styleSheet.cssText = b)
                : SnapABug.styleTag.appendChild(document.createTextNode(b));
            var c = document.head || document.getElementsByTagName("head")[0];
            c.appendChild(SnapABug.styleTag),
              SnapABug.addStyleRule(
                [
                  "#SnapABug_WP",
                  "div",
                  "span",
                  "iframe",
                  "h1",
                  "h2",
                  "h3",
                  "h4",
                  "h5",
                  "h6",
                  "hr",
                  "p",
                  "a",
                  "big",
                  "em",
                  "img",
                  "q",
                  "small",
                  "strong",
                  "b",
                  "u",
                  "i",
                  "fieldset",
                  "input",
                  'input[type="submit"]',
                  "button",
                  "textarea",
                  "form",
                  "label",
                ],
                "margin: 0; padding: 0; border: 0; font-size: 100%; font: inherit; font-weight: normal; vertical-align: baseline; float: none;max-width: none; max-height: none; letter-spacing: normal; line-height: normal;text-transform: none;-webkit-transform: none; -moz-transform: none; -ms-transform: none; -o-transform: none; transform: none; -webkit-transition-property: none; -moz-transition-property: none; -o-transition-property: none; transition: none;-webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none;font-feature-settings: normal; -webkit-font-feature-settings: normal; -moz-font-feature-settings: normal; -ms-font-feature-settings: normal; -o-font-feature-settings: normal; "
              ),
              SnapABug.addStyleRule(["*:before", "*:after"], "display:none;"),
              SnapABug.addStyleRule(
                ["img"],
                "" + SnapABug.getDisplayInlineBlockCSS()
              );
          }
          var d =
              "position:fixed;_position:absolute;display:none;top:0%;_top:expression(eval(document.body.scrollTop));left:0px;width:100%;height:100%;text-align:left;z-index:2147483644;margin:0;padding:0;border-collapse:collapse;border-spacing:0;border:none;list-style:none;text-align:left;font-size:100%;font-weight:normal;outline:none;background-image:url('" +
              SnapABug.getBlankImg() +
              "');background-repeat:repeat;",
            e =
              "position:fixed;_position:absolute;display:none;z-index:2147483645;overflow:hidden;margin:0;padding:0;border-collapse:collapse;border-spacing:0;border:none;list-style:none;outline:none;",
            f =
              '<div id="SnapABug_O" style="position:absolute;width:100%;height:100%;top:0px;left:0px;text-align:left;z-index:auto;-moz-opacity:0.5;opacity:.50;filter:alpha(opacity=50);background-color:' +
              lightboxColor +
              ';"></div>',
            g =
              '<div id="SnapABug_P" style="position:absolute;left:0px;top:0px;margin:0;padding:0;border:none;text-align:left;z-index:1;overflow:hidden;background-color:transparent;"></div><div id="SnapABug_IP" style="position:absolute;left:0px;top:0px;z-index:0;"></div><div id="SnapABug_DB" style="position:absolute;left:0px;top:0px;margin:0;border:0;padding:0;z-index:1;cursor:move;background-image:url(\'' +
              SnapABug.getBlankImg() +
              "');background-repeat:repeat;\"></div>";
          if (a) {
            var h = document.getElementById("SnapABug_W");
            h ||
              ((h = document.createElement("div")),
              (h.id = "SnapABug_W"),
              document.body.appendChild(h));
            var i = document.getElementById("SnapABug_WP");
            i ||
              ((i = document.createElement("div")),
              (i.id = "SnapABug_WP"),
              document.body.appendChild(i));
            try {
              h.setAttribute("style", d), i.setAttribute("style", e);
            } catch (a) {}
            try {
              (h.style.cssText = d), (i.style.cssText = e);
            } catch (a) {}
            (h.innerHTML = f),
              (i.innerHTML = g + SnapABug.soundNotificationDiv());
          } else
            try {
              console.log(
                "ERROR: SnapEngage code is setup in a legacy no longer supported mode. Contact support for assistance."
              );
            } catch (a) {}
        },
        addStyleRule: function (a, b) {
          if (SnapABug.styleTag) {
            var c = "",
              d = 1 + "SnapABug".length + 3,
              e = "";
            if ("string" == typeof a)
              (c = "#SnapABug_WP" !== a.substr(0, d) ? "#SnapABug_WP " : ""),
                (e = c + a + " { " + b + " } ");
            else if ("object" == typeof a && "undefined" != typeof a.length) {
              for (var f = 0; f < a.length; f++)
                (c =
                  "#SnapABug_WP" !== a[f].substr(0, d) ? "#SnapABug_WP " : ""),
                  (e += c + a[f]),
                  f !== a.length - 1 && (e += ", ");
              e += "{ " + b + " } ";
            }
            SnapABug.styleTag.styleSheet
              ? (SnapABug.styleTag.styleSheet.cssText += e)
              : (SnapABug.styleTag.textContent += e);
          }
        },
        setMobileSettings: function (a) {
          mobileStyle = a;
        },
        initMobile: function () {
          mobileUI ||
            (null === mobileStyle && (mobileStyle = {}),
            (mobileStyle.staticUrl = staticBaseURL + "/m"),
            (mobileUI = new window.snapengage_mobile.SnapEngageMobileClient(
              mobileStyle
            )),
            mobileUI.init(),
            setTimeout(function () {
              mobileUI.showTab();
            }, 1e3),
            mobileUI.allowOffline(offlineAllowed));
        },
        setCustomDesignSettings: function (a) {
          customDesignStyle = a;
        },
        initCustomDesign: function () {
          customDesignUI ||
            (null === customDesignStyle && (customDesignStyle = {}),
            (customDesignUI = new window.chat_custom_design.SnapEngageCustomDesign(
              customDesignStyle
            )),
            customDesignUI.init());
        },
        soundNotificationDiv: function () {
          return SnapABug.hasFlash()
            ? '<div id="SnapABug_Snd" style="width:0px;height:0px;font-size:0px;margin:0;padding:0;background-color:transparent;"></div>'
            : (SnapABug.allowChatSound(!1), "");
        },
        positionDragger: function (a, b, c, d) {
          var e = document.getElementById("SnapABug_DB");
          (e.style.left = a + "px"),
            (e.style.top = b + "px"),
            (e.style.width = c + "px"),
            (e.style.height = d + "px");
        },
        moveForm: function (a, b) {
          var c = document.getElementById("SnapABug_WP");
          a < 0 && (a = 0),
            a > SnapABug.getWindowWidth() - c.offsetWidth &&
              (a = SnapABug.getWindowWidth() - c.offsetWidth),
            b < 0 && (b = 0),
            b > SnapABug.getWindowHeight() - c.offsetHeight &&
              (b = SnapABug.getWindowHeight() - c.offsetHeight),
            (c.style.left = a + "px"),
            (c.style.top = b + "px"),
            (SnapABug.formPosX = a),
            (SnapABug.formPosY = b);
        },
        setupDraggerHandler: function () {
          try {
            var a = document.getElementById("SnapABug_WP"),
              b = document.getElementById("SnapABug_DB");
            (b.onmousedown = function (a) {
              if (
                ((SnapABug.dragging = !0),
                document.getElementById && !document.all)
              )
                (SnapABug.dragFromX = a.pageX), (SnapABug.dragFromY = a.pageY);
              else {
                var b =
                  document.compatMode && "BackCompat" != document.compatMode
                    ? document.documentElement
                    : document.body;
                (SnapABug.dragFromX = event.clientX + b.scrollLeft),
                  (SnapABug.dragFromY = event.clientY + b.scrollTop);
              }
              return !1;
            }),
              onmouseupInstalled ||
                onmouseupPrev ||
                !document.onmouseup ||
                "function" != typeof document.onmouseup ||
                (onmouseupPrev = document.onmouseup),
              (onmouseupInstalled = !0),
              (document.onmouseup = function (a) {
                if (
                  SnapABug.dragging &&
                  (SnapABug.formPosX > -1 || SnapABug.formPosY > -1)
                ) {
                  var b = [SnapABug.formPosX, -1, SnapABug.formPosY, -1];
                  SnapABug.calculateAndSetInViewportPosition(b);
                }
                SnapABug.dragging = !1;
                try {
                  onmouseupPrev && onmouseupPrev(a);
                } catch (a) {}
              }),
              onmousemoveInstalled ||
                onmousemovePrev ||
                !document.onmousemove ||
                "function" != typeof document.onmousemove ||
                (onmousemovePrev = document.onmousemove),
              (onmousemoveInstalled = !0),
              (document.onmousemove = function (b) {
                if (SnapABug.dragging) {
                  var c = 0,
                    d = 0;
                  if (document.getElementById && !document.all)
                    (c = a.offsetLeft + b.pageX - SnapABug.dragFromX),
                      (d = a.offsetTop + b.pageY - SnapABug.dragFromY),
                      (SnapABug.dragFromX = b.pageX),
                      (SnapABug.dragFromY = b.pageY);
                  else {
                    var e =
                      document.compatMode && "BackCompat" != document.compatMode
                        ? document.documentElement
                        : document.body;
                    (c =
                      a.offsetLeft +
                      event.clientX +
                      e.scrollLeft -
                      SnapABug.dragFromX),
                      (d =
                        a.offsetTop +
                        event.clientY +
                        e.scrollTop -
                        SnapABug.dragFromY),
                      (SnapABug.dragFromX = event.clientX + e.scrollLeft),
                      (SnapABug.dragFromY = event.clientY + e.scrollTop);
                  }
                  SnapABug.moveForm(c, d);
                  try {
                    onmousemovePrev && onmousemovePrev(b);
                  } catch (a) {}
                  return !1;
                }
                try {
                  onmousemovePrev && onmousemovePrev(b);
                } catch (a) {}
                return !0;
              });
          } catch (a) {}
        },
        injectButton: function (a, b, c, d, e) {
          "https:" === document.location.protocol &&
            (d && (d = d.replace("http://", "https://")),
            e && (e = e.replace("http://", "https://")));
          var f,
            g = "",
            h = buttonOffset;
          f =
            "%" == h.substr(h.length - 1, 1)
              ? "left" == buttonPosition || "right" == buttonPosition
                ? Math.round(
                    (h.substr(0, h.length - 1) * this.getWindowHeight()) / 100
                  )
                : Math.round(
                    (h.substr(0, h.length - 1) * this.getWindowWidth()) / 100
                  )
              : h.substr(0, h.length - 2);
          var i = "";
          if (
            (b || "" != buttonImgUrl || (i = this.getMessage(0)),
            d && e && d == e)
          )
            (buttonImgUrl = d), (buttonWidth = -1), (buttonHeight = -1);
          else if (b || (d && e)) {
            var j =
              "w=" +
              a +
              "&rand=" +
              encodeURIComponent(
                Math.floor(4294967295 * Math.random()).toString(16)
              );
            (j = SnapABug.appendTagsParameter(j)),
              (buttonImgUrl = baseURL + "/statusImage?" + j),
              (buttonWidth = -1),
              (buttonHeight = -1),
              d &&
                e &&
                (buttonImgUrl +=
                  "&on=" +
                  encodeURIComponent(d) +
                  "&off=" +
                  encodeURIComponent(e));
          } else if (
            "" == buttonImgUrl &&
            ((buttonImgUrl =
              staticBaseURL + "/btn/help_" + buttonPosition + "_" + locale),
            (buttonImgUrl += this.isIE6() ? ".gif" : ".png"),
            "top" == buttonPosition || "bottom" == buttonPosition)
          ) {
            var k = buttonWidth;
            (buttonWidth = buttonHeight), (buttonHeight = k);
          }
          switch (buttonPosition) {
            case "left":
              g +=
                "body .SnapABug_Button{cursor:pointer;cursor:hand;overflow:hidden;position:fixed;_position:absolute;display:block;top:" +
                h +
                ";_top:expression(eval(document.body.scrollTop)+" +
                f +
                ");left:0px;z-index:2147000000;margin:0;padding:0;border-collapse:collapse;border-spacing:0;border:none;outline:none;font-size:0px;line-height:0px;}";
              break;
            case "right":
              g +=
                "body .SnapABug_Button{cursor:pointer;cursor:hand;overflow:hidden;position:fixed;_position:absolute;display:block;top:" +
                h +
                ";_top:expression(eval(document.body.scrollTop)+" +
                f +
                ");right:0px;z-index:2147000000;margin:0;padding:0;border-collapse:collapse;border-spacing:0;border:none;outline:none;font-size:0px;line-height:0px;}";
              break;
            case "top":
              g +=
                "body .SnapABug_Button{cursor:pointer;cursor:hand;overflow:hidden;position:fixed;_position:absolute;display:block;top:0px;left:" +
                h +
                ";_left:expression(eval(document.body.scrollLeft)+" +
                f +
                ");z-index:2147000000;margin:0;padding:0;border-collapse:collapse;border-spacing:0;border:none;outline:none;font-size:0px;line-height:0px;}";
              break;
            case "bottom":
              g +=
                "body .SnapABug_Button{cursor:pointer;cursor:hand;overflow:hidden;position:fixed;_position:absolute;display:block;bottom:0px;left:" +
                h +
                ";_left:expression(eval(document.body.scrollLeft)+" +
                f +
                ");z-index:2147000000;margin:0;padding:0;border-collapse:collapse;border-spacing:0;border:none;outline:none;font-size:0px;line-height:0px;}";
          }
          g += " @media print{body .SnapABug_Button{display:none;}}";
          var l = "";
          buttonWidth > 0 &&
            buttonHeight > 0 &&
            (l = 'width="' + buttonWidth + '" height="' + buttonHeight + '"');
          var m =
            '<img id="SnapABug_bImg" style="position:relative;" src="' +
            buttonImgUrl +
            '" alt="' +
            i +
            '" border="0" ' +
            l +
            ' onmouseover="SnapABug.buttonOver();" onmouseout="SnapABug.buttonOut();" />';
          if (c) {
            var n = document.getElementsByTagName("head")[0],
              o = document.createElement("style");
            (o.type = "text/css"),
              o.styleSheet
                ? (o.styleSheet.cssText = g)
                : o.appendChild(document.createTextNode(g)),
              n.appendChild(o);
            var p = document.getElementById("SnapABug_Button");
            p ||
              ((p = document.createElement("div")),
              (p.id = "SnapABug_Button"),
              (p.className = "SnapABug_Button"),
              (p.onclick = SnapABug.startLink),
              document.body.appendChild(p)),
              (p.innerHTML = m);
          } else
            try {
              console.log(
                "ERROR: SnapEngage code is setup in a legacy no longer supported mode. Contact support for assistance."
              );
            } catch (a) {}
          this.buttonOut();
        },
        buttonOver: function () {
          var a = document.getElementById("SnapABug_bImg").style;
          switch (buttonPosition) {
            case "left":
              a.left = "0px";
              break;
            case "right":
              a.right = "0px";
              break;
            case "top":
              a.top = "0px";
              break;
            case "bottom":
              a.bottom = "0px";
          }
          this.preloadLoadingImg();
        },
        buttonOut: function () {
          try {
            var a = document.getElementById("SnapABug_bImg").style;
            switch (buttonPosition) {
              case "left":
                a.left = buttonPos;
                break;
              case "right":
                a.right = buttonPos;
                break;
              case "top":
                a.top = buttonPos;
                break;
              case "bottom":
                a.bottom = buttonPos;
            }
          } catch (a) {}
        },
        showForm: function (a, b, c, d, e, f, g) {
          (SnapABug.formWidth = b), (SnapABug.formHeight = c);
          var h = document.getElementById("SnapABug_P"),
            i = document.getElementById("SnapABug_IP"),
            j = document.getElementById("SnapABug_WP"),
            k = document.getElementById("SnapABug_W"),
            l = document.getElementById("SnapABug_O");
          (j.style.width = b + "px"),
            (j.style.height = c + "px"),
            (h.style.width = b + "px"),
            (h.style.height = c + "px"),
            (i.style.left = d + "px"),
            (i.style.top = e + "px"),
            (i.style.width = f + "px"),
            (i.style.height = g + "px"),
            (j.style.display = "block"),
            (h.style.display = "block"),
            f > 0 && g > 0
              ? (i.style.display = "block")
              : (i.style.display = "none"),
            a && "" != lightboxColor
              ? ((k.style.display = "block"),
                (l.style.display = "block"),
                (l.style.width = this.getWindowWidth() + "px"),
                (l.style.height = this.getWindowHeight() + "px"))
              : ((k.style.display = "none"), (l.style.display = "none"));
          var m = [-1, -1, -1, -1];
          SnapABugChat.isFirstInit() && SnapABug.formPosX && SnapABug.formPosY
            ? ((m[0] = SnapABug.formPosX), (m[2] = SnapABug.formPosY))
            : (m = this.getDefaultChatPosition(a)),
            (i.innerHTML =
              '<iframe width="100%" height="100%" frameborder="0" src="' +
              SnapABug.getBaseURL() +
              '/empty.html"></iframe>'),
            SnapABug.positionForm(m[0], m[1], m[2], m[3]),
            this.setupDraggerHandler();
        },
        getDefaultChatPosition: function (a) {
          if (!SnapABug.isCustomDesignEnabled()) {
            var b = -1,
              c = -1,
              d = -1,
              e = -1;
            switch (SnapABug.getChatFormPosition()) {
              case "tl":
                (c = 0), (d = 0);
                break;
              case "tr":
                (b = 0), (d = 0);
                break;
              case "bl":
                (c = 0), (e = 0);
                break;
              case "br":
              default:
                (b = 0), (e = 0);
            }
            if (a || "c" === SnapABug.getChatFormPosition()) {
              var f = document.getElementById("SnapABug_P");
              (b = -1),
                (e = -1),
                (c = Math.round(this.getWindowWidth() / 2 - f.offsetWidth / 2)),
                c <= 0 && (c = 0),
                0 !== formTopPos
                  ? (d = formTopPos)
                  : ((d = Math.round(
                      this.getWindowHeight() / 2 - f.offsetHeight / 2
                    )),
                    d <= 0 && (d = 0));
            }
            return [c, b, d, e];
          }
        },
        positionForm: function (a, b, c, d, e) {
          if (!SnapABug.isAnimating() || e) {
            var f = document.getElementById("SnapABug_WP");
            if (this.isIE6()) {
              var g = document.documentElement.scrollTop
                  ? document.documentElement.scrollTop
                  : document.body.scrollTop,
                h = document.documentElement.scrollLeft
                  ? document.documentElement.scrollLeft
                  : document.body.scrollLeft;
              c
                ? (f.style.top = g + c + "px")
                : (f.style.top =
                    g + SnapABug.getWindowHeight() - d - f.offsetHeight + "px"),
                a
                  ? (f.style.left = h + a + "px")
                  : (f.style.left =
                      h + SnapABug.getWindowWidth() - b - f.offsetWidth + "px");
            } else
              (f.style.top = c != -1 ? c + "px" : ""),
                (f.style.bottom = d != -1 ? d + "px" : ""),
                (f.style.left = a != -1 ? a + "px" : ""),
                (f.style.right = b != -1 ? b + "px" : "");
          }
        },
        getPositionArray: function () {
          for (
            var a = document.getElementById("SnapABug_WP"),
              b = [
                parseInt(a.style.left, 10),
                parseInt(a.style.right, 10),
                parseInt(a.style.top, 10),
                parseInt(a.style.bottom, 10),
              ],
              c = 0;
            c < b.length;
            c++
          )
            isNaN(b[c]) && (b[c] = -1);
          return b;
        },
        debounce: function (a, b, c) {
          var d,
            e,
            f,
            g,
            h,
            i = function () {
              var j = new Date().getTime() - g;
              j < b && j >= 0
                ? (d = setTimeout(i, b - j))
                : ((d = null), c || ((h = a.apply(f, e)), d || (f = e = null)));
            };
          return function () {
            (f = this), (e = arguments), (g = new Date().getTime());
            var j = c && !d;
            return (
              d || (d = setTimeout(i, b)),
              j && ((h = a.apply(f, e)), (f = e = null)),
              h
            );
          };
        },
        addOnResizeHandler: function () {
          function a(a) {
            if (chatInProgress) {
              var c = b.getPositionArray();
              b.isOutsideViewport(c) && b.calculateAndSetInViewportPosition(c);
            }
          }
          if (
            !SnapABug.isMobileEnabled() &&
            !SnapABug.isCustomDesignEnabled()
          ) {
            var b = this,
              c = this.debounce(a, 100);
            if (window.addEventListener)
              window.addEventListener("resize", c, 0);
            else if (window.attachEvent) window.attachEvent("onresize", c);
            else {
              var d = window.onresize,
                e = function (a) {
                  c(a), d && d(a);
                };
              window.onresize = e;
            }
          }
        },
        isOutsideViewport: function (a) {
          return (
            SnapABug.isOutsideViewportEdgeTop(a) ||
            SnapABug.isOutsideViewportEdgeRight(a) ||
            SnapABug.isOutsideViewportEdgeBottom(a)
          );
        },
        isOutsideViewportEdgeTop: function (a) {
          return SnapABug.formHeight > SnapABug.getWindowHeight() || a[2] < -1;
        },
        isOutsideViewportEdgeRight: function (a) {
          if (SnapABug.formWidth > SnapABug.getWindowWidth()) return !0;
          var b = a[0],
            c = b + SnapABug.formWidth;
          return SnapABug.getWindowWidth() < c;
        },
        isOutsideViewportEdgeBottom: function (a) {
          var b = a[2],
            c = b + SnapABug.formHeight;
          return SnapABug.getWindowHeight() < c;
        },
        calculateAndSetInViewportPosition: function (a) {
          function b(a) {
            return (
              SnapABugChat.setChatWindowCookieData("chatBoxPosition", a),
              SnapABug.positionForm(a[0], a[1], a[2], a[3]),
              a
            );
          }
          if (!SnapABug.isOutsideViewport(a)) return b(a);
          var c = 0,
            d = 1,
            e = 2,
            f = 3,
            g = [-1, -1, -1, -1],
            h = !1,
            i = !1;
          return (
            SnapABug.isOutsideViewportEdgeTop(a) && ((g[e] = 0), (i = !0)),
            SnapABug.isOutsideViewportEdgeRight(a) && ((g[d] = 0), (h = !0)),
            !i &&
              SnapABug.isOutsideViewportEdgeBottom(a) &&
              ((g[f] = 0), (i = !0)),
            i || ((g[e] = a[e]), (g[f] = a[f])),
            h || ((g[c] = a[c]), (g[d] = a[d])),
            b(g)
          );
        },
        isAnimating: function (a) {
          return "undefined" != typeof a && (animating = a), animating;
        },
        slideFormOut: function () {
          if (!caseId && !dbCaseId) {
            for (
              var a = SnapABug.getWindowWidth(),
                b = document.getElementById("SnapABug_WP"),
                c = b.offsetLeft,
                d = b.offsetTop,
                e = 20,
                f = 1e3,
                g = 0,
                h = 0;
              h < e;
              h++
            )
              (g =
                c > a / 2
                  ? c + (a - c) * (1 - Math.cos((h * Math.PI) / e / 2))
                  : c -
                    (c + SnapABug.formWidth) *
                      (1 - Math.cos((h * Math.PI) / e / 2))),
                0 == h &&
                  (SnapABug.isAnimating(!0),
                  setTimeout("SnapABug.isAnimating(false);", f)),
                setTimeout(
                  "SnapABug.positionForm(" + g + ", -1, " + d + ", -1, true);",
                  (h * f) / e
                );
            setTimeout("SnapABug.closeForm(true);", f);
          }
        },
        slideFormIn: function () {
          for (
            var a = SnapABug.getWindowWidth(),
              b = document.getElementById("SnapABug_WP"),
              c = b.offsetLeft,
              d = b.offsetTop,
              e = 20,
              f = 600,
              g = 0,
              h = 0;
            h < e;
            h++
          )
            if (
              ((g =
                c > a / 2
                  ? c + (a - c) * (1 - Math.sin((h * Math.PI) / e / 2))
                  : c -
                    (c + SnapABug.formWidth) *
                      (1 - Math.sin((h * Math.PI) / e / 2))),
              0 == h)
            ) {
              SnapABug.positionForm(g, -1, d, -1),
                SnapABug.isAnimating(!0),
                setTimeout("SnapABug.isAnimating(false);", f);
              var i = SnapABug.getDefaultChatPosition();
              setTimeout(
                "SnapABug.positionForm(" +
                  i[0] +
                  "," +
                  i[1] +
                  "," +
                  i[2] +
                  "," +
                  i[3] +
                  ");",
                f + 1
              );
            } else
              setTimeout(
                "SnapABug.positionForm(" + g + ", -1, " + d + ", -1, true);",
                (h * f) / e
              );
        },
        getCSS: function (a, b, c, d, e, f) {
          var g =
            ";position:absolute;display:block;margin:0;padding:0;border:none;float:none;clear:none;";
          return (
            void 0 != a && (g += "left:" + a + "px;"),
            void 0 != b && (g += "top:" + b + "px;"),
            void 0 != c &&
              (g +=
                "width:" +
                c +
                "px;max-width:" +
                c +
                "px;min-width:" +
                c +
                "px;"),
            void 0 != d &&
              (g +=
                "height:" +
                d +
                "px;max-height:" +
                d +
                "px;min-height:" +
                d +
                "px;"),
            (g +=
              "z-index:2;background-color:transparent;background:none;font-style:normal;font-weight:normal;font-size:100%;line-height:normal;text-shadow:none;list-style:none;" +
              ("" == direction ? "text-align:left;" : "text-align:right;") +
              "outline:none;text-indent:0px;-moz-box-shadow:none;-webkit-box-shadow:none;" +
              direction),
            void 0 != e && (g += e.replace(/"/g, "'")),
            void 0 != f && (g += f.replace(/"/g, "'")),
            g
          );
        },
        getSystemMessageCSS: function (a, b, c, d, e, f) {
          return (
            SnapABug.getCSS(a, b, c, d, e, f) +
            "position: relative; background-color: #D5E8EA; border: 1px solid #D5E8EA; border-radius: 4px; -moz-border-radius: 4px; -webkit-border-radius: 4px; margin: 5px 0px; font-size: .9em; display: inline-block;"
          );
        },
        getBlankImg: function () {
          return this.isIE6()
            ? staticBaseURL + "/wbg/blank.gif"
            : staticBaseURL + "/wbg/blank.gif";
        },
        preloadLoadingImg: function () {
          if (!waitImgLoaded) {
            waitImgLoaded = !0;
            var a = new Image();
            a.src = staticBaseURL + "/wbg/loading.gif";
          }
        },
        showLoading: function () {
          (document.getElementById("SnapABug_P").innerHTML =
            '<div style="position:absolute;left:0;top:0;z-index:1;"><img src="' +
            staticBaseURL +
            '/wbg/loading.gif" style="' +
            this.getCSS(0, 0, 31, 31) +
            '" galleryimg="no" width="31" height="31" border="0" alt="Loading..." /></div>'),
            this.showForm(!0, 31, 31, 0, 0, 0, 0);
        },
        loadForm: function () {
          this.showLoading();
          var a = new Image();
          return (
            (a.onload = function () {
              SnapABug.populateForm();
            }),
            (a.src = bgURL),
            !1
          );
        },
        getSnapABugSiteUrl: function () {
          return (
            "https://www.snapengage.com/partner?src=widget&amp;id=" +
            widgetId +
            "&amp;l=" +
            SnapABug.getLocale()
          );
        },
        getLogoClickATag: function () {
          var a = SnapABugChat.getPageTitle(!1).toLowerCase(),
            b = a.indexOf("live chat") != -1 || a.indexOf("online chat") != -1;
          return (
            '<a href="' +
            SnapABug.getSnapABugSiteUrl() +
            '" target="_blank" style="text-indent:0px;border:none;"' +
            (b ? "" : ' rel="nofollow"') +
            ">"
          );
        },
        logoLink: function () {
          return (
            "e5277a72-aea3-4184-b8eb-f056273a52e9" !== widgetId &&
            "e09b64f1-5bf5-415d-8fc0-1a633f5f01b5" !== widgetId &&
            "40277fbf-4da8-4569-8ea2-573323e291f6" !== widgetId &&
            "9e7310f0-e8a4-4210-9033-98d3ef28f95c" !== widgetId &&
            logoLinkEnabled
          );
        },
        getInvisibleDivIEFixCSS: function () {
          return 'background-color: #ffffff;-ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";filter: alpha(opacity=0);-moz-opacity: 0;-khtml-opacity: 0;opacity: 0;';
        },
        initMinimizeArea: function (a, b, c, d) {
          if (!SnapABug.isQuirksMode()) {
            "undefined" ==
              typeof SnapABugChat.getChatWindowCookieData("isMinimized") &&
              SnapABugChat.setChatWindowCookieData("isMinimized", !1),
              (SnapABugChat.minimizedDimensions = [a, b, c, d]);
            var e = document.getElementById("SnapABug_RB");
            if (!e) {
              (e = document.createElement("div")),
                (e.id = "SnapABug_RB"),
                SnapABug.addStyleRule(
                  "#SnapABug_WP #SnapABug_RB",
                  "position: absolute; z-index: 12; cursor: pointer; left: " +
                    a +
                    "px; top: " +
                    b +
                    "px; width: " +
                    c +
                    "px; height: " +
                    d +
                    "px; display: none;" +
                    SnapABug.getInvisibleDivIEFixCSS()
                ),
                SnapABug.addStyleRule(
                  "#SnapABug_WP.minimized #SnapABug_RB",
                  "display: block;"
                );
              try {
                e.setAttribute("onclick", "SnapEngageChat.minimizeToggle()");
              } catch (a) {}
              try {
                e.onclick = function () {
                  SnapABugChat.minimizeToggle();
                };
              } catch (a) {}
              document.getElementById("SnapABug_WP").appendChild(e);
            }
          }
        },
        initMinimizeNotification: function (a, b, c, d, e, f, g, h, i) {
          if (!SnapABug.isQuirksMode()) {
            var j = document.getElementById("SnapABug_WP"),
              k = document.getElementById("SnapABug_NMN"),
              l = document.getElementById("SnapABug_NMNi");
            k || ((k = document.createElement("div")), (k.id = "SnapABug_NMN")),
              l ||
                ((l = document.createElement("span")),
                (l.id = "SnapABug_NMNi")),
              (a = a ? a : 0),
              (b = b ? b : 0),
              (c = c ? c : 25),
              (d = d ? d : 20),
              (g = g ? g : "#FF0000"),
              (f = f ? f : 3),
              (i = i ? i : ""),
              (e = e ? e : 16),
              (h = h ? h : "#FFFFFF");
            var m =
                "display: none; position: absolute; left:" +
                a +
                "px; top:" +
                b +
                "px; z-index: 2; font-size:" +
                e +
                "px; text-align: center; cursor: pointer;  background-color: " +
                g +
                "; color: " +
                h +
                "; -webkit-border-radius:" +
                f +
                "px; border-radius:" +
                f +
                "px;" +
                i,
              n =
                SnapABug.getDisplayInlineBlockCSS() +
                " box-sizing: border-box;  color: " +
                h +
                "; font-size: 1em; font-weight: bold; padding:0 0.3em;",
              o = d === c,
              p = (d / e).toFixed(4);
            n += o
              ? " line-height:" + p + "em; min-width:" + p + "em;"
              : " line-height:" + d + "px; min-width:" + c + "px;";
            try {
              k.setAttribute("style", m),
                k.setAttribute("onclick", "SnapEngageChat.minimizeToggle()"),
                l.setAttribute("style", n);
            } catch (a) {}
            try {
              (k.style.cssText = m),
                (k.onclick = function () {
                  SnapABugChat.minimizeToggle();
                }),
                (l.style.cssText = n);
            } catch (a) {}
            j.appendChild(k), k.appendChild(l);
          }
        },
        initChatBoxMenuButton: function (a, b, c, d, e, f, g, h) {
          if (
            !(
              SnapABug.isQuirksMode() ||
              SnapABug.isIE6() ||
              SnapABug.isIE7() ||
              SnapABug.isIE8()
            )
          ) {
            var i = document.getElementById("SnapABug_WP"),
              j = document.getElementById("SnapABug_CBMBtn"),
              k = document.getElementById("SnapABug_CBMBtnI");
            if (!j) {
              if (
                ((j = document.createElement("div")),
                (j.id = "SnapABug_CBMBtn"),
                k ||
                  ((k = document.createElement("i")),
                  (k.id = "SnapABug_CBMBtnI")),
                j.appendChild(k),
                !menuButtonStylesAdded)
              ) {
                if (
                  ((a = a ? a : SnapABug.formWidth - 30),
                  (b = b ? b : 10),
                  (c = c ? c : 20),
                  (d = d ? d : 20),
                  (e = e ? e : "black"),
                  (f = f ? f : "transparent"),
                  (extraCSS = g ? g : ""),
                  (SnapABugChat._chatMenuButtonHeight = d),
                  h)
                )
                  SnapABug.menuButtonIconSpriteSheetURL = h;
                else {
                  var l =
                    SnapABug.getStaticBaseURL() + "/wbg/minBtn_sprites_v2_";
                  switch (e) {
                    case "white":
                    case "#FFFFFF":
                    case "#ffffff":
                      SnapABug.menuButtonIconSpriteSheetURL = l + "white2x.png";
                      break;
                    case "black":
                    case "#000000":
                    default:
                      SnapABug.menuButtonIconSpriteSheetURL = l + "black2x.png";
                  }
                }
                var m = "position: absolute; z-index: 2;";
                SnapABug.addStyleRule(
                  "#SnapABug_CBMBtn",
                  m +
                    "left:" +
                    a +
                    "px; top:" +
                    b +
                    "px; width:" +
                    c +
                    "px; height:" +
                    d +
                    "px; cursor: pointer; display: block; background-color: " +
                    f +
                    "; color: " +
                    e +
                    "; " +
                    g
                ),
                  SnapABug.addStyleRule(
                    ["#SnapABug_WP:not(.minimized) #SnapABug_CBMBtn:hover"],
                    "border-bottom-left-radius: 0; border-bottom-right-radius: 0;"
                  ),
                  SnapABug.addStyleRule(
                    "#SnapABug_CBMBtn>i",
                    m +
                      "right:0px; top:0px; width:20px; height:20px; background-image: url(" +
                      SnapABug.menuButtonIconSpriteSheetURL +
                      "); background-size: 40px 80px; background-repeat: no-repeat; background-position: " +
                      SnapABug.getIconCoords("chevron-down") +
                      ";"
                  ),
                  SnapABug.addStyleRule(
                    "#SnapABug_WP.minimized #SnapABug_CBMBtn>i",
                    "background-position: " +
                      SnapABug.getIconCoords("chevron-up") +
                      ";"
                  ),
                  SnapABug.addStyleRule(["#SnapABug_CBM"], "display:none;");
              }
              i.appendChild(j);
            }
          }
        },
        initChatBoxMenu: function (a, b, c, d, e, f) {
          if (!SnapABug.isQuirksMode()) {
            var g = document.getElementById("SnapABug_CBMBtn");
            if (g) {
              var h = document.getElementById("SnapABug_CBM");
              if (!h) {
                (h = document.createElement("div")), (h.id = "SnapABug_CBM");
                var i = document.getElementById("SnapABug_CBMHoverHelper");
                if (!i) {
                  if (
                    ((i = document.createElement("div")),
                    (i.id = "SnapABug_CBMHoverHelper"),
                    !menuStylesAdded)
                  ) {
                    var j,
                      k,
                      l,
                      m =
                        SnapABug.getStaticBaseURL() + "/wbg/minBtn_sprites_v2_";
                    switch (
                      ((a = a ? a : ""),
                      (extraCSS = e ? e : ""),
                      (c = c ? c : "#000000"))
                    ) {
                      case "white":
                      case "#FFFFFF":
                      case "#ffffff":
                        (j = "#FFFFFF"),
                          (k = d ? d : "#555555"),
                          (l = b ? b : "#000000"),
                          (SnapABug.menuIconSpriteSheetURL = f
                            ? f
                            : m + "white2x.png");
                        break;
                      case "black":
                      case "#000000":
                      default:
                        (j = "#000000"),
                          (k = d ? d : "#EEEEEE"),
                          (l = b ? b : "#FFFFFF"),
                          (SnapABug.menuIconSpriteSheetURL = f
                            ? f
                            : m + "black2x.png");
                    }
                    var n = "position: absolute; z-index: 2;",
                      o = 3;
                    SnapABug.addStyleRule(
                      [
                        "#SnapABug_CBMBtn:hover #SnapABug_CBM:hover",
                        "#SnapABug_CBMBtn:hover #SnapABug_CBM",
                        "#SnapABug_CBMBtn #SnapABug_CBM:hover",
                      ],
                      "display:block;"
                    ),
                      SnapABug.addStyleRule(
                        "#SnapABug_CBM",
                        n +
                          (a ? "width: " + a + "; " : "") +
                          "padding: 1px " +
                          o +
                          "px; border-radius: 1px;top: " +
                          SnapABugChat._chatMenuButtonHeight +
                          "px; right: 0px; background: " +
                          l +
                          "; color: " +
                          j +
                          "; border: thin solid " +
                          k +
                          ";-webkit-box-shadow: 0 1px 4px 0 " +
                          j +
                          ";        box-shadow: 0 1px 4px 0 " +
                          j +
                          "; " +
                          extraCSS
                      ),
                      SnapABug.addStyleRule(
                        ".SnapABug_CBMItem",
                        "position:relative; height: 20px; width: 100%;"
                      ),
                      SnapABug.addStyleRule(
                        ".SnapABug_CBMItem:hover",
                        "background-color: " + k + ";"
                      ),
                      SnapABug.addStyleRule(
                        ".SnapABug_CBMItem span",
                        "font-size: 14px; white-space: nowrap; padding-left: 10px;padding-right:26px;"
                      ),
                      SnapABug.addStyleRule(
                        ".SnapABug_CBMItem i",
                        "" +
                          SnapABug.getDisplayInlineBlockCSS() +
                          "position:absolute; top:0; right:0; height: 20px; width: 20px; background-size: 40px 80px;"
                      ),
                      SnapABug.addStyleRule(
                        ".SnapABug_CBMItemSplitter",
                        "height:0; width: 90%; margin: 0px auto;  border-bottom: thin solid " +
                          c +
                          ";clear: both;opacity: 0.15; -ms-filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=15);filter: alpha(opacity=15);"
                      ),
                      SnapABug.addStyleRule(
                        "#SnapABug_closeBtn",
                        "margin-top: 3px;"
                      ),
                      SnapABug.addStyleRule(
                        "#SnapABug_minBtn",
                        "margin-bottom: 3px;"
                      ),
                      SnapABug.addStyleRule(
                        ["#SnapABug_CBMHoverHelper"],
                        "display: block;position: absolute;top: -" +
                          SnapABugChat._chatMenuButtonHeight +
                          "px;left: -" +
                          o +
                          "px;height: " +
                          SnapABugChat._chatMenuButtonHeight +
                          "px;width: 100%;" +
                          SnapABug.getInvisibleDivIEFixCSS()
                      );
                  }
                  var p = SnapABug.appendMenuItem(
                    h,
                    "SnapABug_minBtn",
                    SnapABug.getMessage(36),
                    "div",
                    SnapABug.getIconCoords("minimize"),
                    "SnapABugChat.minimizeToggle();"
                  );
                  p && SnapABug.appendMenuSplitter(h),
                    SnapABug.appendMenuItem(
                      h,
                      "SnapABug_closeBtn",
                      SnapABug.getMessage(37),
                      "div",
                      SnapABug.getIconCoords("close"),
                      "SnapABug.closeForm();"
                    ),
                    g.appendChild(h),
                    h.appendChild(i);
                }
              }
            }
          }
        },
        appendMenuItem: function (
          chatBoxMenu,
          id,
          label,
          elemType,
          iconCoords,
          onClickFunc
        ) {
          if (null !== document.getElementById(id)) return !1;
          var newElem = document.createElement(elemType),
            newElemLabel = document.createElement("span"),
            newElemIcon = document.createElement("i");
          (newElem.id = id),
            (newElem.className = "SnapABug_CBMItem"),
            (newElemIconCSS =
              "background-image: url('" +
              SnapABug.menuIconSpriteSheetURL +
              "'); background-repeat: no-repeat; background-position: " +
              iconCoords +
              ";"),
            (newElemLabel.innerHTML = label);
          try {
            newElem.setAttribute("onclick", onClickFunc),
              newElemIcon.setAttribute("style", newElemIconCSS);
          } catch (a) {}
          try {
            (newElem.onclick = function () {
              eval(onClickFunc);
            }),
              newElemIcon.style || (newElemIcon.style.cssText = newElemIconCSS);
          } catch (a) {}
          return (
            newElem.appendChild(newElemLabel),
            newElem.appendChild(newElemIcon),
            chatBoxMenu.appendChild(newElem),
            !0
          );
        },
        appendMenuSplitter: function (a) {
          var b = document.createElement("div");
          (b.className = "SnapABug_CBMItemSplitter"), a.appendChild(b);
        },
        getIconCoords: function (a) {
          switch (a) {
            case "chevron-down":
              return "0 0";
            case "chevron-up":
              return "0 -20px";
            case "minimize":
              return "0 -40px";
            case "close":
              return "0 -60px";
            default:
              return "-100px -100px";
          }
        },
        hideChatBoxMenu: function () {
          var a = document.getElementById("SnapABug_WP"),
            b = document.getElementById("SnapABug_CBMBtn");
          b && a.removeChild(b);
        },
        setRequiredMark: function (a, b) {
          (requiredColor = a || "#FF0000"), (requiredMarker = b || "*");
        },
        getRequiredMark: function () {
          return requiredColor && requiredMarker
            ? '<span class="SnapABug_RequiredMark" style="color:' +
                requiredColor +
                ';">' +
                requiredMarker +
                "</span>"
            : "";
        },
        showRequiredMarks: function () {
          function a(a) {
            var b = a.getElementsByTagName("span");
            if (0 === b.length) return !1;
            for (var c = !1, d = 0; d < b.length; d++)
              if (b[d].className.indexOf("SnapABug_RequiredMark") !== -1) {
                c = !0;
                break;
              }
            return c;
          }
          if (requiredColor && requiredMarker) {
            var b = document.getElementById("SnapABug_email"),
              c = document.getElementById("SnapABug_desc");
            chatEmailRequired &&
              b &&
              !a(b) &&
              (b.innerHTML += " " + SnapABug.getRequiredMark()),
              chatDescriptionRequired &&
                c &&
                !a(c) &&
                (c.innerHTML += " " + SnapABug.getRequiredMark());
          }
        },
        isBranded: function () {
          return !0;
        },
        populateForm: function () {
          SnapABug.setRequiredMark();
          var a = 375,
            b = 386,
            c = "";
          emailLocked && (c = 'readonly="1" disabled="1"'),
            "" == email &&
              "" != SnapABugChat.getUserEmailCookie() &&
              (email = SnapABugChat.getUserEmailCookie());
          var d =
              '<div style="left:0;top:0;z-index:1;"><img src="' +
              bgURL +
              '" style="' +
              this.getCSS(0, 0, a, b) +
              '" galleryimg="no" width="' +
              a +
              '" height="' +
              b +
              '" /></div><div id="SnapABug_H" style="position:absolute;left:37px;top:126px;width:200px;z-index:100000;font-family:arial,sans-serif;text-align:left;color:white;background-color:#67a8f3;border:4px solid white;padding:4px;font-size:9pt;display:none;"></div><form name="SnapABug_Form" accept-charset="UTF-8" style="margin:0px;" action="#" onsubmit="return SnapABug.submitForm(false);"><div id="SnapABug_email" style="' +
              this.getCSS(
                34,
                41,
                300,
                20,
                "font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;font-weight:600;color:#61656d;"
              ) +
              '">' +
              this.getMessage(1) +
              "</div><div><input " +
              c +
              ' style="' +
              this.getCSS(
                58,
                67,
                276,
                17,
                'font-family:"lucida grande","Helvetica Neue",Helvetica,Arial,sans-serif;font-size:13px;color:black;',
                "background-image:url('" +
                  this.getBlankImg() +
                  "');background-repeat:repeat;"
              ) +
              '" type="text" id="email" name="email" value="' +
              email +
              '" size="10"/></div><div id="SnapABug_desc" style="' +
              this.getCSS(
                34,
                103,
                300,
                20,
                "font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;font-weight:600;color:#61656d;"
              ) +
              '">' +
              this.getMessage(2) +
              '</div><div><textarea name="description" style="' +
              this.getCSS(
                37,
                126,
                297,
                143,
                "font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;font-size:13px;color:black;",
                "background-image:url('" +
                  this.getBlankImg() +
                  "');background-repeat:repeat;resize:none;overflow:auto;"
              ) +
              '">' +
              description +
              "</textarea></div>",
            e = "#ffffff",
            f = "#c7c9c7",
            g = "#a0a1a0",
            h = "10px",
            i = "#51555d",
            j = "#303030",
            k =
              "font-weight:400;float:none;clear:none;width:auto;height:25px;margin:0 0px 0 4px;cursor:pointer;border:1px solid " +
              g +
              ";background-color:" +
              f +
              ";" +
              (this.isIE()
                ? "filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=" +
                  e +
                  ",endColorstr=" +
                  f +
                  ");"
                : "background:-webkit-gradient(linear, left top, left bottom,from(" +
                  e +
                  "),to(" +
                  f +
                  "));background:-moz-linear-gradient(top," +
                  e +
                  "," +
                  f +
                  ");") +
              "padding:3px 5px;width:auto;overflow:visible;-webkit-border-radius:" +
              h +
              ";-moz-border-radius:" +
              h +
              ";border-radius:" +
              h +
              ";color:" +
              i +
              ";font-size:12px;font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;text-decoration:none;vertical-align:middle;",
            l =
              "onmouseover=\"this.style.color='" +
              j +
              "';\" onmouseout=\"this.style.color='" +
              i +
              "';\"";
          d +=
            '<div id="SnapABug_FormButtons" style="' +
            this.getCSS(100, 311, 232, 30) +
            ';text-align:right;"><input id="SnapABug_OSB" onclick="return SnapABug.submitForm(false);" style="' +
            k +
            'display:none;" type="button" value="' +
            this.getMessage(12) +
            '" ' +
            l +
            ' /><input id="SnapABug_OCB" onclick="return SnapABug.submitForm(true);" style="' +
            k +
            'display:none;font-weight:bold;" type="button" value="' +
            this.getMessage(13) +
            '" ' +
            l +
            ' /><input id="SnapABug_SB" onclick="return SnapABug.submitForm(false);" style="' +
            k +
            'font-weight:bold;" type="button" value="' +
            this.getMessage(12) +
            '" ' +
            l +
            ' /></div></form><div id="SnapABug_FormFbk" style="' +
            this.getCSS(
              35,
              349,
              298,
              18,
              "font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;color:#61656d;"
            ) +
            '"><span id="SnapABug_FormFbkT"></span> <a id="SnapABug_FormFbkL" target="_blank" href="#" style="color:#333;font-weight:bold;font-size:12px;"></a></div>';
          var m = 20,
            n = 20;
          (d +=
            '<div style="' +
            this.getCSS(344, 10, m, n, "cursor:pointer;") +
            '" onclick="SnapABug.closeForm();" title="' +
            this.getMessage(10) +
            '"><img style="margin:0;border:none;padding:0;width:' +
            m +
            "px;height:" +
            n +
            'px;" src="' +
            this.getBlankImg() +
            '" width="' +
            m +
            '" height="' +
            n +
            '" alt="' +
            this.getMessage(10) +
            '" /></div>'),
            this.isBranded() &&
              ((d += '<div style="' + this.getCSS(34, 311, 84, 24) + '">'),
              this.logoLink() && (d += SnapABug.getLogoClickATag()),
              (d +=
                '<img style="margin:0;border:none;padding:0;" src="' +
                staticBaseURL +
                '/wbg/logo.png" border="0" alt="powered by SnapEngage" width="84" height="24" />'),
              this.logoLink() && (d += "</a>"),
              (d += "</div>")),
            (document.getElementById("SnapABug_P").innerHTML = d),
            this.sendGetWidgetConfig(!1),
            SnapABug.positionDragger(0, 0, 338, 42),
            this.showForm(!0, a, b, 13, 13, 341, 358),
            this.showFeedback(),
            this.updateFormButtons();
          var o = document.SnapABug_Form;
          return (
            o && ("" == email ? o.email.focus() : o.description.focus()), !1
          );
        },
        updateFormButtons: function () {
          if (expiredAccount)
            return void (
              (document.getElementById("SnapABug_OCB") ||
                document.getElementById("SnapABug_OSB") ||
                document.getElementById("SnapABug_CL")) &&
              SnapABug.populateFormStatus(-2)
            );
          try {
            var a = document.getElementById("SnapABug_SB"),
              b = document.getElementById("SnapABug_OSB"),
              c = document.getElementById("SnapABug_OCB");
            agentStatus
              ? (a && (a.style.display = "none"),
                offlineAllowed && b && (b.style.display = "inline"),
                c && (c.style.display = "inline"))
              : (a && (a.style.display = "inline"),
                b && (b.style.display = "none"),
                c && (c.style.display = "none"));
          } catch (a) {}
        },
        showFeedback: function () {
          try {
            var a = document.getElementById("SnapABug_FormFbk");
            a &&
              (fbkText || fbkLinkText
                ? ((document.getElementById(
                    "SnapABug_FormFbkT"
                  ).innerHTML = fbkText),
                  (document.getElementById("SnapABug_FormFbkL").href = fbkLink),
                  (document.getElementById(
                    "SnapABug_FormFbkL"
                  ).innerHTML = fbkLinkText),
                  (a.style.display = "block"))
                : (a.style.display = "none"));
          } catch (a) {}
        },
        populateFormStatus: function (a) {
          if (SnapABug.isMobileEnabled() || SnapABug.isCustomDesignEnabled())
            return (
              4 === a && chatInProgress && SnapABugChat
                ? SnapABugChat.startChat(caseId, baseURL)
                : (6 !== a && 7 !== a) ||
                  SnapABug.getCustomDesignUI().initErrorMessage(),
              !1
            );
          var b = this.getMessage(9),
            c =
              '<div style="margin-top:30px;background:white;width:100%;border:none;text-align:left;"><div id="SnapABug_PB" style="background:#61656d;width:' +
              Math.round((100 * a) / 4) +
              '%;height:20px;border:none;text-align:left;"></div></div>';
          if (
            (1 == a
              ? (b = this.getMessage(6))
              : 4 == a
              ? (b = this.getMessage(7))
              : 5 == a
              ? (b = this.getMessage(7) + "..")
              : 6 == a
              ? (b = this.getMessage(8))
              : 7 == a
              ? (b = this.getMessage(11))
              : a == -2 &&
                (b = "Sorry, this SnapEngage account is currently inactive"),
            (4 == a || 5 == a) && chatInProgress && SnapABugChat)
          )
            return SnapABugChat.startChat(caseId, baseURL), !1;
          var d = "",
            e = logoLinkEnabled;
          if (
            (4 == a || 5 == a || 6 == a || 7 == a || a == -2
              ? ((d = "SnapABug.closeForm();"),
                (c =
                  '<div style="text-align:middle;margin-top:20px;"><input type="button" value="' +
                  this.getMessage(10) +
                  '" onclick="' +
                  d +
                  '" style="float:none;clear:none;width:auto;height:28px;margin:0;padding:3px 5px 3px 5px;font-size:12px;font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;cursor:pointer;" /></div>'))
              : (logoLinkEnabled = !1),
            (!SnapABug.isMobileEnabled() &&
              !SnapABug.isCustomDesignEnabled() &&
              !chatInProgress &&
              "" == callmePhone) ||
              6 == b ||
              7 == b ||
              b == -2)
          ) {
            var f =
                '<div style="margin:50px 20px;font-size:14px;font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;color:#61656d !important;">' +
                b +
                c +
                "</div>",
              g = SnapABug.getChatFormPosition();
            SnapABug.setChatFormPosition("c"),
              SnapABugChat.populateSubChatForm(f, d),
              SnapABug.setChatFormPosition(g);
          }
          logoLinkEnabled = e;
        },
        updateFormStatusBar: function (a, b) {
          var c = document.getElementById("SnapABug_PB");
          c &&
            (c.style.width = Math.round((100 * a) / 4 + (100 * b) / 4) + "%");
        },
        closeForm: function (a) {
          var b = chatInProgress,
            c = "",
            d = "";
          ready &&
            (this.hideOverlay(!1),
            chatInProgress
              ? (SnapABugChat.closeChat(!0), (chatInProgress = !1))
              : SnapABugChat.reInit()),
            SnapABugChat && 1 != a && SnapABugChat.setNoProactiveChatCookie(),
            (SnapABug.proactiveAgentNumber = ""),
            SnapABugChat.clearProactive(),
            SnapABugChat.isMinimized() && SnapABugChat.unminimizeChat(),
            SnapABug.hideChatBoxMenu(),
            this._showButton(),
            1 != a &&
              ((c =
                "proactive" === SnapABug.getTypeOfChat()
                  ? "proactive"
                  : b
                  ? "chat"
                  : "form"),
              (d = agentStatus ? "online" : "offline"),
              SnapABug.callCallback("Close", c, d));
        },
        getTypeOfChat: function () {
          return SnapABug.isCustomDesignEnabled()
            ? SnapABug.getCustomDesignUI().getTypeOfChat()
            : SnapABug._isReactiveChat
            ? "manual"
            : SnapABugChat.isProactive()
            ? "proactive"
            : "manual";
        },
        hideOverlay: function (a) {
          SnapABug.isCustomDesignEnabled() ||
            (a ||
              (document.getElementById("SnapABug_W").style.display = "none"),
            (document.getElementById("SnapABug_O").style.display = "none"),
            (document.getElementById("SnapABug_P").style.display = "none"),
            (document.getElementById("SnapABug_WP").style.display = "none"),
            window.scrollBy(1, 0),
            window.scrollBy(-1, 0));
        },
        submitForm: function (a) {
          var b = document.SnapABug_Form;
          if (b) {
            (webCapture = b.screenshot && b.screenshot.checked),
              (sshot = 0),
              b.screenshot && (sshot = b.screenshot.checked ? 1 : 2),
              "" == labelColor
                ? (labelColor = document.getElementById("SnapABug_email").style
                    .color)
                : ((document.getElementById(
                    "SnapABug_email"
                  ).style.color = labelColor),
                  (document.getElementById(
                    "SnapABug_desc"
                  ).style.color = labelColor));
            var c = !1;
            if (cvvalRequired)
              try {
                for (var d = cvvalRequired.split(","), e = 0; e < d.length; e++)
                  "undefined" == typeof cvval[d[e]] || "" == cvval[d[e]]
                    ? ((document.getElementById(
                        "SnapABug_" + d[e]
                      ).style.color = "red"),
                      (c = !0),
                      b[d[e]].focus())
                    : (document.getElementById(
                        "SnapABug_" + d[e]
                      ).style.color = labelColor);
              } catch (a) {}
            "" != b.description.value ||
              (a && !chatDescriptionRequired) ||
              ((document.getElementById("SnapABug_desc").style.color = "red"),
              b.description.focus(),
              (c = !0));
            var f = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            0 != f.test(b.email.value) ||
              (a && !chatEmailRequired) ||
              ((document.getElementById("SnapABug_email").style.color = "red"),
              b.email.focus(),
              (c = !0)),
              c ||
                ((ready = !1),
                SnapABugChat.setUserEmailCookie(b.email.value),
                (email = b.email.value),
                b.Name && (userName = b.Name.value),
                this.sendCreateCase(b.email.value, b.description.value, a) ||
                  ((document.getElementById("SnapABug_desc").style.color =
                    "red"),
                  b.description.focus(),
                  (ready = !0)));
          }
          return !1;
        },
        startChatGo: function () {
          agentStatus
            ? SnapABugChat.proactive(
                proactiveMsg,
                !1,
                "",
                "",
                proactiveCommands
              )
            : ((startChatMessage = ""), this.startLink()),
            (startChatRequested = !1);
        },
        getStartChatRequested: function () {
          if (startChatRequested) return proactiveMsg;
        },
        sendClickToCall: function (a, b) {
          var c = "ci=" + encodeURIComponent(dbCaseId);
          "" == dbCaseId && (c = "c=" + encodeURIComponent(caseId)),
            (c += "&p=" + encodeURIComponent(a) + "&src=" + b),
            this.rpc(
              baseURL + "/chatjs/ServiceClickToCall?" + c,
              3,
              "sendClickToCall"
            ),
            this.callCallback("StartCallme", a);
        },
        callbackClickToCall: function (a) {},
        sendGetCallConfig: function () {
          var a = "w=" + encodeURIComponent(widgetId);
          this.rpc(
            baseURL + "/chatjs/ServiceGetCallConfig?" + a,
            3,
            "sendGetCallConfig"
          );
        },
        callbackGetCallConfig: function (a) {
          a > 0
            ? SnapABugChat.populateCallMeForm()
            : ((startChatMessage = ""), this.startLink());
        },
        sendGetWidgetConfig: function (a) {
          if (!widgetId)
            return (
              console.error(
                "Cannot continue due to missing widgetId.  Please refresh and try again."
              ),
              SnapEngage.setCallback("agentOnline", null),
              this.populateFormStatus(6),
              !1
            );
          var b = "w=" + encodeURIComponent(widgetId);
          a && (b += "&p=1"),
            (b = SnapABug.appendTagsParameter(b)),
            this.rpc(
              baseURL + "/chatjs/ServiceGetConfig?" + b,
              3,
              "sendGetWidgetConfig"
            );
        },
        callbackGetWidgetConfig: function (a, b, c, d, e, f, g, h, i) {
          if (
            ((agentStatus = a),
            SnapABug.isMobileEnabled() &&
              SnapABug.getMobileUI().setRequiredFields(g, h),
            a == -1)
          )
            return (
              SnapABug._hideButton(),
              void (
                SnapABug.isCustomDesignEnabled() &&
                this.callCallback("agentOnline", !!a)
              )
            );
          if (a == -2)
            return (
              (expiredAccount = !0),
              (logoLinkEnabled = !1),
              void (
                (document.getElementById("SnapABug_OCB") ||
                  document.getElementById("SnapABug_OSB") ||
                  document.getElementById("SnapABug_CL") ||
                  startChatRequested) &&
                SnapABug.populateFormStatus(-2)
              )
            );
          ("1" != SnapABugChat.getBannedCookie() && chatAllowed) ||
            ((agentStatus = 0),
            SnapABug.isCustomDesignEnabled() &&
              SnapABug.getCustomDesignUI().checkStatusShowButton()),
            this.callCallback("agentOnline", !!a),
            this.setCallback("agentOnline", null);
          var j = new Date(),
            k = j.getTime();
          (agentStatusLastCheck = k),
            (agentStatusCheckInterval *= 1.1),
            i &&
              i > 0 &&
              !SnapABugChat.isNoProactiveChatCookie() &&
              !SnapEngage.getIsInstanceProactiveV2() &&
              (SnapABugChat.proactiveRulesTimers.proactiveTimer &&
                clearTimeout(SnapABugChat.proactiveRulesTimers.proactiveTimer),
              i <= 15
                ? SnapABug.sendGetProactiveChatAgent()
                : ((i -= 15),
                  (SnapABugChat.proactiveRulesTimers.proactiveTimer = setTimeout(
                    "SnapABug.sendGetProactiveChatAgent(false);",
                    1e3 * i
                  )))),
            SnapABug.isCustomDesignEnabled() || this.updateFormButtons(),
            (chatEmailRequired = g),
            (chatDescriptionRequired = h),
            SnapABug.showRequiredMarks(),
            (fbkText = b),
            (fbkLink = d),
            (fbkLinkText = c),
            this.showFeedback(),
            startChatRequested &&
              (this.startChatGo(),
              a &&
                (SnapABug.callCallback("Open", "online"),
                visitorFirstMessage &&
                  SnapABug.sendCreateCase("", visitorFirstMessage, !0),
                SnapABug.getPreChatSearchEnabled() &&
                  SnapABug.resetPreChatSearch())),
            callCallbackOpen &&
              document.getElementById("SnapABug_OCB") &&
              (SnapABug.callCallback("Open", a ? "online" : "offline"),
              (callCallbackOpen = !1),
              SnapABug.getPreChatSearchEnabled() &&
                SnapABug.resetPreChatSearch());
        },
        preReqestChatAgent: function () {
          SnapABug.isChatInProgess() ||
            0 === agentStatus ||
            ((sendGetProactiveChatAgentForIsBotOnly = !0),
            SnapABug.sendGetProactiveChatAgent());
        },
        getFunctionStack: function (a) {
          for (var b = [], c = a, d = "unknown", e = []; c; ) {
            if (
              ((e = c.toString().match(/function ([^\(]+)/)),
              (d = e && e.length > 0 ? e[1] : "unknown"),
              c.arguments && c.arguments.length > 0)
            ) {
              d += "(";
              for (var f = 0; f < c.arguments.length; f++)
                (d += 0 !== f ? "," : ""), (d += c.arguments[f]);
              d += ")";
            }
            b.push(d),
              (c =
                c.arguments && c.arguments.callee
                  ? c.arguments.callee.caller
                  : null);
          }
          return b.join("&");
        },
        sendGetProactiveChatAgent: function (a, b, c) {
          var d;
          if (proactiveChatAllowed) {
            var e = "w=" + encodeURIComponent(widgetId);
            if (
              (a && (e += "&c=1"),
              "undefined" != typeof b && (e += "&rid=" + b),
              c &&
                c.length > 0 &&
                (e += "&tags=" + encodeURIComponent(c.join())),
              "undefined" == typeof b && SnapEngage.getIsInstanceProactiveV2())
            )
              try {
                (d =
                  "&debug=" +
                  encodeURIComponent(
                    SnapABug.getFunctionStack(arguments.callee)
                  )),
                  (e +=
                    baseURL.length + e.length + d.length < 2e3
                      ? d
                      : "&too-many-chars");
              } catch (a) {}
            this.rpc(
              baseURL + "/chatjs/ServiceGetProactiveChatAgent?" + e,
              3,
              "sendGetProactiveChatAgent"
            );
          }
        },
        prepareProactiveMessage: function (a, b) {
          var c = a;
          return (c = a.replace("{alias}", b));
        },
        callbackProactiveChatAgent: function (a, b, c, d, e, f, g) {
          if (
            ((waitingRPCResponce = !1),
            SnapABug.setChatHandledByBot(g),
            sendGetProactiveChatAgentForIsBotOnly)
          )
            return void (sendGetProactiveChatAgentForIsBotOnly = !1);
          if (
            ((SnapABug.proactiveAgentNumber = b),
            "" != callmePhone
              ? (SnapABugChat.proactive(" ", !1, a, f, proactiveCommands),
                (webCapture = !1),
                SnapABug.sendCreateCase(
                  SnapABug.getUserEmail(),
                  "Call-me request",
                  !0
                ))
              : ("" != proactiveMsg &&
                  ((d = SnapABug.prepareProactiveMessage(proactiveMsg, a)),
                  (proactiveNotify = !0)),
                "" != b && "" != d
                  ? ((proactiveMsg = d),
                    e && "1" == e
                      ? (proactiveNotify = !0)
                      : "0" === e && (proactiveNotify = !1),
                    SnapABugChat.proactive(
                      proactiveMsg,
                      proactiveNotify,
                      a,
                      f,
                      proactiveCommands,
                      minimizedProactiveChatBox
                    ),
                    SnapABug.isMobileEnabled() ||
                      SnapABug.isCustomDesignEnabled() ||
                      this._hideButton(),
                    ruleSetArray && (ruleSetArray.length = 0))
                  : proactiveOfflineFallback && this.startLink()),
            c)
          ) {
            if (SnapABug.isCustomDesignEnabled())
              return void SnapABug.getCustomDesignUI().setAllowCallMe(c);
            SnapABug.enableCallMe();
          } else SnapABug.disableCallMe();
        },
        setFromUrlOverride: function (a) {
          fromUrlOverride = a;
        },
        isPendingAjax: function () {
          return SnapEngage.pendingXHR;
        },
        sendXMLHttpRequest: function (a, b, c) {
          function d(e, f, i) {
            function j() {
              if (g--) return d(e, f, i);
            }
            h.open(e, f),
              a.timeout && (h.timeout = a.timeout),
              g && (h.ontimeout = j),
              a.contentType &&
                h.setRequestHeader("Content-Type", a.contentType),
              (h.onload = function () {
                try {
                  var a = parseXhrJSON(this.responseText);
                  if (!a || !a.statusCode)
                    return 200 === this.status
                      ? b(this.responseText)
                      : c && c();
                  switch (a.statusCode) {
                    case statusCodes.SUCCESS:
                    case statusCodes.DUPLICATE:
                    case statusCodes.INVALID:
                    case statusCodes.NO_DATA:
                      return b(a);
                    case statusCodes.RETRY:
                      return j();
                    default:
                      return c && c(a);
                  }
                } catch (a) {
                  return c && c();
                } finally {
                  return (SnapEngage.pendingXHR = !1), !1;
                }
              }),
              (h.onerror = function () {
                return this.status === this.UNSENT
                  ? ((g = 0),
                    console.warn(
                      "Please update your Content-Security-Policy to allow " +
                        SnapEngage.getBaseURL() +
                        " for a better experience."
                    ),
                    c(this))
                  : 0 !== this.status && this.getAllResponseHeaders()
                  ? j()
                  : void (SnapEngage.pendingXHR = !1);
              }),
              (SnapEngage.pendingXHR = !0),
              h.send(i ? i : null);
          }
          if (!a) return c();
          var e = a.method ? a.method : "GET",
            f = SnapABug.getBaseURL() + a.url,
            g = a.retries ? a.retries : 0,
            h = new XMLHttpRequest();
          d(e, f, a.visitorData);
        },
        sendCreateCase: function (a) {
          this._hideButton();
          var b = a.isOnlineForm,
            c = a.address,
            d = a.description,
            e = SnapABug.isChatInProgress();
          if (visitorChatHistoryCookie) {
            var f = SnapABugChat.getHistoryCookie();
            "" !== f &&
              historyCookieEnabled &&
              SnapABug.setCvval("__sehist", f);
          } else
            SnapABugChat.setCookie("SnapABugUserEmail", "", 0),
              SnapABugChat.deleteCookie("SnapABugUserEmail"),
              SnapABugChat.setCookie("SnapABugHistory", "", 0),
              SnapABugChat.deleteCookie("SnapABugHistory");
          SnapABugChat.getPageTitle(!1) &&
            SnapABug.setCvval("__sepaget", SnapABugChat.getPageTitle(!1));
          var g = SnapABugChat.getTokensCookies();
          if (("" !== g && SnapABug.setCvval("__setokens", g), e)) return !1;
          SnapABug.setChatInProgress(b),
            "" === c &&
              ("" !== email
                ? (c = email)
                : "" !== SnapABugChat.getUserEmailCookie() &&
                  (c = SnapABugChat.getUserEmailCookie())),
            (d = d.replace(/^\s+|\s+$/g, "")),
            SnapABug.isCustomDesignEnabled()
              ? (SnapABug.getCustomDesignUI().disableButton(
                  "prechat-start-chat"
                ),
                SnapABug.getCustomDesignUI().disableButton(
                  "offline-send-email"
                ),
                SnapABug.getCustomDesignUI().disableButton(
                  "intelliprechat-next"
                ))
              : (SnapABug.disableButton("SnapABug_SB"),
                SnapABug.disableButton("SnapABug_OSB"),
                SnapABug.disableButton("SnapABug_OCB")),
            (newCaseJSON = {
              approvalBotCookie: !!SnapABugChat.getCookie("SnapABugApproval")
                .length,
              description: d.replace(/\n/g, "<br />"),
              emailAddress: c,
              entryPage: SnapABug.getEntryPageUrl(),
              from: fromUrlOverride ? fromUrlOverride : "",
              jsVariables: SnapABug.getJSVariables(),
              locale: locale,
              pageReferrer: SnapABug.getEntryPageRef(),
              proactiveAgentNumber: SnapABug.proactiveAgentNumber
                ? SnapABug.proactiveAgentNumber
                : proactiveAgentNumber
                ? proactiveAgentNumber
                : "",
              proactiveChatPrompt: SnapABugChat.getProactiveChatPrompt(),
              status: b ? "online" : "offline",
              tags: SnapABug.getTags(),
              type: SnapABug.getTypeOfChat(),
              uniqueKey: Math.floor(4294967295 * Math.random()).toString(16),
              userName: SnapABug.getUserName(),
              widgetPublicId: widgetId,
            });
          var h = {
            visitorData: JSON.stringify(newCaseJSON),
            url: "/public/api/v2/cases",
            retries: 3,
            method: "POST",
            timeout: 7e4,
            contentType: "application/json;charset=UTF-8",
          };
          return (
            SnapEngage.sendXMLHttpRequest(
              h,
              this.createSuccess.bind(this),
              this.createError.bind(this)
            ),
            (d = SnapABug.deactivateHTML(d)),
            b
              ? SnapABug.callCallback(
                  "StartChat",
                  c,
                  d,
                  SnapABug.getTypeOfChat()
                )
              : SnapABug.callCallback("MessageSubmit", c, d),
            SnapABug.getChatHandledByBot() &&
              SnapABug.isChatInProgress() &&
              SnapABug.getCustomDesignUI()
                .chatView.getMessageView()
                .triggerAgentIsTyping(!0),
            !0
          );
        },
        createSuccess: function (a) {
          if (
            a.statusCode === statusCodes.DUPLICATE ||
            a.statusCode === statusCodes.INVALID
          )
            return (
              SnapABug.setChatInProgress(!1),
              SnapABug.getCustomDesignUI().initErrorMessage()
            );
          var b = 0 === SnapEngage.getAgentStatus();
          return b
            ? SnapABugChat.stopPolling()
            : (a.statusCode === statusCodes.SUCCESS &&
                ((caseId = a.data.casePublicId),
                (dbCaseId = a.data.dbCaseId),
                SnapABug.setChatInProgress(!0),
                SnapABugChat.updateHistoryCookieForLastCase(caseId),
                SnapABugChat.startChat(caseId, baseURL),
                "proactive" === SnapABug.getCustomDesignUI().getTypeOfChat() &&
                  SnapABug.getCustomDesignUI().proactiveController.clearInvite(),
                SnapABugChat.startPolling(),
                "" !== SnapABug.getCallMePhone() &&
                  (SnapABug.sendClickToCall(SnapABug.getCallMePhone(), 2),
                  SnapABug.setCallMePhone(""))),
              void (newCaseJSON = {}));
        },
        createError: function (a) {
          SnapABug.getCustomDesignUI().initErrorMessage(), (newCaseJSON = {});
        },
        sendUpdateCase: function (a) {
          if (caseId || dbCaseId) {
            (cvval = {}), (vval = ""), (jsvars = a);
            var b = "c=" + encodeURIComponent(caseId);
            dbCaseId && (b = "ci=" + encodeURIComponent(dbCaseId)),
              (b += "&vjs=" + encodeURIComponent(this.getJSVariables())),
              this.rpc(
                baseURL + "/chatjs/ServiceUpdateCase?" + b,
                3,
                "sendUpdateCase"
              );
          }
        },
        callbackUpdateCase: function (a) {},
        sendCheckPhone: function (a) {
          var b =
            "w=" + encodeURIComponent(widgetId) + "&p=" + encodeURIComponent(a);
          this.rpc(
            baseURL + "/chatjs/ServiceCheckPhone?" + b,
            3,
            "sendCheckPhone"
          );
        },
        callbackCheckPhone: function (a) {
          a
            ? (caseId || dbCaseId
                ? SnapABug.sendClickToCall(callmePhone, 2)
                : this.sendGetProactiveChatAgent(!0),
              SnapABug.disableCallMe(),
              SnapABugChat.formCallMeDone())
            : SnapABug.isCustomDesignEnabled() ||
              SnapABugChat.populateCallMeForm(!0, this.getCallMePhone());
        },
        thankYouNote: function () {
          (ready = !0), this.populateFormStatus(4);
        },
        showHelp: function () {
          try {
            (h = document.getElementById("SnapABug_H")),
              (h.innerHTML = this.getMessage(5)),
              (h.style.display = "block");
          } catch (a) {}
          return !1;
        },
        hideHelp: function () {
          try {
            document.getElementById("SnapABug_H").style.display = "none";
          } catch (a) {}
        },
        getFlashVersion: function () {
          function a() {
            var a,
              b = "";
            try {
              (a = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")),
                (b = a.GetVariable("$version"));
            } catch (a) {}
            if (!b)
              try {
                (a = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6")),
                  (b = "WIN 6,0,21,0"),
                  (a.AllowScriptAccess = "always"),
                  (b = a.GetVariable("$version"));
              } catch (a) {}
            if (!b)
              try {
                (a = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3")),
                  (b = a.GetVariable("$version"));
              } catch (a) {}
            if (!b)
              try {
                (a = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3")),
                  (b = "WIN 3,0,18,0");
              } catch (a) {}
            if (!b)
              try {
                (a = new ActiveXObject("ShockwaveFlash.ShockwaveFlash")),
                  (b = "WIN 2,0,0,11");
              } catch (a) {}
            return b;
          }
          var b = navigator.appVersion.indexOf("MSIE") !== -1,
            c = navigator.appVersion.toLowerCase().indexOf("win") !== -1,
            d = navigator.userAgent.indexOf("Opera") !== -1;
          try {
            var e = "none";
            if (null != navigator.plugins && navigator.plugins.length > 0) {
              if (
                navigator.plugins["Shockwave Flash 2.0"] ||
                navigator.plugins["Shockwave Flash"]
              ) {
                var f = navigator.plugins["Shockwave Flash 2.0"] ? " 2.0" : "",
                  g = navigator.plugins["Shockwave Flash" + f].description,
                  h = g.split(" "),
                  i = h[2].split("."),
                  j = i[0],
                  k = i[1],
                  l = h[3];
                "" == l && (l = h[4]),
                  "d" == l[0]
                    ? (l = l.substring(1))
                    : "r" == l[0] &&
                      ((l = l.substring(1)),
                      l.indexOf("d") > 0 &&
                        (l = l.substring(0, l.indexOf("d")))),
                  (e = j + "." + k + "." + l);
              }
            } else
              navigator.userAgent.toLowerCase().indexOf("webtv/2.6") !== -1
                ? (e = 4)
                : navigator.userAgent.toLowerCase().indexOf("webtv/2.5") !== -1
                ? (e = 3)
                : navigator.userAgent.toLowerCase().indexOf("webtv") !== -1
                ? (e = 2)
                : b && c && !d && (e = a());
            return e.replace(/,/g, ".");
          } catch (a) {
            return "none";
          }
        },
        hasFlash: function () {
          var a = SnapABug.getFlashVersion();
          return "none" != a && "" != a;
        },
        getJSVariables: function () {
          try {
            vval = "";
            for (var item in cvval) this.setVarVal(item + "=" + cvval[item]);
            if ("" != jsvars)
              for (var a = jsvars.split(","), i = 0; i < a.length; i++)
                "" != a[i] &&
                  "undefined" == typeof cvval[a[i]] &&
                  eval(
                    "if(typeof " +
                      a[i] +
                      '=== "undefined"){SnapABug.setVarVal("' +
                      a[i] +
                      '=undefined");}else{SnapABug.setVarVal("' +
                      a[i] +
                      '="+' +
                      a[i] +
                      ");};"
                  );
            return vval;
          } catch (a) {
            return "E";
          }
        },
        setVarVal: function (a) {
          try {
            (a = a.replace(/,/g, "&#44;")),
              "" != vval && (vval += ","),
              (vval += a);
          } catch (a) {}
        },
        getMessage: function (a) {
          var b = SnapABug.getLocale(),
            c = "ar" === b || "iw" === b ? "direction:rtl;" : "";
          SnapABug.setDirection(c),
            "undefined" == typeof SnapABug.messagesObj &&
              SnapABug.messagesDefaultInit();
          var d = "";
          return (d =
            SnapABug.messagesObj[b] && SnapABug.messagesObj[b][a]
              ? SnapABug.messagesObj[b][a]
              : SnapABug.messagesObj.en[a]
              ? SnapABug.messagesObj.en[a]
              : "Message not found. msgId: " + a);
        },
        messagesDefaultInit: function () {
          SnapABug.messagesObj = {
            en: {
              0: "Help",
              1: "Your email:",
              2: "Your question:",
              3: "Include a snapshot of the current page",
              4: "Send",
              5: "Send a screen shot of what I am seeing on the web page so that the support team can provide a fast answer.",
              6: 'Preparing for snapshot...<br /><br />Please click "Run" or "Allow" to let our applet send a snapshot of the web page to the support team.',
              7: "Thank you,<br />Your message has been sent.",
              8: "Sorry, your message couldn't be sent.<br />We are investigating the issue.<br />Please try again later.",
              9: "Uploading...",
              10: "Close",
              11: "You have already submitted this case to the support team.",
              12: "Email us",
              13: "Chat with us",
              14: "Type your message here and press [enter] to send...",
              15: "me",
              16: "How can we help?",
              17: "Do any of these help?",
              18: "Next",
              19: "Back",
              20: "None of these helped...",
              21: "How would you rate your chat?",
              22: "How would you rate your chat with {alias}?",
              23: "Any comments you wish to add?",
              24: "Submit",
              25: "or Cancel",
              26: "Thank you for your feedback!",
              27: "Not helpful",
              28: "Needs work",
              29: "So-so",
              30: "Helpful",
              31: "Very helpful",
              32: "Poor",
              33: "Ok",
              34: "Great",
              36: "Minimize",
              37: "End Chat",
              38: "Call from my computer",
              39: "Call me on my phone",
              40: "Return to chat",
              41: "Call me",
              42: "Cancel",
              56: "Please click the UPLOAD button below.",
              57: "UPLOAD",
              58: "Close",
              59: "<b>Thank you for contacting us.</b><br>Chat session disconnected.",
              60: "<br><b>Thank you for contacting us.</b><br>Your chat session was disconnected because it was idle for too long.",
              61: "Accept Co-Browsing? Only this browser tab will be shared with {alias}.",
              62: "ACCEPT",
              63: "DECLINE",
              64: "This browser tab will now be shared live with {alias}.",
              65: "Invitation to Co-Browse declined.",
              66: "is typing...",
              67: "Enter an email address below to receive a transcript of this chat.",
              68: "Invalid email",
              69: "Cancel",
              70: "Okay",
              71: "A transcript will be sent to {email} at the end of this chat.",
              72: "Request email transcript",
              73: "Comment box will close in {X} minutes",
            },
          };
        },
        prepareEventHandling: function () {
          document.addEventListener
            ? ((SnapABug.addEvent = function (a, b, c) {
                return a.addEventListener(b, c, !1), c;
              }),
              (SnapABug.removeEvent = function (a, b, c) {
                a.removeEventListener(b, c, !1);
              }))
            : document.attachEvent &&
              ((SnapABug.addEvent = function (a, b, c) {
                var d = function () {
                  return c.apply(a, arguments);
                };
                return a.attachEvent("on" + b, d), d;
              }),
              (SnapABug.removeEvent = function (a, b, c) {
                a.detachEvent("on" + b, c);
              }));
        },
        sendGetProactiveGeoData: function () {
          if (!geoRPCSent) {
            geoRPCSent = !0;
            var a = "w=" + encodeURIComponent(widgetId);
            this.rpc(
              baseURL + "/chatjs/servicegetproactivegeodata?" + a,
              3,
              "sendGetProactiveGeoData"
            );
          }
        },
        setProactiveChatEventListener: function (a, b, c) {
          if (!proactiveEventListenersAdded)
            switch (((c = [c]), a.toLowerCase())) {
              case "scroll":
                SnapABug.addEvent(window, "scroll", function (a) {
                  var d =
                    (window.pageYOffset ||
                      document.documentElement.scrollyPos) +
                    (window.innerHeight ||
                      document.documentElement.offsetHeight);
                  SnapABug.evaluateProactiveRule("intrule", b, d) &&
                    SnapABug.proactiveChatEvaluateCallback(!0, c);
                });
                break;
              case "click":
                SnapABug.addEvent(document, "click", function () {
                  visitorClicks++,
                    SnapABug.evaluateProactiveRule(
                      "intrule",
                      b,
                      visitorClicks
                    ) && SnapABug.proactiveChatEvaluateCallback(!0, c);
                });
                break;
              case "exit":
                SnapABug.addEvent(document, "mouseout", function (a) {
                  a = a ? a : window.event;
                  var b = a.relatedTarget || a.toElement,
                    d = a.pageY || a.clientY;
                  (b && "HTML" != b.nodeName) ||
                    (d != -1 &&
                      d < 150 &&
                      SnapABug.proactiveChatEvaluateCallback(!0, c));
                });
            }
        },
        prepareForRegexMatch: function (a) {
          return a
            .replace(/[-[\]{}()+?.,\\^$|#\s]/g, "\\$&")
            .replace(/\*+/g, ".*");
        },
        evaluateProactiveRule: function (a, b, c) {
          switch (a.toLowerCase()) {
            case "stringrule":
              var d;
              switch (b.operator.toLowerCase()) {
                case "equals":
                  return (
                    (d = new RegExp(
                      "^" +
                        SnapABug.prepareForRegexMatch(
                          decodeURIComponent(b.value)
                        ) +
                        "$"
                    )),
                    d.test(c)
                  );
                case "notequals":
                  return (
                    (d = new RegExp(
                      "^" +
                        SnapABug.prepareForRegexMatch(
                          decodeURIComponent(b.value)
                        ) +
                        "$"
                    )),
                    !d.test(c)
                  );
                case "contains":
                  return (
                    (d = new RegExp(
                      SnapABug.prepareForRegexMatch(decodeURIComponent(b.value))
                    )),
                    d.test(c)
                  );
                case "notcontains":
                  return (
                    (d = new RegExp(
                      SnapABug.prepareForRegexMatch(decodeURIComponent(b.value))
                    )),
                    !d.test(c)
                  );
                case "in":
                  return (
                    (d = new RegExp(
                      SnapABug.prepareForRegexMatch(decodeURIComponent(c))
                    )),
                    d.test(b.value)
                  );
                case "beginswith":
                  return (
                    (d = new RegExp(
                      "^" +
                        SnapABug.prepareForRegexMatch(
                          decodeURIComponent(b.value)
                        )
                    )),
                    d.test(c)
                  );
                case "endwith":
                  return (
                    (d = new RegExp(
                      SnapABug.prepareForRegexMatch(
                        decodeURIComponent(b.value)
                      ) + "$"
                    )),
                    d.test(c)
                  );
                case "matchregex":
                  return (
                    (d = new RegExp(decodeURIComponent(b.value))), d.test(c)
                  );
              }
              break;
            case "intrule":
              switch (b.operator.toLowerCase()) {
                case "equals":
                  return c == b.value;
                case "notequals":
                  return c != b.value;
                case "greater":
                  return c > b.value;
                case "less":
                  return c < b.value;
                case "greaterequal":
                  return c >= b.value;
                case "lessequal":
                  return c <= b.value;
              }
              break;
            case "boolrule":
              return (
                SnapABug.booleanToString(c) == SnapABug.booleanToString(b.value)
              );
            case "timeofdayrule":
              for (
                var e = new Date(b.toEpoch),
                  f = new Date(b.fromEpoch),
                  g = new Date(c),
                  h = !1,
                  i = !1,
                  j = b.days.length;
                j >= 0;
                j--
              )
                b.days[j] == g.getUTCDay() && (i = !0);
              if (!i) return !1;
              if (
                (f.getUTCHours() === g.getUTCHours() &&
                  f.getUTCMinutes() <= g.getUTCMinutes() &&
                  (h = !0),
                g.getUTCHours() === e.getUTCHours() &&
                  g.getUTCMinutes() <= e.getUTCMinutes() &&
                  (h = !0),
                h)
              )
                return !0;
              var k = e.getUTCHours() < f.getUTCHours();
              return (
                k
                  ? f.getUTCHours() < g.getUTCHours()
                    ? (h = !0)
                    : g.getUTCHours() < e.getUTCHours() && (h = !0)
                  : f.getUTCHours() < g.getUTCHours() &&
                    g.getUTCHours() < e.getUTCHours() &&
                    (h = !0),
                h
              );
          }
        },
        booleanToString: function (a) {
          return "boolean" == typeof a ? a.toString() : a;
        },
        getSearchParamsFromUrl: function (a) {
          var b,
            c = [],
            d = ["google", "bing", "ask", "msn", "yahoo"],
            e = "q",
            f = !1,
            g = 0;
          for (g = 0; g < d.length; g++)
            a.indexOf(d[g]) !== -1 && ((f = !0), "yahoo" === d[g] && (e = "p"));
          if (f) {
            var h = a.slice(a.indexOf("?") + 1).split("&");
            for (g = 0; g < h.length; g++)
              (b = h[g].split("=")), c.push(b[0]), (c[b[0]] = b[1]);
          }
          return void 0 !== c[e]
            ? decodeURIComponent(c[e].replace(/\+/g, " "))
            : "";
        },
        setOpenProactiveChatAPIRule: function (a) {
          null !== openProactiveChatAPIRule ||
            SnapABug.isRuleSetAgentRouted(a) ||
            (openProactiveChatAPIRule = a);
        },
        proactiveChatRuleEvalStep1: function () {
          var a,
            b,
            c,
            d,
            e,
            f,
            g,
            h = !1;
          (currentEvaluationStep = 1), (h = !1);
          for (var i = ruleSetArray.length; i-- > 0; ) {
            (a = ruleSetArray[i]),
              (g =
                !SnapABug.isRuleSetAgentRouted(a) &&
                !SnapABug.isRuleSetTagRouted(a)),
              (b = a.operator),
              (c = a.pageRules);
            var j = c.length;
            a: for (; j-- > 0; ) {
              switch (((d = c[j]), (f = !1), d.name.toLowerCase())) {
                case "pageurl":
                  e = SnapABug.proactiveUrlEvaluation(
                    d.ruleProperty,
                    window.location.href
                  );
                  break;
                case "entryurl":
                  e = SnapABug.proactiveUrlEvaluation(
                    d.ruleProperty,
                    SnapABug.getEntryPageUrl(!0)
                  );
                  break;
                case "comingfrom":
                  e = SnapABug.proactiveUrlEvaluation(
                    d.ruleProperty,
                    SnapABug.getEntryPageRef(!0)
                  );
                  break;
                case "keywords":
                  e = SnapABug.evaluateProactiveRule(
                    "stringrule",
                    d.ruleProperty,
                    SnapABug.getSearchParamsFromUrl(
                      SnapABug.getEntryPageRef(!0)
                    )
                  );
                  break;
                case "jsvar":
                  e = SnapABug.evaluateProactiveRule(
                    "stringrule",
                    d.ruleProperty,
                    SnapABug.getJSVarValue(d.ruleProperty.jsVar)
                  );
                  break;
                case "newvisitor":
                  (e = SnapABug.evaluateProactiveRule(
                    "boolrule",
                    d.ruleProperty,
                    SnapABugChat.getVisitorIsFirstTimeVisiting()
                  )),
                    (g = !1);
                  break;
                case "chattedbefore":
                  (e = SnapABug.evaluateProactiveRule(
                    "boolrule",
                    d.ruleProperty,
                    SnapABugChat.getVisitorNumberOfPreviousChats() > 0
                  )),
                    (g = !1);
                  break;
                case "pagesvisited":
                  e = SnapABug.evaluateProactiveRule(
                    "intrule",
                    d.ruleProperty,
                    SnapABugChat.getVisitorNumberOfPagesVisited()
                  );
                  break;
                case "lang":
                case "timeofday":
                case "country":
                case "state":
                case "city":
                case "region":
                  h = !0;
                default:
                  f = !0;
              }
              if (!f)
                if ("any" === b) {
                  if (e)
                    return (
                      g && SnapABug.setOpenProactiveChatAPIRule(a),
                      void SnapABug.openProactiveV2Chat(i)
                    );
                } else {
                  if (!e) {
                    ruleSetArray.splice(i, 1);
                    break a;
                  }
                  if (!(c.length > 1))
                    return (
                      g && SnapABug.setOpenProactiveChatAPIRule(a),
                      void SnapABug.openProactiveV2Chat(i)
                    );
                  ruleSetArray[i].pageRules.splice(j, 1);
                }
            }
          }
          h
            ? SnapABug.sendGetProactiveGeoData()
            : SnapABug.proactiveChatRuleEvalStep3();
        },
        proactiveUrlEvaluation: function (a, b) {
          if (!b || !a) return !1;
          var c = SnapABug.evaluateProactiveRule("stringrule", a, b);
          if (
            ("notequals" !== a.operator.toLowerCase() && !c) ||
            ("notequals" === a.operator.toLowerCase() && c)
          ) {
            var d = "",
              e = b.charAt(b.length - 1);
            (d = "/" === e ? b.substring(0, b.length - 1) : b + "/"),
              (c = SnapABug.evaluateProactiveRule("stringrule", a, d));
          }
          return c;
        },
        callbackGetProactiveGeoData: function (a, b, c, d, e) {
          (visitorCountry = a),
            (visitorRegion = b),
            (visitorCity = c),
            (visitorLocalTime = 1e3 * d),
            (visitorLanguages = e),
            SnapABug.proactiveChatRuleEvalStep2();
        },
        proactiveChatRuleEvalStep2: function () {
          var a, b, c, d, e, f, g;
          currentEvaluationStep = 2;
          for (var h = ruleSetArray.length; h-- > 0; ) {
            (a = ruleSetArray[h]),
              (g =
                !SnapABug.isRuleSetAgentRouted(a) &&
                !SnapABug.isRuleSetTagRouted(a)),
              (b = a.operator),
              (c = a.pageRules);
            var i = c.length;
            a: for (; i-- > 0; ) {
              switch (((d = c[i]), (f = !1), d.name.toLowerCase())) {
                case "timeofday":
                  e = SnapABug.evaluateProactiveRule(
                    "timeofdayrule",
                    d.ruleProperty,
                    visitorLocalTime
                  );
                  break;
                case "country":
                  e = SnapABug.evaluateProactiveRule(
                    "stringrule",
                    d.ruleProperty,
                    visitorCountry
                  );
                  break;
                case "region":
                  e = SnapABug.evaluateProactiveRule(
                    "stringrule",
                    d.ruleProperty,
                    visitorCountry
                  );
                  break;
                case "state":
                  e = SnapABug.evaluateProactiveRule(
                    "stringrule",
                    d.ruleProperty,
                    visitorRegion
                  );
                  break;
                case "city":
                  e = SnapABug.evaluateProactiveRule(
                    "stringrule",
                    d.ruleProperty,
                    visitorCity
                  );
                  break;
                case "lang":
                  e = SnapABug.evaluateProactiveRule(
                    "stringrule",
                    d.ruleProperty,
                    visitorLanguages
                  );
                  break;
                default:
                  f = !0;
              }
              if (!f)
                if ("any" === b) {
                  if (e)
                    return (
                      g && SnapABug.setOpenProactiveChatAPIRule(a),
                      void SnapABug.openProactiveV2Chat(h)
                    );
                } else {
                  if (!e) {
                    ruleSetArray.splice(h, 1);
                    break a;
                  }
                  if (!(c.length > 1))
                    return (
                      g && SnapABug.setOpenProactiveChatAPIRule(a),
                      void SnapABug.openProactiveV2Chat(h)
                    );
                  ruleSetArray[h].pageRules.splice(i, 1);
                }
            }
          }
          SnapABug.proactiveChatRuleEvalStep3();
        },
        proactiveChatRuleEvalStep3: function () {
          function a(a) {
            for (var b = [], c = 0; c < a.length; c++) b.push(a[c]);
            return b;
          }
          function b(a, b) {
            "undefined" == typeof a[b.ruleProperty.value] &&
              (a[b.ruleProperty.value] = []),
              a[b.ruleProperty.value].push(b.eventID);
          }
          var c,
            d,
            e,
            f,
            g = ruleSetArray.length,
            h = {},
            i = {};
          for (
            currentEvaluationStep < 3 &&
            (SnapABug.prepareEventHandling(),
            (firstPass = !0),
            (currentEvaluationStep = 3));
            g-- > 0;

          ) {
            (c = ruleSetArray[g]), (d = c.pageRules);
            var j = d.length;
            for (
              f =
                !SnapABug.isRuleSetAgentRouted(c) &&
                !SnapABug.isRuleSetTagRouted(c);
              j-- > 0;

            ) {
              switch (
                ((e = d[j]),
                firstPass && (e.eventID = "eventID" + g + j),
                e.name.toLowerCase())
              ) {
                case "visitorclicks":
                  firstPass &&
                    (SnapABug.setProactiveChatEventListener(
                      "click",
                      e.ruleProperty,
                      e.eventID
                    ),
                    (f = !1));
                  break;
                case "scrolldown":
                  firstPass &&
                    (SnapABug.setProactiveChatEventListener(
                      "scroll",
                      e.ruleProperty,
                      e.eventID
                    ),
                    (f = !1));
                  break;
                case "visitorexits":
                  firstPass &&
                    (SnapABug.setProactiveChatEventListener(
                      "exit",
                      e.ruleProperty,
                      e.eventID
                    ),
                    (f = !1));
                  break;
                case "timesite":
                  b(h, e);
                  break;
                case "timepage":
                  b(i, e);
              }
              firstPass &&
                f &&
                0 === j &&
                SnapABug.setOpenProactiveChatAPIRule(c);
            }
          }
          (proactiveEventListenersAdded = !0),
            SnapABug.executeProactiveChatEvaluationFinishedCallback(),
            SnapABugChat.proactiveRulesTimers.proactiveChatRules ||
              (SnapABugChat.proactiveRulesTimers.proactiveChatRules = []);
          for (timeSiteTimeout in h)
            if (h.hasOwnProperty(timeSiteTimeout)) {
              var k = window.setTimeout(
                (function (a) {
                  return function () {
                    SnapABug.proactiveChatEvaluateCallback(!0, a);
                  };
                })(a(h[timeSiteTimeout])),
                1e3 * (timeSiteTimeout - SnapABugChat.getVisitorTimeOnSite())
              );
              SnapABugChat.proactiveRulesTimers.proactiveChatRules.push(k);
            }
          for (timePageTimeout in i)
            if (i.hasOwnProperty(timePageTimeout)) {
              var l = window.setTimeout(
                (function (a) {
                  return function () {
                    SnapABug.proactiveChatEvaluateCallback(!0, a);
                  };
                })(a(i[timePageTimeout])),
                1e3 * (timePageTimeout - SnapABugChat.getVisitorTimeOnPage())
              );
              SnapABugChat.proactiveRulesTimers.proactiveChatRules.push(l);
            }
        },
        proactiveChatEvaluateCallback: function (a, b) {
          for (var c, d, e, f = ruleSetArray.length; f-- > 0; ) {
            (c = ruleSetArray[f]), (d = c.pageRules), (e = c.operator);
            for (var g = d.length; g-- > 0; )
              SnapABug.isInArray(d[g].eventID, b) &&
                ("any" === e
                  ? a && SnapABug.openProactiveV2Chat(f)
                  : a
                  ? d.length > 1
                    ? ruleSetArray[f].pageRules.splice(g, 1)
                    : SnapABug.openProactiveV2Chat(f)
                  : ruleSetArray.splice(f, 1));
          }
        },
        openProactiveV2Chat: function (a) {
          var b = ruleSetArray[a];
          if (
            ((minimizedProactiveChatBox = b.minimizedChatBox),
            !waitingRPCResponce)
          ) {
            if (
              ((waitingRPCResponce = !0),
              SnapABug.isRuleSetAgentRouted(b) ||
                SnapABug.isRuleSetTagRouted(b))
            )
              return (
                SnapABug.setRoutingList(a),
                SnapABug.openProactiveChatWithAgentRouting(a)
              );
            SnapABug.openProactiveChatDo(
              !1,
              !1,
              decodeURIComponent(b.message),
              b.id ? b.id : a
            );
          }
        },
        isRuleSetAgentRouted: function (a) {
          return !!(
            a.advanced.agents &&
            a.advanced.agents instanceof Array &&
            a.advanced.agents.length > 0
          );
        },
        isRuleSetTagRouted: function (a) {
          return !!(
            a.advanced.tags &&
            a.advanced.tags instanceof Array &&
            a.advanced.tags.length > 0
          );
        },
        setRoutingList: function (a) {
          var b = ruleSetArray[a],
            c = b.advanced.agents || b.advanced.tags;
          routingList = [];
          for (var d = 0; d < c.length; d++) routingList.push(c[d]);
        },
        getRoutingList: function () {
          return routingList;
        },
        openProactiveChatWithAgentRouting: function (a) {
          var b = ruleSetArray[a];
          (proactiveChatAgentRoutingRuleSetIndex = a),
            "1" != SnapABugChat.getBannedCookie() &&
              chatAllowed &&
              (chatInProgress ||
                SnapABugChat.isNoProactiveChatCookie() ||
                (SnapABugChat.reInit(),
                (proactiveMsg = decodeURIComponent(b.message)),
                b.botMessage &&
                  ((proactiveMsg = decodeURIComponent(
                    decodeURIComponent(b.botMessage[0])
                  )),
                  (proactiveCommands = [b.botMessage[1]])),
                SnapABug.sendGetAvailableAgentList()));
        },
        sendGetAvailableAgentList: function () {
          if (
            this.getRoutingAvailabilityCache(routingAvailabilityCacheLifetime)
          )
            return this.handleProactiveChatRouting();
          var a = "w=" + encodeURIComponent(widgetId) + "&t=1";
          (a = SnapABug.appendTagsParameter(a)),
            this.rpc(
              baseURL + "/chatjs/servicegetallavailableagents?" + a,
              3,
              "sendGetAvailableAgentList"
            );
        },
        setRoutingAvailabilityCache: function (a) {
          routingAvailabilityCache = {
            timestamp: new Date().getTime(),
            data: a,
          };
        },
        getRoutingAvailabilityCache: function (a) {
          return routingAvailabilityCache &&
            routingAvailabilityCache.data &&
            routingAvailabilityCache.timestamp + a > new Date().getTime()
            ? routingAvailabilityCache.data
            : null;
        },
        callbackGetAvailableAgentList: function (routingAvailabilityJSON) {
          var routingAvailability = {};
          routingAvailabilityJSON &&
            (routingAvailability = eval("(" + routingAvailabilityJSON + ")")),
            this.setRoutingAvailabilityCache(routingAvailability),
            this.handleProactiveChatRouting();
        },
        handleProactiveChatRouting: function () {
          var a = [],
            b = this.getRoutingAvailabilityCache(
              routingAvailabilityCacheLifetime
            );
          if (
            b !== {} &&
            (0 !== Object.keys(b).length || b.constructor !== Object)
          ) {
            for (var c = 0; c < routingList.length; c++) {
              var d = routingList[c];
              for (var e in b)
                if (b.hasOwnProperty(e)) {
                  if (b[e].name === d)
                    return SnapABug.sendProactiveRoutingHashAndNumber(
                      b[e].name,
                      e
                    );
                  if (b[e].tags)
                    for (var f = 0; f < b[e].tags.length; f++) {
                      var g = b[e].tags[f];
                      g === d && a.push(g);
                    }
                }
              if (a.length > 0)
                return SnapABug.sendGetProactiveChatAgent(
                  !1,
                  proactiveChatAgentRoutingRuleSetIndex,
                  a
                );
            }
            SnapABug.proactiveChatWithAgentRoutingErrorFallback();
          }
        },
        proactiveChatWithAgentRoutingErrorFallback: function () {
          switch (
            ((waitingRPCResponce = !1),
            SnapABug.clearProactiveChatEvaluationFinishedCallback(),
            proactiveChatAgentRoutingRuleSetIndex != -1 &&
              (ruleSetArray.splice(proactiveChatAgentRoutingRuleSetIndex, 1),
              (proactiveChatAgentRoutingRuleSetIndex = -1)),
            (routingAvailabilityCache = {}),
            (routingList = []),
            currentEvaluationStep)
          ) {
            case 1:
              SnapABug.proactiveChatRuleEvalStep1();
              break;
            case 2:
              SnapABug.proactiveChatRuleEvalStep2();
              break;
            case 3:
              SnapABug.proactiveChatRuleEvalStep3();
          }
        },
        sendProactiveRoutingHashAndNumber: function (a, b) {
          var c = "w=" + encodeURIComponent(widgetId);
          (c += "&h=" + encodeURIComponent(a)),
            (c += "&nr=" + encodeURIComponent(b)),
            this.rpc(
              baseURL + "/chatjs/servicegetproactivedatafromnrhash?" + c,
              3,
              "sendProactiveRoutingHashAndNumber"
            ),
            proactiveChatAgentRoutingRuleSetIndex != -1 &&
              ruleSetArray.splice(proactiveChatAgentRoutingRuleSetIndex, 1);
        },
        proactiveChatInitialize: function (a) {
          if (
            (a
              ? (previousProactiveRulesJSON = a)
              : (a = previousProactiveRulesJSON),
            SnapEngage.setIsInstanceProactiveV2(!0),
            !SnapABugChat.isNoProactiveChatCookie() && a)
          ) {
            var b = JSON.parse(a);
            if (
              ((ruleSetArray = b.ruleSets.reverse()),
              (ruleSetArrayOperator = b.operator),
              b.proactiveDisableTime &&
                SnapABug.setNoProactiveChatDelay(b.proactiveDisableTime),
              b.newVisitorCookieLifeTime &&
                (SnapABug.setVisitorCookieLifeTime(b.newVisitorCookieLifeTime),
                SnapABugChat.getVisitCookie()))
            ) {
              var c = SnapABugChat.getVisitCookie(),
                d = Math.floor(SnapABugChat.getVisitorTimeOnSite() / 60),
                e = SnapABug.getVisitorCookieLifeTime() - d;
              e < 0 && (e = 1), SnapABugChat.setCookie("SnapABugVisit", c, e);
            }
            SnapABug.proactiveChatRuleEvalStep1();
          }
        },
        getJSVarValue: function (a) {
          var b = this.getJSVariables(),
            c = b.split(","),
            d = "",
            e = c
              .filter(function (b) {
                return b.indexOf(a) >= 0;
              })[0]
              .split("=");
          return e && (d = e[1]), d;
        },
        messagesInit: function (newMessagesJSON) {
          var newMessagesObj = eval("(" + newMessagesJSON + ")");
          (SnapABug.messagesObj = newMessagesObj),
            SnapABug.messagesObj &&
              (SnapABug.getMessage = function (a) {
                SnapABug.messagesObj.isSingle &&
                  (SnapABug.setLocale = function () {
                    return !1;
                  });
                var b = SnapABug.getLocale(),
                  c = "ar" === b || "iw" === b ? "direction:rtl;" : "";
                return SnapABug.setDirection(c), SnapABug.messagesObj[b][a];
              });
        },
        setPreChatSearchEnabled: function (a) {
          (this.enablePreChatSearch = a), 1 == a && this.setPreChatSearch(1);
        },
        getPreChatSearchEnabled: function () {
          return this.enablePreChatSearch;
        },
        resetPreChatSearch: function () {
          (preChatSearchQuestion = ""), SnapABug.setPreChatSearch(1);
        },
        startPreChatSearch: function () {
          var a = '<div id="preChatSearchContainer"></div>';
          SnapEngageChat.populateSubChatForm(a, "SnapABug.closeForm();"),
            SnapEngage._hideButton();
          var b = document.getElementById("SnapABug_CM");
          b && (b.parentNode.style.borderColor = "white"),
            SnapABug.preChatSearchShowSearchForm();
        },
        preChatSearchShowSearchForm: function () {
          function a() {
            var a = document.getElementById("SnapABug_CM").parentNode,
              b = parseInt(a.style.height, 10),
              c = d.offsetHeight,
              g = f.offsetHeight,
              h = b - c - g - 20;
            e.style.height = h + "px";
          }
          var b = document.getElementById("preChatSearchContainer"),
            c =
              '<div style="padding: 0px 5px 0px 5px; text-align: left;">   <div id="preChatSearchInstructions" style="padding-bottom: 10px; font-style: normal; line-height: normal; text-shadow: none; list-style: none; text-align: left; outline: none; text-indent: 0px; -moz-box-shadow: none; -webkit-box-shadow: none; font-family: \'lucida grande\', \'Helvetica Neue\', Helvetica, Arial, sans-serif; font-size: 12px; font-weight: 600; color: #61656d;">    ' +
              SnapABug.getMessage(16) +
              '  </div>   <div id="preChatSearchQuestionForm">     <textarea id="preChatSearchQuestionTextArea" autofocus maxlength="500" style="width: 100%;resize: none; outline: none; border: 1px solid #999999 !important; box-shadow:none !important; font-family: arial,sans-serif; font-size: 12px; font-weight: normal; font-style: normal; line-height: normal; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box;"></textarea>     <div id="preChatSearchSubmitArea" style="padding-top: 15px; width:100%; text-align: right; ' +
              SnapABug.getDisplayInlineBlockCSS() +
              '">       <a id="preChatSearchNextButton" href="#" style="color: #999; text-decoration: none; cursor: pointer; outline: none; border: 1px solid rgb(160, 161, 160); background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, from(rgb(255, 255, 255)), to(rgb(199, 201, 199))); padding: 3px 8px 3px 8px; width: auto; overflow: visible; border-radius: 10px; color: rgb(81, 85, 93); font-size: 12px; font-family: \'Helvetica Neue\', Helvetica, \'lucida grande\', Arial, sans-serif; text-decoration: none; font-weight: bold; ' +
              SnapABug.getDisplayInlineBlockCSS() +
              '">        ' +
              SnapABug.getMessage(18) +
              "      </a>    </div>   </div> </div> ";
          b.innerHTML = c;
          var d = document.getElementById("preChatSearchInstructions"),
            e = document.getElementById("preChatSearchQuestionTextArea"),
            f = document.getElementById("preChatSearchSubmitArea"),
            g = document.getElementById("preChatSearchNextButton");
          (g.onclick = function () {
            return SnapABug.preChatSearchSubmit(), !1;
          }),
            a(),
            (e.value = preChatSearchQuestion ? preChatSearchQuestion : ""),
            e.focus(),
            (e.onkeyup = function (a) {
              a && 13 == a.keyCode && SnapABug.preChatSearchSubmit();
            });
        },
        preChatSearchSubmit: function () {
          SnapABug.disableButton("preChatSearchNextButton");
          var a = document.getElementById("preChatSearchContainer"),
            b =
              '<div id="preChatSearchSearching" style="text-align: center; display: block; line-height: 200px;">  <img src=\'' +
              staticBaseURL +
              "/wbg/loading.gif'/></div> ";
          (preChatSearchQuestion = document.getElementById(
            "preChatSearchQuestionTextArea"
          ).value),
            (a.innerHTML = b);
          var c =
            baseURL +
            "/chatjs/preChatSearch?criteria=" +
            encodeURIComponent(preChatSearchQuestion) +
            "&widget=" +
            SnapABug.getWidgetId() +
            "&locale=" +
            SnapABug.getLocale();
          SnapABug.rpc(c, 3, "preChatSearchSubmit");
        },
        callbackSearchAction: function (a) {
          function b() {
            var a = document.getElementById("SnapABug_CM").parentNode,
              b = parseInt(a.style.height, 10),
              c = e.offsetHeight,
              d = g.offsetHeight,
              h = b - c - d - 20;
            f.style.height = h + "px";
          }
          if (SnapABug.isCustomDesignEnabled())
            return void SnapABug.getCustomDesignUI().intelliPrechatController.callbackSearchResults(
              a
            );
          if (!a || a.length <= 0)
            return void SnapABug.preChatSearchStartChat();
          var c = document.getElementById("preChatSearchContainer"),
            d =
              '<div style="padding: 0px 5px 0px 5px; text-align: left;">   <div id="preChatResultsHeader" style="padding-bottom: 10px; font-style: normal; line-height: normal; text-shadow: none; list-style: none; text-align: left; outline: none; text-indent: 0px; -moz-box-shadow: none; -webkit-box-shadow: none; font-family: \'lucida grande\', \'Helvetica Neue\', Helvetica, Arial, sans-serif; font-size: 12px; font-weight: 600; color: #61656d;">    ' +
              SnapABug.getMessage(17) +
              '  </div>  <div id="preChatSearchResultsForm">     <div id="preChatSearchSearchResults" style="outline: 1px solid #dddddd; overflow-y: scroll; overflow-x: hidden;"></div>   </div>   <div id="preChatSearchResultsSubmitArea" style="width:100%;">     <div style="padding-top: 15px; text-align: left; ' +
              SnapABug.getDisplayInlineBlockCSS() +
              '">       <a id="preChatSearchBackButton" href="#" style="color: #999; text-decoration: none; height: 1.5em;">        ' +
              SnapABug.getMessage(19) +
              '      </a>    </div>     <div style="padding-top: 10px; float: right; ' +
              SnapABug.getDisplayInlineBlockCSS() +
              '">       <a id="preChatSearchHelpButton" href="#" style="color: #999; text-decoration: none; cursor: pointer; outline: none; border: 1px solid rgb(160, 161, 160); background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, from(rgb(255, 255, 255)), to(rgb(199, 201, 199))); padding: 3px 8px 3px 8px; width: auto; overflow: visible; border-radius: 10px; color: rgb(81, 85, 93); font-size: 12px; font-family: \'Helvetica Neue\', Helvetica, \'lucida grande\', Arial, sans-serif; text-decoration: none; font-weight: bold; ' +
              SnapABug.getDisplayInlineBlockCSS() +
              '">        ' +
              SnapABug.getMessage(20) +
              "      </a>    </div>   </div> </div> ";
          c.innerHTML = d;
          var e = document.getElementById("preChatResultsHeader"),
            f = document.getElementById("preChatSearchSearchResults"),
            g = document.getElementById("preChatSearchResultsSubmitArea"),
            h = document.getElementById("preChatSearchBackButton"),
            i = document.getElementById("preChatSearchHelpButton");
          (h.onclick = function () {
            return SnapABug.preChatSearchShowSearchForm(), !1;
          }),
            (i.onclick = function () {
              return SnapABug.preChatSearchStartChat(), !1;
            });
          for (
            var j =
                '<ul style="list-style-type: none; padding: 0; margin: 0px;">',
              k = 0;
            k < a.length;
            k += 1
          )
            j =
              j +
              '<li>  <div style="white-space: nowrap; padding: 5px; cursor: pointer;" onclick="window.open(\'' +
              a[k].link +
              '\', \'_blank\');" onmouseover="this.style.backgroundColor=\'#e0ecfd\';" onmouseout="this.style.backgroundColor=\'white\';" style="background-color: white;">     <img style="padding-right: 3px;" height="12" width="12" src="' +
              baseURL +
              '/img/document.png"/>    <span style="font-family: \'lucida grande\', \'Helvetica Neue\', Helvetica, Arial, sans-serif; font-size: 12px; font-weight: bold; text-overflow: ellipsis;">      <a target="_blank" style="color: #5d7584; text-decoration: none;" href="' +
              a[k].link +
              '">' +
              a[k].title +
              "</a>    </span>    <div style=\"font-family: 'lucida grande', 'Helvetica Neue', Helvetica, Arial,sans-serif; font-size: 11px; white-space: normal; line-height: normal;\">" +
              a[k].summary +
              '</div>  </div>  <div style="padding-top: 3px; border-bottom: 1px solid #d0d0d0; margin-bottom:' +
              (k !== a.length - 1 ? "3px" : "none") +
              ';"></div></li>';
          (j += "</ul>"), (f.innerHTML = j), b();
        },
        preChatSearchStartChat: function () {
          if ((SnapABug.setPreChatSearch(0), "" == startChatMessage)) {
            var a = [-1, -1, -1, -1];
            SnapABug.formPosX && SnapABug.formPosY
              ? ((a[0] = SnapABug.formPosX), (a[2] = SnapABug.formPosY))
              : (a = SnapABug.getDefaultChatPosition()),
              SnapABug.setDescription(preChatSearchQuestion),
              SnapABug.loadForm(),
              SnapABug.positionForm(a[0], a[1], a[2], a[3]);
          } else
            preChatSearchQuestion &&
              (SnapABug.setDescription(preChatSearchQuestion),
              SnapABug.setStartChat(preChatSearchQuestion)),
              (visitorFirstMessage = preChatSearchQuestion
                ? preChatSearchQuestion
                : "n/a"),
              SnapEngage.startChat(preChatSearchQuestion, !0);
        },
        deactivateHTML: function (a) {
          return a
            .replace(/>/g, "&gt;")
            .replace(/</g, "&lt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#x27;");
        },
        removeHTMLTags: function (a) {
          return a.replace(/<[^>]*>/g, " ").replace(/\s{2,}/g, " ");
        },
        setJSVariables: function (a) {
          jsvars = a;
        },
        setSecureConnection: function () {},
        setSecureConnexion: function () {},
      };
    })();
    window.SnapABugChat = (function () {
      var caseId = "",
        baseURL = "",
        timer = null,
        proactiveRulesTimers = {},
        pollCount = 0,
        totalPollCount = 0,
        lastTypedText = "",
        _useStaticAgentName = !1,
        _useStaticAgentAvatar = !1,
        nickname = "",
        prevNickname = "",
        avatarURL = "",
        botButtonOptions = "",
        prevAvatarURL = "",
        prevMsgFrom = "",
        readonly = !1,
        webCapInProgress = !1,
        history = "",
        userInput = "",
        introMsg = !0,
        customIntroMsg = "",
        question = "",
        questionKeptForCanceledChat = "",
        chatview = "",
        pollId = 0,
        chatAnswered = !1,
        transcriptAgentCSS = "color:#75A7fE;",
        transcriptVisitorCSS = "color:#A1A1A3;",
        transcriptTextCSS = "color:black;",
        transcriptPadding = 7,
        minimized,
        minimizedDimensions = [0, 0, 0, 0],
        _chatMenuButtonHeight,
        _isFirstInit = !0,
        bgURL = SnapABug.getStaticBaseURL() + "/wbg/snapengage_chat_form.png",
        bgCallMeURL =
          SnapABug.getStaticBaseURL() + "/wbg/snapengage_chat_form.png",
        pageTitle = document.title,
        proactiveMsg = "",
        proactiveCommands = [],
        msgIdLst = null,
        postChatIframeURL = "",
        postChatHTML = "",
        proactiveMessageBuffer = "",
        pageInitTime = +new Date(),
        reassignDelay,
        reassignmentTimerId,
        approvedDate,
        secureCookies = !1,
        chatAgentSurvey = null,
        surveyGracePeriod = -1,
        selectedAgentSurveyRating = null,
        fileUploadInProgress = !1,
        secureDataTransferInProgress = !1,
        WAGTTimeout,
        isApprovalBotChat = !1,
        isHumanResponded = !1,
        typingDiv,
        SYSTEM_COMMANDS = {
          AUTO_TRANSLATE: "TRSL",
        };
      return {
        setCaseId: function (a) {
          caseId = a;
        },
        getCaseId: function () {
          return caseId;
        },
        proactiveRulesTimers: proactiveRulesTimers,
        resetPageInitTime: function () {
          pageInitTime = +new Date();
        },
        reInitProactiveRules: function () {
          SnapABugChat.resetPageInitTime(),
            Object.keys(proactiveRulesTimers).forEach(function (a) {
              return Array.isArray(proactiveRulesTimers[a])
                ? void proactiveRulesTimers[a].forEach(function (b) {
                    clearTimeout(b), delete proactiveRulesTimers[a][b];
                  })
                : (clearTimeout(proactiveRulesTimers[a]),
                  void delete proactiveRulesTimers[a]);
            }),
            SnapABug.proactiveChatInitialize();
        },
        startChat: function (a, b) {
          this.initChat(a, b);
        },
        restartChat: function (a, b) {
          if (
            ((introMsg = !1),
            this.initChat(a, b),
            SnapABug.getPageChangeNotificationAllowed()
              ? this.sendChatMessage(7, window.location.href)
              : this.sendChatMessage(7, ""),
            this.setReadOnly(!1),
            this.setPreviousChatWindowState(),
            this.startPolling(),
            !SnapABugChat.isMinimized())
          ) {
            var c = document.SnapABug_Form;
            c && c.chat.focus();
          }
        },
        getProactiveChatPrompt: function () {
          return proactiveMessageBuffer;
        },
        preloadChatFormImg: function () {
          if (
            !SnapABug.isMobileEnabled() &&
            !SnapABug.isCustomDesignEnabled()
          ) {
            var a = new Image();
            a.src = bgURL;
          }
        },
        getNickname: function () {
          return nickname;
        },
        setIsApprovalBotChat: function (a) {
          isApprovalBotChat = a;
        },
        getIsApprovalBotChat: function () {
          return isApprovalBotChat;
        },
        setIsHumanResponded: function (a) {
          isHumanResponded = a;
        },
        getIsHumanResponded: function () {
          return isHumanResponded;
        },
        proactive: function (a, b, c, d, e, f) {
          SnapEngage.isIE11() && (f = !1),
            SnapABug.isMobileEnabled()
              ? (SnapABug.getMobileUI().proactive(a, b, c, d, e),
                (proactiveMessageBuffer = a))
              : SnapABug.isCustomDesignEnabled()
              ? (SnapABug.getCustomDesignUI().proactive(a, c, d, e, f),
                (proactiveMessageBuffer = a),
                (nickname = c),
                b && this.newMessageNotification())
              : ((baseURL = SnapABug.getBaseURL()),
                (avatarURL = d),
                "" == caseId &&
                  ((nickname = c),
                  this.showFormChat(),
                  " " != a
                    ? "/info " == a.substr(0, 6)
                      ? (proactiveMsg = a.substr(6))
                      : (d && (avatarURL = d),
                        (proactiveMsg = this.createTranscriptLine(c, a)),
                        (proactiveMessageBuffer = a))
                    : (proactiveMsg = " "),
                  (history = proactiveMsg),
                  SnapABugChat.displayHistory(),
                  SnapABug.slideFormIn(),
                  b && this.newMessageNotification(),
                  this.setReadOnly(!1),
                  "" != c && SnapABug.callCallback("OpenProactive", c, a),
                  SnapABug.setProactiveChatAutocloseTimeout()));
        },
        chatStarting: function () {
          document.getElementById("SnapABug_CL") ||
            SnapABug.isMobileEnabled() ||
            SnapABug.isCustomDesignEnabled() ||
            ((baseURL = SnapABug.getBaseURL()),
            this.showFormChat(),
            this.setReadOnly(!0));
        },
        setSecureCookies: function () {
          secureCookies = !0;
        },
        initChat: function (a, b) {
          (caseId = a),
            (baseURL = b),
            (pollCount = 0),
            (pollId = 0),
            (nickname = ""),
            (readonly = !1),
            (webCapInProgress = !1),
            (chatAnswered = !1),
            (msgIdLst = {});
          var c = document.SnapABug_Form;
          (userInput = c && c.chat ? c.chat.value : ""),
            "" == history && "" != proactiveMsg && (history = proactiveMsg),
            (proactiveMsg = ""),
            SnapABug.disableCallMe(),
            this.setCaseIdCookie(),
            this.setChatViewCookie(),
            SnapABug.isMobileEnabled() ||
              SnapABug.isCustomDesignEnabled() ||
              this.showFormChat();
        },
        setCustomIntroMsg: function (a) {
          customIntroMsg = a;
        },
        isFirstInit: function () {
          return _isFirstInit;
        },
        reInit: function () {
          (_isFirstInit = !1),
            (avatarURL = ""),
            (prevAvatarURL = ""),
            (prevNickname = ""),
            (proactiveMessageBuffer = ""),
            (history = ""),
            (prevMsgFrom = ""),
            this.setReadOnly(!0),
            window.clearChatReassignmentTimer &&
              window.clearChatReassignmentTimer(),
            (approvedDate = void 0),
            SnapABug.isCustomDesignEnabled() ||
              ((SnapABug.formPosY = -1), (SnapABug.formPosX = -1)),
            SnapABugChat.resetChatWindowCookieData(),
            SnapABugChat.setIsApprovalBotChat(!1),
            SnapABugChat.setIsHumanResponded(!1);
        },
        isProactive: function () {
          return "" != proactiveMsg;
        },
        clearProactive: function () {
          (proactiveMsg = ""),
            (proactiveCommands = []),
            (SnapEngage.proactiveAgentNumber = ""),
            SnapABug.clearProactiveChatAutocloseTimeout();
        },
        formatRpcUrl: function (a) {
          var b = snapEngageUtils.formatRpcUrl(a);
          return b;
        },
        setReassignmentTimerAfterRestartChat: function (a) {
          window.setChatReassignmentTimer(a);
        },
        isAgentTyping: function () {
          var a = SnapABug.getCustomDesignUI().chatView.messageView.iframe.getElementById(
            "agent-is-typing"
          );
          return !!a;
        },
        callAssignNewAgent: function () {
          window.requestChatReassignment(SnapABugChat.isAgentTyping());
        },
        callbackAssignNewAgent: function (a) {
          a && window.clearChatReassignmentTimer();
        },
        soundNotificationDiv: function () {
          return "";
        },
        populateChatForm: function () {
          var a = 350,
            b = 370,
            c =
              '<div style="left:0;top:0;z-index:1;"><img src="' +
              bgURL +
              '" style="' +
              SnapABug.getCSS(0, 0, a, b) +
              '" galleryimg="no" width="' +
              a +
              '" height="' +
              b +
              '" /></div><div id="SnapABug_CL" style="' +
              SnapABug.getCSS(
                37,
                38,
                265 - transcriptPadding,
                228,
                "background:none;font-family:arial,sans-serif;font-size:12px;font-weight:normal;color:black;",
                "overflow:auto;margin-left:" + transcriptPadding + "px;"
              ) +
              '"></div><form name="SnapABug_Form" accept-charset="UTF-8" action="#" onsubmit="return SnapABugChat.submitChat();"><textarea id="SnapABug_CE" style="' +
              SnapABug.getCSS(
                39,
                280,
                262,
                46,
                "font-family:arial,sans-serif;font-size:12px;font-weight:normal;color:black;",
                "vertical-align:top;resize:none;background-image:url('" +
                  SnapABug.getBlankImg() +
                  "');background-repeat:repeat;overflow:auto;"
              ) +
              '" type="text" name="chat" onkeydown="return SnapABugChat.keyDownHandler(event);" onclick="return SnapABugChat.keyDownHandler(event);"></textarea></form>',
            d = 23,
            e = 23;
          (c +=
            '<div style="' +
            SnapABug.getCSS(311, 15, d, e, "cursor:pointer;") +
            '" onclick="SnapABug.closeForm();" title="' +
            SnapABug.getMessage(10) +
            '"><img style="margin:0;border:none;padding:0;width:' +
            d +
            "px;height:" +
            e +
            'px;" src="' +
            SnapABug.getBlankImg() +
            '" width="' +
            d +
            '" height="' +
            e +
            '" alt="' +
            SnapABug.getMessage(10) +
            '" /></div>' +
            this.soundNotificationDiv()),
            SnapABug.isBranded() &&
              ((c +=
                '<div style="' + SnapABug.getCSS(305, 128, 16, 138) + '">'),
              SnapABug.logoLink() && (c += SnapABug.getLogoClickATag()),
              (c +=
                '<img style="margin:0;border:none;padding:0;" src="' +
                SnapABug.getStaticBaseURL() +
                '/wbg/logo_chat_vertical.png" border="0" alt="powered by SnapEngage" width="16" height="138" />'),
              SnapABug.logoLink() && (c += "</a>"),
              (c += "</div>")),
            (c +=
              '<div id="SnapABug_CallMe" style="' +
              SnapABug.getCSS(36, 332, 78, 16) +
              '">' +
              SnapABug.getCallMeButton() +
              "</div>"),
            (document.getElementById("SnapABug_P").innerHTML = c),
            SnapABug.positionDragger(25, 16, 282, 21),
            SnapABug.showForm(!1, a, b, 19, 18, 304, 331);
        },
        populateSubChatForm: function (a, b) {
          var c = 350,
            d = 370,
            e = "white",
            f = "#8e8e8e",
            g =
              '<div style="left:0;top:0;z-index:1;"><img src="' +
              bgCallMeURL +
              '" style="' +
              SnapABug.getCSS(0, 0, c, d) +
              '" galleryimg="no" width="' +
              c +
              '" height="' +
              d +
              '" /></div><div style="' +
              SnapABug.getCSS(
                36,
                37,
                266,
                290,
                "z-index:2;background-color:" +
                  e +
                  ";font-family:arial,sans-serif;font-size:12px;font-weight:normal;color:black;overflow:hidden;border:1px solid " +
                  f +
                  ";text-align:center;"
              ) +
              '"><div id="SnapABug_CM" style="position:relative;text-align:center;">' +
              a +
              "</div></div>",
            h = 23,
            i = 23;
          b &&
            (g +=
              '<div style="' +
              SnapABug.getCSS(311, 15, h, i, "cursor:pointer;") +
              '" onclick="' +
              b +
              '" title="' +
              SnapABug.getMessage(10) +
              '"><img style="margin:0;border:none;padding:0;width:' +
              h +
              "px;height:" +
              i +
              'px;" src="' +
              SnapABug.getBlankImg() +
              '" width="' +
              h +
              '" height="' +
              i +
              '" alt="' +
              SnapABug.getMessage(10) +
              '" /></div>'),
            (g += this.soundNotificationDiv()),
            SnapABug.isBranded() &&
              ((g +=
                '<div style="' + SnapABug.getCSS(305, 128, 16, 138) + '">'),
              SnapABug.logoLink() && (g += SnapABug.getLogoClickATag()),
              (g +=
                '<img style="margin:0;border:none;padding:0;" src="' +
                SnapABug.getStaticBaseURL() +
                '/wbg/logo_chat_vertical.png" border="0" alt="powered by SnapEngage" width="16" height="138" />'),
              SnapABug.logoLink() && (g += "</a>"),
              (g += "</div>")),
            (document.getElementById("SnapABug_P").innerHTML = g),
            SnapABug.positionDragger(25, 16, 282, 21),
            SnapABug.showForm(!1, c, d, 19, 18, 304, 331);
        },
        populateCallMeForm: function (a, b) {
          var c, d;
          document.getElementById("SnapABug_CL")
            ? ((c = SnapABugChat.getChatTranscriptWidth() + "px"),
              (d =
                Math.round(0.75 * SnapABugChat.getChatTranscriptWidth()) +
                "px"))
            : document.getElementById("SnapABug_CM")
            ? ((c = SnapABugChat.getPostChatWidth() + "px"),
              (d = Math.round(0.75 * SnapABugChat.getPostChatWidth()) + "px"))
            : ((c = "230px"), (d = "172px"));
          var e = "#4d4d4d",
            f = "#FFFFFF",
            g = SnapABug.getStaticBaseURL() + "/wbg/callme_phone_grey.png",
            h = SnapABug.getStaticBaseURL() + "/wbg/callme_phone_black.png",
            i = SnapABug.getStaticBaseURL() + "/wbg/callme_web_grey.png",
            j = SnapABug.getStaticBaseURL() + "/wbg/callme_web_black.png",
            k = SnapABug.getMessage(38),
            l = SnapABug.getMessage(39),
            m = SnapABug.getMessage(40),
            n = "",
            o = SnapABug.isIE6() || SnapABug.isIE7() || SnapABug.isIE8(),
            p = function () {
              if (!a && caseId) {
                var p =
                  "document.getElementById(&apos;SnapABug_CMW&apos;).style.backgroundImage=&apos;url(" +
                  j +
                  ")&apos;;";
                p +=
                  "document.getElementById(&apos;SnapABug_CMW&apos;).style.color=&apos;" +
                  f +
                  "&apos;;";
                var q =
                  "if (document.getElementById(&apos;SnapABug_CMW&apos;)) {";
                (q +=
                  "document.getElementById(&apos;SnapABug_CMW&apos;).style.backgroundImage=&apos;url(" +
                  i +
                  ")&apos;;"),
                  (q +=
                    "document.getElementById(&apos;SnapABug_CMW&apos;).style.color=&apos;" +
                    e +
                    "&apos;;"),
                  (q += "}");
                var r =
                  "width:" +
                  c +
                  ";height:86px;margin:20px auto 0 auto;background-image:url(" +
                  i +
                  ");";
                r +=
                  "background-repeat: no-repeat no-repeat;background-position:center;cursor:pointer;position:relative;color:" +
                  e +
                  ";";
                var s =
                    "width:" +
                    c +
                    ";position:absolute;bottom:5px;margin-top:3px;font-family:arial,sans-serif;font-size:12px;font-weight:normal;font-weight:bold;",
                  t =
                    "document.getElementById(&apos;SnapABug_CMP&apos;).style.backgroundImage=&apos;url(" +
                    h +
                    ")&apos;;";
                t +=
                  "document.getElementById(&apos;SnapABug_CMP&apos;).style.color=&apos;" +
                  f +
                  "&apos;;";
                var u =
                  "if (document.getElementById(&apos;SnapABug_CMP&apos;)) {";
                (u +=
                  "document.getElementById(&apos;SnapABug_CMP&apos;).style.backgroundImage=&apos;url(" +
                  g +
                  ")&apos;;"),
                  (u +=
                    "document.getElementById(&apos;SnapABug_CMP&apos;).style.color=&apos;" +
                    e +
                    "&apos;};");
                var v =
                    "width:" +
                    c +
                    ";height:86px;margin:20px auto 0 auto;background-image:url(" +
                    g +
                    "); background-repeat: no-repeat no-repeat;background-position:center;cursor:pointer;position:relative;color:" +
                    e +
                    ";",
                  w =
                    "width:" +
                    c +
                    ";position:absolute;bottom:5px;margin-top:3px;font-family:arial,sans-serif;font-size:12px;font-weight:normal;font-weight:bold;",
                  x =
                    '<div id="SnapABug_CMW" onclick="SnapABugChat.submitFormCallMe(true, true)" onmouseover="' +
                    p +
                    '" onmouseout="' +
                    q +
                    '"style="' +
                    r +
                    '">';
                (x += '<div style="' + s + '">' + k + "</div>"),
                  (x += "</div>"),
                  SnapABug.isIE() || SnapABug.isSafari()
                    ? SnapABug.hasFlash() && (n += x)
                    : (n += x),
                  (n +=
                    '<div id="SnapABug_CMP" onclick="SnapABugChat.populateCallMeForm(true);" onmouseover="' +
                    t +
                    '" onmouseout="' +
                    u +
                    '" style="' +
                    v +
                    '">'),
                  (n += '<div style="' + w + '">' + l + "</div>"),
                  (n += "</div>");
              } else {
                b || (b = ""), (a = !0);
                var y =
                    "width:" +
                    c +
                    ";margin:20px auto;padding:10px 0px;border-radius:10px;-moz-border-radius:10px;-webkit-border-radius:10px;background-color:white;",
                  z =
                    "margin-top:6px;margin-bottom:6px;font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;font-weight:default;color:grey;",
                  A = "margin:0px;",
                  B =
                    "height:30px;max-width:" +
                    d +
                    ";margin-top:0px;margin-top:0px;font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;font-size:13px;color:black;border:2px inset;" +
                    (b ? "border-color:red;" : ""),
                  C =
                    "width:auto;height:28px;margin:0;margin-top:6px;padding:3px 5px 3px 5px;font-size:12px;font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;cursor:pointer;font-weight:bold;";
                (n += '<div id="SnapABug_CMPFORM" style="' + y + '">'),
                  (n +=
                    '<div id="SnapABug_phone" style="' +
                    z +
                    '">Enter your phone number</div>'),
                  (n +=
                    '<form name="SnapABug_Form" id="SnapABug_Form" accept-charset="UTF-8" style="' +
                    A +
                    '" action="#">'),
                  (n +=
                    '<input style="' +
                    B +
                    '" type="text" id="phonenumber" name="phonenumber" value="' +
                    b +
                    '" size="16"/><br />'),
                  (n +=
                    '<span id="SnapABug_CallMeSubmit"><input onclick="return SnapABugChat.submitFormCallMe(true);" style="' +
                    C +
                    '" type="submit" value="Call Me Now" /></span>'),
                  (n += "</form>"),
                  (n += "</div>");
              }
              history &&
                (n +=
                  '<div onclick="return SnapABugChat.submitFormCallMe(false);" style="color:grey;width:' +
                  c +
                  ';height:28px;margin:20px auto;padding:10px 0px;font-size:12px;font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;text-align:left;cursor:pointer;">' +
                  m +
                  "</div>"),
                SnapABugChat.populateSubChatForm(
                  n,
                  "SnapABugChat.submitFormCallMe(false);"
                ),
                a &&
                  !o &&
                  (SnapABug.phonePicker.init(
                    "phonenumber",
                    SnapABug.getVisitorCountry()
                  ),
                  SnapABugChat.selectPhoneInputCountry(
                    SnapABug.getVisitorCountry()
                  ),
                  SnapABug.phonePicker.setCountryListWindowHeight(150));
              var D = document.getElementById("SnapABug_CM");
              D.style.top = Math.round((290 - D.offsetHeight) / 2) + "px";
            };
          if (SnapABug.phonePicker) p();
          else {
            window._1a058890_5788_4457_aa0e_3453f3f878a0 = SnapABug;
            var q = document.createElement("script");
            (q.type = "text/javascript"),
              (q.src =
                SnapABug.getBaseURL() +
                "/js/i18nphonepicker/i18nphonepicker-min.js"),
              (q.onload = function () {
                var a = document.createElement("link");
                (a.rel = "stylesheet"),
                  (a.type = "text/css"),
                  (a.href =
                    SnapABug.getBaseURL() +
                    "/js/i18nphonepicker/css/intlTelInput.css"),
                  document.getElementsByTagName("head")[0].appendChild(a),
                  p();
              }),
              document.getElementsByTagName("head")[0].appendChild(q);
          }
        },
        selectPhoneInputCountry: function (a) {
          if (
            (("string" == typeof a || a instanceof String) &&
              (a = a.toLowerCase()),
            SnapABug.phonePicker)
          ) {
            var b = SnapABug.phonePicker.getCountryData();
            if (b.countries && a)
              for (var c = 0; c < b.countries.length; c++)
                a === b.countries[c].iso2 &&
                  SnapABug.phonePicker.selectCountry(a);
          }
        },
        isPhoneNumberValid: function () {
          var a;
          return (
            (a = SnapABug.isCustomDesignEnabled()
              ? SnapABug.getCustomDesignIframe().getElementById("callme-form")
              : document.getElementById("SnapABug_Form")),
            !!(a && a.phonenumber && a.phonenumber.value) &&
              /^\+{0,1}[\d \(\)-.]+[xX]{0,1}[wW]*[\d \(\)\-]+$/.test(
                a.phonenumber.value
              ) &&
              a.phonenumber.value.length > 5
          );
        },
        submitFormCallMe: function (a, b) {
          if (a)
            if ((SnapABug.disableCallMe(), b))
              window.open(
                SnapABug.getBaseURL().replace(/http\:/, "https:") +
                  "/voice/webphone.jsp?c=" +
                  SnapABug.getCaseId(),
                "webphone",
                "left=20,top=20,width=310,height=260,toolbar=0,location=0,directories=0,status=0,menubar=0,scrollbars=0,resizable=1"
              ),
                SnapABug.callCallback("StartCallme", ""),
                caseId
                  ? SnapABugChat.formCallMeDone()
                  : SnapABug.hideOverlay(!1);
            else {
              var c,
                d = "";
              if (
                ((c = SnapABug.isCustomDesignEnabled()
                  ? SnapABug.getCustomDesignIframe().getElementById(
                      "callme-form"
                    )
                  : document.getElementById("SnapABug_Form")),
                c && c.phonenumber && c.phonenumber.value)
              ) {
                if (!SnapABugChat.isPhoneNumberValid())
                  return void SnapABug.callbackCheckPhone(!1);
                d = c.phonenumber.value.replace(/[^+0-9xX]*/g, "");
              }
              "" != d &&
                (SnapABug.setCallMePhone(d),
                SnapABug.sendCheckPhone(d),
                SnapABug.isCustomDesignEnabled() ||
                  (document.getElementById("SnapABug_CallMeSubmit").innerHTML =
                    "Please wait..."));
            }
          else
            SnapABug.enableCallMe(),
              caseId || SnapABugChat.isProactive()
                ? SnapABugChat.formCallMeDone()
                : SnapABug.hideOverlay(!1);
          return !1;
        },
        showFormChat: function () {
          if (
            !SnapABug.isMobileEnabled() &&
            !SnapABug.isCustomDesignEnabled()
          ) {
            var a =
              "word-wrap: break-word;-ms-word-break: keep-all;word-break: keep-all;word-break: break-word;-webkit-hyphens: auto;-moz-hyphens: auto;-ms-hyphens: auto;hyphens: auto;white-space: pre-wrap;";
            SnapABug.addStyleRule(["#SnapABug_CL .SnapABug_transcriptLine"], a),
              this.populateChatForm();
          }
          this.isProactive() &&
            ((history = proactiveMsg), this.setReadOnly(!1)),
            "" != history ? this.displayHistory() : this.setReadOnly(!0);
          var b = document.SnapABug_Form;
          b &&
            ("" != userInput
              ? ((b.chat.value = userInput), (userInput = ""))
              : "" != question &&
                "(none)" != question &&
                ("" == history &&
                  this.appendTextToChat(
                    SnapABug.getMessage(15),
                    question + "<br />",
                    !1,
                    !1,
                    !1
                  ),
                (question = "")),
            introMsg
              ? "" != customIntroMsg
                ? (b.chat.value = customIntroMsg)
                : (b.chat.value = unescape(SnapABug.getMessage(14)))
              : SnapABugChat.isMinimized() || b.chat.focus(),
            "" != this.getMessageCookie() &&
              ((introMsg = !1),
              (b.chat.value = this.getMessageCookie()),
              this.setMessageCookie("")));
        },
        displayHistory: function () {
          var a = document.getElementById("SnapABug_CL");
          try {
            (a.innerHTML =
              history + this.createTranscriptLine(nickname, "", !0)),
              this.scrollDown();
          } catch (a) {}
        },
        startPolling: function () {
          timer && this.stopPolling(),
            (timer = setInterval("SnapABugChat.pollChat()", 2e3));
          SnapABugChat.pollChat();
        },
        stopPolling: function () {
          clearInterval(timer);
        },
        keyDownHandler: function (a) {
          var b,
            c = a || window.event,
            d = c.keyCode || c.which;
          return c && 13 == d
            ? (c.ctrlKey
                ? ((b = document.SnapABug_Form),
                  b && (b.chat.value = b.chat.value + "\n"))
                : readonly ||
                  (caseId || SnapABug.clearProactiveChatAutocloseTimeout(),
                  this.submitChat()),
              c.stopPropagation && c.stopPropagation(),
              c.preventDefault && c.preventDefault(),
              c.cancelBubble && (c.cancelBubble = !0),
              c.returnValue && (c.returnValue = !1),
              !1)
            : (introMsg &&
                ((b = document.SnapABug_Form),
                b && (b.chat.value = ""),
                (introMsg = !1)),
              caseId || SnapABug.setProactiveChatAutocloseTimeout(),
              !0);
        },
        submitChat: function () {
          var a = document.SnapABug_Form;
          if (a) {
            var b = a.chat.value;
            introMsg
              ? (a && (a.chat.value = ""), (introMsg = !1))
              : "" != b &&
                (this.appendTextToChat(
                  SnapABug.getMessage(15),
                  SnapABug.deactivateHTML(b),
                  !1,
                  !1,
                  !1
                ),
                this.isProactive()
                  ? (SnapABug.sendCreateCase(
                      SnapABug.getUserEmail(),
                      b,
                      !0,
                      !1
                    ),
                    this.setReadOnly(!0))
                  : this.sendChatMessage(1, SnapABug.deactivateHTML(b)),
                (a.chat.value = ""),
                (lastTypedText = "")),
              a.chat.focus();
          }
          return !1;
        },
        setReadOnly: function (a) {
          readonly = a;
          try {
            var b = document.getElementById("SnapABug_CE");
            b &&
              (readonly
                ? b.setAttribute("readOnly", "readonly")
                : b.removeAttribute("readOnly"));
          } catch (a) {}
        },
        callbackChatPosted: function (a) {},
        parseEmoji: function (a) {
          var b = /(:[^:\s]{1,}\|[^:\s]{4,}:)/g;
          return (
            a.match(b) &&
              (a = a.replace(b, function (a) {
                var b = a.split("|"),
                  c = b[1];
                c = c.substring(0, c.length - 1);
                var d = b[0].substring(1),
                  e =
                    '<img src="' +
                    SnapABug.getStaticBaseURL() +
                    "/img/emoji/twemoji/2/72x72/" +
                    c +
                    '.png" alt=":' +
                    d +
                    ':" width="16" height="16" />';
                return e;
              })),
            a
          );
        },
        appendTextToChat: function (a, b, c, d, e, f) {
          if (
            (this.setCaseIdCookie(),
            (b = b.replace(/\&\#41\;/g, ")")),
            (b = b.replace(/\&\#40\;/g, "(")),
            (b = b.replace(/\\n/g, "<br />")),
            (b = b.replace(/\n/g, "<br />")),
            (b = b.replace(/&lt; *br *\/*&gt;/g, "<br />")),
            (b = b.replace(/&lt; *BR *\/*&gt;/g, "<br />")),
            SnapABug.isMobileEnabled() ||
              SnapABug.isCustomDesignEnabled() ||
              ((b = b.replace(/(\s|^):\)/g, " :slightly_smiling_face|1f642:")),
              (b = b.replace(/(\s|^);\)/g, " :wink|1f609:")),
              (b = b.replace(/(\s|^):D/g, " :grinning|1f600:")),
              (b = b.replace(/(\s|^):\(/g, " :slightly_frowning_face|2639:")),
              (b = b.replace(/(\s|^):o/g, " :open_mouth|1f62e:")),
              (b = b.replace(/(\s|^):\-\)/g, " :slightly_smiling_face|1f642:")),
              (b = b.replace(/(\s|^);\-\)/g, " :wink|1f609:")),
              (b = b.replace(/(\s|^):\-D/g, " :grinning|1f600:")),
              (b = b.replace(/(\s|^):\-\(/g, " :slightly_frowning_face|2639:")),
              (b = b.replace(/(\s|^):\-o/g, " :open_mouth|1f62e:")),
              SnapABugChat.handleDataTransferInProgress()),
            (b = this.parseEmoji(b)),
            SnapABug.isMobileEnabled())
          )
            SnapABug.getMobileUI().updateChat(
              b,
              a == SnapABug.getMessage(15),
              c
            );
          else if (SnapABug.isCustomDesignEnabled())
            SnapABug.getCustomDesignUI().updateChat(
              b,
              a == SnapABug.getMessage(15),
              c,
              d,
              e,
              f
            );
          else {
            var g = document.getElementById("SnapABug_CL");
            (history += this.createTranscriptLine(a, b, !1)),
              (prevMsgFrom = a),
              1 != c &&
                g &&
                ((g.innerHTML =
                  history + this.createTranscriptLine(nickname, "", !0)),
                this.scrollDown());
          }
          systemMsgId = null;
        },
        setUseStaticAgentAvatar: function (a) {
          _useStaticAgentAvatar = a;
        },
        staticAgentAvatarEl: function () {
          return document.getElementById("SnapABug_AAvatar");
        },
        populateStaticAgentAvatar: function () {
          var a = this.staticAgentAvatarEl();
          a && a.src !== avatarURL && (a.src = avatarURL);
        },
        setUseStaticAgentName: function (a) {
          _useStaticAgentName = a;
        },
        staticAgentNameEl: function () {
          return document.getElementById("SnapABug_AName");
        },
        populateStaticAgentName: function () {
          var a = this.staticAgentNameEl();
          a && prevNickname !== nickname && (a.innerHTML = nickname);
        },
        createTranscriptLine: function (a, b, c) {
          var d = "",
            e = "",
            f = a === nickname;
          if (
            (history ||
              ((d += '<div style="height:' + transcriptPadding + 'px;"></div>'),
              _useStaticAgentAvatar && this.populateStaticAgentAvatar()),
            !c &&
              "" !== avatarURL &&
              f &&
              (_useStaticAgentAvatar ||
                ("" != prevNickname && prevNickname == nickname) ||
                (e +=
                  '<img src="' +
                  avatarURL +
                  '" style="float:left;margin-right:5px;padding:1px;border:1px solid #888;background-color:#fff;" width="53" height="53" />'),
              (prevAvatarURL = avatarURL),
              (prevNickname = nickname)),
            "" !== a && "Chat Bot" !== a && a != prevMsgFrom)
          ) {
            var g = f ? transcriptAgentCSS : transcriptVisitorCSS;
            e +=
              '<span style="' +
              g +
              "font-weight:bold;" +
              SnapABug.getDirection() +
              '">' +
              a +
              ":</span> ";
          }
          !c && "" !== avatarURL && f && ((e += "<br />"), (avatarURL = ""));
          var h = "",
            i = "";
          c
            ? ((h = 'id="SnapABug_Typing" '),
              (i = "visibility:hidden;"),
              (b =
                '<img src="' +
                baseURL +
                '/img/typing.gif" alt="[...]" width="24" height="8" />'))
            : f || (b = SnapABug.deactivateHTML(b));
          var j = 'class="SnapABug_transcriptLine" ';
          return (
            a != prevMsgFrom
              ? ("" != history && (d += '<div style="height:7px;"></div>'),
                (d +=
                  "<div " +
                  h +
                  j +
                  'style="clear:left;line-height:normal;' +
                  transcriptTextCSS +
                  i +
                  SnapABug.getDirection() +
                  '">' +
                  e +
                  b +
                  "</div>"))
              : (d +=
                  "<div " +
                  h +
                  j +
                  'style="line-height:normal;' +
                  transcriptTextCSS +
                  i +
                  SnapABug.getDirection() +
                  '">' +
                  e +
                  b +
                  "</div>"),
            d
          );
        },
        isTyping: function (a) {
          SnapABug.isMobileEnabled() && a
            ? SnapABug.getMobileUI().triggerIsTyping()
            : SnapABug.isCustomDesignEnabled()
            ? SnapABug.getCustomDesignUI().triggerIsTyping(a)
            : ((typingDiv = document.getElementById("SnapABug_Typing")),
              typingDiv &&
                (a
                  ? (typingDiv.style.visibility = "visible")
                  : (typingDiv.style.visibility = "hidden")));
        },
        scrollDown: function () {
          var a = document.getElementById("SnapABug_CL");
          a && (a.scrollTop = a.scrollHeight);
        },
        animateScrollDown: function (a, b, c) {
          var d = 0,
            e = 20,
            f = a.scrollHeight - b;
          a.scrollTop = b;
          var g = function () {
            d += e;
            var b = (f / c) * 100;
            (a.scrollTop += b), d < c && setTimeout(g, e);
          };
          g();
        },
        animateFadeOut: function (a) {
          if (!a) return !1;
          var b = function () {
            (a.style.opacity -= 0.03),
              a.style.opacity > 0
                ? (window.requestAnimationFrame && requestAnimationFrame(b)) ||
                  setTimeout(b, 20)
                : a.parentNode.removeChild(a);
          };
          isNaN(parseInt(a.style.opacity)) && (a.style.opacity = 1), b();
        },
        waitingForAgentMessage: function (a) {
          if (SnapEngageChat.getIsApprovalBotChat()) {
            if (SnapEngageChat.getIsHumanResponded()) return;
          } else if (SnapEngageChat.getChatAnsweredStatus()) return;
          "" != SnapEngage.getCaseId() &&
            ((systemMsgId = "WAGT_AUTO_RESPOND"),
            SnapABug.isCustomDesignEnabled()
              ? this.appendTextToChat("", a, !1, systemMsgId, !1)
              : ((a = a.replace(
                  /\[\[/g,
                  '<a href="#" onclick="SnapABugChat.cancelChat(); return false;">'
                )),
                (a = a.replace(/\]\]/g, "</a>")),
                (a = a.replace(
                  /\[/g,
                  '<a href="#" onclick="SnapABugChat.cancelChat(); return false;">'
                )),
                (a = a.replace(/\]/g, "</a>")),
                this.appendTextToChat("", "<br />" + a, !1, systemMsgId, !1)),
            clearTimeout(WAGTTimeout));
        },
        isVisitorTyping: function () {
          if (SnapABug.isMobileEnabled())
            return SnapABug.getMobileUI().isVisitorTyping();
          if (SnapABug.isCustomDesignEnabled())
            return SnapABug.getCustomDesignUI().isVisitorTyping();
          var a = !1,
            b = "",
            c = document.SnapABug_Form;
          return (
            c &&
              c.chat &&
              ((b = c.chat.value),
              !introMsg && b && lastTypedText != b && (a = !0)),
            (lastTypedText = b),
            a
          );
        },
        pollChat: function () {
          if (!this.isChatViewCookieValid() || "" == caseId)
            return (
              this.stopPolling(),
              SnapABug.isCustomDesignEnabled()
                ? SnapABug.getCustomDesignUI().destroy()
                : SnapABug.hideOverlay(!1),
              void SnapABug.setChatInProgress(!1)
            );
          if ((this.refreshChatViewCookie(), 0 == pollCount)) {
            var a =
                "c=" +
                encodeURIComponent(caseId) +
                "&i=" +
                this.getPollIdCookie(),
              b = new Date();
            if (
              ((a += "&t=" + b.getTime()),
              totalPollCount % 2 == 0 &&
                ((a += "&gt"),
                this.isVisitorTyping() && (a += "&st"),
                SnapABug.isSneakPeek()))
            ) {
              var c = "";
              if (SnapABug.isMobileEnabled())
                c = SnapABug.getMobileUI().getVisitorTyping();
              else if (SnapABug.isCustomDesignEnabled())
                c = SnapABug.getCustomDesignUI().getVisitorTyping();
              else {
                var d = document.SnapABug_Form;
                c = d && d.chat ? d.chat.value : "";
              }
              "" === c ||
                SnapABugChat.introMsg ||
                (a += "&tt=" + encodeURIComponent(c));
            }
            SnapABug.rpc(
              baseURL + "/chatjs/ServiceChatPoll?" + a,
              0,
              "pollChat"
            );
          }
          pollCount++, pollCount > 3 && (pollCount = 0), totalPollCount++;
        },
        callbackPolling: function (a, b, c) {
          (b !== -1 && 1 == msgIdLst[b]) ||
            ((msgIdLst[b] = 1),
            b != -1 && this.setPollIdCookie(b),
            this.callbackMessage(!0, a, !1)),
            1 == c
              ? this.isTyping(!0)
              : 2 != c || SnapABug.getChatHandledByBot() || this.isTyping(!1),
            (pollCount = 0);
        },
        sendChatMessage: function (a, b, c) {
          var d = "a=" + a + "&c=" + encodeURIComponent(caseId),
            e = new Date();
          (d += "&t=" + e.getTime()),
            "" != b && (d += "&m=" + encodeURIComponent(b)),
            c && c.buttonId && (d += "&i=" + encodeURIComponent(c.buttonId));
          var f = baseURL + "/chatjs/ServiceChatMessage?" + d;
          f.length > 2e3 &&
            ((d = "a=" + a + "&c=" + encodeURIComponent(caseId)),
            (d += "&t=" + e.getTime()),
            (d += "&m=" + encodeURIComponent("[truncated message] " + b)),
            (f = baseURL + "/chatjs/ServiceChatMessage?" + d)),
            (f = this.formatRpcUrl(f)),
            SnapABug.rpc(f, 3, "sendChatMessage"),
            1 == a &&
              (SnapABug.callCallback("ChatMessageSent", b),
              SnapABug.getChatHandledByBot() &&
                SnapABug.isChatInProgress() &&
                SnapABug.getCustomDesignUI()
                  .chatView.getMessageView()
                  .triggerAgentIsTyping(!0));
        },
        handleNewMessageFormat: function (a, b, c, d) {
          var e = {
            inline_buttons: handleButtonMessage,
            text: handleTextMessage,
            cards: handleSearchResultsMessage,
            link_text: handleLinkTextMessage,
          };
          try {
            return e[a.type](a, b, c, d);
          } catch (a) {
            allowedDomains = ["timzon000", "localhost"];
            for (var f = 0; f < allowedDomains.length; f++)
              document.location.href.indexOf(allowedDomains[f]) > 0 &&
                console.log("Error: ", a);
          }
        },
        getSecureDataTransferURL: function (a) {
          return (
            SnapABug.getBaseURL() +
            "/secureDataTransferRequest?casePublicId=" +
            SnapABug.getCaseId() +
            "&type=" +
            a
          );
        },
        callbackMessage: function (fromAgent, textMsg, replay, historyOnly) {
          if ("string" != typeof textMsg)
            return void this.handleNewMessageFormat(
              textMsg,
              fromAgent,
              replay,
              historyOnly
            );
          if ("" != textMsg) {
            textMsg = decodeURIComponent(textMsg).replace(/\%20/g, " ");
            var from = nickname,
              cmd = textMsg.substr(0, 4);
            switch (cmd) {
              case "/BYE":
                replay ||
                  ((systemMsgId = "BYE_BYE"),
                  this.appendTextToChat(
                    "",
                    textMsg.substr(5),
                    !1,
                    systemMsgId,
                    !1
                  ),
                  this.setReadOnly(!0),
                  this.closeChat(),
                  SnapABug.disableCallMe(),
                  SnapABug.isMobileEnabled()
                    ? SnapABug.getMobileUI().endChat()
                    : SnapABug.isCustomDesignEnabled() &&
                      SnapABug.getCustomDesignUI().endChat(!1));
                break;
              case "/NIC":
                (nickname = textMsg.substr(5)),
                  SnapABug.isMobileEnabled()
                    ? SnapABug.getMobileUI().updateAgentName(nickname)
                    : SnapABug.isCustomDesignEnabled()
                    ? SnapABug.getCustomDesignUI().setAgentName(nickname)
                    : _useStaticAgentName && this.populateStaticAgentName();
                break;
              case "/GO2":
                replay || this.redirectBrowser(textMsg.substr(5));
                break;
              case "/WAI":
                this.setReadOnly(!0),
                  (systemMsgId = "WAI_WAITING"),
                  this.appendTextToChat(
                    "",
                    textMsg.substr(5),
                    !1,
                    systemMsgId,
                    !1
                  );
                break;
              case "/NFO":
                (systemMsgId = "NFO_INITIAL"),
                  SnapABug.isMobileEnabled() &&
                    SnapABug.getMobileUI().isInitAgentMsg(textMsg.substr(5)),
                  this.setReadOnly(!1),
                  this.appendTextToChat(
                    "",
                    textMsg.substr(5),
                    !1,
                    systemMsgId,
                    !1
                  );
                break;
              case "/CAL":
                var optionCallMeValue = textMsg.substr(5);
                optionCallMeValue.indexOf("1") != -1
                  ? (SnapABug.isCustomDesignEnabled() &&
                      SnapABug.getCustomDesignUI().setAllowCallMe(!0),
                    SnapABug.enableCallMe())
                  : SnapABug.disableCallMe();
                break;
              case "/BAN":
                this.setBannedCookie(), SnapABug.allowChat(!1);
                break;
              case "/AVA":
                (avatarURL = textMsg.substr(5)),
                  _useStaticAgentAvatar
                    ? this.populateStaticAgentAvatar()
                    : (this.setCookie("SnapABugAgentAvatar", avatarURL),
                      SnapABug.isMobileEnabled()
                        ? SnapABug.getMobileUI().updateAgentAvatar(avatarURL)
                        : SnapABug.isCustomDesignEnabled() &&
                          SnapABug.getCustomDesignUI().setAgentAvatar(
                            avatarURL
                          ));
                break;
              case "/BTM":
                buttonOptions = textMsg.substr(5);
                var buttons = JSON.parse(buttonOptions),
                  convertedMessage = {
                    type: MESSAGE_TYPES.BUTTON,
                    buttons: buttons,
                  };
                this.handleNewMessageFormat(convertedMessage);
                break;
              case "/SYS":
                var payload = textMsg.substr(5),
                  syscmd = payload.substr(0, 4),
                  systemMsg = "";
                if ("PURL" == syscmd) postChatIframeURL = payload.substr(5);
                else if (syscmd === SYSTEM_COMMANDS.AUTO_TRANSLATE) {
                  var customDesignUi = SnapABug.getCustomDesignUI();
                  payload.indexOf("ON") > -1
                    ? customDesignUi.chatView.showGoogleLogo()
                    : payload.indexOf("OFF") > -1 &&
                      customDesignUi.chatView.removeGoogleLogo();
                } else if ("PTXT" == syscmd)
                  postChatHTML = decodeURIComponent(payload.substr(5)).replace(
                    /\%20/g,
                    " "
                  );
                else if ("WAGT" == syscmd) {
                  if (!SnapABug.isMobileEnabled()) {
                    var message = decodeURIComponent(payload.substr(5)).replace(
                        /\%20/g,
                        " "
                      ),
                      delay = message.substring(0, message.indexOf(","));
                    (message = message.substring(message.indexOf(",") + 1)),
                      (WAGTTimeout = window.setTimeout(
                        'SnapABugChat.waitingForAgentMessage("' +
                          message.replace(/\"/g, '\\"') +
                          '");',
                        1e3 * delay
                      ));
                  }
                } else if ("EMAI" == syscmd) {
                  var payload = decodeURIComponent(payload.substr(5)).replace(
                    /\%20/g,
                    " "
                  );
                  SnapABug.setUserEmail(payload),
                    SnapABugChat.setUserEmailCookie(payload);
                } else if ("REAS" == syscmd) {
                  var reassignDelay = payload.substr(5);
                  SnapABugChat.setReassignmentTimerAfterRestartChat(
                    reassignDelay
                  );
                } else if ("RERY" != syscmd || historyOnly)
                  if ("SRVY" == syscmd)
                    chatAgentSurvey = eval("(" + payload.substr(5) + ")");
                  else if ("GRCP" == syscmd)
                    surveyGracePeriod = 60 * parseInt(payload.substr(5));
                  else if ("XSRV" == syscmd) chatAgentSurvey = null;
                  else if ("IBOT" == syscmd)
                    SnapABug.setChatHandledByBot("true" == payload.substr(5));
                  else if ("FURV" == syscmd) {
                    if (
                      (SnapABugChat.sendChatMessage(
                        6,
                        "Visitor has received the file request."
                      ),
                      SnapABugChat.setFileUploadInProgress(!0),
                      SnapABug.isMobileEnabled())
                    )
                      return void SnapABug.getMobileUI().showUploadButtons();
                    if (SnapABug.isCustomDesignEnabled())
                      return void SnapABug.getCustomDesignUI().enableFileUploadButtons();
                    SnapABugChat.loadVisitorIframe(
                      SnapABug.getBaseURL() +
                        "/chatFileUpload?widgetPublicId=" +
                        SnapABug.getWidgetId() +
                        "&casePublicId=" +
                        SnapABug.getCaseId(),
                      "SnapABugChat.cancelVisitorRequest();",
                      120
                    );
                  } else if ("FUMV" == syscmd) {
                    var json = textMsg.substr(9),
                      re = new RegExp("&#34;", "g");
                    (json = json.replace(re, '"')), (json = JSON.parse(json));
                    var fileName = SnapABugChat.fileNamePretty(
                        json[0].fileName
                      ),
                      randomId = SnapABugChat.createRandomId(),
                      thumbnailImg = "",
                      thumbnailDivHeight = "";
                    json[0].mimeType.indexOf("/png") > -1 ||
                    json[0].mimeType.indexOf("/jpeg") > -1 ||
                    json[0].mimeType.indexOf("/bmp") > -1
                      ? ((thumbnailImg =
                          '<img src="' +
                          json[0].url +
                          '?thumbnail" style="position: relative; display: block;"/>'),
                        (thumbnailDivHeight =
                          "min-height:100px; max-height:130px;"))
                      : json[0].mimeType.indexOf("/gif") > -1 &&
                        ((thumbnailImg =
                          '<img src="' +
                          json[0].url +
                          '" height="130px" width="130px" style="position: relative; display: block;"/>'),
                        (thumbnailDivHeight =
                          "min-height:100px; max-height:130px;")),
                      SnapABug.isMobileEnabled()
                        ? (systemMsg =
                            '<img style="display:inline;height:32px;" src="' +
                            json[0].mimeTypeUrl +
                            '" /><a href="' +
                            json[0].url +
                            '" target="_blank"><span style="font-weight: 800">' +
                            fileName +
                            '</span></a><a href="' +
                            json[0].url +
                            '" target="_blank"><div style="' +
                            thumbnailDivHeight +
                            '">' +
                            thumbnailImg +
                            "</div></a>")
                        : SnapABug.isCustomDesignEnabled()
                        ? (systemMsg =
                            '<img style="display:inline;height:32px;" src="' +
                            json[0].mimeTypeUrl +
                            '" /><a href="' +
                            json[0].url +
                            '" target="_blank"><span style="font-weight: 800">' +
                            fileName +
                            '</span></a><a href="' +
                            json[0].url +
                            '" target="_blank"><div style="' +
                            thumbnailDivHeight +
                            '">' +
                            thumbnailImg +
                            "</div></a>")
                        : ((systemMsg =
                            '<div id="systemMsg" style="' +
                            SnapABug.getCSS(
                              0,
                              5,
                              SnapABugChat.getChatTranscriptWidth(),
                              ""
                            ) +
                            'position: relative; background-color: #D5E8EA; border: 1px solid #D5E8EA; border-radius: 4px; -moz-border-radius: 4px; -webkit-border-radius: 4px; margin: 5px 0px; font-size: .9em; display: inline-block; "> <div id="' +
                            randomId +
                            "\" onmouseenter=\"SnapABugChat.viewOrDownload('mouseenter', this.id,  '" +
                            json[0].url +
                            "')\" onmouseleave=\"SnapABugChat.viewOrDownload('mouseleave', this.id , '" +
                            json[0].url +
                            '\')" style="' +
                            SnapABug.getCSS(0, 0) +
                            'position: absolute; border: 1px solid #D5E8EA; border-radius: 4px; -moz-border-radius: 4px; -webkit-border-radius: 4px; width: 100%; height: 100%;"></div> <div style="float:left; margin:10px;height:32px;"><img style="display: inline" src="' +
                            json[0].mimeTypeUrl +
                            '" /></div><div style="margin:10px;">File uploaded: <span style="font-weight: 800"><br />' +
                            fileName +
                            '</span></div><div style="margin:14px;' +
                            thumbnailDivHeight +
                            '">' +
                            thumbnailImg +
                            "</div></div>"),
                          SnapABugChat.saveUserInput(),
                          SnapABugChat.showFormChat()),
                      (from =
                        1 === json[0].authorType
                          ? nickname
                          : SnapABug.getMessage(15)),
                      SnapABugChat.appendTextToChat(
                        from,
                        systemMsg,
                        !1,
                        !1,
                        !0,
                        !1
                      ),
                      SnapABugChat.setFileUploadInProgress(!1),
                      SnapABug.isMobileEnabled() &&
                        SnapABug.getMobileUI().updateScroll();
                  } else if ("SDR_" == syscmd) {
                    if (SnapABug.isMobileEnabled()) {
                      SnapABugChat.sendChatMessage(
                        6,
                        "Sorry, this feature is not yet available for mobile visitors."
                      );
                      break;
                    }
                    SnapABugChat.sendChatMessage(
                      6,
                      "Visitor has received the Secure Data Transfer request."
                    ),
                      (secureDataTransferInProgress = !0);
                    var iframeHeight = 150;
                    "SDR_CC" === payload
                      ? (iframeHeight = 230)
                      : "SDR_CCZ" === payload
                      ? (iframeHeight = 280)
                      : "SDR_SSN" === payload
                      ? (iframeHeight = 132)
                      : "SDR_SN" === payload && (iframeHeight = 180),
                      SnapABugChat.loadVisitorIframe(
                        SnapABugChat.getSecureDataTransferURL(payload),
                        "SnapABugChat.cancelVisitorRequest();",
                        iframeHeight
                      );
                  } else {
                    if ("COBR" == syscmd) {
                      var cobrParams = payload.split(" "),
                        customDesignUI = SnapABug.getCustomDesignUI(),
                        CobrowseLoader = window.Cobrowse;
                      return (
                        CobrowseLoader &&
                          handleCobrowseSysCmd(
                            cobrParams[1],
                            cobrParams[2],
                            nickname,
                            replay,
                            SnapABug.isCustomDesignEnabled(),
                            customDesignUI,
                            SnapEngage,
                            SnapEngageChat,
                            CobrowseLoader
                          ),
                        void (
                          CobrowseLoader ||
                          SnapEngageChat.sendChatMessage(
                            6,
                            "Visitor browser does not have cobrowsing present."
                          )
                        )
                      );
                    }
                    if ("SDTM" == syscmd) {
                      if (SnapABug.isCustomDesignEnabled()) {
                        if (replay) return;
                        SnapABug.getCustomDesignUI().secureDataController.submitSecureDataClick(),
                          (systemMsg =
                            '<div id="SnapABug_SystemMsg"> <div style="float:left; margin:0 5px 0 0;height:20px;"><img style="display:inline; height:20px;" src="' +
                            SnapABug.getBaseURL() +
                            '/img/securedata/fa-lock.png" /></div><div style="display:inline;">Thank you.  Your secure data has been received.</div></div>');
                      } else
                        SnapABugChat.showFormChat(),
                          (systemMsg =
                            '<div id="SnapABug_SystemMsg" style="' +
                            SnapABug.getSystemMessageCSS(
                              0,
                              5,
                              SnapABugChat.getChatTranscriptWidth(),
                              ""
                            ) +
                            '"> <div style="float:left; margin:5px;height:32px;"><img style="display: inline" src="' +
                            SnapABug.getBaseURL() +
                            '/img/securedata/fa-lock.png" /></div><div style="margin-top:15px;display:inline-block;">' +
                            SnapABug.getMessage(43) +
                            "</div></div>");
                      (systemMsgId = "SDTM_SECURE_DATA"),
                        SnapABugChat.appendTextToChat(
                          "",
                          systemMsg,
                          !1,
                          systemMsgId,
                          !0,
                          !1
                        ),
                        (secureDataTransferInProgress = !1);
                    } else if ("APRV" == syscmd) {
                      if (!SnapABug.isCustomDesignEnabled()) return !1;
                      SnapEngageChat.setIsApprovalBotChat(!0);
                      var payloadJSON = JSON.parse(payload.substr(5));
                      payloadJSON.approved
                        ? ((approvedDate = new Date()),
                          SnapABugChat.getCookie("SnapABugApproval") ||
                            SnapABugChat.setCookie(
                              "SnapABugApproval",
                              !0,
                              525600
                            ))
                        : SnapABugChat.getCookie("SnapABugApproval") &&
                          SnapABugChat.deleteCookie("SnapABugApproval");
                    } else if ("EMTR" == syscmd) {
                      if (SnapABug.isCustomDesignEnabled()) {
                        var enabled = JSON.parse(payload.substr(5));
                        enabled &&
                          SnapABug.getCustomDesignUI().enableEmailTranscriptRequest();
                      }
                    } else if ("MSG2" === syscmd) {
                      this.isTyping(!1);
                      var searchResultsString = payload.substr(5),
                        searchResultsData = JSON.parse(searchResultsString);
                      this.handleNewMessageFormat(searchResultsData);
                    }
                  }
                else
                  SnapABugChat.updateHistoryCookieForLastCase(
                    SnapABug.getCaseId()
                  );
                break;
              default:
                this.setReadOnly(!1),
                  fromAgent
                    ? ((chatAnswered = !0),
                      SnapABug.getChatHandledByBot() &&
                        SnapABug.getCustomDesignUI()
                          .chatView.getMessageView()
                          .triggerAgentIsTyping(!1))
                    : (from = SnapABug.getMessage(15)),
                  this.appendTextToChat(from, textMsg, historyOnly, !1, !1),
                  replay ||
                    (this.newMessageNotification(),
                    fromAgent &&
                      (SnapABugChat.isMinimized() &&
                        SnapABugChat.newMinimizedMessageReceived(),
                      SnapABug.callCallback(
                        "ChatMessageReceived",
                        nickname,
                        textMsg
                      )));
            }
          }
          pollCount = 0;
        },
        loadVisitorIframe: function (a, b, c) {
          if (!SnapABug.isMobileEnabled()) {
            if (SnapABug.isCustomDesignEnabled())
              return void SnapABug.getCustomDesignUI().initSecureFileDataTransfer(
                a,
                c
              );
            SnapABugChat.saveUserInput();
            var d = document.getElementById("SnapABug_CL");
            (d.style.position = "static"),
              SnapABugChat.populateSubChatForm(
                d.outerHTML,
                "SnapABug.closeForm()"
              );
            var e = document.createElement("div");
            e.setAttribute("id", "SnapABug_VisitorIframeDiv"),
              e.setAttribute("display", "inline-block"),
              (e.innerHTML =
                '<iframe id="SnapABug_VisitorIframe" src="' +
                a +
                '" height="' +
                c +
                'px" style="' +
                SnapABug.getCSS(0, 10, SnapABugChat.getChatTranscriptWidth()) +
                'display: inline-block; position: relative; padding: 5px;" scrolling="no" horizontalscrolling="no" verticalscrolling="no"></iframe><br/><br/><a href="#" id="SnapABug_IframeCancel" style="float: left; font-style: italic; text-decoration: underline; color: gray; font-size: .9em; margin: 0px 10px 10px 0px;" onclick="' +
                b +
                '">' +
                SnapABug.getMessage(42) +
                "</a>"),
              document.getElementById("SnapABug_CL").appendChild(e);
            var f = SnapABugChat.getChatBoxHeight();
            (document.getElementById("SnapABug_CL").style.maxHeight = f),
              (document.getElementById("SnapABug_CL").style.minHeight = f),
              document.getElementById("SnapABug_VisitorIframe").focus(),
              SnapABugChat.scrollDown();
          }
        },
        cancelVisitorRequest: function () {
          SnapABugChat.sendChatMessage(6, "Visitor has cancelled the request."),
            SnapABugChat.setFileUploadInProgress(!1),
            (secureDataTransferInProgress = !1),
            SnapABug.isCustomDesignEnabled() || SnapABugChat.showFormChat();
        },
        createRandomId: function () {
          return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(
            /[xy]/g,
            function (a) {
              var b = (16 * Math.random()) | 0,
                c = "x" === a ? b : (3 & b) | 8;
              return c.toString(16);
            }
          );
        },
        viewOrDownload: function (a, b, c) {
          var d = document.getElementById(b);
          if ("mouseenter" === a) {
            (d.style.background = "rgba(0,0,0,0.3)"),
              (d.style.border = "rgba(0,0,0,0.3)");
            var e = 30,
              f = Math.round((d.offsetHeight - e) / 2),
              g = document.createElement("div");
            (g.innerHTML =
              '<div id="links" style="margin: 0 auto; text-align: center">   <a href="' +
              c +
              '" target="_blank"><img id="view" src="' +
              SnapABug.getBaseURL() +
              '/img/fileupload/view.png" style="position: relative; top:' +
              f +
              'px; margin: 0 3px 0 0" alt="View" /></a>   <a href="' +
              c +
              '?contentDisposition=attachment"><img id="download" src="' +
              SnapABug.getBaseURL() +
              '/img/fileupload/download.png" style="position: relative; top:' +
              f +
              'px; margin: 0 0 0 3px;" alt="Download" /></a></div>'),
              d.appendChild(g);
          }
          "mouseleave" === a &&
            (document
              .getElementById("links")
              .parentNode.removeChild(document.getElementById("links")),
            (d.style.background = ""),
            (d.style.border = ""));
        },
        saveUserInput: function () {
          var a = document.SnapABug_Form;
          a && (userInput = a.chat.value);
        },
        callbackHistory: function (a, b, c) {
          if (c && SnapEngage.isCustomDesignEnabled()) {
            var d = SnapEngage.getCustomDesignUI().TYPEOFCHAT[c];
            SnapEngage.getCustomDesignUI().setTypeOfChat(d);
          }
          if (a && a.length > 0) {
            msgIdLst = {};
            for (var e = 0, f = 0; f < a.length / 3; f++) {
              var g = a[3 * f],
                h = a[3 * f + 1],
                i = a[3 * f + 2];
              this.callbackMessage(g, h, !0, !0),
                i != -1 && ((msgIdLst[i] = 1), (e = i));
            }
            (chatAnswered = b), this.displayHistory(), this.setPollIdCookie(e);
          }
          pollCount = 0;
        },
        fileNamePretty: function (a) {
          if (a.length > 15) {
            var b = a.split("."),
              c = b[b.length - 1];
            return (
              (b = b.splice(0, b.length - 1).join(".")),
              (b = b.substr(0, 6) + "..." + b.substr(b.length - 6, 6)),
              b + "." + c
            );
          }
          return a;
        },
        cancelSecureDataRequest: function () {
          SnapABugChat.sendChatMessage(
            6,
            "Visitor has cancelled the Secure Data Transfer request."
          ),
            SnapABugChat.showFormChat();
        },
        newMessageNotification: function () {
          if (SnapABug.isCustomDesignEnabled()) {
            var a = {
              state1: this.getPageTitle(!0),
              state2: this.getPageTitle(!1),
            };
            SnapABug.getCustomDesignUI().setVisitorNotification(a);
          } else
            (document.title = this.getPageTitle(!0)),
              proactiveRulesTimers.documentTitles ||
                (proactiveRulesTimers.documentTitles = []),
              proactiveRulesTimers.documentTitle.push(
                window.setTimeout(
                  "document.title=SnapABugChat.getPageTitle(false);",
                  1e3
                )
              ),
              proactiveRulesTimers.documentTitle.push(
                window.setTimeout(
                  "document.title=SnapABugChat.getPageTitle(true);",
                  1500
                )
              ),
              proactiveRulesTimers.documentTitle.push(
                window.setTimeout(
                  "document.title=SnapABugChat.getPageTitle(false);",
                  2500
                )
              ),
              proactiveRulesTimers.documentTitle.push(
                window.setTimeout(
                  "document.title=SnapABugChat.getPageTitle(true);",
                  3e3
                )
              ),
              proactiveRulesTimers.documentTitle.push(
                window.setTimeout(
                  "document.title=SnapABugChat.getPageTitle(false);",
                  4e3
                )
              ),
              proactiveRulesTimers.documentTitle.push(
                window.setTimeout(
                  "document.title=SnapABugChat.getPageTitle(true);",
                  4500
                )
              ),
              proactiveRulesTimers.documentTitle.push(
                window.setTimeout(
                  "document.title=SnapABugChat.getPageTitle(false);",
                  5500
                )
              );
          SnapABug.getChatSoundAllowed() && this.playSound();
        },
        playSound: function () {
          var a = SnapABug.getBaseURL() + "/sounds/chatmsg.mp3",
            b = SnapABug.getBaseURL() + "/sounds/chatmsg.ogg";
          try {
            var c;
            (c = SnapABug.isFirefox() ? new Audio(b) : new Audio(a)), c.play();
          } catch (a) {
            try {
              var d = document.getElementById("SnapABug_Snd");
              if (!d) return;
              d.innerHTML =
                '<iframe src="' +
                baseURL +
                '/sounds/chatmsg.html" allowtransparency="true" frameborder="0" />';
            } catch (a) {}
          }
        },
        getPageTitle: function (a) {
          return a
            ? SnapABug.getMessage(45).replace("{alias}", nickname)
            : pageTitle
            ? pageTitle
            : document.domain;
        },
        getChatTranscriptWidth: function () {
          return (
            document.getElementById("SnapABug_CL").offsetWidth -
            3 * transcriptPadding
          );
        },
        getPostChatWidth: function () {
          return (
            document.getElementById("SnapABug_CM").offsetWidth -
            3 * transcriptPadding
          );
        },
        getChatBoxHeight: function () {
          return (
            document.getElementById("SnapABug_CM").parentNode.offsetHeight +
            "px"
          );
        },
        setQuestion: function (a) {
          (question = a), "(none)" != a && (questionKeptForCanceledChat = a);
        },
        cancelChat: function () {
          chatAnswered
            ? SnapABugChat.closeChat(!0)
            : (this.sendChatMessage(8, ""), (caseId = "")),
            SnapABug.closeForm(!0),
            SnapABug.setDescription(questionKeptForCanceledChat),
            SnapABug.allowChat(!1),
            SnapABug.startLink();
        },
        closeChat: function (a) {
          if (!SnapABug.isCustomDesignEnabled()) {
            if (
              (this.stopPolling(),
              a && caseId && this.sendChatMessage(2, ""),
              !SnapABug.isMobileEnabled() &&
                !SnapABug.isCustomDesignEnabled() &&
                null === document.getElementById("chatSurvey"))
            )
              if (chatAgentSurvey && !SnapABugChat.getBannedCookie())
                this.populateChatAgentSurvey();
              else if (postChatIframeURL) {
                var b =
                    "?agent=" +
                    encodeURIComponent(nickname) +
                    "&case=" +
                    encodeURIComponent(
                      SnapABug.getBaseURL() + "/viewcase?c=" + caseId
                    ),
                  c =
                    '<iframe src="' +
                    postChatIframeURL +
                    b +
                    '" frameborder="0" width="100%" height="100%" style="overflow:hidden"></iframe>';
                this.populateSubChatForm(c, "SnapABug.closeForm();"),
                  (postChatIframeURL = "");
              } else
                postChatHTML &&
                  ((postChatHTML = postChatHTML.replace(
                    /\{alias\}/g,
                    encodeURIComponent(nickname)
                  )),
                  (postChatHTML = postChatHTML.replace(
                    /\{case\}/g,
                    encodeURIComponent(
                      SnapABug.getBaseURL() + "/viewcase?c=" + caseId
                    )
                  )),
                  this.populateSubChatForm(
                    postChatHTML,
                    "SnapABug.closeForm();"
                  ),
                  (postChatHTML = ""));
            (caseId = ""), this.deleteChatCookies(), this.reInit();
          }
        },
        resetCaseIdFromCustomDesign: function () {
          caseId = "";
        },
        redirectBrowser: function (a) {
          var b = document.SnapABug_Form;
          if (b && ((userInput = b.chat.value), "" != userInput))
            try {
              var c = new RegExp(/^\s+$/);
              c.test(userInput) ||
                this.setMessageCookie(
                  userInput.replace(/^\s*/, "").replace(/\s*$/, "")
                );
            } catch (a) {}
          (systemMsgId = "GO2_REDIRECT"),
            this.appendTextToChat("", "redirecting...", !1, systemMsgId, !1);
          var d = !1;
          try {
            var e = document.location.hostname;
            if (0 === a.indexOf("http") && a.indexOf("://") !== -1) {
              var f = a.substring(a.indexOf("://") + 3);
              if (
                (f.indexOf("/") !== -1 &&
                  ((f = f.substring(0, f.indexOf("/"))),
                  f.indexOf(":") !== -1 &&
                    (f = f.substring(0, f.indexOf(":")))),
                0 === a.indexOf(SnapABug.getBaseURL() + "/chat?c=") ||
                  0 ===
                    a.indexOf(
                      SnapABug.getBaseURL().replace("http:", "https:") +
                        "/chat?c="
                    ))
              )
                d = !0;
              else if (
                "" != f &&
                e != f &&
                ("" == SnapABug.getDomain() ||
                  f.indexOf(SnapABug.getDomain()) === -1)
              ) {
                var g = SnapABug.getBaseURL() + "/chatcrossdomain?c=";
                0 === a.indexOf("http://") &&
                  (g = g.replace("https://", "http://")),
                  (a =
                    g +
                    SnapABug.getCaseId() +
                    "&u=" +
                    encodeURIComponent(a) +
                    "&w=" +
                    SnapABug.getWidgetId()),
                  (d = !0),
                  this.deleteChatCookies();
              }
            }
          } catch (a) {}
          d && top && top.frames && top.frames.length > 0
            ? (proactiveRulesTimers.changeLocation = setTimeout(
                'top.location.href = "' + a + '"',
                100
              ))
            : (proactiveRulesTimers.changeLocation = setTimeout(
                'window.location.href = "' + a + '"',
                100
              ));
        },
        formCallMeDone: function () {
          this.showFormChat();
        },
        setCaseIdCookie: function () {
          caseId && this.setCookie("SnapABugChatSession", caseId, 16);
        },
        getCaseIdCookie: function () {
          return this.getCookie("SnapABugChatSession");
        },
        setNoProactiveChatCookie: function () {
          this.setCookie(
            "SnapABugNoProactiveChat",
            "no",
            SnapABug.getNoProactiveChatDelay()
          );
        },
        isNoProactiveChatCookie: function () {
          return (
            "no" == this.getCookie("SnapABugNoProactiveChat") ||
            !this.isCookieEnabled()
          );
        },
        setIsForcedProactive: function (a) {
          this.isForcedProactive = a;
        },
        getIsForcedProactive: function () {
          return this.isForcedProactive;
        },
        setPollIdCookie: function (a) {
          "" != caseId && this.setCookie("SnapABugChatPoll" + caseId, a, 16);
        },
        getPollIdCookie: function () {
          var a = pollId;
          return (
            "" != caseId &&
              ((pollId = parseInt(this.getCookie("SnapABugChatPoll" + caseId))),
              isNaN(pollId) && (pollId = a)),
            pollId
          );
        },
        setMessageCookie: function (a) {
          this.setCookie("SnapABugChatMessage", encodeURIComponent(a), 16);
        },
        getMessageCookie: function () {
          return decodeURIComponent(this.getCookie("SnapABugChatMessage"));
        },
        setAgentAvatarCookie: function (a) {
          this.setCookie("SnapABugAgentAvatar", encodeURIComponent(a), 16);
        },
        getAgentAvatarCookie: function () {
          return decodeURIComponent(this.getCookie("SnapABugAgentAvatar"));
        },
        setChatViewCookie: function () {
          (chatview = Math.random()),
            this.setCookie("SnapABugChatView", chatview, 16);
        },
        refreshChatViewCookie: function () {
          this.setCookie("SnapABugChatView", chatview, 16);
        },
        isChatViewCookieValid: function () {
          var a = this.getCookie("SnapABugChatView");
          return chatview == a || "" == a;
        },
        removeDupeCookies: function (a) {
          var b = getAllCookies().split(";"),
            c = [];
          b.forEach(function (b, d) {
            b.indexOf(a) >= 0 && c.push(b.trim());
          }),
            c.pop(),
            c.forEach(
              function (b) {
                this.getCookie("SnapABugHistory") === b.split("=")[1] &&
                  this.deleteCookie(a);
              }.bind(this)
            );
        },
        updateHistoryCookieForLastCase: function (a) {
          if ((this.removeDupeCookies("SnapABugHistory", !0), a))
            try {
              var b = new SnapABugHistory(this.getCookie("SnapABugHistory")),
                c = new Date(),
                d = c.getTime(),
                e = b.cases();
              if (e.length) {
                var f = e[e.length - 1].split(":")[0];
                if (f === a) return;
              }
              b.addNewCaseData(a, d);
              var g = b.getAsString();
              this.setCookie("SnapABugHistory", g, 525600);
            } catch (a) {
              this.setCookie("SnapABugHistory", "0#", 525600);
            }
        },
        setHistoryCookieIncrementVisits: function () {
          try {
            var a = this.getCookie("SnapABugHistory");
            if ("" == a) a = "1#";
            else {
              var b = a.split("#"),
                c = parseInt(b[0]) + 1;
              (b[0] = c), (a = b[0] + "#" + b[1]);
            }
            this.setCookie("SnapABugHistory", a, 525600);
          } catch (a) {
            this.setCookie("SnapABugHistory", "0#", 525600);
          }
        },
        getHistoryCookie: function () {
          return this.getCookie("SnapABugHistory");
        },
        getHistoryCookieLastCase: function () {
          try {
            var a = this.getCookie("SnapABugHistory"),
              b = a.split("#"),
              c = b[1].split("!");
            return c[c.length - 2].split(":");
          } catch (a) {}
        },
        getTokensCookies: function () {
          var a = "",
            b = this.getCookie("hubspotutk");
          return b && (a += "28#" + b + "!"), a;
        },
        getVisitorIsFirstTimeVisiting: function () {
          try {
            var a = this.getCookie("SnapABugHistory"),
              b = a.split("#"),
              c = parseInt(b[0]);
            return c <= 1;
          } catch (a) {
            return !0;
          }
        },
        getVisitorNumberOfPreviousChats: function () {
          try {
            var a = this.getCookie("SnapABugHistory"),
              b = a.split("#");
            return (b[1].match(/!/g) || []).length;
          } catch (a) {
            return 0;
          }
        },
        setInitialVisitCookie: function () {
          SnapABugChat.getVisitCookie() ||
            SnapABugChat.setCookie(
              "SnapABugVisit",
              "0#" + Math.round(new Date().getTime() / 1e3),
              SnapABug.getVisitorCookieLifeTime()
            );
        },
        getVisitCookie: function () {
          return SnapABugChat.getCookie("SnapABugVisit");
        },
        incrementVisitCookie: function () {
          if (SnapABugChat.getVisitCookie()) {
            var a = SnapABugChat.getVisitCookie().split("#"),
              b = parseInt(a[0]) + 1 + "#" + a[1];
            SnapABugChat.setCookie(
              "SnapABugVisit",
              b,
              SnapABug.getVisitorCookieLifeTime()
            );
          }
        },
        getVisitorTimeOnSite: function () {
          return SnapABugChat.getVisitCookie()
            ? Math.round(new Date().getTime() / 1e3) -
                SnapABugChat.getVisitCookie().split("#")[1]
            : 0;
        },
        getVisitorTimeOnPage: function () {
          var a = +new Date();
          return (a - pageInitTime) / 1e3;
        },
        getVisitorNumberOfPagesVisited: function () {
          return SnapABugChat.getVisitCookie()
            ? SnapABugChat.getVisitCookie().split("#")[0]
            : "";
        },
        setUserEmailCookie: function (a) {
          this.deleteCookie("SnapABugUserEmail");
          for (var b = "", c = 0; c < a.length; ++c)
            b += String.fromCharCode(6 ^ a.charCodeAt(c));
          this.setCookie(
            "SnapABugUserEmail",
            encodeURIComponent("#" + b),
            525600
          );
        },
        getUserEmailCookie: function () {
          var a = decodeURIComponent(this.getCookie("SnapABugUserEmail")),
            b = "";
          if ("#" == a.charAt(0))
            for (var c = 1; c < a.length; c++)
              b += String.fromCharCode(6 ^ a.charCodeAt(c));
          else b = a;
          return b;
        },
        setUserNameCookie: function (a) {
          this.deleteCookie("SnapABugUserName");
          for (var b = "", c = 0; c < a.length; ++c)
            b += String.fromCharCode(6 ^ a.charCodeAt(c));
          this.setCookie(
            "SnapABugUserName",
            encodeURIComponent("#" + b),
            525600
          );
        },
        getUserNameCookie: function () {
          var a = decodeURIComponent(this.getCookie("SnapABugUserName")),
            b = "";
          if ("#" == a.charAt(0))
            for (var c = 1; c < a.length; c++)
              b += String.fromCharCode(6 ^ a.charCodeAt(c));
          else b = a;
          return b;
        },
        setUserAliasCookie: function (a) {
          this.deleteCookie("SnapABugUserAlias");
          for (var b = "", c = 0; c < a.length; ++c)
            b += String.fromCharCode(6 ^ a.charCodeAt(c));
          this.setCookie(
            "SnapABugUserAlias",
            encodeURIComponent("#" + b),
            525600
          );
        },
        getUserAliasCookie: function () {
          var a = decodeURIComponent(this.getCookie("SnapABugUserAlias")),
            b = "";
          if ("#" == a.charAt(0))
            for (var c = 1; c < a.length; c++)
              b += String.fromCharCode(6 ^ a.charCodeAt(c));
          else b = a;
          return b;
        },
        setBannedCookie: function () {
          this.setCookie("SnapABugBanned", "1", 43200);
        },
        getBannedCookie: function () {
          return this.getCookie("SnapABugBanned");
        },
        deleteChatCookies: function () {
          this.setCookie("SnapABugChatSession", "", 16),
            this.setCookie("SnapABugChatView", "", 16),
            this.setCookie("SnapABugChatMessage", "", 16),
            this.setCookie("SnapABugAgentAvatar", "", 16),
            this.deleteCookie("SnapABugChatSession"),
            this.deleteCookie("SnapABugChatView"),
            this.deleteCookie("SnapABugChatMessage"),
            this.deleteCookie("SnapABugAgentAvatar");
        },
        setCookie: function (a, b, c) {
          var d = "";
          if (c > 0) {
            var e = new Date();
            e.setTime(e.getTime() + 60 * c * 1e3),
              (d = "; expires=" + e.toGMTString());
          }
          var f = "";
          SnapABug.getDomain() && (f = "; domain=" + SnapABug.getDomain());
          var g = "";
          secureCookies && (g = "; Secure"),
            (document.cookie = a + "=" + b + d + "; path=/;" + f + g);
        },
        deleteCookie: function (a) {
          var b = "";
          SnapABug.getDomain() && (b = "; domain=" + SnapABug.getDomain()),
            (document.cookie =
              a + "=; expires=Thu, 01-Jan-70 00:00:01 GMT;; path=/;" + b);
        },
        getCookie: function (a) {
          for (var b = document.cookie.split(";"), c = 0; c < b.length; c++) {
            for (var d = b[c]; " " == d.charAt(0); )
              d = d.substring(1, d.length);
            if (0 == d.indexOf(a)) return d.substring(a.length + 1, d.length);
          }
          return "";
        },
        isCookieEnabled: function () {
          var a = !!navigator.cookieEnabled;
          return (
            "undefined" != typeof navigator.cookieEnabled ||
              a ||
              (a = "" != SnapABugChat.getVisitCookie()),
            a
          );
        },
        getSystemCommandsCustomDesign: function () {
          return {
            chatAgentSurvey: chatAgentSurvey,
            nickname: nickname,
            postChatHTML: postChatHTML,
            caseId: caseId,
            timeOut: surveyGracePeriod,
          };
        },
        getChatAnsweredStatus: function () {
          return chatAnswered;
        },
        populateChatAgentSurvey: function () {
          function a() {
            var a = document.getElementById("SnapABug_CM").parentNode,
              b = parseInt(a.style.height, 10),
              d = c.offsetHeight;
            f.style.display = "block";
            var e = h.offsetHeight;
            f.style.display = "none";
            var i = b - d - e - 24;
            g.style.height = i + "px";
          }
          if (!SnapABug.isMobileEnabled()) {
            SnapABug.hideChatBoxMenu();
            var b, c, d, e, f, g, h, i, j, k;
            if (chatAgentSurvey) {
              var l =
                  '<div id="chatSurvey" style="text-align: center; margin: 5px ' +
                  transcriptPadding +
                  'px 5px 0px;">   <div id="chatSurveyRatingContainer">     <div id="chatSurveyQuestion" style="padding: 5px 5px 5px 5px;">' +
                  SnapABug.getMessage(21) +
                  '</div>     <div id="chatSurveyRating" style="height: 36px;"></div>     <div id="chatSurveyRatingText" style="height: 20px;" ></div>   </div>   <div id="chatSurveyCommentsContainer" style="padding: 5px; display: none;">     <textarea id="chatSurveyComments" maxlength="500" style="width: 100%; padding: 5px; height: auto; resize: none; outline: none; border: 1px solid #999999 !important; -webkit-border-radius: 2px; -moz-border-radius: 2px; border-radius: 2px; box-shadow:none !important; font-family: arial,sans-serif; font-size: 12px; font-weight: normal; font-style: normal; line-height: normal; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box;">' +
                  SnapABug.getMessage(23) +
                  '</textarea>     <div id="chatSurveySubmitContainer">       <div style="' +
                  SnapABug.getDisplayInlineBlockCSS() +
                  ' padding: 5px 0 0 0;">        <input id="chatSurveySubmitButton" value="' +
                  SnapABug.getMessage(24) +
                  '" type="button" style="clear: none; height: 25px; width: inherit; margin: 0px 0px 0px 4px; cursor: pointer; outline: none; border: 1px solid rgb(160, 161, 160); background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, from(rgb(255, 255, 255)), to(rgb(199, 201, 199))); padding: 3px 5px; width: auto; overflow: visible; border-top-left-radius: 10px; border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-bottom-left-radius: 10px; color: rgb(81, 85, 93); font-size: 12px; font-family: \'lucida grande\', \'Helvetica Neue\', Helvetica, Arial, sans-serif; text-decoration: none; font-weight: bold;">      </div>       <div style="' +
                  SnapABug.getDisplayInlineBlockCSS() +
                  ' padding: 5px 0 0 0;">        <a id="chatSurveyCancelButton" style="color: #999; text-decoration: none;" href="#">' +
                  SnapABug.getMessage(25) +
                  '</a>      </div>     </div>   </div> </div> <div id="chatSurveyResults" style="padding-top: 0px; padding-bottom: 10px; font-weight: 800; text-align: center; display: none;">' +
                  SnapABug.getMessage(26) +
                  "</div>",
                m = document.getElementById("SnapABug_CL");
              SnapABugChat.populateSubChatForm(
                m.outerHTML,
                "SnapABug.closeForm();"
              );
              var n = document.createElement("div");
              (n.innerHTML = l),
                document.getElementById("SnapABug_CL").appendChild(n),
                (document.getElementById("SnapABug_CL").style.position =
                  "static");
              var o =
                  document.getElementById("SnapABug_CM").parentNode
                    .offsetHeight + "px",
                p =
                  document.getElementById("SnapABug_CM").parentNode
                    .offsetWidth -
                  transcriptPadding +
                  "px";
              (document.getElementById("SnapABug_CL").style.maxHeight = o),
                (document.getElementById("SnapABug_CL").style.minHeight = o),
                (document.getElementById("SnapABug_CL").style.maxWidth = p),
                (document.getElementById("SnapABug_CL").style.minWidth = p),
                (b = document.getElementById("chatSurvey")),
                (c = document.getElementById("chatSurveyRatingContainer")),
                (d = document.getElementById("chatSurveyRating")),
                (e = document.getElementById("chatSurveyQuestion")),
                (f = document.getElementById("chatSurveyCommentsContainer")),
                (g = document.getElementById("chatSurveyComments")),
                (h = document.getElementById("chatSurveySubmitContainer")),
                (i = document.getElementById("chatSurveySubmitButton")),
                (j = document.getElementById("chatSurveyCancelButton")),
                (k = document.getElementById("chatSurveyResults"));
              for (
                var q = "", r = chatAgentSurvey.ratings, s = 0;
                s < r.length;
                s++
              )
                q =
                  q +
                  '<img id="' +
                  r[s].id +
                  '" alt="' +
                  r[s].text +
                  '" src="' +
                  SnapABug.getBaseURL() +
                  r[s].defaultImg +
                  '" style="cursor: pointer;" onmouseover="SnapABugChat.mouseoverChatAgentSurveyRating(this.id);" onmouseout="SnapABugChat.mouseoutChatAgentSurveyRating(this.id);" onmousedown="SnapABugChat.setChatAgentSurveyRating(this.id)" />';
              (d.innerHTML = q), a();
              var t = document.getElementById("SnapABug_CL"),
                u =
                  t.scrollHeight -
                  document.getElementById("SnapABug_CM").parentNode
                    .offsetHeight;
              if (
                (SnapABugChat.animateScrollDown(t, u, 3e3), nickname.length > 0)
              ) {
                var v = SnapABug.getMessage(22);
                (v = v.replace("{alias}", nickname)), (e.innerHTML = v);
              } else e.innerHTML = SnapABug.getMessage(21);
              (g.onfocus = function () {
                this.value === SnapABug.getMessage(23) && (this.value = "");
              }),
                (i.onclick = function () {
                  SnapABugChat.animateFadeOut(
                    document.getElementById("chatSurvey")
                  ),
                    (k.style.display = ""),
                    document.getElementById("SnapABug_CL").focus(),
                    (chatAgentSurvey = null),
                    SnapABugChat.sendChatAgentSurveyRating();
                }),
                (j.onclick = function () {
                  return SnapABugChat.closeChatAgentSurvey(), !1;
                }),
                setTimeout(function () {
                  SnapABugChat.closeChatAgentSurvey();
                }, 36e6);
            }
          }
        },
        mouseoverChatAgentSurveyRating: function (a) {
          if (chatAgentSurvey)
            for (
              var b = 0, c = 2, d = chatAgentSurvey.ratings, e = 0;
              e < d.length;
              e++
            )
              if (
                ((chatAgentSurvey.type != b && chatAgentSurvey.type != c) ||
                  ((document.getElementById(d[e].id).src =
                    SnapABug.getBaseURL() + d[e].selectedImg),
                  (document.getElementById("chatSurveyRatingText").innerHTML =
                    d[e].text)),
                d[e].id == a)
              ) {
                (document.getElementById(d[e].id).src =
                  SnapABug.getBaseURL() + d[e].selectedImg),
                  (document.getElementById("chatSurveyRatingText").innerHTML =
                    d[e].text);
                break;
              }
        },
        mouseoutChatAgentSurveyRating: function (a) {
          if (chatAgentSurvey) {
            for (var b = chatAgentSurvey.ratings, c = b.length - 1; c >= 0; c--)
              document.getElementById(b[c].id).src =
                SnapABug.getBaseURL() + b[c].defaultImg;
            selectedAgentSurveyRating
              ? SnapABugChat.mouseoverChatAgentSurveyRating(
                  selectedAgentSurveyRating.id
                )
              : (document.getElementById("chatSurveyRatingText").innerHTML =
                  "");
          }
        },
        setChatAgentSurveyRating: function (a) {
          if (chatAgentSurvey) {
            for (var b = chatAgentSurvey.ratings, c = 0; c < b.length; c++)
              if (b[c].id == a) {
                (selectedAgentSurveyRating = b[c]),
                  SnapABugChat.sendChatAgentSurveyRating(),
                  SnapABugChat.mouseoutChatAgentSurveyRating(
                    selectedAgentSurveyRating.id
                  );
                break;
              }
            document.getElementById(
              "chatSurveyCommentsContainer"
            ).style.display = "";
            var d = document.getElementById("SnapABug_CL");
            SnapABugChat.animateScrollDown(d, d.scrollTop, 3e3);
          }
        },
        sendChatAgentSurveyRating: function () {
          if (selectedAgentSurveyRating) {
            var a =
                SnapABug.getBaseURL() +
                "/chatjs/postChat/recordSurvey?publicCaseId=" +
                SnapABug.getCaseId() +
                "&rating=" +
                selectedAgentSurveyRating.id,
              b = document.getElementById("chatSurveyComments").value;
            b != SnapABug.getMessage(23) &&
              (a = a + "&comments=" + encodeURIComponent(SnapABug.trim(b))),
              SnapABug.rpc(a, 3, "sendChatAgentSurveyRating");
          }
        },
        callbackRecordSurveyAction: function () {},
        closeChatAgentSurvey: function () {
          chatAgentSurvey = null;
          var a = document.getElementById("chatSurvey");
          SnapABugChat.animateFadeOut(a),
            document.getElementById("SnapABug_CL").focus();
        },
        isMinimized: function () {
          return SnapABugChat.getChatWindowCookieData("isMinimized");
        },
        minimizeToggle: function () {
          var a = SnapABugChat.isMinimized();
          if ("undefined" != typeof a)
            return SnapABug.isChatInProgress()
              ? (SnapABug.sendTextToChat(
                  "Visitor has " + (a ? "un-" : "") + "minimized the Chat Box."
                ),
                a
                  ? (SnapABugChat.unminimizeChat(), !1)
                  : (SnapABugChat.minimizeChat(), !0))
              : void 0;
        },
        minimizeChat: function (a) {
          if (
            "undefined" !== SnapABugChat.isMinimized() &&
            (SnapABugChat.setChatWindowCookieData("isMinimized", !0),
            SnapABugChat.getCookie("isProactiveInvite") ||
              SnapABugChat.setNoProactiveChatCookie(),
            !SnapABug.isCustomDesignEnabled())
          ) {
            var b = document.getElementById("SnapABug_WP");
            b.className.indexOf("minimized") === -1 &&
              (b.className += " minimized");
            var c = document.getElementById("SnapABug_NMNi");
            c.innerHTML = SnapABugChat.getChatWindowCookieData(
              "newMinimizedMessageCount"
            );
            var d = SnapABugChat.minimizedDimensions,
              e = [],
              f = 0;
            if ("undefined" == typeof a || !a) {
              for (
                e = [
                  parseInt(b.style.left, 10),
                  parseInt(b.style.right, 10),
                  parseInt(b.style.top, 10),
                  parseInt(b.style.bottom, 10),
                ],
                  f = 0;
                f < e.length;
                f++
              )
                (isNaN(e[f]) || 0 === e[f]) && (e[f] = -1);
              SnapABugChat.setChatWindowCookieData("chatBoxPosition", e);
            }
            (b.style.width = d[2] + "px"), (b.style.height = d[3] + "px");
            var g = SnapABug.getWindowWidth() / 2,
              h = d[2] / 2,
              i =
                (SnapABugChat.getChatWindowCookieData("chatBoxPosition")[0] ===
                -1
                  ? b.offsetLeft
                  : SnapABugChat.getChatWindowCookieData(
                      "chatBoxPosition"
                    )[0]) + h;
            if (
              ((b.style.bottom = b.style.right = b.style.top = b.style.left =
                ""),
              i < g ? (b.style.left = "0") : (b.style.right = "0"),
              (b.style.bottom = "0"),
              0 !== d[0] || 0 !== d[1])
            ) {
              var j = document.getElementById("SnapABug_P");
              (j.style.left = d[0] + "px"), (j.style.top = d[1] + "px");
            }
            document.getElementById("SnapABug_DB").style.display = "none";
            var k = [],
              l = b.getElementsByTagName("a");
            for (f = 0; f < l.length; f++) k.push(l[f]);
            var m = b.getElementsByTagName("textarea");
            for (f = 0; f < m.length; f++) k.push(m[f]);
            if (SnapEngage.isIE()) {
              var n = b.getElementsByTagName("iframe");
              for (f = 0; f < n.length; f++) k.push(n[f]);
            }
            for (f = 0; f < k.length; f++) k[f].setAttribute("tabIndex", "-1");
          }
        },
        unminimizeChat: function () {
          if (
            "undefined" !== SnapABugChat.isMinimized() &&
            (SnapABugChat.setChatWindowCookieData("isMinimized", !1),
            !SnapABug.isCustomDesignEnabled())
          ) {
            var a = document.getElementById("SnapABug_WP");
            a.className = a.className.replace(/(\s|)minimized(\s|)/, "");
            var b = document.getElementById("SnapABug_NMNi");
            b ||
              (SnapABug.initMinimizeNotification(),
              (b = document.getElementById("SnapABug_NMNi"))),
              (b.innerHTML = "");
            var c = SnapABugChat.minimizedDimensions;
            if (
              ((document.getElementById("SnapABug_NMN").style.display = "none"),
              SnapABugChat.setChatWindowCookieData(
                "newMinimizedMessageCount",
                0
              ),
              (a.style.width = SnapABug.formWidth + "px"),
              (a.style.height = SnapABug.formHeight + "px"),
              0 !== c[0] || 0 !== c[1])
            ) {
              var d = document.getElementById("SnapABug_P");
              (d.style.left = "0"), (d.style.top = "0");
            }
            document.getElementById("SnapABug_DB").style.display = "block";
            var e = [],
              f = a.getElementsByTagName("a"),
              g = 0;
            for (g = 0; g < f.length; g++)
              null !== f[g].getAttribute("tabIndex") && e.push(f[g]);
            var h = a.getElementsByTagName("textarea");
            for (g = 0; g < h.length; g++)
              null !== h[g].getAttribute("tabIndex") && e.push(h[g]);
            if (SnapEngage.isIE()) {
              var i = a.getElementsByTagName("iframe");
              for (g = 0; g < i.length; g++)
                null !== i[g].getAttribute("tabIndex") && e.push(i[g]);
            }
            for (g = 0; g < e.length; g++) e[g].removeAttribute("tabIndex");
            var j = SnapABugChat.getChatWindowCookieData("chatBoxPosition"),
              k = !1;
            k = j[0] >= 0 && j[2] >= 0 && j[1] === -1 && j[3] === -1;
            var l = !1;
            if (
              (k &&
                ((l = j[0] + SnapABug.formWidth > SnapABug.getWindowWidth()),
                l ||
                  (l =
                    j[2] + SnapABug.formHeight > SnapABug.getWindowHeight())),
              k && !l)
            )
              return (
                SnapABug.positionForm(j[0], j[1], j[2], j[3]),
                void SnapABugChat.setChatWindowCookieData("chatBoxPosition", [
                  j[0],
                  j[1],
                  j[2],
                  j[3],
                ])
              );
            var m = SnapABug.getDefaultChatPosition();
            SnapABug.positionForm(m[0], m[1], m[2], m[3]),
              SnapABugChat.setChatWindowCookieData("chatBoxPosition", [
                m[0],
                m[1],
                m[2],
                m[3],
              ]);
            var n = SnapABugChat.getChatWindowCookieData("chatBoxPosition");
            SnapABug.calculateAndSetInViewportPosition(n);
          }
        },
        newMinimizedMessageReceived: function () {
          var a = document.getElementById("SnapABug_NMN"),
            b = document.getElementById("SnapABug_NMNi");
          if (a) {
            a.style.display = "block";
            var c = SnapABugChat.getChatWindowCookieData(
              "newMinimizedMessageCount"
            );
            (b.innerHTML = ++c),
              SnapABugChat.setChatWindowCookieData(
                "newMinimizedMessageCount",
                c
              );
          }
        },
        setPreviousChatWindowState: function () {
          if (
            !SnapABug.isMobileEnabled() &&
            !SnapABug.isCustomDesignEnabled()
          ) {
            var a = decodeURIComponent(
              SnapABugChat.getCookie("SnapABugChatWindow")
            ).split("|");
            if (0 !== a.length)
              if (SnapABugChat.isMinimized()) {
                var b = document.getElementById("SnapABug_NMN");
                if (b) {
                  var c = SnapABugChat.getChatWindowCookieData(
                    "newMinimizedMessageCount"
                  );
                  b.style.display = c > 0 ? "block" : "none";
                }
                SnapABugChat.minimizeChat(!0);
              } else {
                var d = SnapABugChat.getChatWindowCookieData("chatBoxPosition");
                SnapABug.calculateAndSetInViewportPosition(d);
              }
          }
        },
        resetChatWindowCookieData: function () {
          this.getChatWindowCookieData("isMinimized") &&
            this.setChatWindowCookieData("minimize", "false"),
            this.getChatWindowCookieData("newMinimizedMessageCount") &&
              this.setChatWindowCookieData("newMinimizedMessageCount", "0"),
            this.getChatWindowCookieData("chatBoxPosition") &&
              this.setChatWindowCookieData(
                "chatBoxPosition",
                SnapABug.getDefaultChatPosition()
              );
        },
        setChatWindowCookieData: function (a, b) {
          var c = decodeURIComponent(
              SnapABugChat.getCookie("SnapABugChatWindow")
            ),
            d = [];
          if (
            ("" === c || c.split("|").length < 3
              ? ((d[0] = void 0),
                (d[1] = 0),
                SnapEngage.isCustomDesignEnabled() || (d[2] = [-1, 0, -1, 0]))
              : (d = c.split("|")),
            !a)
          )
            return void SnapABugChat.setCookie(
              "SnapABugChatWindow",
              encodeURIComponent(d.join("|")),
              30
            );
          switch (a) {
            case "isMinimized":
              d[0] = b;
              break;
            case "newMinimizedMessageCount":
              d[1] = b;
              break;
            case "chatBoxPosition":
              d[2] = b;
          }
          SnapABugChat.setCookie(
            "SnapABugChatWindow",
            encodeURIComponent(d.join("|")),
            30
          );
        },
        getChatWindowCookieData: function (a) {
          if (!a) return !1;
          var b = decodeURIComponent(
            SnapABugChat.getCookie("SnapABugChatWindow")
          ).split("|");
          if ("" === b)
            return (
              SnapABugChat.setChatWindowCookieData(),
              void (b = decodeURIComponent(
                SnapABugChat.getCookie("SnapABugChatWindow")
              ).split("|"))
            );
          var c;
          switch (a) {
            case "isMinimized":
              c =
                "undefined" == typeof b[0] || "undefined" === b[0]
                  ? void 0
                  : "true" === b[0];
              break;
            case "newMinimizedMessageCount":
              c = b[1] ? parseInt(b[1], 10) : 0;
              break;
            case "chatBoxPosition":
              if (!b[2]) return SnapABug.getDefaultChatPosition();
              for (var d = b[2].split(","), e = 0; e < d.length; e++)
                d[e] = parseInt(d[e], 10);
              c = d;
              break;
            default:
              c = void 0;
          }
          return c;
        },
        handleDataTransferInProgress: function () {
          if (
            SnapABugChat.isFileUploadInProgress() ||
            secureDataTransferInProgress
          ) {
            var a = "";
            if (
              (SnapABugChat.isFileUploadInProgress()
                ? (a = "File upload")
                : secureDataTransferInProgress && (a = "Secure data"),
              (SnapABugChat.isFileUploadInProgress() &&
                document.getElementById("SnapABug_CM")) ||
                (secureDataTransferInProgress &&
                  document.getElementById("SnapABug_CM")))
            ) {
              switch (
                (SnapABugChat.saveUserInput(), SnapABugChat.showFormChat(), a)
              ) {
                case "File upload":
                  SnapABugChat.setFileUploadInProgress(!1);
                  break;
                case "Secure data":
                  secureDataTransferInProgress = !1;
                  break;
                default:
                  return;
              }
              SnapABugChat.sendChatMessage(
                6,
                a + " request interrupted; please send request again."
              );
            }
          }
        },
        setFileUploadInProgress: function (a) {
          fileUploadInProgress = a;
        },
        isFileUploadInProgress: function () {
          return fileUploadInProgress;
        },
      };
    })();
    var SnapEngage = SnapABug,
      SnapEngageChat = SnapABugChat;
    if (
      ((window.SnapABug = SnapABug),
      (window.SnapEngage = SnapEngage),
      (window.SnapEngageChat = SnapEngageChat),
      (window.handleCobrowseSysCmd = function (a, b, c, d, e, f, g, h, i) {
        i.isSupported() &&
          e &&
          !d &&
          (f.updateChat(
            g.getMessage(61).replace("{alias}", c),
            !1,
            !1,
            "COBR_COBROWSE_INVITE",
            !1,
            !1
          ),
          f.updateScroll(),
          f.enableCobrowsingButtons(a, b)),
          i.isSupported() ||
            h.sendChatMessage(
              6,
              "Visitor browser does not support cobrowsing."
            ),
          e ||
            h.sendChatMessage(
              6,
              "Visitor browser does not have custom design enabled."
            ),
          d &&
            h.sendChatMessage(
              6,
              "Visitor browser will resume the current cobrowsing session."
            );
      }),
      (window.parseXhrJSON = function (a) {
        try {
          var b = JSON.parse(a);
          return b.hasOwnProperty("statusCode") ? b : null;
        } catch (a) {
          return null;
        }
      }),
      (window.getAllCookies = function () {
        return document.cookie;
      }),
      (window.SnapABugHistory = function (a) {
        var b = a.split("#").filter(Boolean),
          c = "";
        return {
          cases: function () {
            return (b[1] && b[1].split("!").filter(Boolean)) || [];
          },
          count: function () {
            return b[0] || "1";
          },
          addNewCaseData: function (a, d) {
            this.cases().length >= 5 && this.removeFirst();
            var e = b[1];
            e && (c += e), (c += a + ":" + d + "!");
          },
          getAsString: function () {
            return this.count() + "#" + c;
          },
          removeFirst: function () {
            var a = this.cases();
            a.shift(0, 1), (b[1] = a.join("!") + "!");
          },
        };
      }),
      (window.CallbackManager = CallbackManager),
      (window.MESSAGE_TYPES = {
        TEXT: "text",
        BUTTON: "inline_buttons",
        CARDS: "cards",
        OFFLINE: "link_text",
      }),
      (window.handleButtonMessage = function (a) {
        SnapABug.isCustomDesignEnabled() &&
          SnapABug.getCustomDesignUI().showButtonUI(a.buttons);
      }),
      (window.handleTextMessage = function (a, b, c, d) {
        this.callbackMessage(b, a.text, c, d);
      }),
      (window.handleSearchResultsMessage = function (a) {
        SnapABug.getCustomDesignUI().initSearchResultsView(a);
      }),
      (window.handleLinkTextMessage = function (a) {
        var b = {
          offlineForm: "offline_form",
        };
        a.action.type === b.offlineForm
          ? SnapABug.getCustomDesignUI().initTextLinkView(a)
          : console.log("action type is unsupported: ", a.action.type);
      }),
      "undefined" == typeof YAHOO || !YAHOO)
    )
      var YAHOO = {};
    (YAHOO.namespace = function () {
      var a,
        b,
        c,
        d = arguments,
        e = null;
      for (a = 0; a < d.length; a += 1)
        for (
          c = ("" + d[a]).split("."), e = YAHOO, b = "YAHOO" == c[0] ? 1 : 0;
          b < c.length;
          b += 1
        )
          (e[c[b]] = e[c[b]] || {}), (e = e[c[b]]);
      return e;
    }),
      (YAHOO.log = function (a, b, c) {
        var d = YAHOO.widget.Logger;
        return !(!d || !d.log) && d.log(a, b, c);
      }),
      (YAHOO.register = function (a, b, c) {
        var d,
          e,
          f,
          g,
          h,
          i = YAHOO.env.modules;
        for (
          i[a] ||
            (i[a] = {
              versions: [],
              builds: [],
            }),
            d = i[a],
            e = c.version,
            f = c.build,
            g = YAHOO.env.listeners,
            d.name = a,
            d.version = e,
            d.build = f,
            !!d.versions && d.versions.push(e),
            !!d.builds && d.builds.push(f),
            d.mainClass = b,
            h = 0;
          h < g.length;
          h += 1
        )
          g[h](d);
        b
          ? ((b.VERSION = e), (b.BUILD = f))
          : YAHOO.log("mainClass is undefined for module " + a, "warn");
      }),
      (YAHOO.env = YAHOO.env || {
        modules: [],
        listeners: [],
      }),
      (YAHOO.env.getVersion = function (a) {
        return YAHOO.env.modules[a] || null;
      }),
      (YAHOO.env.ua = (function () {
        var a,
          b = function (a) {
            var b = 0;
            return parseFloat(
              a.replace(/\./g, function () {
                return 1 == b++ ? "" : ".";
              })
            );
          },
          c = navigator,
          d = {
            ie: 0,
            opera: 0,
            gecko: 0,
            webkit: 0,
            mobile: null,
            air: 0,
            caja: c.cajaVersion,
            secure: !1,
            os: null,
          },
          e = navigator && navigator.userAgent,
          f = window && window.location,
          g = f && f.href;
        return (
          (d.secure = g && 0 === g.toLowerCase().indexOf("https")),
          e &&
            (/windows|win32/i.test(e)
              ? (d.os = "windows")
              : /macintosh/i.test(e) && (d.os = "macintosh"),
            /KHTML/.test(e) && (d.webkit = 1),
            (a = e.match(/AppleWebKit\/([^\s]*)/)),
            a &&
              a[1] &&
              ((d.webkit = b(a[1])),
              / Mobile\//.test(e)
                ? (d.mobile = "Apple")
                : ((a = e.match(/NokiaN[^\/]*/)), a && (d.mobile = a[0])),
              (a = e.match(/AdobeAIR\/([^\s]*)/)),
              a && (d.air = a[0])),
            d.webkit ||
              ((a = e.match(/Opera[\s\/]([^\s]*)/)),
              a && a[1]
                ? ((d.opera = b(a[1])),
                  (a = e.match(/Opera Mini[^;]*/)),
                  a && (d.mobile = a[0]))
                : ((a = e.match(/MSIE\s([^;]*)/)),
                  a && a[1]
                    ? (d.ie = b(a[1]))
                    : ((a = e.match(/Gecko\/([^\s]*)/)),
                      a &&
                        ((d.gecko = 1),
                        (a = e.match(/rv:([^\s\)]*)/)),
                        a && a[1] && (d.gecko = b(a[1]))))))),
          d
        );
      })()),
      (function () {
        if (
          (YAHOO.namespace("util", "widget", "example"),
          "undefined" != typeof YAHOO_config)
        ) {
          var a,
            b = YAHOO_config.listener,
            c = YAHOO.env.listeners,
            d = !0;
          if (b) {
            for (a = 0; a < c.length; a++)
              if (c[a] == b) {
                d = !1;
                break;
              }
            d && c.push(b);
          }
        }
      })(),
      (YAHOO.lang = YAHOO.lang || {}),
      (function () {
        var a = YAHOO.lang,
          b = Object.prototype,
          c = "[object Array]",
          d = "[object Function]",
          e = "[object Object]",
          f = [],
          g = ["toString", "valueOf"],
          h = {
            isArray: function (a) {
              return b.toString.apply(a) === c;
            },
            isBoolean: function (a) {
              return "boolean" == typeof a;
            },
            isFunction: function (a) {
              return "function" == typeof a || b.toString.apply(a) === d;
            },
            isNull: function (a) {
              return null === a;
            },
            isNumber: function (a) {
              return "number" == typeof a && isFinite(a);
            },
            isObject: function (b) {
              return (b && ("object" == typeof b || a.isFunction(b))) || !1;
            },
            isString: function (a) {
              return "string" == typeof a;
            },
            isUndefined: function (a) {
              return "undefined" == typeof a;
            },
            _IEEnumFix: YAHOO.env.ua.ie
              ? function (c, d) {
                  var e, f, h;
                  for (e = 0; e < g.length; e += 1)
                    (f = g[e]),
                      (h = d[f]),
                      a.isFunction(h) && h != b[f] && (c[f] = h);
                }
              : function () {},
            extend: function (c, d, e) {
              if (!d || !c)
                throw new Error(
                  "extend failed, please check that all dependencies are included."
                );
              var f,
                g = function () {};
              if (
                ((g.prototype = d.prototype),
                (c.prototype = new g()),
                (c.prototype.constructor = c),
                (c.superclass = d.prototype),
                d.prototype.constructor == b.constructor &&
                  (d.prototype.constructor = d),
                e)
              ) {
                for (f in e) a.hasOwnProperty(e, f) && (c.prototype[f] = e[f]);
                a._IEEnumFix(c.prototype, e);
              }
            },
            augmentObject: function (b, c) {
              if (!c || !b)
                throw new Error("Absorb failed, verify dependencies.");
              var d,
                e,
                f = arguments,
                g = f[2];
              if (g && g !== !0)
                for (d = 2; d < f.length; d += 1) b[f[d]] = c[f[d]];
              else {
                for (e in c) (!g && e in b) || (b[e] = c[e]);
                a._IEEnumFix(b, c);
              }
            },
            augmentProto: function (b, c) {
              if (!c || !b)
                throw new Error("Augment failed, verify dependencies.");
              var d,
                e = [b.prototype, c.prototype];
              for (d = 2; d < arguments.length; d += 1) e.push(arguments[d]);
              a.augmentObject.apply(this, e);
            },
            dump: function (b, c) {
              var d,
                e,
                f = [],
                g = "{...}",
                h = "f() {...}",
                i = ", ",
                j = " => ";
              if (!a.isObject(b)) return b + "";
              if (b instanceof Date || ("nodeType" in b && "tagName" in b))
                return b;
              if (a.isFunction(b)) return h;
              if (((c = a.isNumber(c) ? c : 3), a.isArray(b))) {
                for (f.push("["), d = 0, e = b.length; d < e; d += 1)
                  a.isObject(b[d])
                    ? f.push(c > 0 ? a.dump(b[d], c - 1) : g)
                    : f.push(b[d]),
                    f.push(i);
                f.length > 1 && f.pop(), f.push("]");
              } else {
                f.push("{");
                for (d in b)
                  a.hasOwnProperty(b, d) &&
                    (f.push(d + j),
                    a.isObject(b[d])
                      ? f.push(c > 0 ? a.dump(b[d], c - 1) : g)
                      : f.push(b[d]),
                    f.push(i));
                f.length > 1 && f.pop(), f.push("}");
              }
              return f.join("");
            },
            substitute: function (b, c, d) {
              for (
                var f,
                  g,
                  h,
                  i,
                  j,
                  k,
                  l,
                  m,
                  n,
                  o = [],
                  p = "dump",
                  q = " ",
                  r = "{",
                  s = "}";
                ((f = b.lastIndexOf(r)), !(f < 0)) &&
                ((g = b.indexOf(s, f)), !(f + 1 >= g));

              )
                (l = b.substring(f + 1, g)),
                  (i = l),
                  (k = null),
                  (h = i.indexOf(q)),
                  h > -1 && ((k = i.substring(h + 1)), (i = i.substring(0, h))),
                  (j = c[i]),
                  d && (j = d(i, j, k)),
                  a.isObject(j)
                    ? a.isArray(j)
                      ? (j = a.dump(j, parseInt(k, 10)))
                      : ((k = k || ""),
                        (m = k.indexOf(p)),
                        m > -1 && (k = k.substring(4)),
                        (n = j.toString()),
                        (j =
                          n === e || m > -1 ? a.dump(j, parseInt(k, 10)) : n))
                    : a.isString(j) ||
                      a.isNumber(j) ||
                      ((j = "~-" + o.length + "-~"), (o[o.length] = l)),
                  (b = b.substring(0, f) + j + b.substring(g + 1));
              for (f = o.length - 1; f >= 0; f -= 1)
                b = b.replace(
                  new RegExp("~-" + f + "-~"),
                  "{" + o[f] + "}",
                  "g"
                );
              return b;
            },
            trim: function (a) {
              try {
                return a.replace(/^\s+|\s+$/g, "");
              } catch (b) {
                return a;
              }
            },
            merge: function () {
              var b,
                c = {},
                d = arguments,
                e = d.length;
              for (b = 0; b < e; b += 1) a.augmentObject(c, d[b], !0);
              return c;
            },
            later: function (b, c, d, e, g) {
              (b = b || 0), (c = c || {});
              var h,
                i,
                j = d,
                k = e;
              if ((a.isString(d) && (j = c[d]), !j))
                throw new TypeError("method undefined");
              return (
                k && !a.isArray(k) && (k = [e]),
                (h = function () {
                  j.apply(c, k || f);
                }),
                (i = g ? setInterval(h, b) : setTimeout(h, b)),
                {
                  interval: g,
                  cancel: function () {
                    this.interval ? clearInterval(i) : clearTimeout(i);
                  },
                }
              );
            },
            isValue: function (b) {
              return (
                a.isObject(b) ||
                a.isString(b) ||
                a.isNumber(b) ||
                a.isBoolean(b)
              );
            },
          };
        (a.hasOwnProperty = b.hasOwnProperty
          ? function (a, b) {
              return a && a.hasOwnProperty(b);
            }
          : function (b, c) {
              return (
                !a.isUndefined(b[c]) && b.constructor.prototype[c] !== b[c]
              );
            }),
          h.augmentObject(a, h, !0),
          (YAHOO.util.Lang = a),
          (a.augment = a.augmentProto),
          (YAHOO.augment = a.augmentProto),
          (YAHOO.extend = a.extend);
      })(),
      YAHOO.register("yahoo", YAHOO, {
        version: "2.8.2r1",
        build: "7",
      }),
      (YAHOO.util.Get = (function () {
        var a = {},
          b = 0,
          c = 0,
          d = !1,
          e = YAHOO.env.ua,
          f = YAHOO.lang,
          g = function (a, b, c) {
            var d = c || window,
              e = d.document,
              f = e.createElement(a);
            for (var g in b)
              b[g] &&
                YAHOO.lang.hasOwnProperty(b, g) &&
                f.setAttribute(g, b[g]);
            return f;
          },
          h = function (a, b, d) {
            var e = {
              id: "yui__dyn_" + c++,
              type: "text/css",
              rel: "stylesheet",
              href: a,
            };
            return d && f.augmentObject(e, d), g("link", e, b);
          },
          i = function (a, b, d) {
            var e = {
              id: "yui__dyn_" + c++,
              type: "text/javascript",
              src: a,
            };
            return d && f.augmentObject(e, d), g("script", e, b);
          },
          j = function (a, b) {
            return {
              tId: a.tId,
              win: a.win,
              data: a.data,
              nodes: a.nodes,
              msg: b,
              purge: function () {
                q(this.tId);
              },
            };
          },
          k = function (b, c) {
            var d = a[c],
              e = f.isString(b) ? d.win.document.getElementById(b) : b;
            return e || l(c, "target node not found: " + b), e;
          },
          l = function (b, c) {
            var d = a[b];
            if (d.onFailure) {
              var e = d.scope || d.win;
              d.onFailure.call(e, j(d, c));
            }
          },
          m = function (b) {
            var c = a[b];
            if (((c.finished = !0), c.aborted)) {
              var d = "transaction " + b + " was aborted";
              return void l(b, d);
            }
            if (c.onSuccess) {
              var e = c.scope || c.win;
              c.onSuccess.call(e, j(c));
            }
          },
          n = function (b) {
            var c = a[b];
            if (c.onTimeout) {
              var d = c.scope || c;
              c.onTimeout.call(d, j(c));
            }
          },
          o = function (b, c) {
            var d = a[b];
            if ((d.timer && d.timer.cancel(), d.aborted)) {
              var g = "transaction " + b + " was aborted";
              return void l(b, g);
            }
            c
              ? (d.url.shift(), d.varName && d.varName.shift())
              : ((d.url = f.isString(d.url) ? [d.url] : d.url),
                d.varName &&
                  (d.varName = f.isString(d.varName)
                    ? [d.varName]
                    : d.varName));
            var j,
              p = d.win,
              q = p.document,
              r = q.getElementsByTagName("head")[0];
            if (0 !== d.url.length) {
              var t = d.url[0];
              if (!t) return d.url.shift(), o(b);
              if (
                (d.timeout && (d.timer = f.later(d.timeout, d, n, b)),
                (j =
                  "script" === d.type
                    ? i(t, p, d.attributes)
                    : h(t, p, d.attributes)),
                s(d.type, j, b, t, p, d.url.length),
                d.nodes.push(j),
                d.insertBefore)
              ) {
                var u = k(d.insertBefore, b);
                u && u.parentNode.insertBefore(j, u);
              } else r.appendChild(j);
              (e.webkit || e.gecko) && "css" === d.type && o(b, t);
            } else if (
              "script" === d.type &&
              e.webkit &&
              e.webkit < 420 &&
              !d.finalpass &&
              !d.varName
            ) {
              var v = i(null, d.win, d.attributes);
              (v.innerHTML = 'YAHOO.util.Get._finalize("' + b + '");'),
                d.nodes.push(v),
                r.appendChild(v);
            } else m(b);
          },
          p = function () {
            if (!d) {
              d = !0;
              for (var b in a) {
                var c = a[b];
                c.autopurge && c.finished && (q(c.tId), delete a[b]);
              }
              d = !1;
            }
          },
          q = function (b) {
            if (a[b]) {
              var c,
                d,
                e,
                f,
                g = a[b],
                h = g.nodes,
                i = h.length,
                j = g.win.document,
                l = j.getElementsByTagName("head")[0];
              for (
                g.insertBefore &&
                  ((c = k(g.insertBefore, b)), c && (l = c.parentNode)),
                  d = 0;
                d < i;
                d += 1
              ) {
                if (((e = h[d]), e.clearAttributes)) e.clearAttributes();
                else for (f in e) delete e[f];
                l.removeChild(e);
              }
              g.nodes = [];
            }
          },
          r = function (c, d, e) {
            var g = "q" + b++;
            (e = e || {}),
              b % YAHOO.util.Get.PURGE_THRESH === 0 && p(),
              (a[g] = f.merge(e, {
                tId: g,
                type: c,
                url: d,
                finished: !1,
                aborted: !1,
                nodes: [],
              }));
            var h = a[g];
            return (
              (h.win = h.win || window),
              (h.scope = h.scope || h.win),
              (h.autopurge = "autopurge" in h ? h.autopurge : "script" === c),
              e.charset &&
                ((h.attributes = h.attributes || {}),
                (h.attributes.charset = e.charset)),
              f.later(0, h, o, g),
              {
                tId: g,
              }
            );
          },
          s = function (b, c, d, g, h, i, j) {
            var k = j || o;
            if (e.ie)
              c.onreadystatechange = function () {
                var a = this.readyState;
                ("loaded" !== a && "complete" !== a) ||
                  ((c.onreadystatechange = null), k(d, g));
              };
            else if (e.webkit) {
              if ("script" === b)
                if (e.webkit >= 420)
                  c.addEventListener("load", function () {
                    k(d, g);
                  });
                else {
                  var m = a[d];
                  if (m.varName) {
                    var n = YAHOO.util.Get.POLL_FREQ;
                    (m.maxattempts = YAHOO.util.Get.TIMEOUT / n),
                      (m.attempts = 0),
                      (m._cache = m.varName[0].split(".")),
                      (m.timer = f.later(
                        n,
                        m,
                        function (a) {
                          var b,
                            c = this._cache,
                            e = c.length,
                            f = this.win;
                          for (b = 0; b < e; b += 1)
                            if (((f = f[c[b]]), !f)) {
                              if (
                                (this.attempts++,
                                this.attempts++ > this.maxattempts)
                              ) {
                                var h = "Over retry limit, giving up";
                                m.timer.cancel(), l(d, h);
                              }
                              return;
                            }
                          m.timer.cancel(), k(d, g);
                        },
                        null,
                        !0
                      ));
                  } else f.later(YAHOO.util.Get.POLL_FREQ, null, k, [d, g]);
                }
            } else
              c.onload = function () {
                k(d, g);
              };
          };
        return {
          POLL_FREQ: 10,
          PURGE_THRESH: 20,
          TIMEOUT: 2e3,
          _finalize: function (a) {
            f.later(0, null, m, a);
          },
          abort: function (b) {
            var c = f.isString(b) ? b : b.tId,
              d = a[c];
            d && (d.aborted = !0);
          },
          script: function (a, b) {
            return r("script", a, b);
          },
          css: function (a, b) {
            return r("css", a, b);
          },
        };
      })()),
      YAHOO.register("get", YAHOO.util.Get, {
        version: "2.8.2r1",
        build: "7",
      }),
      (window.YAHOO = YAHOO);
    SnapEngage.isSneakPeek = function () {
      return true;
    };
    if (typeof SnapEngage.setJSVariables == "function") {
      SnapEngage.setJSVariables(
        "subscriptionType,customerLifeCycle,platform,customerCode,customerId,site,uiLanguage"
      );
    }
    (function () {
      !(function (t) {
        function e(t, e) {
          (this.options = t), (this.target = e);
        }
        (e.prototype = {
          initViewport: function () {
            this.isViewportModified = !1;
            var t = this._findViewportMeta();
            t && (this.originalMeta = t);
          },
          _findViewportMeta: function () {
            var t,
              e,
              i = document.getElementsByTagName("meta");
            for (t = 0; t < i.length; t++)
              if (/viewport/i.test(i[t].getAttribute("name"))) {
                e = i[t];
                break;
              }
            return e;
          },
          _injectViewportMeta: function (t) {
            var e = document.createElement("meta");
            e.setAttribute("name", "viewport"),
              e.setAttribute("content", t),
              document.head.appendChild(e);
          },
          toggleViewport: function () {
            var t = this._findViewportMeta();
            if (this.isViewportModified)
              t.parentNode.removeChild(t),
                this.originalMeta &&
                  this._injectViewportMeta(
                    this.originalMeta.getAttribute("content")
                  ),
                (this.isViewportModified = !1);
            else {
              var e,
                i = /user-scalable\s*=\s*(yes|no|0|1)/;
              if (t) {
                var n = t.getAttribute("content");
                (e = i.test(n)
                  ? n.replace(i, "user-scalable=0")
                  : n + ", user-scalable=0"),
                  t.parentNode.removeChild(t);
              } else e = "user-scalable=0";
              this._injectViewportMeta(e), (this.isViewportModified = !0);
            }
          },
          setLanguageDirection: function (e) {
            ("ar" !== e && "iw" !== e) ||
              (t.chat_custom_design.direction = "rtl");
          },
          setDomLanguageDirection: function (e) {
            this.iframe = e;
            var i = this.iframe.getElementsByTagName("html")[0];
            "rtl" === t.chat_custom_design.direction &&
              (i.setAttribute("dir", t.chat_custom_design.direction),
              i.setAttribute(
                "lang",
                "ar" === t.chat_custom_design.locale ? "ar" : "he"
              ));
          },
          isMobileDevice: function () {
            return !this.isInsideGWT() &&
              SnapEngage &&
              SnapEngage.getCustomDesignUI() &&
              SnapEngage.getCustomDesignUI().state &&
              null !== SnapEngage.getCustomDesignUI().getState("isMobileUI")
              ? SnapEngage.getCustomDesignUI().getState("isMobileUI")
              : ((t.chat_custom_design.Helpers.isMobile = !1),
                (e = navigator.userAgent || navigator.vendor || t.opera),
                (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(
                  e
                ) ||
                  /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(
                    e.substr(0, 4)
                  )) &&
                  (t.chat_custom_design.Helpers.isMobile = !0),
                t.chat_custom_design.Helpers.isMobile);
            var e;
          },
          isIos: function () {
            return (
              !!navigator.platform &&
              /iPad|iPhone|iPod/.test(navigator.platform)
            );
          },
          iosScrollToTop: function () {
            this.isIos() &&
              setTimeout(function () {
                t.scrollTo(
                  0,
                  "number" == typeof t.iosScrollPositionY
                    ? t.iosScrollPositionY
                    : t.pageYOffset
                );
              }, 100);
          },
          isIpad: function () {
            return navigator.userAgent.match(/(iPad)/);
          },
          debounce: function (t, e, i) {
            var n;
            return function () {
              var a = this,
                s = arguments,
                r = i && !n;
              clearTimeout(n),
                (n = setTimeout(function () {
                  (n = null), i || t.apply(a, s);
                }, e)),
                r && t.apply(a, s);
            };
          },
          disableScrolling: function () {
            this.isMobileDevice() &&
              (document.documentElement.style.overflow = "hidden");
          },
          enableScrolling: function () {
            this.isMobileDevice() &&
              (document.documentElement.style.overflow = "");
          },
          getScale: function () {
            return this.isMobileDevice()
              ? t.matchMedia("(orientation: portrait)").matches
                ? t.innerWidth > screen.width
                  ? ((this.nonResponsive = !0), screen.width / t.innerWidth)
                  : screen.width / screen.availWidth
                : t.matchMedia("(orientation: landscape)").matches
                ? 0
                : void 0
              : 1;
          },
          removeChildren: function (t) {
            if (void 0 !== t)
              for (; t.firstChild; ) t.removeChild(t.firstChild);
          },
          removeElement: function (t) {
            t && t.parentNode && t.parentNode.removeChild(t);
          },
          elementHasClass: function (t, e) {
            var i = new RegExp("(\\s|^)" + e + "(\\s|$)");
            return !!t.className.match(i);
          },
          elementAddClass: function (t, e) {
            this.elementHasClass(t, e) ||
              (t.className += (t.className.length > 0 ? " " : "") + e);
          },
          elementRemoveClass: function (t, e) {
            if (this.elementHasClass(t, e)) {
              var i = new RegExp("(\\s|^)" + e + "(\\s|$)");
              t.className = t.className.replace(
                i,
                t.className.length > 0 ? " " : ""
              );
            }
          },
          elementToggleClass: function (t, e) {
            this.elementHasClass(t, e)
              ? this.elementRemoveClass(t, e)
              : this.elementAddClass(t, e);
          },
          elementSwapClass: function (t, e, i) {
            t &&
              (this.elementHasClass(t, e)
                ? (this.elementRemoveClass(t, e), this.elementAddClass(t, i))
                : this.elementAddClass(t, i));
          },
          elementAddId: function (t, e) {
            this.iframe = document.getElementById(
              this.getIframeId()
            ).contentWindow.document;
            var i = this.iframe.getElementsByClassName(t);
            i.length > 0 && i[i.length - 1].setAttribute("id", e);
          },
          setButtonViewOptions: function (t) {
            this.options = t;
          },
          supportsSvg: function () {
            return document.implementation.hasFeature(
              "http://www.w3.org/TR/SVG11/feature#Image",
              "1.1"
            );
          },
          svgButtonTemplate: function (t) {
            var e = document.createElement("div");
            e.id = "svg-container";
            var i = t ? "comments-o" : this.options.svgIcon;
            if (this.supportsSvg()) {
              var n = "http://www.w3.org/2000/svg",
                a = document.createElementNS(n, "svg");
              a.setAttributeNS(null, "viewBox", "0 0 600 600");
              var s = document.createElementNS(n, "defs");
              a.appendChild(s);
              var r = document.createElement("filter");
              (r.id = "dropshadow"),
                r.setAttribute("height", "140%"),
                s.appendChild(r);
              var o = document.createElement("feGaussianBlur");
              o.setAttribute("in", "SourceAlpha"),
                o.setAttribute("stdDeviation", "15"),
                r.appendChild(o);
              var l = document.createElement("feOffset");
              l.setAttribute("result", "offsetblur"),
                l.setAttribute("dx", "10"),
                l.setAttribute("dy", "10"),
                r.appendChild(l);
              var c = document.createElement("feComponentTransfer");
              r.appendChild(c);
              var d = document.createElement("feFuncA");
              d.setAttribute("type", "linear"),
                d.setAttribute("slope", "0.8"),
                c.appendChild(d);
              var m = document.createElement("feMerge");
              r.appendChild(m);
              var h = document.createElement("feMergeNode");
              m.appendChild(h);
              var u = document.createElement("feMergeNode");
              u.setAttribute("in", "SourceGraphic"), m.appendChild(u);
              var p = document.createElementNS(n, "g");
              (p.id = i),
                p.setAttributeNS(null, "class", "designstudio-container");
              var g = document.createElementNS(n, "circle");
              g.setAttributeNS(null, "class", "designstudio-circle"),
                g.setAttributeNS(null, "cx", "50%"),
                g.setAttributeNS(null, "cy", "50%"),
                g.setAttributeNS(null, "r", "260"),
                g.setAttributeNS(null, "fill", this.options.bgColor),
                g.setAttributeNS(null, "linejoin", "round"),
                g.setAttributeNS(null, "stroke", this.options.borderColor),
                g.setAttributeNS(null, "stroke-width", "0"),
                g.setAttributeNS(null, "fill-opacity", "1"),
                g.setAttributeNS(null, "position", "absolute"),
                p.appendChild(g),
                a.appendChild(p);
              var q = this.getSvgPath(i, this.options.fontColor),
                f = document.createElementNS(
                  "http://www.w3.org/2000/svg",
                  "path"
                );
              f.setAttribute("class", "designstudio-icon"),
                f.setAttribute("fill", q.iconColor),
                f.setAttribute("d", q.data),
                f.setAttribute("transform", q.tran),
                p.appendChild(f),
                e.appendChild(a);
            } else {
              var b = document.createElement("img");
              (b.id = "button-img"),
                b.setAttribute("alt", ""),
                b.setAttribute(
                  "src",
                  this.options.staticUrl + "/images/png/" + i + "-dk.png"
                ),
                e.appendChild(b);
            }
            return e;
          },
          addStaticSvgIcon: function (t, e) {
            var i = this.iframe.createElement("img");
            return (
              (i.className = e),
              (i.src =
                SnapEngage.getBaseURL() + "/studio/images/svg/" + t + ".svg"),
              i
            );
          },
          addSvgIcon: function (t, e) {
            if (
              ((this.iframe = document.getElementById(
                this.getIframeId()
              ).contentWindow.document),
              this.supportsSvg())
            ) {
              var i = "http://www.w3.org/2000/svg",
                n = this.iframe.createElementNS(i, "svg"),
                a = this.iframe.createElementNS(i, "g");
              (a.id = t), n.appendChild(a);
              var s = this.getSvgPath(t, e);
              n.setAttributeNS(null, "viewBox", s.viewBox);
              var r = this.iframe.createElementNS(
                "http://www.w3.org/2000/svg",
                "path"
              );
              return (
                r.setAttribute("class", "designstudio-icon"),
                r.setAttribute("fill", s.iconColor),
                r.setAttribute("d", s.data),
                r.setAttribute("transform", s.tran),
                a.appendChild(r),
                n
              );
            }
            var o = this.iframe.createElement("img");
            return (
              o.setAttribute("alt", ""),
              (o.className = "svg-backup-img"),
              (o.src =
                this.options.staticUrl + "/images/png/icons/" + t + "-dk.png"),
              o
            );
          },
          getSvgPath: function (t, e) {
            var i,
              n,
              a = "90 100 375 375";
            switch (t) {
              case "bars":
                (i =
                  "M1536 192v-128q0 -26 -19 -45t-45 -19h-1408q-26 0 -45 19t-19 45v128q0 26 19 45t45 19h1408q26 0 45 -19t19 -45zM1536 704v-128q0 -26 -19 -45t-45 -19h-1408q-26 0 -45 19t-19 45v128q0 26 19 45t45 19h1408q26 0 45 -19t19 -45zM1536 1216v-128q0 -26 -19 -45 t-45 -19h-1408q-26 0 -45 19t-19 45v128q0 26 19 45t45 19h1408q26 0 45 -19t19 -45z"),
                  (n = "scale(.195, -.195) translate(750, -2200)");
                break;
              case "camera":
                (i =
                  "M960 864q119 0 203.5 -84.5t84.5 -203.5t-84.5 -203.5t-203.5 -84.5t-203.5 84.5t-84.5 203.5t84.5 203.5t203.5 84.5zM1664 1280q106 0 181 -75t75 -181v-896q0 -106 -75 -181t-181 -75h-1408q-106 0 -181 75t-75 181v896q0 106 75 181t181 75h224l51 136 q19 49 69.5 84.5t103.5 35.5h512q53 0 103.5 -35.5t69.5 -84.5l51 -136h224zM960 128q185 0 316.5 131.5t131.5 316.5t-131.5 316.5t-316.5 131.5t-316.5 -131.5t-131.5 -316.5t131.5 -316.5t316.5 -131.5z"),
                  (n = "scale(.175, -.175) translate(725, -2350)");
                break;
              case "cancel":
                (i =
                  "M1312 643q0 161 -87 295l-754 -753q137 -89 297 -89q111 0 211.5 43.5t173.5 116.5t116 174.5t43 212.5zM313 344l755 754q-135 91 -300 91q-148 0 -273 -73t-198 -199t-73 -274q0 -162 89 -299zM1536 643q0 -157 -61 -300t-163.5 -246t-245 -164t-298.5 -61t-298.5 61 t-245 164t-163.5 246t-61 300t61 299.5t163.5 245.5t245 164t298.5 61t298.5 -61t245 -164t163.5 -245.5t61 -299.5z"),
                  (n = "scale(.215, -.215) translate(625, -2000)");
                break;
              case "chevron-down":
                (i =
                  "M1683 728l-742 -741q-19 -19 -45 -19t-45 19l-742 741q-19 19 -19 45.5t19 45.5l166 165q19 19 45 19t45 -19l531 -531l531 531q19 19 45 19t45 -19l166 -165q19 -19 19 -45.5t-19 -45.5z"),
                  (n = "scale(.20, -.20) translate(600, -2050)");
                break;
              case "chevron-left":
                (i =
                  "M1171 1235l-531 -531l531 -531q19 -19 19 -45t-19 -45l-166 -166q-19 -19 -45 -19t-45 19l-742 742q-19 19 -19 45t19 45l742 742q19 19 45 19t45 -19l166 -166q19 -19 19 -45t-19 -45z"),
                  (n = "scale(.20, -.20) translate(700, -2150)");
                break;
              case "close":
                (i =
                  "M1298 214q0 -40 -28 -68l-136 -136q-28 -28 -68 -28t-68 28l-294 294l-294 -294q-28 -28 -68 -28t-68 28l-136 136q-28 28 -28 68t28 68l294 294l-294 294q-28 28 -28 68t28 68l136 136q28 28 68 28t68 -28l294 -294l294 294q28 28 68 28t68 -28l136 -136q28 -28 28 -68 t-28 -68l-294 -294l294 -294q28 -28 28 -68z"),
                  (n = "scale(.20, -.20) translate(600, -2050)");
                break;
              case "comment":
                (i =
                  "M1792 640q0 -174 -120 -321.5t-326 -233t-450 -85.5q-70 0 -145 8q-198 -175 -460 -242q-49 -14 -114 -22q-17 -2 -30.5 9t-17.5 29v1q-3 4 -0.5 12t2 10t4.5 9.5l6 9t7 8.5t8 9q7 8 31 34.5t34.5 38t31 39.5t32.5 51t27 59t26 76q-157 89 -247.5 220t-90.5 281 q0 130 71 248.5t191 204.5t286 136.5t348 50.5q244 0 450 -85.5t326 -233t120 -321.5z"),
                  (n = "scale(.195, -.195) translate(600, -2000)");
                break;
              case "comment-o":
                (i =
                  "M896 1152q-204 0 -381.5 -69.5t-282 -187.5t-104.5 -255q0 -112 71.5 -213.5t201.5 -175.5l87 -50l-27 -96q-24 -91 -70 -172q152 63 275 171l43 38l57 -6q69 -8 130 -8q204 0 381.5 69.5t282 187.5t104.5 255t-104.5 255t-282 187.5t-381.5 69.5zM1792 640 q0 -174 -120 -321.5t-326 -233t-450 -85.5q-70 0 -145 8q-198 -175 -460 -242q-49 -14 -114 -22h-5q-15 0 -27 10.5t-16 27.5v1q-3 4 -0.5 12t2 10t4.5 9.5l6 9t7 8.5t8 9q7 8 31 34.5t34.5 38t31 39.5t32.5 51t27 59t26 76q-157 89 -247.5 220t-90.5 281q0 174 120 321.5 t326 233t450 85.5t450 -85.5t326 -233t120 -321.5z"),
                  (n = "scale(.195, -.195) translate(600, -2000)");
                break;
              case "comments":
                (i =
                  "M1408 768q0 -139 -94 -257t-256.5 -186.5t-353.5 -68.5q-86 0 -176 16q-124 -88 -278 -128q-36 -9 -86 -16h-3q-11 0 -20.5 8t-11.5 21q-1 3 -1 6.5t0.5 6.5t2 6l2.5 5t3.5 5.5t4 5t4.5 5t4 4.5q5 6 23 25t26 29.5t22.5 29t25 38.5t20.5 44q-124 72 -195 177t-71 224 q0 139 94 257t256.5 186.5t353.5 68.5t353.5 -68.5t256.5 -186.5t94 -257zM1792 512q0 -120 -71 -224.5t-195 -176.5q10 -24 20.5 -44t25 -38.5t22.5 -29t26 -29.5t23 -25q1 -1 4 -4.5t4.5 -5t4 -5t3.5 -5.5l2.5 -5t2 -6t0.5 -6.5t-1 -6.5q-3 -14 -13 -22t-22 -7 q-50 7 -86 16q-154 40 -278 128q-90 -16 -176 -16q-271 0 -472 132q58 -4 88 -4q161 0 309 45t264 129q125 92 192 212t67 254q0 77 -23 152q129 -71 204 -178t75 -230z"),
                  (n = "scale(.195, -.195) translate(600, -2000)");
                break;
              case "comments-o":
                (i =
                  "M704 1152q-153 0 -286 -52t-211.5 -141t-78.5 -191q0 -82 53 -158t149 -132l97 -56l-35 -84q34 20 62 39l44 31l53 -10q78 -14 153 -14q153 0 286 52t211.5 141t78.5 191t-78.5 191t-211.5 141t-286 52zM704 1280q191 0 353.5 -68.5t256.5 -186.5t94 -257t-94 -257 t-256.5 -186.5t-353.5 -68.5q-86 0 -176 16q-124 -88 -278 -128q-36 -9 -86 -16h-3q-11 0 -20.5 8t-11.5 21q-1 3 -1 6.5t0.5 6.5t2 6l2.5 5t3.5 5.5t4 5t4.5 5t4 4.5q5 6 23 25t26 29.5t22.5 29t25 38.5t20.5 44q-124 72 -195 177t-71 224q0 139 94 257t256.5 186.5 t353.5 68.5zM1526 111q10 -24 20.5 -44t25 -38.5t22.5 -29t26 -29.5t23 -25q1 -1 4 -4.5t4.5 -5t4 -5t3.5 -5.5l2.5 -5t2 -6t0.5 -6.5t-1 -6.5q-3 -14 -13 -22t-22 -7q-50 7 -86 16q-154 40 -278 128q-90 -16 -176 -16q-271 0 -472 132q58 -4 88 -4q161 0 309 45t264 129 q125 92 192 212t67 254q0 77 -23 152q129 -71 204 -178t75 -230q0 -120 -71 -224.5t-195 -176.5z"),
                  (n = "scale(.195, -.195) translate(600, -2000)");
                break;
              case "commenting-o":
                (i =
                  "M640 640q0 -53 -37.5 -90.5t-90.5 -37.5t-90.5 37.5t-37.5 90.5t37.5 90.5t90.5 37.5t90.5 -37.5t37.5 -90.5zM1024 640q0 -53 -37.5 -90.5t-90.5 -37.5t-90.5 37.5t-37.5 90.5t37.5 90.5t90.5 37.5t90.5 -37.5t37.5 -90.5zM1408 640q0 -53 -37.5 -90.5t-90.5 -37.5 t-90.5 37.5t-37.5 90.5t37.5 90.5t90.5 37.5t90.5 -37.5t37.5 -90.5zM896 1152q-204 0 -381.5 -69.5t-282 -187.5t-104.5 -255q0 -112 71.5 -213.5t201.5 -175.5l87 -50l-27 -96q-24 -91 -70 -172q152 63 275 171l43 38l57 -6q69 -8 130 -8q204 0 381.5 69.5t282 187.5 t104.5 255t-104.5 255t-282 187.5t-381.5 69.5zM1792 640q0 -174 -120 -321.5t-326 -233t-450 -85.5q-70 0 -145 8q-198 -175 -460 -242q-49 -14 -114 -22h-5q-15 0 -27 10.5t-16 27.5v1q-3 4 -0.5 12t2 10t4.5 9.5l6 9t7 8.5t8 9q7 8 31 34.5t34.5 38t31 39.5t32.5 51 t27 59t26 76q-157 89 -247.5 220t-90.5 281q0 130 71 248.5t191 204.5t286 136.5t348 50.5t348 -50.5t286 -136.5t191 -204.5t71 -248.5z"),
                  (n = "scale(.195, -.195) translate(600, -2000)");
                break;
              case "ellipsis-v":
                (i =
                  "M384 288v-192q0 -40 -28 -68t-68 -28h-192q-40 0 -68 28t-28 68v192q0 40 28 68t68 28h192q40 0 68 -28t28 -68zM384 800v-192q0 -40 -28 -68t-68 -28h-192q-40 0 -68 28t-28 68v192q0 40 28 68t68 28h192q40 0 68 -28t28 -68zM384 1312v-192q0 -40 -28 -68t-68 -28h-192 q-40 0 -68 28t-28 68v192q0 40 28 68t68 28h192q40 0 68 -28t28 -68z"),
                  (n = "scale(.20, -.20) translate(1300, -2100)");
                break;
              case "envelope":
                (i =
                  "M1792 826v-794q0 -66 -47 -113t-113 -47h-1472q-66 0 -113 47t-47 113v794q44 -49 101 -87q362 -246 497 -345q57 -42 92.5 -65.5t94.5 -48t110 -24.5h1h1q51 0 110 24.5t94.5 48t92.5 65.5q170 123 498 345q57 39 100 87zM1792 1120q0 -79 -49 -151t-122 -123 q-376 -261 -468 -325q-10 -7 -42.5 -30.5t-54 -38t-52 -32.5t-57.5 -27t-50 -9h-1h-1q-23 0 -50 9t-57.5 27t-52 32.5t-54 38t-42.5 30.5q-91 64 -262 182.5t-205 142.5q-62 42 -117 115.5t-55 136.5q0 78 41.5 130t118.5 52h1472q65 0 112.5 -47t47.5 -113z"),
                  (n = "scale(.175, -.175) translate(800, -2250)");
                break;
              case "envelope-o":
                (i =
                  "M1664 32v768q-32 -36 -69 -66q-268 -206 -426 -338q-51 -43 -83 -67t-86.5 -48.5t-102.5 -24.5h-1h-1q-48 0 -102.5 24.5t-86.5 48.5t-83 67q-158 132 -426 338q-37 30 -69 66v-768q0 -13 9.5 -22.5t22.5 -9.5h1472q13 0 22.5 9.5t9.5 22.5zM1664 1083v11v13.5t-0.5 13 t-3 12.5t-5.5 9t-9 7.5t-14 2.5h-1472q-13 0 -22.5 -9.5t-9.5 -22.5q0 -168 147 -284q193 -152 401 -317q6 -5 35 -29.5t46 -37.5t44.5 -31.5t50.5 -27.5t43 -9h1h1q20 0 43 9t50.5 27.5t44.5 31.5t46 37.5t35 29.5q208 165 401 317q54 43 100.5 115.5t46.5 131.5z M1792 1120v-1088q0 -66 -47 -113t-113 -47h-1472q-66 0 -113 47t-47 113v1088q0 66 47 113t113 47h1472q66 0 113 -47t47 -113z"),
                  (n = "scale(.175, -.175) translate(800, -2250)");
                break;
              case "paper-plane":
                (i =
                  "M1764 1525q33 -24 27 -64l-256 -1536q-5 -29 -32 -45q-14 -8 -31 -8q-11 0 -24 5l-453 185l-242 -295q-18 -23 -49 -23q-13 0 -22 4q-19 7 -30.5 23.5t-11.5 36.5v349l864 1059l-1069 -925l-395 162q-37 14 -40 55q-2 40 32 59l1664 960q15 9 32 9q20 0 36 -11z"),
                  (n = "scale(.17, -.17) translate(750, -2450)");
                break;
              case "paper-plane-o":
                (i =
                  "M1764 1525q33 -24 27 -64l-256 -1536q-5 -29 -32 -45q-14 -8 -31 -8q-11 0 -24 5l-527 215l-298 -327q-18 -21 -47 -21q-14 0 -23 4q-19 7 -30 23.5t-11 36.5v452l-472 193q-37 14 -40 55q-3 39 32 59l1664 960q35 21 68 -2zM1422 26l221 1323l-1434 -827l336 -137 l863 639l-478 -797z"),
                  (n = "scale(.17, -.17) translate(750, -2450)");
                break;
              case "phone":
                (i =
                  "M1408 296q0 -27 -10 -70.5t-21 -68.5q-21 -50 -122 -106q-94 -51 -186 -51q-27 0 -52.5 3.5t-57.5 12.5t-47.5 14.5t-55.5 20.5t-49 18q-98 35 -175 83q-128 79 -264.5 215.5t-215.5 264.5q-48 77 -83 175q-3 9 -18 49t-20.5 55.5t-14.5 47.5t-12.5 57.5t-3.5 52.5 q0 92 51 186q56 101 106 122q25 11 68.5 21t70.5 10q14 0 21 -3q18 -6 53 -76q11 -19 30 -54t35 -63.5t31 -53.5q3 -4 17.5 -25t21.5 -35.5t7 -28.5q0 -20 -28.5 -50t-62 -55t-62 -53t-28.5 -46q0 -9 5 -22.5t8.5 -20.5t14 -24t11.5 -19q76 -137 174 -235t235 -174 q2 -1 19 -11.5t24 -14t20.5 -8.5t22.5 -5q18 0 46 28.5t53 62t55 62t50 28.5q14 0 28.5 -7t35.5 -21.5t25 -17.5q25 -15 53.5 -31t63.5 -35t54 -30q70 -35 76 -53q3 -7 3 -21z"),
                  (n = "scale(.195, -.195) translate(750, -2200)");
                break;
              case "user":
                (i =
                  "M1408 131q0 -120 -73 -189.5t-194 -69.5h-874q-121 0 -194 69.5t-73 189.5q0 53 3.5 103.5t14 109t26.5 108.5t43 97.5t62 81t85.5 53.5t111.5 20q9 0 42 -21.5t74.5 -48t108 -48t133.5 -21.5t133.5 21.5t108 48t74.5 48t42 21.5q61 0 111.5 -20t85.5 -53.5t62 -81 t43 -97.5t26.5 -108.5t14 -109t3.5 -103.5zM1088 1024q0 -159 -112.5 -271.5t-271.5 -112.5t-271.5 112.5t-112.5 271.5t112.5 271.5t271.5 112.5t271.5 -112.5t112.5 -271.5z"),
                  (n = "scale(.19, -.19) translate(850, -2150)");
                break;
              case "minimize_thin":
                (i = "M1779.3,853.3H12.7v85.4h1766.7V853.3z"),
                  (n = "scale(.215, -.215) translate(400, -2300)");
                break;
              case "close_thin":
                (i =
                  "M1778.3 76.8 1716.2 14.7 896.5 834.4 76.8 14.7 14.7 76.8 834.4 896.5 14.7 1716.2 76.8 1778.3 896.5 958.6 1716.2 1778.3 1778.3 1716.2 958.6 896.5z"),
                  (n = "scale(.215, -.215) translate(400, -2300)");
                break;
              case "icn-send-outline":
                (i =
                  "M2.5,8.6L58,31.7L2.5,54.8l0-15.4l34.4-5.6l13.4-2.2l-13.4-2.2L2.5,24L2.5,8.6 M0.3,5.3l0,20.6l36.3,5.9L0.2,37.6l0,20.6l63.5-26.5L0.3,5.3L0.3,5.3z"),
                  (n = "translate(0, 0)"),
                  (a = "0 0 60 60");
                break;
              case "icn-envelope":
                (i =
                  "M60.8,10.7H3.2c-1.8,0-3.2,1.3-3.2,3v36.6c0,1.6,1.4,3,3.2,3h57.6c1.8,0,3.2-1.3,3.2-3V13.7 C64,12.1,62.6,10.7,60.8,10.7z M58.5,13.7L37.4,34c-1.6,1.4-2.6,2-3.3,2.3c-1.3,0.4-2.7,0.4-4,0c-0.8-0.2-1.8-0.9-3.3-2.3L5.5,13.7 H58.5z M3.2,15.8l18.4,17.5L3.2,48.2V15.8z M5.7,50.3l18.2-14.7l0.6,0.5c1.7,1.6,3.1,2.5,4.3,3c3.9,1.5,8-0.3,10.7-3l0.6-0.5 l18.2,14.7H5.7z M60.8,48.3L42.4,33.4l18.4-17.6V48.3z"),
                  (n = "translate(0, 0)"),
                  (a = "0 0 60 60");
                break;
              case "icn-confirmation":
                (i =
                  "M25.9,41.9L15.4,31.3l-2.3,2.3l12.8,12.8l25.3-25.3l-2.3-2.2L25.9,41.9z M32,0C18.7,0,6.5,8.6,2,21 c-4.7,12.6-0.6,27.1,9.7,35.6C22,65.2,37,66.4,48.5,59.4C59.9,52.5,66,38.8,63.4,25.7C60.7,12.8,50,2.4,37,0.4C35.3,0.1,33.7,0,32,0 z M32,60.8c-12,0-22.9-7.7-27-18.9C0.8,30.6,4.4,17.5,13.7,9.8C23,2.1,36.6,1.1,46.9,7.4C57.2,13.6,62.6,26,60.2,37.8 c-2.4,11.6-12,20.9-23.8,22.7C35,60.7,33.5,60.8,32,60.8z"),
                  (n = "translate(0, 0)"),
                  (a = "0 0 64 64");
                break;
              case "icn-menu":
                (i =
                  "M18,28c5.5,0,10-4.5,10-10S23.5,8,18,8S8,12.5,8,18S12.5,28,18,28z M18,29c6.1,0,11-4.9,11-11S24.1,7,18,7 S7,11.9,7,18S11.9,29,18,29z M13.9,18c0,0.8-0.6,1.4-1.4,1.4s-1.4-0.6-1.4-1.4s0.6-1.4,1.4-1.4S13.9,17.2,13.9,18z M19.4,18c0,0.8-0.6,1.4-1.4,1.4s-1.4-0.6-1.4-1.4s0.6-1.4,1.4-1.4S19.4,17.2,19.4,18z M24.9,18c0,0.8-0.6,1.4-1.4,1.4s-1.4-0.6-1.4-1.4s0.6-1.4,1.4-1.4S24.9,17.2,24.9,18z"),
                  (n = "translate(0, 0)"),
                  (a = "6 6 24 24");
                break;
              default:
                (i = ""), (n = "");
            }
            return {
              iconColor: e,
              data: i,
              tran: n,
              viewBox: a,
            };
          },
          getIframeId: function () {
            return this.target && document.getElementById(this.target)
              ? "designstudio-iframe-" + this.target
              : "designstudio-iframe";
          },
          getLogoChatBoxURL: function (t, e, i) {
            return t.replace("{0}", e).replace("{1}", i);
          },
          toggleHeader: function (t) {
            switch (
              ((this.iframe = document.getElementById(
                this.getIframeId()
              ).contentWindow.document),
              this.clearHeaderSettings(),
              t)
            ) {
              case "prechat":
                this.options.header = this.options.prechatHeader;
                break;
              case "offline":
                this.options.header = this.options.offlineHeader;
                break;
              case "chat":
                this.options.header = this.options.chatHeader;
                break;
              case "none":
                this.clearHeaderSettings();
            }
            this.elementAddClass(
              this.iframe.getElementById("header"),
              t + "-header"
            ),
              this.elementAddClass(
                this.iframe.getElementById("header-text"),
                t + "-header-text"
              ),
              (this.iframe.getElementById(
                "header-text"
              ).innerHTML = this.options.header.text);
            var e = this.addSvgIcon(
              this.options.header.svgIcon,
              this.options.header.fontColor
            );
            this.iframe.getElementById("icon-custom").appendChild(e);
            var i = this.addSvgIcon(
              this.options.minimizeIcon,
              this.options.header.fontColor
            );
            this.iframe.getElementById("icon-minimize").appendChild(i);
            var n = this.addSvgIcon(
              this.options.closeIcon,
              this.options.header.fontColor
            );
            this.iframe.getElementById("icon-close").appendChild(n);
          },
          clearHeaderSettings: function () {
            (this.iframe = document.getElementById(
              this.getIframeId()
            ).contentWindow.document),
              (this.header = this.iframe.getElementById("header")),
              this.elementRemoveClass(this.header, "prechat-header"),
              this.elementRemoveClass(this.header, "chat-header"),
              this.elementRemoveClass(this.header, "offline-header"),
              this.elementRemoveClass(this.header, "none-header"),
              this.removeChildren(this.iframe.getElementById("icon-custom")),
              this.removeChildren(this.iframe.getElementById("icon-minimize")),
              this.removeChildren(this.iframe.getElementById("icon-close"));
          },
          toggleFooterButtons: function (t) {
            switch (
              ((this.iframe = document.getElementById(
                this.getIframeId()
              ).contentWindow.document),
              this.clearFooterButtonSettings(),
              t)
            ) {
              case "offline":
                this.iframe
                  .getElementById("buttons-offline-div")
                  .setAttribute("style", "display:inline;");
                var e = this.iframe.createElement("input");
                (e.className = "button"),
                  (e.id = t + "-send-email"),
                  e.setAttribute("type", "button"),
                  (e.value = this.options.offlineSendEmailButton.text),
                  this.iframe
                    .getElementById("button-send-email")
                    .appendChild(e),
                  this.expandFooter(!0);
                break;
              case "prechat":
                this.iframe
                  .getElementById("buttons-prechat-div")
                  .setAttribute("style", "display:inline;");
                var i = this.iframe.createElement("input");
                (i.className = "button"),
                  (i.id = "prechat-start-chat"),
                  i.setAttribute("type", "button"),
                  (i.value = this.options.prechatChatButton.text),
                  this.iframe
                    .getElementById("button-start-chat")
                    .appendChild(i),
                  this.expandFooter(!0);
                break;
              case "chat":
                this.iframe
                  .getElementById("buttons-chat-div")
                  .setAttribute("style", "display:inline;");
                var n = this.iframe.createElement("input");
                (n.className = "button btn-primary"),
                  (n.id = t + "-cancel-callme"),
                  n.setAttribute("type", "button"),
                  this.iframe
                    .getElementById("button-cancel-callme")
                    .appendChild(n);
                var a = this.iframe.createElement("input");
                (a.className = "button btn-secondary"),
                  (a.id = "warning-cancel-end"),
                  a.setAttribute("type", "button"),
                  this.iframe
                    .getElementById("button-cancel-end-chat")
                    .appendChild(a);
                var s = this.iframe.createElement("input");
                (s.className = "button btn-primary"),
                  (s.id = "warning-end-chat"),
                  s.setAttribute("type", "button"),
                  this.iframe.getElementById("button-end-chat").appendChild(s);
                var r = this.iframe.createElement("input");
                (r.className = "button btn-primary"),
                  (r.id = t + "-close"),
                  r.setAttribute("type", "button"),
                  this.iframe
                    .getElementById("button-close-chat")
                    .appendChild(r);
                var o = this.iframe.createElement("input");
                (o.className = "button btn-secondary"),
                  (o.id = t + "-cancel-file-upload"),
                  o.setAttribute("type", "button"),
                  this.iframe
                    .getElementById("button-cancel-file-upload")
                    .appendChild(o);
                var l = this.iframe.createElement("input");
                (l.className = "button btn-primary"),
                  (l.id = t + "-file-upload"),
                  l.setAttribute("type", "button"),
                  this.iframe
                    .getElementById("button-file-upload")
                    .appendChild(l);
                var c = this.iframe.createElement("input");
                (c.className = "button btn-secondary"),
                  (c.id = t + "-cobrowse-decline"),
                  c.setAttribute("type", "button"),
                  this.iframe
                    .getElementById("button-cobrowse-decline")
                    .appendChild(c);
                var d = this.iframe.createElement("input");
                (d.className = "button btn-primary"),
                  (d.id = t + "-cobrowse-accept"),
                  d.setAttribute("type", "button"),
                  this.iframe
                    .getElementById("button-cobrowse-accept")
                    .appendChild(d);
                break;
              case "none":
                this.clearFooterButtonSettings();
            }
          },
          expandFooter: function (t) {
            this.iframe = document.getElementById(
              this.getIframeId()
            ).contentWindow.document;
            var e = this.iframe.getElementById(
              "footer-" + (this.isMobileDevice() ? "mobile" : "desktop")
            );
            e && (e.className = "footer-" + (t ? "expand" : "collapse"));
          },
          clearFooterButtonSettings: function () {
            this.iframe
              .getElementById("buttons-prechat-div")
              .setAttribute("style", "display:none;"),
              this.iframe
                .getElementById("buttons-offline-div")
                .setAttribute("style", "display:none;"),
              this.iframe
                .getElementById("buttons-chat-div")
                .setAttribute("style", "display:none;"),
              this.removeChildren(this.iframe.getElementById("button-call-me")),
              this.removeChildren(
                this.iframe.getElementById("button-send-email")
              ),
              this.removeChildren(
                this.iframe.getElementById("button-start-chat")
              ),
              this.removeChildren(
                this.iframe.getElementById("button-close-chat")
              ),
              this.removeChildren(
                this.iframe.getElementById("button-file-upload")
              ),
              this.removeChildren(
                this.iframe.getElementById("button-cancel-file-upload")
              ),
              this.removeChildren(
                this.iframe.getElementById("button-cancel-callme")
              ),
              this.removeChildren(
                this.iframe.getElementById("button-cancel-end-chat")
              ),
              this.removeChildren(
                this.iframe.getElementById("button-end-chat")
              );
          },
          disableViewButton: function (t) {
            this.iframe = document.getElementById(
              this.getIframeId()
            ).contentWindow.document;
            var e = this.iframe.getElementById(
              "prechat" === t ? t + "-start-chat" : t + "-send-email"
            );
            e.setAttribute("disabled", !0), this.elementAddClass(e, "disabled");
          },
          enableViewButton: function (t) {
            t.removeAttribute("disabled"),
              this.elementRemoveClass(t, "disabled");
          },
          splitMessageAndLink: function (t) {
            var e,
              i,
              n = t;
            return (
              (null !== t ? t.match("\\[.*?\\]|\\[\\[.*?\\]\\]") : null) &&
                ((n = t.substring(0, t.indexOf("["))),
                (e = t.substring(t.lastIndexOf("]") + 1)),
                (i = t.substring(t.lastIndexOf("[") + 1, t.indexOf("]")))),
              {
                linkStr: i,
                message1: n,
                message2: e,
              }
            );
          },
          checkFontForImport: function () {
            if (this.parseBaseFontOption(this.options.baseFont).import)
              return !0;
          },
          parseBaseFontOption: function (t) {
            var e = t.split("|");
            return {
              name: e[0].match(/'([^']*?)'/)[1],
              family: e[0],
              weight: e[1],
              import: "import" === e[3] && "import",
            };
          },
          getOuterHeight: function (e) {
            e = "string" == typeof e ? document.querySelector(e) : e;
            var i = t.getComputedStyle(e),
              n = parseFloat(i.marginTop) + parseFloat(i.marginBottom);
            return Math.ceil(e.offsetHeight + n);
          },
          getOuterWidth: function (e) {
            e = "string" == typeof e ? document.querySelector(e) : e;
            var i = t.getComputedStyle(e),
              n = parseFloat(i.marginLeft) + parseFloat(i.marginRight);
            return Math.ceil(e.offsetWidth + n);
          },
          isInsideGWT: function () {
            return this.target && document.getElementById(this.target);
          },
          setIsMobile: function (t) {
            this.isInsideGWT() && (this.isMobile = t);
          },
          getVisible: function (t) {
            return t.isVisible;
          },
          _deactivateHTML: function (t) {
            return t
              .replace(/>/g, "&gt;")
              .replace(/</g, "&lt;")
              .replace(/"/g, "&quot;")
              .replace(/'/g, "&#x27;");
          },
          secondsToMinutes: function (t) {
            return Math.floor(t / 60) + ":" + Math.floor(t % 60).slice(-2);
          },
          setStyle: function (t, e) {
            for (var i in e) t.style[i] = e[i];
          },
        }),
          (t.chat_custom_design = t.chat_custom_design || {}),
          (t.chat_custom_design.Helpers = e);
      })(window);
      !(function (t) {
        function n() {
          this.CALLBACKS = {
            SWITCH_WIDGET: {
              name: "switchwidget",
              fctn: null,
            },
            MINIMIZE: {
              name: "minimize",
              fctn: null,
            },
          };
        }
        (n.prototype = {
          setCallback: function (t, n) {
            switch (t.toLowerCase()) {
              case this.CALLBACKS.MINIMIZE.name:
                this.CALLBACKS.MINIMIZE.fctn = n;
                break;
              case this.CALLBACKS.SWITCH_WIDGET.name:
                this.CALLBACKS.SWITCH_WIDGET.fctn = n;
            }
          },
          callCallback: function () {
            switch (arguments[0].toLowerCase()) {
              case this.CALLBACKS.MINIMIZE.name:
                "function" == typeof arguments[4] && arguments[4](),
                  this.CALLBACKS.MINIMIZE.fctn(
                    arguments[1],
                    arguments[2],
                    arguments[3]
                  );
                break;
              case this.CALLBACKS.SWITCH_WIDGET.name:
                this.CALLBACKS.SWITCH_WIDGET.fctn(arguments[1]);
            }
          },
          getCallback: function (t) {
            return this.CALLBACKS[t].fctn;
          },
        }),
          (t.chat_custom_design = t.chat_custom_design || {}),
          (t.chat_custom_design.CallbackStore = n);
      })(window);
      !(function () {
        function t(t, n, i) {
          return t.call.apply(t.bind, arguments);
        }
        function n(t, n, i) {
          if (!t) throw Error();
          if (2 < arguments.length) {
            var e = Array.prototype.slice.call(arguments, 2);
            return function () {
              var i = Array.prototype.slice.call(arguments);
              return Array.prototype.unshift.apply(i, e), t.apply(n, i);
            };
          }
          return function () {
            return t.apply(n, arguments);
          };
        }
        function i(e, o, a) {
          return (i =
            Function.prototype.bind &&
            -1 != Function.prototype.bind.toString().indexOf("native code")
              ? t
              : n).apply(null, arguments);
        }
        var e =
          Date.now ||
          function () {
            return +new Date();
          };
        function o(t, n) {
          (this.a = t), (this.o = n || t), (this.c = this.o.document);
        }
        var a = !!window.FontFace;
        function s(t, n, i, e) {
          if (((n = t.c.createElement(n)), i))
            for (var o in i)
              i.hasOwnProperty(o) &&
                ("style" == o
                  ? (n.style.cssText = i[o])
                  : n.setAttribute(o, i[o]));
          return e && n.appendChild(t.c.createTextNode(e)), n;
        }
        function r(t, n, i) {
          (t = t.c.getElementsByTagName(n)[0]) ||
            (t = document.documentElement),
            t.insertBefore(i, t.lastChild);
        }
        function c(t) {
          t.parentNode && t.parentNode.removeChild(t);
        }
        function f(t, n, i) {
          (n = n || []), (i = i || []);
          for (var e = t.className.split(/\s+/), o = 0; o < n.length; o += 1) {
            for (var a = !1, s = 0; s < e.length; s += 1)
              if (n[o] === e[s]) {
                a = !0;
                break;
              }
            a || e.push(n[o]);
          }
          for (n = [], o = 0; o < e.length; o += 1) {
            for (a = !1, s = 0; s < i.length; s += 1)
              if (e[o] === i[s]) {
                a = !0;
                break;
              }
            a || n.push(e[o]);
          }
          t.className = n
            .join(" ")
            .replace(/\s+/g, " ")
            .replace(/^\s+|\s+$/, "");
        }
        function h(t, n) {
          for (
            var i = t.className.split(/\s+/), e = 0, o = i.length;
            e < o;
            e++
          )
            if (i[e] == n) return !0;
          return !1;
        }
        function l(t, n, i) {
          function e() {
            h && o && c && (h(f), (h = null));
          }
          n = s(t, "link", {
            rel: "stylesheet",
            href: n,
            media: "all",
          });
          var o = !1,
            c = !0,
            f = null,
            h = i || null;
          a
            ? ((n.onload = function () {
                (o = !0), e();
              }),
              (n.onerror = function () {
                (o = !0), (f = Error("Stylesheet failed to load")), e();
              }))
            : setTimeout(function () {
                (o = !0), e();
              }, 0),
            r(t, "head", n);
        }
        function u(t, n, i, e) {
          var o = t.c.getElementsByTagName("head")[0];
          if (o) {
            var a = s(t, "script", {
                src: n,
              }),
              r = !1;
            return (
              (a.onload = a.onreadystatechange = function () {
                r ||
                  (this.readyState &&
                    "loaded" != this.readyState &&
                    "complete" != this.readyState) ||
                  ((r = !0),
                  i && i(null),
                  (a.onload = a.onreadystatechange = null),
                  "HEAD" == a.parentNode.tagName && o.removeChild(a));
              }),
              o.appendChild(a),
              setTimeout(function () {
                r || ((r = !0), i && i(Error("Script load timeout")));
              }, e || 5e3),
              a
            );
          }
          return null;
        }
        function p() {
          (this.a = 0), (this.c = null);
        }
        function g(t) {
          return (
            t.a++,
            function () {
              t.a--, v(t);
            }
          );
        }
        function d(t, n) {
          (t.c = n), v(t);
        }
        function v(t) {
          0 == t.a && t.c && (t.c(), (t.c = null));
        }
        function w(t) {
          this.a = t || "-";
        }
        function m(t, n) {
          (this.c = t), (this.f = 4), (this.a = "n");
          var i = (n || "n4").match(/^([nio])([1-9])$/i);
          i && ((this.a = i[1]), (this.f = parseInt(i[2], 10)));
        }
        function y(t) {
          var n = [];
          t = t.split(/,\s*/);
          for (var i = 0; i < t.length; i++) {
            var e = t[i].replace(/['"]/g, "");
            -1 != e.indexOf(" ") || /^\d/.test(e)
              ? n.push("'" + e + "'")
              : n.push(e);
          }
          return n.join(",");
        }
        function b(t) {
          return t.a + t.f;
        }
        function _(t) {
          var n = "normal";
          return (
            "o" === t.a ? (n = "oblique") : "i" === t.a && (n = "italic"), n
          );
        }
        function j(t) {
          var n = 4,
            i = "n",
            e = null;
          return (
            t &&
              ((e = t.match(/(normal|oblique|italic)/i)) &&
                e[1] &&
                (i = e[1].substr(0, 1).toLowerCase()),
              (e = t.match(/([1-9]00|normal|bold)/i)) &&
                e[1] &&
                (/bold/i.test(e[1])
                  ? (n = 7)
                  : /[1-9]00/.test(e[1]) &&
                    (n = parseInt(e[1].substr(0, 1), 10)))),
            i + n
          );
        }
        function x(t, n) {
          (this.c = t),
            (this.f = t.o.document.documentElement),
            (this.h = n),
            (this.a = new w("-")),
            (this.j = !1 !== n.events),
            (this.g = !1 !== n.classes);
        }
        function k(t) {
          if (t.g) {
            var n = h(t.f, t.a.c("wf", "active")),
              i = [],
              e = [t.a.c("wf", "loading")];
            n || i.push(t.a.c("wf", "inactive")), f(t.f, i, e);
          }
          S(t, "inactive");
        }
        function S(t, n, i) {
          t.j && t.h[n] && (i ? t.h[n](i.c, b(i)) : t.h[n]());
        }
        function T() {
          this.c = {};
        }
        function C(t, n) {
          (this.c = t),
            (this.f = n),
            (this.a = s(
              this.c,
              "span",
              {
                "aria-hidden": "true",
              },
              this.f
            ));
        }
        function A(t) {
          r(t.c, "body", t.a);
        }
        function N(t) {
          return (
            "display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:" +
            y(t.c) +
            ";font-style:" +
            _(t) +
            ";font-weight:" +
            t.f +
            "00;"
          );
        }
        function E(t, n, i, e, o, a) {
          (this.g = t),
            (this.j = n),
            (this.a = e),
            (this.c = i),
            (this.f = o || 3e3),
            (this.h = a || void 0);
        }
        function W(t, n, i, e, o, a, s) {
          (this.v = t),
            (this.B = n),
            (this.c = i),
            (this.a = e),
            (this.s = s || "BESbswy"),
            (this.f = {}),
            (this.w = o || 3e3),
            (this.u = a || null),
            (this.m = this.j = this.h = this.g = null),
            (this.g = new C(this.c, this.s)),
            (this.h = new C(this.c, this.s)),
            (this.j = new C(this.c, this.s)),
            (this.m = new C(this.c, this.s)),
            (t = N((t = new m(this.a.c + ",serif", b(this.a))))),
            (this.g.a.style.cssText = t),
            (t = N((t = new m(this.a.c + ",sans-serif", b(this.a))))),
            (this.h.a.style.cssText = t),
            (t = N((t = new m("serif", b(this.a))))),
            (this.j.a.style.cssText = t),
            (t = N((t = new m("sans-serif", b(this.a))))),
            (this.m.a.style.cssText = t),
            A(this.g),
            A(this.h),
            A(this.j),
            A(this.m);
        }
        (w.prototype.c = function (t) {
          for (var n = [], i = 0; i < arguments.length; i++)
            n.push(arguments[i].replace(/[\W_]+/g, "").toLowerCase());
          return n.join(this.a);
        }),
          (E.prototype.start = function () {
            var t = this.c.o.document,
              n = this,
              i = e(),
              o = new Promise(function (o, a) {
                !(function s() {
                  e() - i >= n.f
                    ? a()
                    : t.fonts
                        .load(
                          (function (t) {
                            return _(t) + " " + t.f + "00 300px " + y(t.c);
                          })(n.a),
                          n.h
                        )
                        .then(
                          function (t) {
                            1 <= t.length ? o() : setTimeout(s, 25);
                          },
                          function () {
                            a();
                          }
                        );
                })();
              }),
              a = null,
              s = new Promise(function (t, i) {
                a = setTimeout(i, n.f);
              });
            Promise.race([s, o]).then(
              function () {
                a && (clearTimeout(a), (a = null)), n.g(n.a);
              },
              function () {
                n.j(n.a);
              }
            );
          });
        var F = {
            D: "serif",
            C: "sans-serif",
          },
          I = null;
        function O() {
          if (null === I) {
            var t = /AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(
              window.navigator.userAgent
            );
            I =
              !!t &&
              (536 > parseInt(t[1], 10) ||
                (536 === parseInt(t[1], 10) && 11 >= parseInt(t[2], 10)));
          }
          return I;
        }
        function P(t, n, i) {
          for (var e in F)
            if (F.hasOwnProperty(e) && n === t.f[F[e]] && i === t.f[F[e]])
              return !0;
          return !1;
        }
        function B(t) {
          var n,
            o = t.g.a.offsetWidth,
            a = t.h.a.offsetWidth;
          (n = o === t.f.serif && a === t.f["sans-serif"]) ||
            (n = O() && P(t, o, a)),
            n
              ? e() - t.A >= t.w
                ? O() &&
                  P(t, o, a) &&
                  (null === t.u || t.u.hasOwnProperty(t.a.c))
                  ? D(t, t.v)
                  : D(t, t.B)
                : (function (t) {
                    setTimeout(
                      i(function () {
                        B(this);
                      }, t),
                      50
                    );
                  })(t)
              : D(t, t.v);
        }
        function D(t, n) {
          setTimeout(
            i(function () {
              c(this.g.a), c(this.h.a), c(this.j.a), c(this.m.a), n(this.a);
            }, t),
            0
          );
        }
        function L(t, n, i) {
          (this.c = t),
            (this.a = n),
            (this.f = 0),
            (this.m = this.j = !1),
            (this.s = i);
        }
        W.prototype.start = function () {
          (this.f.serif = this.j.a.offsetWidth),
            (this.f["sans-serif"] = this.m.a.offsetWidth),
            (this.A = e()),
            B(this);
        };
        var $ = null;
        function q(t) {
          0 == --t.f &&
            t.j &&
            (t.m
              ? ((t = t.a).g &&
                  f(
                    t.f,
                    [t.a.c("wf", "active")],
                    [t.a.c("wf", "loading"), t.a.c("wf", "inactive")]
                  ),
                S(t, "active"))
              : k(t.a));
        }
        function H(t) {
          (this.j = t),
            (this.a = new T()),
            (this.h = 0),
            (this.f = this.g = !0);
        }
        function M(t, n, e, o, a) {
          var s = 0 == --t.h;
          (t.f || t.g) &&
            setTimeout(function () {
              var t = a || null,
                r = o || {};
              if (0 === e.length && s) k(n.a);
              else {
                (n.f += e.length), s && (n.j = s);
                var c,
                  h = [];
                for (c = 0; c < e.length; c++) {
                  var l = e[c],
                    u = r[l.c],
                    p = n.a,
                    g = l;
                  if (
                    (p.g &&
                      f(p.f, [p.a.c("wf", g.c, b(g).toString(), "loading")]),
                    S(p, "fontloading", g),
                    (p = null),
                    null === $)
                  )
                    if (window.FontFace) {
                      g = /Gecko.*Firefox\/(\d+)/.exec(
                        window.navigator.userAgent
                      );
                      var d =
                        /OS X.*Version\/10\..*Safari/.exec(
                          window.navigator.userAgent
                        ) && /Apple/.exec(window.navigator.vendor);
                      $ = g ? 42 < parseInt(g[1], 10) : !d;
                    } else $ = !1;
                  (p = $
                    ? new E(i(n.g, n), i(n.h, n), n.c, l, n.s, u)
                    : new W(i(n.g, n), i(n.h, n), n.c, l, n.s, t, u)),
                    h.push(p);
                }
                for (c = 0; c < h.length; c++) h[c].start();
              }
            }, 0);
        }
        function z(t, n) {
          (this.c = t), (this.a = n);
        }
        function G(t, n) {
          (this.c = t), (this.a = n);
        }
        function K(t, n) {
          (this.c = t || R), (this.a = []), (this.f = []), (this.g = n || "");
        }
        (L.prototype.g = function (t) {
          var n = this.a;
          n.g &&
            f(
              n.f,
              [n.a.c("wf", t.c, b(t).toString(), "active")],
              [
                n.a.c("wf", t.c, b(t).toString(), "loading"),
                n.a.c("wf", t.c, b(t).toString(), "inactive"),
              ]
            ),
            S(n, "fontactive", t),
            (this.m = !0),
            q(this);
        }),
          (L.prototype.h = function (t) {
            var n = this.a;
            if (n.g) {
              var i = h(n.f, n.a.c("wf", t.c, b(t).toString(), "active")),
                e = [],
                o = [n.a.c("wf", t.c, b(t).toString(), "loading")];
              i || e.push(n.a.c("wf", t.c, b(t).toString(), "inactive")),
                f(n.f, e, o);
            }
            S(n, "fontinactive", t), q(this);
          }),
          (H.prototype.load = function (t) {
            (this.c = new o(this.j, t.context || this.j)),
              (this.g = !1 !== t.events),
              (this.f = !1 !== t.classes),
              (function (t, n, i) {
                var e = [],
                  o = i.timeout;
                !(function (t) {
                  t.g && f(t.f, [t.a.c("wf", "loading")]), S(t, "loading");
                })(n);
                var e = (function (t, n, i) {
                    var e,
                      o = [];
                    for (e in n)
                      if (n.hasOwnProperty(e)) {
                        var a = t.c[e];
                        a && o.push(a(n[e], i));
                      }
                    return o;
                  })(t.a, i, t.c),
                  a = new L(t.c, n, o);
                for (t.h = e.length, n = 0, i = e.length; n < i; n++)
                  e[n].load(function (n, i, e) {
                    M(t, a, n, i, e);
                  });
              })(this, new x(this.c, t), t);
          }),
          (z.prototype.load = function (t) {
            var n = this,
              i = n.a.projectId,
              e = n.a.version;
            if (i) {
              var o = n.c.o;
              u(
                this.c,
                (n.a.api || "https://fast.fonts.net/jsapi") +
                  "/" +
                  i +
                  ".js" +
                  (e ? "?v=" + e : ""),
                function (e) {
                  e
                    ? t([])
                    : ((o["__MonotypeConfiguration__" + i] = function () {
                        return n.a;
                      }),
                      (function n() {
                        if (o["__mti_fntLst" + i]) {
                          var e,
                            a = o["__mti_fntLst" + i](),
                            s = [];
                          if (a)
                            for (var r = 0; r < a.length; r++) {
                              var c = a[r].fontfamily;
                              null != a[r].fontStyle && null != a[r].fontWeight
                                ? ((e = a[r].fontStyle + a[r].fontWeight),
                                  s.push(new m(c, e)))
                                : s.push(new m(c));
                            }
                          t(s);
                        } else
                          setTimeout(function () {
                            n();
                          }, 50);
                      })());
                }
              ).id = "__MonotypeAPIScript__" + i;
            } else t([]);
          }),
          (G.prototype.load = function (t) {
            var n,
              i,
              e = this.a.urls || [],
              o = this.a.families || [],
              a = this.a.testStrings || {},
              s = new p();
            for (n = 0, i = e.length; n < i; n++) l(this.c, e[n], g(s));
            var r = [];
            for (n = 0, i = o.length; n < i; n++)
              if ((e = o[n].split(":"))[1])
                for (var c = e[1].split(","), f = 0; f < c.length; f += 1)
                  r.push(new m(e[0], c[f]));
              else r.push(new m(e[0]));
            d(s, function () {
              t(r, a);
            });
          });
        var R = "https://fonts.googleapis.com/css";
        function U(t) {
          (this.f = t), (this.a = []), (this.c = {});
        }
        var V = {
            latin: "BESbswy",
            "latin-ext": "\xE7\xF6\xFC\u011F\u015F",
            cyrillic: "\u0439\u044F\u0416",
            greek: "\u03B1\u03B2\u03A3",
            khmer: "\u1780\u1781\u1782",
            Hanuman: "\u1780\u1781\u1782",
          },
          X = {
            thin: "1",
            extralight: "2",
            "extra-light": "2",
            ultralight: "2",
            "ultra-light": "2",
            light: "3",
            regular: "4",
            book: "4",
            medium: "5",
            "semi-bold": "6",
            semibold: "6",
            "demi-bold": "6",
            demibold: "6",
            bold: "7",
            "extra-bold": "8",
            extrabold: "8",
            "ultra-bold": "8",
            ultrabold: "8",
            black: "9",
            heavy: "9",
            l: "3",
            r: "4",
            b: "7",
          },
          J = {
            i: "i",
            italic: "i",
            n: "n",
            normal: "n",
          },
          Q = /^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;
        function Y(t, n) {
          (this.c = t), (this.a = n);
        }
        var Z = {
          Arimo: !0,
          Cousine: !0,
          Tinos: !0,
        };
        function tt(t, n) {
          (this.c = t), (this.a = n);
        }
        function nt(t, n) {
          (this.c = t), (this.f = n), (this.a = []);
        }
        (Y.prototype.load = function (t) {
          var n = new p(),
            i = this.c,
            e = new K(this.a.api, this.a.text),
            o = this.a.families;
          !(function (t, n) {
            for (var i = n.length, e = 0; e < i; e++) {
              var o = n[e].split(":");
              3 == o.length && t.f.push(o.pop());
              var a = "";
              2 == o.length && "" != o[1] && (a = ":"), t.a.push(o.join(a));
            }
          })(e, o);
          var a = new U(o);
          !(function (t) {
            for (var n = t.f.length, i = 0; i < n; i++) {
              var e = t.f[i].split(":"),
                o = e[0].replace(/\+/g, " "),
                a = ["n4"];
              if (2 <= e.length) {
                var s;
                if (((s = []), (r = e[1])))
                  for (
                    var r, c = (r = r.split(",")).length, f = 0;
                    f < c;
                    f++
                  ) {
                    var h;
                    if ((h = r[f]).match(/^[\w-]+$/)) {
                      if (null == (u = Q.exec(h.toLowerCase()))) h = "";
                      else {
                        if (
                          ((h = null == (h = u[2]) || "" == h ? "n" : J[h]),
                          null == (u = u[1]) || "" == u)
                        )
                          u = "4";
                        else
                          var l = X[u],
                            u = l || (isNaN(u) ? "4" : u.substr(0, 1));
                        h = [h, u].join("");
                      }
                    } else h = "";
                    h && s.push(h);
                  }
                0 < s.length && (a = s),
                  3 == e.length &&
                    ((s = []),
                    0 < (e = (e = e[2]) ? e.split(",") : s).length &&
                      (e = V[e[0]]) &&
                      (t.c[o] = e));
              }
              for (
                t.c[o] || ((e = V[o]) && (t.c[o] = e)), e = 0;
                e < a.length;
                e += 1
              )
                t.a.push(new m(o, a[e]));
            }
          })(a),
            l(
              i,
              (function (t) {
                if (0 == t.a.length) throw Error("No fonts to load!");
                if (-1 != t.c.indexOf("kit=")) return t.c;
                for (var n = t.a.length, i = [], e = 0; e < n; e++)
                  i.push(t.a[e].replace(/ /g, "+"));
                return (
                  (n = t.c + "?family=" + i.join("%7C")),
                  0 < t.f.length && (n += "&subset=" + t.f.join(",")),
                  0 < t.g.length && (n += "&text=" + encodeURIComponent(t.g)),
                  n
                );
              })(e),
              g(n)
            ),
            d(n, function () {
              t(a.a, a.c, Z);
            });
        }),
          (tt.prototype.load = function (t) {
            var n = this.a.id,
              i = this.c.o;
            n
              ? u(
                  this.c,
                  (this.a.api || "https://use.typekit.net") + "/" + n + ".js",
                  function (n) {
                    if (n) t([]);
                    else if (
                      i.Typekit &&
                      i.Typekit.config &&
                      i.Typekit.config.fn
                    ) {
                      n = i.Typekit.config.fn;
                      for (var e = [], o = 0; o < n.length; o += 2)
                        for (
                          var a = n[o], s = n[o + 1], r = 0;
                          r < s.length;
                          r++
                        )
                          e.push(new m(a, s[r]));
                      try {
                        i.Typekit.load({
                          events: !1,
                          classes: !1,
                          async: !0,
                        });
                      } catch (c) {}
                      t(e);
                    }
                  },
                  2e3
                )
              : t([]);
          }),
          (nt.prototype.load = function (t) {
            var n = this.f.id,
              i = this.c.o,
              e = this;
            n
              ? (i.__webfontfontdeckmodule__ ||
                  (i.__webfontfontdeckmodule__ = {}),
                (i.__webfontfontdeckmodule__[n] = function (n, i) {
                  for (var o = 0, a = i.fonts.length; o < a; ++o) {
                    var s = i.fonts[o];
                    e.a.push(
                      new m(
                        s.name,
                        j("font-weight:" + s.weight + ";font-style:" + s.style)
                      )
                    );
                  }
                  t(e.a);
                }),
                u(
                  this.c,
                  (this.f.api || "https://f.fontdeck.com/s/css/js/") +
                    (function (t) {
                      return t.o.location.hostname || t.a.location.hostname;
                    })(this.c) +
                    "/" +
                    n +
                    ".js",
                  function (n) {
                    n && t([]);
                  }
                ))
              : t([]);
          });
        var it = new H(window);
        (it.a.c.custom = function (t, n) {
          return new G(n, t);
        }),
          (it.a.c.fontdeck = function (t, n) {
            return new nt(n, t);
          }),
          (it.a.c.monotype = function (t, n) {
            return new z(n, t);
          }),
          (it.a.c.typekit = function (t, n) {
            return new tt(n, t);
          }),
          (it.a.c.google = function (t, n) {
            return new Y(n, t);
          });
        var et = {
          load: i(it.load, it),
        };
        (window.DS_WebFont = et),
          window.DS_WebFontConfig && it.load(window.DS_WebFontConfig);
      })();
      !(function (e) {
        function t(e) {
          this.options = e;
        }
        (t.prototype = {
          hasSessionStorage: function () {
            try {
              return (
                e.sessionStorage.setItem("test", "1"),
                e.sessionStorage.removeItem("test"),
                !0
              );
            } catch (t) {
              return !1;
            }
          },
          injectFontLoader: function (o) {
            var n = e.chat_custom_design;
            n.helpers =
              n.helpers || new e.chat_custom_design.Helpers(o.options);
            var s = n.helpers.parseBaseFontOption(o.options.baseFont),
              i = "300" === s.weight ? "400" : "600";
            DS_WebFont.load({
              google: {
                families: [s.name + ":" + s.weight + "," + i],
              },
              context: frames[o.context],
              active: function () {
                t.prototype.hasSessionStorage() && (sessionStorage.fonts = !0);
              },
              fontinactive: function (e) {
                (sessionStorage.fonts = !1),
                  o.context.indexOf("button") >= 0 &&
                    n.helpers.getVisible(o.view) &&
                    o.view.setPlacement();
              },
              fontactive: function (e) {
                o.context.indexOf("button") >= 0 &&
                  n.helpers.getVisible(o.view) &&
                  o.view.setPlacement();
              },
            });
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.FontConfig = t);
      })(window);
      var Aa = 13,
        na = 32;
      window.ListView = function () {
        (this.direction = {
          TOP: "top",
          BOTTOM: "bottom",
        }),
          (this.createWrapper = function (e) {
            var t = document.createElement("ul");
            return (
              (t.className = "menu-list box-shadow " + e.direction),
              (t.id = e.id),
              t
            );
          }),
          (this.createItem = function (e, t) {
            var n = document.createElement("li");
            return (
              (n.innerText = e.text),
              (n.id = e.name),
              n.setAttribute("tabindex", "0"),
              (n.onclick = e.registerEvent),
              (n.onkeydown = function (t) {
                (t.keyCode !== Aa && t.keyCode !== na) || e.registerEvent(t);
              }),
              n
            );
          });
      };
      (window.Card = function (e) {
        if (!(this instanceof Card)) return new Card(e);
        try {
          if (-1 === Object.keys(e).indexOf("id"))
            throw new Error("id is required");
        } catch (s) {
          return void console.warn(
            "please include featureObjParams when creating instance"
          );
        }
        (this.classes = e.classes),
          (this.id = e.id),
          (this.createUI = function () {
            var e = document.createElement("div");
            return (
              (e.className = "card " + (this.classes ? this.classes : "")),
              (e.id = this.id),
              e
            );
          });
      }),
        (window.chat_custom_design.Card = Card);
      var ya = window.chat_custom_design.Card,
        ca = function (e) {
          if (!(this instanceof ca)) return new ca(e);
          try {
            Object.keys(e).length;
          } catch (t) {
            return void console.warn(
              "please include featureObjParams when creating instance"
            );
          }
          (this.helpers = e.helpers),
            (this.removeEmailTranscriptCallback =
              e.removeEmailTranscriptCallback),
            (this.iframe = document.getElementById(
              this.helpers.getIframeId()
            ).contentWindow.document),
            (this.state = {
              emailTranscriptUiVisible: !1,
              emailTranscriptAddress: null,
              isSubmittingEmail: !1,
              isSubmitted: !1,
            }),
            (this.setState = function (e, t) {
              this.state[e] = t;
            }),
            (this.getState = function (e) {
              return this.state[e];
            }),
            (this.createUI = function () {
              var e = new ya({
                  id: "wrapper-email-request",
                  classes: "hidden",
                }).createUI(),
                t = document.createElement("div");
              (t.id = "content-card-email"), e.appendChild(t);
              var i = document.createElement("div");
              (i.id = "text-email-request"),
                (i.className = "card-item"),
                (i.innerHTML = SnapEngage.getMessage(67)),
                t.appendChild(i);
              var a = document.createElement("div");
              (a.id = "inputarea-email-request"), (a.className = "card-item");
              var n = document.createElement("input");
              (n.value = this.getState("emailTranscriptAddress")),
                (n.placeholder = "email@example.com"),
                (n.type = "email"),
                (n.id = "input-email-request"),
                (n.required = !0);
              var s = document.createElement("div");
              s.id = "label-wrapper";
              var r = document.createElement("label");
              (r.id = "label-input-email-request"),
                (r.for = "input-email-request"),
                (r.innerHTML = SnapEngage.getMessage(68).toUpperCase()),
                (r.className = "hidden"),
                s.appendChild(r);
              var l = document.createElement("div");
              (l.id = "success-email-request"),
                (l.className = "hidden"),
                l.appendChild(
                  this.helpers.addSvgIcon("icn-confirmation", "#69CE00")
                );
              var u = this.createEmailRequestButtons();
              return (
                a.appendChild(n),
                a.appendChild(s),
                t.appendChild(a),
                t.appendChild(l),
                t.appendChild(u),
                e
              );
            }),
            (this.createEmailRequestButtons = function () {
              var e = document.createElement("div");
              (e.id = "wrapper-buttons-email-transcript"),
                (e.className = "wrapper-multi-buttons flex");
              var t = document.createElement("input");
              (t.type = "button"),
                (t.value = SnapEngage.getMessage(69).toUpperCase()),
                (t.id = "button-email-cancel"),
                t.setAttribute("tabindex", "0"),
                (t.className = "multi-button-first btn-secondary button"),
                e.appendChild(t);
              var i = document.createElement("input");
              return (
                (i.type = "button"),
                (i.value = SnapEngage.getMessage(70).toUpperCase()),
                (i.id = "button-email-submit"),
                i.setAttribute("tabindex", "0"),
                (i.className = "multi-button-second button btn-primary"),
                (i.disabled = !0),
                e.appendChild(i),
                e
              );
            }),
            (this.setElementsRef = function () {
              [
                {
                  emailRequestWrapper: "wrapper-email-request",
                },
                {
                  contentEmailRequest: "content-card-email",
                },
                {
                  inputWrapper: "inputarea-email-request",
                },
                {
                  requestHelperText: "text-email-request",
                },
                {
                  successWrapper: "success-email-request",
                },
                {
                  inputEmailTranscriptButtons:
                    "wrapper-buttons-email-transcript",
                },
                {
                  buttonCancelTranscript: "button-email-cancel",
                },
                {
                  buttonSubmitTranscript: "button-email-submit",
                },
                {
                  inputEmailTranscript: "input-email-request",
                },
              ].forEach(
                function (e) {
                  var t = Object.keys(e)[0];
                  this.setUiElementVariable(t, e[t]);
                }.bind(this)
              );
            }),
            (this.setUiElementVariable = function (e, t) {
              this[e] = this.iframe.getElementById(t);
            }),
            (this.fadeInRequestWrapper = function () {
              this.helpers.elementSwapClass(
                this.emailRequestWrapper,
                "hidden",
                "fadeIn"
              );
            }),
            (this.fadeOutRequestWrapper = function () {
              this.helpers.elementSwapClass(
                this.emailRequestWrapper,
                "fadeIn",
                "fadeOut"
              );
            }),
            (this.getTranscriptEmailAddress = function () {
              var e = {
                url:
                  "/public/api/v2/casevisitoremail/" + SnapEngage.getCaseId(),
                contentType: "application/json",
              };
              SnapEngage.sendXMLHttpRequest(
                e,
                this.getTranscriptEmailAddressSuccess.bind(this)
              );
            }),
            (this.getTranscriptEmailAddressSuccess = function (e) {
              1 === e.statusCode
                ? this.setState(
                    "emailTranscriptAddress",
                    SnapABug.deactivateHTML(e.data.email)
                  )
                : this.setState(
                    "emailTranscriptAddress",
                    SnapEngage.getUserEmail() || null
                  ),
                this.setEmailInputValue();
            }),
            (this.setEmailInputValue = function () {
              if (this.inputEmailTranscript) {
                var e = this.getState("emailTranscriptAddress");
                e &&
                  ((this.inputEmailTranscript.value = e || null),
                  this.buttonSubmitTranscript.removeAttribute("disabled")),
                  this.inputEmailTranscript.focus();
              }
            }),
            (this.bindEvents = function () {
              this.bindInputEvents(
                "emailInputBlur",
                this.handleEmailValidation.bind(this)
              ),
                this.bindInputEvents(
                  "emailInputKeyup",
                  this.handleInputKeyup.bind(this)
                ),
                this.bindInputEvents(
                  "emailInputKeydown",
                  this.handleSubmitTranscriptButton.bind(this)
                ),
                this.bindCancelClick(
                  this.handleCancelTranscriptButton.bind(this)
                ),
                this.bindSubmitClick(
                  this.handleSubmitTranscriptButton.bind(this)
                );
            }),
            (this.bindInputEvents = function (e, t) {
              "emailInputBlur" === e &&
                this.inputEmailTranscript.addEventListener("blur", function (
                  e
                ) {
                  t(e);
                }),
                "emailInputKeyup" === e &&
                  this.inputEmailTranscript.addEventListener("keyup", function (
                    e
                  ) {
                    t(e);
                  }),
                "emailInputKeydown" === e &&
                  this.inputEmailTranscript.addEventListener(
                    "keydown",
                    function (e) {
                      if ("Enter" === e.key) {
                        if (this.getState("isSubmittingEmail")) return;
                        t(e);
                      }
                    }.bind(this)
                  );
            }),
            (this.bindCancelClick = function (e) {
              this.buttonCancelTranscript.addEventListener(
                "click",
                function (t) {
                  t.preventDefault(), e();
                }.bind(this)
              );
            }),
            (this.bindSubmitClick = function (e) {
              this.buttonSubmitTranscript.addEventListener("click", function (
                t
              ) {
                t.preventDefault(), e();
              });
            }),
            (this.handleInputKeyup = function (e) {
              e.target.value.length >= 5 &&
              this.getState("emailTranscriptUiVisible") &&
              this.handleEmailValidation(e)
                ? this.buttonSubmitTranscript.removeAttribute("disabled")
                : this.buttonSubmitTranscript.setAttribute("disabled", !0),
                this.setState("emailTranscriptAddress", e.target.value);
            }),
            (this.handleEmailValidation = function (e) {
              var t = SnapEngage.getCustomDesignUI().fieldsController.validateEmailDiv(
                  e.target
                ),
                i = this.iframe.getElementById("label-input-email-request");
              return (
                t
                  ? this.enableInvalidEmailLabel(i)
                  : this.disableInvalidEmailLabel(i),
                t
              );
            }),
            (this.enableInvalidEmailLabel = function (e) {
              this.helpers.elementSwapClass(e, "visible", "hidden");
            }),
            (this.disableInvalidEmailLabel = function (e) {
              this.helpers.elementSwapClass(e, "hidden", "visible");
            }),
            (this.handleCancelTranscriptButton = function () {
              this.emailRequestWrapper.addEventListener(
                "animationend",
                function (e) {
                  if ((e.preventDefault(), "fadeOut" !== e.animationName))
                    return !1;
                  this.removeTranscriptRequestUi.call(this);
                }.bind(this)
              ),
                this.fadeOutRequestWrapper();
            }),
            (this.removeTranscriptRequestUi = function () {
              this.removeEmailTranscriptRequestForm(),
                this.setState("emailTranscriptUiVisible", !1),
                "function" == typeof this.removeEmailTranscriptCallback &&
                  this.removeEmailTranscriptCallback();
            }),
            (this.removeEmailTranscriptRequestForm = function () {
              this.helpers.removeElement(this.emailRequestWrapper),
                this.helpers.removeElement(this.inputEmailTranscriptButtons);
            }),
            (this.handleSubmitTranscriptButton = function () {
              this.setState("isSubmittingEmail", !0),
                this.inputEmailTranscript.blur();
              var e = this.getState("emailTranscriptAddress");
              if (!e) return !1;
              this.sendEmailRequest(e);
            }),
            (this.sendEmailRequest = function (e) {
              var t = {
                url:
                  "/public/api/v2/casevisitoremail/" + SnapEngage.getCaseId(),
                method: "POST",
                visitorData: JSON.stringify({
                  email: e,
                }),
                contentType: "application/json",
              };
              SnapEngage.sendXMLHttpRequest(
                t,
                this.handleEmailSuccess.bind(this),
                this.handleEmailError.bind(this)
              );
            }),
            (this.handleEmailSuccess = function () {
              this.setState("isSubmittingEmail", !1),
                this.setState("isSubmitted", !0),
                this.fadeOutContentWrapper();
            }),
            (this.updateTranscriptMessage = function () {
              var e = SnapEngage.getMessage(71).replace(
                "{email}",
                " <b>" + this.getState("emailTranscriptAddress") + "</b>"
              );
              (this.requestHelperText.innerHTML = e),
                this.helpers.elementRemoveClass(
                  this.requestHelperText,
                  "hidden"
                );
            }),
            (this.fadeOutPaperWrappper = function () {
              this.emailRequestWrapper.addEventListener(
                "animationend",
                function (e) {
                  if ("fadeOut" !== e.animationName) return !1;
                  this.removeTranscriptRequestUi.call(this),
                    this.setState("emailTranscriptAddress", null);
                }.bind(this)
              ),
                this.helpers.elementSwapClass(
                  this.emailRequestWrapper,
                  "fadeIn",
                  "fadeOut"
                );
            }),
            (this.fadeOutContentWrapper = function () {
              this.contentEmailRequest.addEventListener(
                "animationend",
                this.callbackFadeOutContentWrapper.bind(this)
              ),
                this.helpers.elementSwapClass(
                  this.contentEmailRequest,
                  "flex",
                  "fadeOut"
                );
            }),
            (this.callbackFadeOutContentWrapper = function (e) {
              if ("fadeOut" !== e.animationName) return !1;
              this.fadeElementsAfterSuccess(),
                this.updateTranscriptMessage(),
                this.enableSuccessIcon(),
                this.contentEmailRequest.addEventListener(
                  "animationend",
                  this.callbackFadeInContentWrapper.bind(this)
                );
            }),
            (this.fadeElementsAfterSuccess = function () {
              this.helpers.elementSwapClass(
                this.inputEmailTranscriptButtons,
                "flex",
                "hidden"
              ),
                this.helpers.elementAddClass(this.requestHelperText, "hidden"),
                this.helpers.elementAddClass(this.inputWrapper, "hidden"),
                this.helpers.elementSwapClass(
                  this.contentEmailRequest,
                  "fadeOut",
                  "fadeIn"
                );
            }),
            (this.callbackFadeInContentWrapper = function (e) {
              if ("fadeIn" !== e.animationName) return !1;
              setTimeout(
                function () {
                  this.fadeOutPaperWrappper.call(this);
                }.bind(this),
                3e3
              );
            }),
            (this.enableSuccessIcon = function () {
              this.helpers.elementSwapClass(
                this.successWrapper,
                "hidden",
                "flex"
              );
            }),
            (this.handleEmailError = function () {
              this.setState("isSubmittingEmail", !1),
                (this.requestHelperText.innerHTML = SnapEngage.getMessage(67));
            });
        };
      window.chat_custom_design.EmailTranscriptRequest = ca;
      !(function (t) {
        function i(t, i) {
          (this.options = t),
            (this.helpers = i),
            (this.basePx = 16),
            (this.scale = this.helpers.getScale()),
            (this.font = this.helpers.parseBaseFontOption(
              this.options.baseFont
            )),
            (this.headerHeight = 45),
            (this.textEntryHeight = 80),
            (this.bottomGap = 15),
            (this.footerHeightCollapse = 25),
            (this.footerHeightExpand = 60),
            (this.messageMinHeight = 40),
            (this.messageProactiveMinHeight = 120),
            (this.buttonSpacing = 15),
            (this.minimizeViewWidth = 252),
            (this.minimizeOutsideMargin = 15),
            (this.chatPrimaryButton =
              void 0 === this.options.chatPrimaryButton ||
              null === this.options.chatPrimaryButton
                ? this.options.chatCallMeButton
                : this.options.chatPrimaryButton),
            (this.chatSecondaryButton =
              void 0 === this.options.chatSecondaryButton ||
              null === this.options.chatSecondaryButton
                ? {
                    text: null,
                    svgIcon: null,
                    fontColor: "#949494",
                    bgColor: "transparent",
                    borderColor: "transparent",
                    borderWidth: "0",
                    borderRadius: "4",
                    padding: "10",
                  }
                : this.options.chatSecondaryButton),
            (this.inlineMessagePrimaryButton = this.options
              .inlineMessagePrimaryButton
              ? this.options.inlineMessagePrimaryButton
              : {
                  fontColor: this.options.fieldFontColor,
                  bgColor: this.options.visitorMessage.bgColor,
                  borderColor: this.options.visitorMessage.bgColor,
                  borderWidth: "1",
                  borderRadius: this.options.visitorMessage.borderRadius,
                  padding: "10",
                }),
            (this.quadrant = {
              TOP_RIGHT: "top_right",
              BOTTOM_RIGHT: "bottom_right",
              TOP_LEFT: "top_left",
              BOTTOM_LEFT: "bottom_left",
            }),
            (this.position = {
              TOP: "top",
              BOTTOM: "bottom",
              LEFT: "left",
              RIGHT: "right",
            });
        }
        (i.prototype = {
          em: function (t, i, e, o) {
            return o ? t / i : t / i + (e ? "em" : "em;");
          },
          calcBaseFontSize: function (t, i) {
            return Math.round(t / this.scale) + (i ? "px" : "px;");
          },
          calcMessagesHeight: function (t) {
            var i;
            switch (t) {
              case "messages-expand":
                i =
                  this.headerHeight +
                  this.textEntryHeight +
                  this.footerHeightCollapse;
                break;
              case "messages-collapse":
                i =
                  this.headerHeight +
                  this.textEntryHeight +
                  this.bottomGap +
                  this.footerHeightExpand;
                break;
              case "messages-notextarea":
                i = this.headerHeight + this.footerHeightCollapse;
                break;
              case "messages-notextarea-with-expand":
                i =
                  this.headerHeight + this.footerHeightExpand + this.bottomGap;
                break;
              default:
                i =
                  this.headerHeight +
                  this.textEntryHeight +
                  this.footerHeightCollapse;
            }
            return "calc(100% - " + this.em(i, this.basePx, !0) + ");";
          },
          getPlacementInsidePreview: function (t, i, e, o, s) {
            if (((o -= 12), e < (s -= 12) && i < o))
              return this.getPlacement(t, i, e);
            var n = "",
              a = "right:0;",
              r = "left:50%;margin-left:" + (e / 2) * -1 + "px;";
            e > s && ((a = ""), (r = ""));
            var h = "bottom:0;",
              l = "top:50%;margin-top:" + (i / 2) * -1 + "px;";
            switch ((i > o && ((h = ""), (l = "")), t)) {
              case "left-top":
                n = "top:0;left:0;float:left;";
                break;
              case "left-bottom":
                n = h + "left:0;float:left;";
                break;
              case "right-top":
                n = a + "float:right;top:0;";
                break;
              case "right-bottom":
                n = a + "float:right;" + h;
                break;
              case "center-top":
                n = "top:0;" + r;
                break;
              case "left-center":
                n = "left:0;float:left;" + l;
                break;
              case "center-center":
                n = l + r;
                break;
              case "center-bottom":
                n = h + r;
                break;
              case "right-center":
                n = a + l;
                break;
              default:
                console.log(
                  "Placement parameter in in helpers.getPlacement() doesn't match any options."
                );
            }
            return n;
          },
          getPlacement: function (t, i, e) {
            var o = "";
            if (
              !this.helpers.isInsideGWT() &&
              !this.helpers.isIpad() &&
              void 0 !==
                SnapEngageChat.getChatWindowCookieData("chatBoxPosition") &&
              "" !== SnapEngageChat.getChatWindowCookieData("chatBoxPosition")
            ) {
              var s = SnapEngageChat.getChatWindowCookieData("chatBoxPosition");
              return "left:" + s[0] + "px;top:" + s[1] + "px;";
            }
            var n = this.em((i / 2) * -1, this.basePx),
              a = this.em((e / 2) * -1, this.basePx);
            switch (this._ipadPlacement(t)) {
              case "left-top":
                o = "top:0;left:0;float:left;";
                break;
              case "left-bottom":
                o = "bottom:0;left:0;float:left;";
                break;
              case "right-top":
                o = "right:0;float:right;top:0;";
                break;
              case "right-bottom":
                o = "right:0;float:right;bottom:0;";
                break;
              case "center-top":
                o = "top:0;left:50%;margin-left:" + a;
                break;
              case "left-center":
                o = "left:0;float:left;top:50%;margin-top:" + n;
                break;
              case "center-center":
                o = "top:50%;margin-top:" + n + "left:50%;margin-left:" + a;
                break;
              case "center-bottom":
                o = "bottom:0;left:50%;margin-left:" + a;
                break;
              case "right-center":
                o = "right:0;top:50%;margin-top:" + n;
                break;
              default:
                console.warn(
                  "Placement parameter in in helpers.getPlacement() doesn't match any options."
                );
            }
            return o;
          },
          getMinimizeContentsPlacement: function (t, i, e, o, s) {
            if (((this.buttonViewOptions = s), t && i && e && o)) {
              var n = "",
                a = "",
                r = "",
                h = "",
                l = " left",
                d = " right",
                p = " top",
                m = " bottom",
                g = " message-left",
                b = " message-right",
                f = " minimize-notify-top",
                c = " minimize-notify-bottom",
                u = " minimize-notify-left-avatar",
                x = " minimize-notify-right-avatar";
              switch (this.getQuadrant(s)) {
                case this.quadrant.TOP_LEFT:
                  (n = l + p), (a = l + p), (r = b + p), (h = u + f);
                  break;
                case this.quadrant.BOTTOM_LEFT:
                  (n = l + m), (a = l + m), (r = b + m), (h = u + c);
                  break;
                case this.quadrant.TOP_RIGHT:
                  (n = d + p), (a = d + p), (r = g + p), (h = x + f);
                  break;
                case this.quadrant.BOTTOM_RIGHT:
                  (n = d + m), (a = d + m), (r = g + m), (h = x + c);
                  break;
                default:
                  (n = l + m), (a = l + m), (r = b + m), (h = u + c);
              }
              this.helpers.elementAddClass(t, n),
                this.helpers.elementAddClass(i, a),
                this.helpers.elementAddClass(e, r),
                this.helpers.elementAddClass(o, h);
            }
          },
          _ipadPlacement: function (t) {
            return (
              this.helpers.isIpad() &&
                t.indexOf("-top") < 0 &&
                (t.indexOf("left-") >= 0
                  ? (t = "left-top")
                  : t.indexOf("center-") >= 0
                  ? (t = "center-top")
                  : t.indexOf("right") >= 0 && (t = "right-top")),
              t
            );
          },
          getQuadrant: function (t) {
            var i;
            return (
              (this.buttonViewOptions = t),
              this._isPositionInNorthwest(this.buttonViewOptions)
                ? (i = this.quadrant.TOP_LEFT)
                : this._isPositionInSouthwest(this.buttonViewOptions)
                ? (i = this.quadrant.BOTTOM_LEFT)
                : this._isPositionInNortheast(this.buttonViewOptions)
                ? (i = this.quadrant.TOP_RIGHT)
                : this._isPositionInSoutheast(this.buttonViewOptions) &&
                  (i = this.quadrant.BOTTOM_RIGHT),
              i
            );
          },
          _isPositionInNorthwest: function (t) {
            var i = parseInt(t.offsetValue),
              e =
                t.position === this.position.TOP &&
                ((t.offset === this.position.LEFT && i < 50) ||
                  (t.offset === this.position.RIGHT && i > 50)),
              o =
                t.position === this.position.LEFT &&
                ((t.offset === this.position.TOP && i < 50) ||
                  (t.offset === this.position.BOTTOM && i > 50));
            return e || o;
          },
          _isPositionInSouthwest: function (t) {
            var i = parseInt(t.offsetValue),
              e =
                t.position === this.position.BOTTOM &&
                ((t.offset === this.position.LEFT && i < 50) ||
                  (t.offset === this.position.RIGHT && i > 50)),
              o =
                t.position === this.position.LEFT &&
                ((t.offset === this.position.TOP && i >= 50) ||
                  (t.offset === this.position.BOTTOM && i <= 50));
            return e || o;
          },
          _isPositionInNortheast: function (t) {
            var i = parseInt(t.offsetValue),
              e =
                t.position === this.position.TOP &&
                ((t.offset === this.position.LEFT && i >= 50) ||
                  (t.offset === this.position.RIGHT && i <= 50)),
              o =
                t.position === this.position.RIGHT &&
                ((t.offset === this.position.TOP && i < 50) ||
                  (t.offset === this.position.BOTTOM && i > 50));
            return e || o;
          },
          _isPositionInSoutheast: function (t) {
            var i = parseInt(t.offsetValue),
              e =
                t.position === this.position.BOTTOM &&
                ((t.offset === this.position.LEFT && i >= 50) ||
                  (t.offset === this.position.RIGHT && i <= 50)),
              o =
                t.position === this.position.RIGHT &&
                ((t.offset === this.position.TOP && i >= 50) ||
                  (t.offset === this.position.BOTTOM && i <= 50));
            return e || o;
          },
          setUpAnimations: function (t) {
            var i = t.id.indexOf("minimize") >= 0,
              e = t.id.indexOf("button") >= 0;
            if (
              !this.helpers.isInsideGWT() &&
              SnapEngage.getCustomDesignUI() &&
              void 0 !== SnapEngage.getCustomDesignUI().animateView
            ) {
              var o = "",
                s = "",
                n = "",
                a = "",
                r = "";
              switch (
                (i && ((a = "fadeInUp"), (r = "fadeOut")),
                this.buttonViewOptions.position)
              ) {
                case this.position.LEFT:
                  (o = "fadeInLeft"),
                    (s = "fadeOutLeft"),
                    e &&
                      (n =
                        null !== this.buttonViewOptions.text
                          ? "slideInDown"
                          : "slideInLeft");
                  break;
                case this.position.RIGHT:
                  (o = "fadeInRight"),
                    (s = "fadeOutRight"),
                    e &&
                      (n =
                        null !== this.buttonViewOptions.text
                          ? "slideInDown"
                          : "slideInRight");
                  break;
                case this.position.TOP:
                  (o = "fadeInDown"),
                    (s = "fadeOutUp"),
                    (n = "slideInDown"),
                    i && ((a = "fadeInDown"), (r = "fadeOut"));
                  break;
                case this.position.BOTTOM:
                  (o = "fadeInUp"), (s = "fadeOutDown"), (n = "slideInUp");
              }
              var h = SnapEngage.getCustomDesignUI().animateView;
              h.setAnimationIn(h.animatedElement.BOX, o),
                h.setAnimationOut(h.animatedElement.BOX, s),
                e && h.setAnimationIn(h.animatedElement.BUTTON, n),
                i &&
                  (h.setAnimationIn(h.animatedElement.MINIMIZE, o),
                  h.setAnimationOut(h.animatedElement.MINIMIZE, s),
                  this.getMinimizeIframe().body.appendChild(
                    h.animateStylesheet()
                  ),
                  h.setAnimationIn(h.animatedElement.MINIMIZE_MESSAGE, a),
                  h.setAnimationOut(h.animatedElement.MINIMIZE_MESSAGE, r));
            }
          },
          getMinimizeIframe: function () {
            return document.getElementById("iframe-minimize").contentWindow
              .document;
          },
          minimizeStylesheet: function () {
            return (
              '<style type="text/css">html{margin:0;padding:0;border:0;font-family:' +
              this.font.family +
              ";font-size:" +
              this.calcBaseFontSize(this.buttonViewOptions.fontSize) +
              "font-weight:" +
              this.font.weight +
              ";line-height:1;-ms-overflow-style: -ms-autohiding-scrollbar;}#minimize-content{cursor:pointer;display:inline;cursor:pointer;overflow:hidden;height:" +
              this.em(60, this.buttonViewOptions.fontSize) +
              "width:" +
              this.em(60, this.buttonViewOptions.fontSize) +
              "}#minimize-svg{height:" +
              this.em(60, this.buttonViewOptions.fontSize) +
              "width:" +
              this.em(60, this.buttonViewOptions.fontSize) +
              "margin:" +
              this.em(11, this.buttonViewOptions.fontSize) +
              "}#minimize-svg > #svg-container > img{margin:" +
              this.em(5, this.buttonViewOptions.fontSize) +
              "height:" +
              this.em(55, this.buttonViewOptions.fontSize) +
              "width:" +
              this.em(55, this.buttonViewOptions.fontSize) +
              "}#minimize-avatar-container{height:" +
              this.em(54, this.buttonViewOptions.fontSize) +
              "width:" +
              this.em(54, this.buttonViewOptions.fontSize) +
              "box-shadow: 1.8px 1.8px 6.4px 1.1px rgba(0, 0, 0, 0.2);border-radius:" +
              this.em(this.options.agentMessage.avatarBorderRadius, 9) +
              "margin:" +
              this.em(
                this.minimizeOutsideMargin,
                this.buttonViewOptions.fontSize
              ) +
              "}#minimize-avatar-container, #minimize-svg{font-size:" +
              this.em(14, this.buttonViewOptions.fontSize) +
              "position:absolute;overflow:hidden;}img#minimize-avatar {display:inline;margin:0 auto;height:100%;border-radius:" +
              this.em(
                this.options.agentMessage.avatarBorderRadius,
                this.buttonViewOptions.fontSize
              ) +
              "}#minimize-messages{display:none;position:absolute;margin-bottom: " +
              this.em(
                this.minimizeOutsideMargin,
                this.buttonViewOptions.fontSize
              ) +
              "}#minimize-messages > div.designstudio-fadeOut{animation-duration: 4s;-moz-animation-duration: 4s;-webkit-animation-duration: 4s;-o-animation-duration: 4s;}.minimize-message{opacity: " +
              this.options.bgOpacity +
              ";background-color:" +
              this.options.agentMessage.bgColor +
              ";box-shadow: 1.8px 1.8px 6.4px 1.1px rgba(0, 0, 0, 0.2);max-height:" +
              this.em(this.messageMinHeight, this.buttonViewOptions.fontSize) +
              "padding-top:" +
              this.em(11, this.buttonViewOptions.fontSize) +
              "padding-bottom:" +
              this.em(10.5, this.buttonViewOptions.fontSize) +
              "position:relative;margin-top:" +
              this.em(
                this.minimizeOutsideMargin,
                this.buttonViewOptions.fontSize
              ) +
              "}.minimize-message-proactive{opacity: " +
              this.options.bgOpacity +
              ";background-color:" +
              this.options.agentMessage.bgColor +
              ";box-shadow: 1.8px 1.8px 6.4px 1.1px rgba(0, 0, 0, 0.2);max-height:" +
              this.em(
                this.messageProactiveMinHeight,
                this.buttonViewOptions.fontSize
              ) +
              "padding-top:" +
              this.em(11, this.buttonViewOptions.fontSize) +
              "padding-bottom:" +
              this.em(10.5, this.buttonViewOptions.fontSize) +
              "position:relative;}.button-message{font-family:inherit;cursor:pointer;font-weight:inherit;font-size:" +
              this.em(14, this.options.visitorMessage.fontSize) +
              "color:" +
              this.inlineMessagePrimaryButton.fontColor +
              ";margin-bottom:" +
              this.em(5, this.options.visitorMessage.fontSize) +
              "padding:" +
              this.em(10, this.options.visitorMessage.fontSize, !0) +
              " " +
              this.em(14, this.options.visitorMessage.fontSize) +
              "border-radius:" +
              this.em(
                this.inlineMessagePrimaryButton.borderRadius,
                this.options.visitorMessage.fontSize
              ) +
              "border-color:" +
              this.inlineMessagePrimaryButton.borderColor +
              ";border-width:" +
              this.em(
                this.inlineMessagePrimaryButton.borderWidth,
                this.options.visitorMessage.fontSize
              ) +
              "background-color:" +
              this.inlineMessagePrimaryButton.bgColor +
              ";transition: border-color 0.15s, background-color 0.15s, color 0.15s;}.button-message:hover{background-color:" +
              this.inlineMessagePrimaryButton.fontColor +
              ";color:" +
              this.inlineMessagePrimaryButton.bgColor +
              "}#minimize-text-proactive{text-align: left;color:" +
              this.options.agentMessage.fontColor +
              ";display:block;display: -webkit-box;margin: 0 " +
              this.em(13.5, this.buttonViewOptions.fontSize) +
              "font-size:" +
              this.em(14, this.options.agentMessage.fontSize) +
              "line-height:" +
              this.em(16, this.options.agentMessage.fontSize) +
              "-webkit-line-clamp: 4;-webkit-box-orient: vertical;overflow: hidden;text-overflow: ellipsis;max-height:" +
              this.em(124, this.buttonViewOptions.fontSize, !0, !0) *
                this.em(20, this.buttonViewOptions.fontSize, !0, !0) *
                2 +
              "em;min-width:" +
              this.em(124, this.buttonViewOptions.fontSize) +
              "cursor:pointer}#minimize-text{text-align: left;color:" +
              this.options.agentMessage.fontColor +
              ";display:block;display: -webkit-box;margin: 0 " +
              this.em(13.5, this.buttonViewOptions.fontSize) +
              "font-size:" +
              this.em(14, this.options.agentMessage.fontSize) +
              "line-height:" +
              this.em(16, this.options.agentMessage.fontSize) +
              "-webkit-line-clamp: 2;-webkit-box-orient: vertical;overflow: hidden;text-overflow: ellipsis;max-height:" +
              this.em(11, this.buttonViewOptions.fontSize, !0, !0) *
                this.em(20, this.buttonViewOptions.fontSize, !0, !0) *
                2 +
              "em;min-width:" +
              this.em(124, this.buttonViewOptions.fontSize) +
              "max-width:" +
              this.em(124, this.buttonViewOptions.fontSize) +
              "}#minimize-text.rtl{text-align:right;}#desktop-text{max-width:" +
              this.em(150, this.buttonViewOptions.fontSize) +
              "}#mobile-text{width:100%;}.message-left{right:" +
              this.em(84, this.buttonViewOptions.fontSize) +
              "margin-left:" +
              this.em(
                this.minimizeOutsideMargin,
                this.buttonViewOptions.fontSize
              ) +
              "}.message-right{left:" +
              this.em(84, this.buttonViewOptions.fontSize) +
              "margin-right:" +
              this.em(
                this.minimizeOutsideMargin,
                this.buttonViewOptions.fontSize
              ) +
              "}.message-left > div{border-radius:" +
              this.em(
                this.buttonViewOptions.borderRadius,
                this.buttonViewOptions.fontSize
              ) +
              "border-bottom-right-radius:0;}.message-right > div{border-radius:" +
              this.em(
                this.buttonViewOptions.borderRadius,
                this.buttonViewOptions.fontSize
              ) +
              "border-bottom-left-radius:0;}#minimize-notify{display:none;position:absolute;width:" +
              this.em(18, this.buttonViewOptions.fontSize) +
              "height:" +
              this.em(18, this.buttonViewOptions.fontSize) +
              "padding:" +
              this.em(3, this.buttonViewOptions.fontSize) +
              "text-shadow:0 " +
              this.em(1, 11, !0) +
              " 0 rgba(0,0,0,0.1);-webkit-box-shadow:-" +
              this.em(1, 11, !0) +
              " " +
              this.em(1, 11, !0) +
              " " +
              this.em(1, 11, !0) +
              " rgba(0,0,0,0.2);box-shadow:-" +
              this.em(1, 11, !0) +
              " " +
              this.em(1, 11, !0) +
              " " +
              this.em(1, 11, !0) +
              " rgba(0,0,0,0.2);border-radius:50%;border-style:solid;border:none;background-color:" +
              this.buttonViewOptions.notifyBgColor +
              ";z-index:100;justify-content:center;align-items:center;}.minimize-notify-right-avatar{right:" +
              this.em(8, this.buttonViewOptions.fontSize) +
              "}.minimize-notify-left-avatar{left:" +
              this.em(60, this.buttonViewOptions.fontSize) +
              "}.minimize-notify-bottom{bottom:" +
              this.em(54, this.buttonViewOptions.fontSize) +
              "}.minimize-notify-bottom-proactive{bottom:" +
              this.em(94, this.buttonViewOptions.fontSize) +
              "}.minimize-notify-top{top:" +
              this.em(6, this.buttonViewOptions.fontSize) +
              "}#minimize-notify-counter{font-weight:bold;font-size:" +
              this.em(12, this.buttonViewOptions.fontSize) +
              "color:" +
              this.buttonViewOptions.notifyFontColor +
              ";}.right{float:right;right:0;}.left{float:left;left:0;}.bottom, .bottom > div{bottom:0;}.top, .top > div{top:0;}</style>"
            );
          },
          iframeButtonStylesheet: function (t) {
            return (
              (this.buttonViewOptions = t),
              '<style type="text/css">html{margin:0;padding:0;border:0;font-family:' +
                this.font.family +
                ";font-size:" +
                this.calcBaseFontSize(this.buttonViewOptions.fontSize) +
                "line-height:1;-ms-overflow-style: -ms-autohiding-scrollbar;}body{margin:0;}#iframe-button-container{display:inline-block;position:static;}#iframe-button-content{cursor:pointer;position:absolute;font-size:" +
                this.calcBaseFontSize(this.buttonViewOptions.fontSize) +
                "}.designstudio-circle{filter: url(#dropshadow);filter: \"progid:DXImageTransform.Microsoft.Dropshadow(OffX=10, OffY=10, Color='#444')\";-webkit-filter: url(#dropshadow);}@-moz-document url-prefix() {.designstudio-circle{filter: drop-shadow(10px 10px 15px #000);}}.button-svg{height:" +
                this.em(60, t.fontSize) +
                "width:" +
                this.em(60, t.fontSize) +
                "}.button-svg > svg{height:" +
                this.em(60, t.fontSize) +
                "width:" +
                this.em(60, t.fontSize) +
                "}.designstudio-container:hover{opacity: 0.6;transition:opacity .5s ease-out; -moz-transition:opacity .5s ease-out; -webkit-transition:opacity .5s ease-out; -o-transition:opacity .5s ease-out;}#designstudio-button-text{white-space:nowrap;padding:" +
                this.em(4, this.buttonViewOptions.fontSize) +
                this.buttonTextTransformCss() +
                "}.button-text{" +
                this.buttonTextCss() +
                "}#button-img{height:" +
                this.em(60, t.fontSize) +
                "width:" +
                this.em(60, t.fontSize) +
                "}#designstudio-button-image-desktop{width:" +
                this.em(this.buttonViewOptions.imageWidth, t.fontSize) +
                "min-width:" +
                this.em(this.buttonViewOptions.imageWidth, t.fontSize) +
                "max-width:" +
                this.em(this.buttonViewOptions.imageWidth, t.fontSize) +
                "height:" +
                this.em(this.buttonViewOptions.imageHeight, t.fontSize) +
                "min-height:" +
                this.em(this.buttonViewOptions.imageHeight, t.fontSize) +
                "max-height:" +
                this.em(this.buttonViewOptions.imageHeight, t.fontSize) +
                "}#designstudio-button-image-mobile{width:" +
                this.em(0.6 * this.buttonViewOptions.imageWidth, t.fontSize) +
                "height:" +
                this.em(0.6 * this.buttonViewOptions.imageHeight, t.fontSize) +
                "min-width:" +
                this.em(0.6 * this.buttonViewOptions.imageWidth, t.fontSize) +
                "max-width:" +
                this.em(0.6 * this.buttonViewOptions.imageWidth, t.fontSize) +
                "height:" +
                this.em(0.6 * this.buttonViewOptions.imageHeight, t.fontSize) +
                "min-height:" +
                this.em(0.6 * this.buttonViewOptions.imageHeight, t.fontSize) +
                "max-height:" +
                this.em(0.6 * this.buttonViewOptions.imageHeight, t.fontSize) +
                "}#svg-container{display:inline;}</style>"
            );
          },
          buttonTextTransformCss: function () {
            var t = "";
            return (
              "right" === this.buttonViewOptions.position
                ? (t +=
                    "-ms-transform:rotate(-180deg);-webkit-transform:rotate(-180deg);transform:rotate(-180deg);")
                : (t +=
                    "-ms-transform:rotate(0deg);-webkit-transform:rotate(0deg);transform:rotate(0deg);"),
              t
            );
          },
          buttonTextCss: function () {
            var t = 0,
              i = 0,
              e = this.buttonViewOptions.borderRadius,
              o = this.buttonViewOptions.borderRadius,
              s = this.buttonViewOptions.borderWidth,
              n = this.buttonViewOptions.borderWidth,
              a = 0,
              r = this.buttonViewOptions.borderWidth;
            return (
              "bottom" === this.buttonViewOptions.position &&
                ((t = this.buttonViewOptions.borderRadius),
                (i = this.buttonViewOptions.borderRadius),
                (e = 0),
                (o = 0),
                (s = this.buttonViewOptions.borderWidth),
                (n = this.buttonViewOptions.borderWidth),
                (a = this.buttonViewOptions.borderWidth),
                (r = 0)),
              "font-family:" +
                this.font.family +
                ";font-weight:" +
                this.font.weight +
                ";padding:" +
                this.em(10, this.buttonViewOptions.fontSize) +
                "text-align:center;color:" +
                this.buttonViewOptions.fontColor +
                ";font-size:" +
                this.em(
                  this.buttonViewOptions.fontSize,
                  this.buttonViewOptions.fontSize
                ) +
                "border-top-left-radius:" +
                this.em(t, this.buttonViewOptions.fontSize) +
                "border-top-right-radius:" +
                this.em(i, this.buttonViewOptions.fontSize) +
                "border-bottom-left-radius:" +
                this.em(e, this.buttonViewOptions.fontSize) +
                "border-bottom-right-radius:" +
                this.em(o, this.buttonViewOptions.fontSize) +
                "border-left:" +
                this.em(s, this.buttonViewOptions.fontSize, !0) +
                " solid " +
                this.buttonViewOptions.borderColor +
                ";border-right:" +
                this.em(n, this.buttonViewOptions.fontSize, !0) +
                " solid " +
                this.buttonViewOptions.borderColor +
                ";border-top:" +
                this.em(a, this.buttonViewOptions.fontSize, !0) +
                " solid " +
                this.buttonViewOptions.borderColor +
                ";border-bottom:" +
                this.em(r, this.buttonViewOptions.fontSize, !0) +
                " solid " +
                this.buttonViewOptions.borderColor +
                ";background-color:" +
                this.buttonViewOptions.bgColor +
                ";"
            );
          },
          updateElementPlacement: function (t, i, e) {
            (this.buttonViewOptions = e),
              (t.style.left = null),
              (t.style.right = null),
              (t.style.top = null),
              (t.style.bottom = null),
              (t.style.webkitTransform = null),
              (t.style.MozTransform = null),
              (t.style.msTransform = null),
              (t.style.transform = null),
              (t.style.webkitTransformOrigin = null),
              (t.style.MozTransformOrigin = null),
              (t.style.msTransformOrigin = null),
              (t.style.transformOrigin = null),
              this.buttonViewOptions.position === this.position.LEFT
                ? this.buttonViewOptions.offset === this.position.TOP
                  ? ((t.style.left = 0), (i.style.right = 0), (i.style.top = 0))
                  : this.buttonViewOptions.offset === this.position.BOTTOM &&
                    ((t.style.left = 0), (i.style.left = 0), (i.style.top = 0))
                : this.buttonViewOptions.position === this.position.RIGHT
                ? this.buttonViewOptions.offset === this.position.TOP
                  ? ((t.style.right = 0), (i.style.left = 0), (i.style.top = 0))
                  : this.buttonViewOptions.offset === this.position.BOTTOM &&
                    ((t.style.right = 0),
                    (i.style.right = 0),
                    (i.style.top = 0))
                : this.buttonViewOptions.position === this.position.TOP
                ? this.buttonViewOptions.offset === this.position.RIGHT
                  ? ((t.style.top = 0), (i.style.top = 0), (i.style.right = 0))
                  : this.buttonViewOptions.offset === this.position.LEFT &&
                    ((t.style.top = 0), (i.style.top = 0), (i.style.left = 0))
                : this.buttonViewOptions.position === this.position.BOTTOM &&
                  (this.buttonViewOptions.offset === this.position.RIGHT
                    ? ((t.style.bottom = 0),
                      (i.style.bottom = 0),
                      (i.style.right = 0))
                    : this.buttonViewOptions.offset === this.position.LEFT &&
                      ((t.style.bottom = 0),
                      (i.style.bottom = 0),
                      (i.style.left = 0))),
              t.id.indexOf("minimize") >= 0 &&
                ((this.buttonViewOptions.position !== this.position.TOP &&
                  this.buttonViewOptions.position !== this.position.BOTTOM) ||
                  "50" !== this.buttonViewOptions.offsetValue ||
                  (this.buttonViewOptions.offset === this.position.LEFT
                    ? (t.style.marginLeft = this.em(
                        (this.minimizeViewWidth / 2) * -1,
                        this.options.agentMessage.fontSize,
                        !0
                      ))
                    : (t.style.marginRight = this.em(
                        (this.minimizeViewWidth / 2) * -1,
                        this.options.agentMessage.fontSize,
                        !0
                      ))));
          },
          updateButtonRotation: function (t) {
            this.button = t;
            var i = this._getButtonDegreeOfRotation(
                null !== this.buttonViewOptions.text,
                this.buttonViewOptions.position
              ),
              e = this._getButtonOriginXY(
                this.buttonViewOptions.position,
                this.buttonViewOptions.offset
              ),
              o = this._getButtonTranslateXY(
                null !== this.buttonViewOptions.text,
                null !== this.buttonViewOptions.svgIcon,
                this.buttonViewOptions.position,
                this.buttonViewOptions.offset,
                this.buttonViewOptions.offsetValue,
                this.buttonViewOptions.offsetUnit
              );
            if ("" !== o) {
              (this.button.style.webkitTransformOrigin = e),
                (this.button.style.MozTransformOrigin = e),
                (this.button.style.msTransformOrigin = e),
                (this.button.style.transformOrigin = e);
              var s = "rotate(" + i + "deg)";
              (this.button.style.webkitTransform = s + o),
                (this.button.style.MozTransform = s + o),
                (this.button.style.msTransform = s + o),
                (this.button.style.transform = s + o);
            }
          },
          _getButtonDegreeOfRotation: function (t, i) {
            var e = "0";
            return (
              t &&
                (i === this.position.LEFT
                  ? (e = "-90")
                  : i === this.position.RIGHT && (e = "90")),
              e
            );
          },
          _getButtonOriginXY: function (t, i) {
            var e = "";
            return (
              t === this.position.LEFT && i === this.position.BOTTOM
                ? (e = "0% 100%")
                : (t === this.position.LEFT && i === this.position.TOP) ||
                  i === this.position.LEFT
                ? (e = "0% 0%")
                : t === this.position.RIGHT && i === this.position.BOTTOM
                ? (e = "100% 100%")
                : ((t === this.position.RIGHT && i === this.position.TOP) ||
                    i === this.position.RIGHT) &&
                  (e = "100% 0%"),
              e
            );
          },
          _getButtonTranslateXY: function (t, i, e, o, s, n) {
            var a = "",
              r = "0%";
            if (
              (!t ||
                (e !== this.position.LEFT && e !== this.position.RIGHT) ||
                (e === this.position.LEFT && o === this.position.BOTTOM
                  ? ((r = "100%"), (a = " translate(0%, 100%)"))
                  : e === this.position.LEFT && o === this.position.TOP
                  ? (a = " translate(-100%, 0%)")
                  : e === this.position.RIGHT && o === this.position.BOTTOM
                  ? ((r = "100%"), (a = " translate(0%, 100%)"))
                  : e === this.position.RIGHT &&
                    o === this.position.TOP &&
                    (a = " translate(100%, 0%)"),
                "50" === s &&
                  "%" === n &&
                  (a =
                    " translate(" +
                    (e === this.position.LEFT ? "-50%" : "50%") +
                    ", " +
                    r +
                    ")")),
              "50" === s && "%" === n && "" === a)
            ) {
              var h = this._getButtonCenter(i);
              a =
                o === this.position.BOTTOM
                  ? " translate(0%, " + h + ")"
                  : o === this.position.TOP
                  ? " translate(0%, -" + h + ")"
                  : o === this.position.LEFT
                  ? " translate(-" + h + ", 0%)"
                  : " translate(" + h + ", 0%)";
            }
            return a;
          },
          _getButtonCenter: function (t) {
            var i = "50%";
            return (
              t && (i = 80 / this.buttonViewOptions.fontSize / 2 + "em"), i
            );
          },
          updateOffset: function (t) {
            var i = this.buttonViewOptions.offsetValue,
              e = this.buttonViewOptions.offsetUnit;
            "px" === e && ((i /= this.buttonViewOptions.fontSize), (e = "em")),
              (t.style[this.buttonViewOptions.offset] = i + e);
          },
          mainCss: function (t) {
            var i =
              "font-size:" +
              this.calcBaseFontSize(this.basePx) +
              "-webkit-transform:translateZ(0);-moz-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);display:" +
              (t >= 0 ? "block" : "none") +
              ";z-index:100003;position:" +
              (t >= 0 ? "absolute" : "fixed") +
              ";";
            if (this.helpers.isMobileDevice())
              i +=
                "top:" +
                this.em(this.options.padding, this.basePx) +
                "bottom:" +
                this.em(this.options.padding, this.basePx) +
                "left:" +
                this.em(this.options.padding, this.basePx) +
                "right:" +
                this.em(this.options.padding, this.basePx);
            else {
              var e = parseInt(this.options.height) + 24,
                o = parseInt(this.options.width) + 24;
              i +=
                "height:" +
                this.em(e, this.basePx) +
                "width:" +
                this.em(o, this.basePx) +
                this.getPlacement(this.options.placement, e, o);
            }
            return i;
          },
          mobileCssWithKeyboard: function (i) {
            return (
              "font-size:" +
              this.calcBaseFontSize(this.basePx) +
              "display:inline;z-index:100003;position:absolute;top:" +
              (t.iosScrollPositionY ? t.iosScrollPositionY : t.scrollY) +
              "px;bottom:0;left:0;right:0;height:" +
              (Math.floor(0.56 * t.innerHeight) + (i ? 36 : 0)) +
              "px;width:100%;"
            );
          },
          draggableCss: function () {
            return (
              "width:calc(100% - " +
              this.em(95, this.basePx, !0) +
              ");left:0;top:0;position:absolute;height:3em;z-index:13000;margin-top:12px;margin-left:12px;cursor:move;"
            );
          },
          getBackgroundTypeCSS: function () {
            var t;
            return (
              null !== this.options.bgColor
                ? (t = "background-color:" + this.options.bgColor + ";")
                : null !== this.options.bgImageUrl
                ? ((t =
                    'background-image:url("' +
                    this.options.bgImageUrl +
                    '");background-repeat: ' +
                    (this.options.bgImageRepeat ? "repeat" : "no-repeat") +
                    ";"),
                  this.options.bgImageRepeat ||
                    (t +=
                      "background-size: 100%;background-position:center center;background-size:cover;"))
                : null !== this.options.bgPatternUrl &&
                  (t =
                    'background-image:url("' +
                    this.options.staticUrl +
                    "/images/png/patterns/" +
                    this.options.bgPatternUrl +
                    '");background-repeat:repeat;background-size:' +
                    this.em(512, this.basePx) +
                    ";"),
              t
            );
          },
          iframeCss: function () {
            return "-webkit-transform:translateZ(0);-moz-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);display:block;position:absolute;border:none;width:100%;height:100%;";
          },
          iframeStylesheet: function () {
            return (
              '<style type="text/css">html{margin:0;padding:0;border:0;font:inherit;line-height:1;-ms-overflow-style: -ms-autohiding-scrollbar;}body{margin:0;font-family:' +
              this.font.family +
              ";font-weight:" +
              this.font.weight +
              ";position:absolute;height:100%;width:100%;font-size:" +
              this.calcBaseFontSize(this.basePx) +
              "}a{color:#38AEFF;text-decoration:none;}.right{float:right;right:0;}.left{float:left;left:0;}.center{margin:0 auto;}.hidden{display:none;}.flex{display:flex;}.visible{display:inline;}@-webkit-keyframes fadeIn{from{opacity:0;}to{opacity:1;}}@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}.fadeIn{animation:fadeIn ease 0.4s;-webkit-animation:fadeIn ease 0.4s;-moz-animation:fadeIn ease 0.4s;-o-animation:fadeIn ease 0.4s;-ms-animation:fadeIn ease 0.4s;}@-webkit-keyframes fadeOut{from{opacity:1;}to{opacity:0;}}@keyframes fadeOut{from{opacity:1;}to{opacity:0;}}.fadeOut{animation:fadeOut ease 0.4s;-webkit-animation:fadeOut ease 0.4s;-moz-animation:fadeOut ease 0.4s;-o-animation:fadeOut ease 0.4s;-ms-animation:fadeOut ease 0.4s;}.box-shadow{box-shadow:0px 6px 12px rgba(0, 0, 0, 0.34);}.main{box-sizing:border-box;position:absolute;overflow:hidden;border-style:solid;border-color:" +
              this.options.borderColor +
              ";border-width:" +
              this.em(this.options.borderWidth, this.basePx) +
              "border-top-left-radius:" +
              this.em(this.options.borderRadius, this.basePx) +
              "border-top-right-radius:" +
              this.em(this.options.borderRadius, this.basePx) +
              "border-bottom-left-radius:" +
              this.em(this.options.borderRadius, this.basePx) +
              "border-bottom-right-radius:" +
              this.em(this.options.borderRadius, this.basePx) +
              "display:none;font-family:" +
              this.font.family +
              ";font-weight:" +
              this.font.weight +
              ";}#main-desktop {position:absolute;width:" +
              this.em(this.options.width, this.basePx) +
              "height:" +
              this.em(this.options.height, this.basePx) +
              "margin:" +
              this.em(12, this.basePx) +
              "box-shadow:" +
              this.options.boxShadow +
              ";}#main-mobile{width:96%;height:96%;margin:2%;}#background{" +
              this.getBackgroundTypeCSS() +
              "opacity:" +
              (null !== this.options.bgOpacity
                ? this.options.bgOpacity / 100
                : 1) +
              ";width:100%;height:calc(100% - " +
              this.em(45, this.basePx, !0) +
              ");position:absolute;}#background.loading-flex{display:flex;justify-content:center;align-items:center;}#indicator-loading{position:relative;background-color:transparent;border-bottom:" +
              this.em(4, this.basePx, !0) +
              " solid transparent;border-left:" +
              this.em(4, this.basePx, !0) +
              " solid transparent;border-right:" +
              this.em(4, this.basePx, !0) +
              " solid " +
              this.options.chatHeader.bgColor +
              ";border-top:" +
              this.em(4, this.basePx, !0) +
              " solid " +
              this.options.chatHeader.bgColor +
              ";border-radius:100%;height:" +
              this.em(32, this.basePx) +
              "width:" +
              this.em(32, this.basePx) +
              "-webkit-animation:spin 0.6s infinite linear;-moz-animation:spin 0.6s infinite linear;-ms-animation:spin 0.6s infinite linear;-o-animation:spin 0.6s infinite linear;animation:spin 0.6s infinite linear;}@-moz-keyframes spin {from {-moz-transform: rotate(0deg);}to {-moz-transform: rotate(360deg);}}@-webkit-keyframes spin {from {-webkit-transform: rotate(0deg);}to {-webkit-transform: rotate(360deg);}}@keyframes spin {from {transform: rotate(0deg);}to {transform: rotate(360deg);}}#overlay{display:inline-block;position:absolute;z-index:50;width:100%;}#header{text-align:center;height:100%;position:relative;width:100%;line-height:" +
              this.em(this.headerHeight, this.basePx) +
              "}#header.loading{background-color:" +
              this.options.bgColor +
              ";}#header-desktop, #header-mobile{height:" +
              this.em(45, this.basePx) +
              "}#header-text{display:inline-block;width:calc(100% - " +
              this.calcBaseFontSize(140, !0) +
              ");text-align:center;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;}#google-translate-logo{display:block;margin:auto;width:50%;padding-bottom:5px;}.subheader{display:inline-block;position:relative;background-color:" +
              this.options.bgColor +
              ";z-index:50;width:100%;height:" +
              this.em(10, this.basePx) +
              "}#icon-custom,#icon-minimize,#icon-close{cursor:pointer;display:inline-block;position:absolute;margin:0 " +
              this.em(10, this.basePx) +
              "top:50%;width:20px;height:20px;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);}#icon-custom {left:0;width:30px;height:30px;}#icon-custom > svg {width:" +
              this.em(30, this.basePx) +
              "height:" +
              this.em(30, this.basePx) +
              "}#icon-custom > img {width:" +
              this.em(33, this.basePx) +
              "height:" +
              this.em(33, this.basePx) +
              "}#icon-close > svg, #icon-minimize > svg{cursor:pointer;width:" +
              this.em(20, this.basePx) +
              "height:" +
              this.em(20, this.basePx) +
              "}#icon-close > img, #icon-minimize > img{cursor:pointer;width:" +
              this.em(22, this.basePx) +
              "height:" +
              this.em(22, this.basePx) +
              "}#icon-close{right: 0;}#icon-minimize{right:" +
              this.em(32, this.basePx) +
              '}#icon-minimize:after{content:"";position:absolute;width:100%;height:100%;z-index:9000;}.footer-expand #footer{min-height:' +
              this.em(this.footerHeightExpand, this.basePx) +
              "max-height:" +
              this.em(this.footerHeightExpand, this.basePx) +
              "height:" +
              this.em(this.footerHeightExpand, this.basePx) +
              "}.footer-collapse #footer{min-height:" +
              this.em(this.footerHeightCollapse, this.basePx) +
              "max-height:" +
              this.em(this.footerHeightCollapse, this.basePx) +
              "height:" +
              this.em(this.footerHeightCollapse, this.basePx) +
              "}#footer-mobile{position:absolute;bottom:0;width:100%;z-index:1;border-bottom-left-radius:" +
              this.em(this.options.borderRadius, this.basePx) +
              "border-bottom-right-radius:" +
              this.em(this.options.borderRadius, this.basePx) +
              "}#footer-desktop{position:absolute;bottom:0;width:100%;z-index:1;border-bottom-left-radius:" +
              this.em(this.options.borderRadius, this.basePx) +
              "border-bottom-right-radius:" +
              this.em(this.options.borderRadius, this.basePx) +
              "}#logo{position:absolute;left:" +
              this.em(20, this.basePx) +
              "bottom:" +
              this.em(25, this.basePx) +
              "}.logo{max-height:" +
              this.em(35, this.basePx) +
              "max-width:" +
              this.em(70, this.basePx) +
              "}.link-powered-by{height:" +
              this.em(25, this.basePx) +
              "text-align:center;position:absolute;display:block;bottom:0;left:50%;width:" +
              this.em(150, this.basePx) +
              "margin-left:" +
              this.em(-75, this.basePx) +
              "}.powered-by{width:inherit;height:" +
              this.em(25, this.basePx) +
              '}.searchResultCard:first-child {margin-left: 8px}.searchResultCard:last-child {margin-right: 0px}.card-content:hover, .card-link:hover {text-decoration: underline;}.cardExcerptEllipsis {overflow: hidden;position: relative;max-height: 4em;padding-right: 1em;}.cardExcerptEllipsis:before {content: "...";position: absolute;right: 2px;bottom: 0;}.cardExcerptEllipsis:after {content: "";position: absolute;right: 0;width: 1em;height: 1em;margin-top: 0.2em;background: white;}.titleExcerptEllipsis {overflow: hidden;position: relative;max-height: 2em;padding-right: 1em;}.titleExcerptEllipsis:before {content: "...";position: absolute;right: 18px;bottom: 0;}.titleExcerptEllipsis:after {content: "";position: absolute;right: 0;width: 1em;height: 1em;margin-top: 0.2em;background: white;}#prechat {display:none;position:relative;}.prechat-header{background-color:' +
              this.options.prechatHeader.bgColor +
              ";color:" +
              this.options.prechatHeader.fontColor +
              ";font-weight:" +
              this.options.prechatHeader.fontWeight +
              ";height:100%;}.prechat-header-text{font-size:" +
              this.calcBaseFontSize(this.options.prechatHeader.fontSize) +
              "}.prechat-content,.offline-content,.chat-content{padding:" +
              this.em(20, this.basePx) +
              "}.prechat-content,.offline-content{height:calc(100% - " +
              this.em(152, this.basePx, !0) +
              ");overflow-y:auto;}#main-mobile .prechat-content::-webkit-scrollbar, #main-mobile .offline-content::-webkit-scrollbar {-webkit-appearance: none;}#main-mobile .prechat-content::-webkit-scrollbar:vertical, #main-mobile .offline-content::-webkit-scrollbar:vertical {width:" +
              this.em(12, this.basePx) +
              "}#main-mobile .prechat-content::-webkit-scrollbar:horizontal, #main-mobile .offline-content::-webkit-scrollbar:horizontal {height:" +
              this.em(12, this.basePx) +
              "}#main-mobile .prechat-content::-webkit-scrollbar-thumb, #main-mobile .offline-content::-webkit-scrollbar-thumb {background-color: rgba(0, 0, 0, .2);border-radius: 10px;border:" +
              this.em(2, this.basePx, !0) +
              " solid #ffffff;}#main-mobile .prechat-content::-webkit-scrollbar-track, #main-mobile .offline-content::-webkit-scrollbar-track {border-radius:" +
              this.em(10, this.basePx) +
              'background-color: #ffffff; }input[type="button"], input[type="submit"]{-webkit-appearance:none;}.button{display:inline-block;box-sizing: border-box;font-family:' +
              this.font.family +
              ";font-weight:" +
              this.font.weight +
              ";font-size:" +
              this.calcBaseFontSize(10) +
              "bottom:0;position:relative;text-align:center;border:0;border-style:none;cursor:pointer;letter-spacing:" +
              this.em(1, 10) +
              "height:" +
              this.em(35, 10) +
              "white-space: nowrap;overflow: hidden;text-overflow: ellipsis;max-width: 100%;text-transform:uppercase;}.button[disabled]{cursor:not-allowed;}.btn-primary {color:" +
              this.chatPrimaryButton.fontColor +
              ";background-color:" +
              this.chatPrimaryButton.bgColor +
              ";border-style:solid;border-color:" +
              this.chatPrimaryButton.borderColor +
              ";border-width:" +
              this.em(this.chatPrimaryButton.borderWidth, 10) +
              "border-radius:" +
              this.em(this.chatPrimaryButton.borderRadius, 10) +
              "padding:0 " +
              this.em(this.chatPrimaryButton.padding, 10) +
              "}.btn-secondary {color:" +
              this.chatSecondaryButton.fontColor +
              ";background-color:" +
              this.chatSecondaryButton.bgColor +
              ";border-style:solid;border-color:" +
              this.chatSecondaryButton.borderColor +
              ";border-width:" +
              this.em(this.chatSecondaryButton.borderWidth, 10) +
              "border-radius:" +
              this.em(this.chatSecondaryButton.borderRadius, 10) +
              "padding:0 " +
              this.em(this.chatSecondaryButton.padding, 10) +
              "}#buttons-chat-div, #buttons-offline-div, #buttons-prechat-div, #buttons-special-div{float:right;text-align:right;width:calc(100% - " +
              this.calcBaseFontSize(this.options.logoImageUrl ? 115 : 40, !0) +
              ");margin-right:" +
              this.em(20, this.basePx) +
              "}#offline-send-email{float:right;border-style:solid;color:" +
              this.options.offlineSendEmailButton.fontColor +
              ";background-color:" +
              this.options.offlineSendEmailButton.bgColor +
              ";border-color:" +
              this.options.offlineSendEmailButton.borderColor +
              ";border-width:" +
              this.em(this.options.offlineSendEmailButton.borderWidth, 10) +
              "border-radius:" +
              this.em(this.options.offlineSendEmailButton.borderRadius, 10) +
              "padding:0 " +
              this.em(this.options.offlineSendEmailButton.padding, 10) +
              "}#prechat-start-chat{float:right;border-style:solid;color:" +
              this.options.prechatChatButton.fontColor +
              ";background-color:" +
              this.options.prechatChatButton.bgColor +
              ";border-color:" +
              this.options.prechatChatButton.borderColor +
              ";border-width:" +
              this.em(this.options.prechatChatButton.borderWidth, 10) +
              "border-radius:" +
              this.em(this.options.prechatChatButton.borderRadius, 10) +
              "padding:0 " +
              this.em(this.options.prechatChatButton.padding, 10) +
              "}#send{float:right;border-style:solid;color:" +
              this.options.chatSendButton.fontColor +
              ";background-color:" +
              this.options.chatSendButton.bgColor +
              ";border-color:" +
              this.options.chatSendButton.borderColor +
              ";border-width:" +
              this.em(this.options.chatSendButton.borderWidth, 10) +
              "border-radius:" +
              this.em(this.options.chatSendButton.borderRadius, 10) +
              "padding:0 " +
              this.em(this.options.chatSendButton.padding, 10) +
              "}#callme-div{display:none;position:absolute;top:" +
              this.em(45, this.basePx) +
              "width:100%;height:calc(100% - " +
              this.em(45, this.basePx, !0) +
              ");background-color:" +
              (this.options.bgColor ? this.options.bgColor : "#FFF") +
              ";}#callme-submit .button{max-width:65%;}#file-upload{padding:" +
              this.em(5, this.basePx) +
              "display:none;}img.chat-icon{width:" +
              this.em(2, this.basePx) +
              "}#file-input, #hiddenFileUploadIframe{visibility:hidden;position:fixed;}#error-dismiss{width:" +
              this.em(100, this.basePx) +
              "left:calc(100% - " +
              this.em(100, this.basePx, !0) +
              ");}#offline-send-email.button.disabled:disabled, #prechat-start-chat.button.disabled:disabled{background-color:#C1C1C1;}#chat-file-upload, #chat-cancel-file-upload, #warning-cancel-end, #warning-end-chat, #chat-cobrowse-decline,#chat-cobrowse-accept{width:100%;}.wrapper-multi-buttons{justify-content:flex-end;}.multi-button-first, .multi-button-second{overflow:auto;}.multi-button-first{margin-right:" +
              this.em(8, this.basePx) +
              "flex:0 1 auto;}.multi-button-second{max-width:80%;flex:0 0 auto;}.container-buttons-message{margin-bottom:" +
              this.em(5, this.options.visitorMessage.fontSize) +
              "font-size:" +
              this.calcBaseFontSize(this.options.agentMessage.fontSize) +
              "display:flex;flex-flow:column nowrap;align-items:flex-end;}.button-message{font-family:inherit;cursor:pointer;font-weight:inherit;font-size:" +
              this.em(14, this.options.visitorMessage.fontSize) +
              "color:" +
              this.inlineMessagePrimaryButton.fontColor +
              ";margin-bottom:" +
              this.em(5, this.options.visitorMessage.fontSize) +
              "padding:" +
              this.em(10, this.options.visitorMessage.fontSize, !0) +
              " " +
              this.em(14, this.options.visitorMessage.fontSize) +
              "border-radius:" +
              this.em(
                this.inlineMessagePrimaryButton.borderRadius,
                this.options.visitorMessage.fontSize
              ) +
              "border-color:" +
              this.inlineMessagePrimaryButton.borderColor +
              ";border-width:" +
              this.em(
                this.inlineMessagePrimaryButton.borderWidth,
                this.options.visitorMessage.fontSize
              ) +
              "background-color:" +
              this.inlineMessagePrimaryButton.bgColor +
              ";transition: border-color 0.15s, background-color 0.15s, color 0.15s;}.button-message:hover{background-color:" +
              this.inlineMessagePrimaryButton.fontColor +
              ";color:" +
              this.inlineMessagePrimaryButton.bgColor +
              "}.card{box-shadow:0px 3px 6px rgba(0, 0, 0, 0.17);font-size:" +
              this.calcBaseFontSize(this.options.agentMessage.fontSize) +
              "padding:" +
              this.em(16, this.options.agentMessage.fontSize) +
              "margin-top:" +
              this.em(16, this.options.agentMessage.fontSize) +
              "margin-bottom:" +
              this.em(10, this.options.agentMessage.fontSize) +
              "background-color:" +
              (this.options.bgColor ? this.options.bgColor : "#fff") +
              ";}#content-card-email{min-height:" +
              this.em(132, this.options.agentMessage.fontSize) +
              "display: flex;justify-content: center;flex-flow: column;}#text-email-request{margin-bottom:" +
              this.em(10, this.options.agentMessage.fontSize) +
              "font-size:" +
              this.em(16, this.options.agentMessage.fontSize) +
              "color:" +
              this.options.fieldLabelColor +
              ";}#inputarea-email-request{font-size:" +
              this.calcBaseFontSize(this.options.agentMessage.fontSize) +
              "height:" +
              this.em(64, this.options.agentMessage.fontSize) +
              "}#input-email-request{padding:" +
              this.em(8, this.basePx) +
              "font-size:" +
              this.em(16, this.options.agentMessage.fontSize) +
              "width:100%;margin-bottom:" +
              this.em(4, this.options.agentMessage.fontSize) +
              "}#label-wrapper{height:" +
              this.em(10, this.options.agentMessage.fontSize) +
              "}#label-input-email-request{text-transform:uppercase;color:#ce462c;font-size:" +
              this.em(10, this.options.agentMessage.fontSize) +
              "font-weight:400;}#success-email-request{justify-content:center;align-items:center;height:" +
              this.em(64, this.options.agentMessage.fontSize) +
              "}#success-email-request svg{width:40px;height:40px;}form{margin:0;}:invalid{box-shadow: none;}.invalid{border:" +
              this.em(2, this.basePx, !0) +
              " solid #ce462c;}textarea, input{outline:none;resize:none;overflow:auto;font-size:" +
              this.em(14, this.basePx) +
              "color:" +
              this.options.fieldFontColor +
              ";font-family:" +
              this.font.family +
              ";font-weight:" +
              this.font.weight +
              ";background-color:" +
              this.options.fieldBgColor +
              ";border-color:" +
              this.options.fieldBorderColor +
              ";border-style:solid;border-radius:" +
              this.em(this.options.fieldBorderRadius, this.basePx) +
              "border-width:" +
              this.em(this.options.fieldBorderWidth, this.basePx) +
              "}.button:focus {outline: 1px dotted #212121;outline: 5px auto -webkit-focus-ring-color;}label{color:" +
              this.options.fieldLabelColor +
              ";font-family:" +
              this.font.family +
              ";font-weight:" +
              this.font.weight +
              ";font-size:" +
              this.calcBaseFontSize(12) +
              "margin-top:" +
              this.em(9, this.basePx) +
              "line-height:normal;}input[type=text], input[type=email], input[type=tel], select{height:" +
              this.em(46, this.basePx) +
              "}.field-input[type=textarea]{height:" +
              this.em(80, this.basePx) +
              '}.field-input.textarea-tall{height:60%;}input[type="checkbox"]{opacity:0;display:none;}.checkbox-name{font-size:' +
              this.calcBaseFontSize(16) +
              "color:" +
              this.options.fieldLabelColor +
              ";margin-top:" +
              this.em(9, this.basePx) +
              "line-height:" +
              this.em(20, this.basePx) +
              "}.prechat-checkbox-item, .offline-checkbox-item {margin:8px 0;}.prechat-checkbox-label, .offline-checkbox-label{font-family: inherit;font-weight: inherit;color:" +
              this.options.fieldLabelColor +
              ";font-size:" +
              this.calcBaseFontSize(16) +
              'position: relative;cursor: pointer;padding: 0;}.prechat-checkbox-label:before, .offline-checkbox-label:before{box-sizing:border-box;content: "";margin-right:' +
              this.em(8, this.basePx) +
              "display: inline-block;vertical-align: text-top;background:" +
              this.options.fieldBgColor +
              ";width:" +
              this.em(20, this.basePx) +
              "height:" +
              this.em(20, this.basePx) +
              "border:" +
              this.em(this.options.fieldBorderWidth, this.basePx, !0) +
              " solid " +
              this.options.fieldBorderColor +
              ";border-radius:" +
              this.options.fieldBorderRadius +
              "px;}.prechat-checkbox:hover + .prechat-checkbox-label:before, .offline-checkbox:hover + .offline-checkbox-label:before {background:" +
              this.options.fieldPlaceholderColor +
              ";}.prechat-checkbox:checked + .prechat-checkbox-label:before, .offline-checkbox:checked + .offline-checkbox-label:before {background:" +
              this.options.fieldBgColor +
              ';}.prechat-checkbox-label:after,.offline-checkbox-label:after{content:"";position:absolute;}.prechat-checkbox:checked + .prechat-checkbox-label:after, .offline-checkbox:checked + .offline-checkbox-label:after{box-sizing:border-box;content:"";position:absolute;left:' +
              this.em(7, this.basePx) +
              "top:" +
              this.em(2, this.basePx) +
              "transform:rotate(45deg);width:6px;border-bottom:" +
              this.em(1, this.basePx, !0) +
              " solid " +
              this.options.fieldFontColor +
              ";height:" +
              this.em(13, this.basePx) +
              "border-right:" +
              this.em(1, this.basePx, !0) +
              " solid " +
              this.options.fieldFontColor +
              ";}input.prechat-checkbox.invalid + .prechat-checkbox-label:before, input.offline-checkbox.invalid + .offline-checkbox-label:before{border:" +
              this.em(2, this.basePx, !0) +
              " solid #ce462c;}.prechat-textinput::-webkit-input-placeholder,.offline-textinput::-webkit-input-placeholder,.prechat-textarea::-webkit-input-placeholder,.offline-textarea::-webkit-input-placeholder{#input-email-requestcolor:" +
              this.options.fieldPlaceholderColor +
              ";}.prechat-textinput-label, .offline-textinput-label{display:inline-block;}.prechat-textinput,.offline-textinput,.prechat-textarea,.offline-textarea{padding:" +
              this.em(8, this.basePx) +
              "margin:" +
              this.em(4, this.basePx, !0) +
              " 0;width:100%;}.prechat-textarea-label, .offline-textarea-label{display:inline-block;}span.dropdown{display:inline-block;vertical-align:middle;position:relative;width:100%;}.prechat-dropdown, .offline-dropdown{height:" +
              this.em(40, this.basePx) +
              "font-size:" +
              this.calcBaseFontSize(16) +
              "font-family: inherit;font-weight: inherit;color:" +
              this.options.fieldFontColor +
              ";line-height:normal;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;width:100%;display:block;border-style:solid;border-radius:" +
              this.em(this.options.fieldBorderRadius, this.basePx) +
              "border-width:" +
              this.em(this.options.fieldBorderWidth, this.basePx) +
              "border-color:" +
              this.options.fieldBorderColor +
              ";background-color:" +
              this.options.fieldBgColor +
              ";box-sizing:border-box;padding:" +
              this.em(9, this.basePx) +
              "margin:" +
              this.em(4, this.basePx, !0) +
              " 0;outline:none;}select.invalid{border:" +
              this.em(2, this.basePx, !0) +
              " solid #ce462c;}span.dropdown select:focus {background" +
              this.options.fieldBgColor +
              ";outline:none;box-shadow:0 0 " +
              this.em(10, this.basePx, !0) +
              " rgba(255, 153, 0, 0.3), inset 0 0 " +
              this.em(7, this.basePx, !0) +
              " rgba(100,100,100,0.3);border-color:" +
              this.options.fieldBorderColor +
              ';}span.dropdown ::-ms-expand {display:none;}span.dropdown:after{content:"";position:absolute;z-index:2;right:' +
              this.em(8, this.basePx) +
              "top:50%;margin-top:" +
              this.em(-3, this.basePx) +
              "height:0;width:0;border-top:" +
              this.em(6, this.basePx, !0) +
              " solid " +
              this.options.fieldBorderColor +
              ";border-left:" +
              this.em(6, this.basePx, !0) +
              " solid transparent;border-right:" +
              this.em(6, this.basePx, !0) +
              " solid transparent;pointer-events:none;}span.dropdown.rtl:after{right: calc(100% - " +
              this.em(28, this.basePx, !0) +
              ");}.prechat-dropdown-label, .offline-dropdown-label{display:inline-block;}.label-freeform{margin:" +
              this.em(10, this.basePx, !0) +
              " 0;}.prechat-label-freeform, .offline-label-freeform{margin:0;font-size:" +
              this.calcBaseFontSize(16) +
              "display: inline-block;position: relative;}.prechat-file-upload, .offline-file-upload{}.required-symbol{padding-left:" +
              this.em(5, this.basePx) +
              "color:#ce462c;font-size:" +
              this.calcBaseFontSize(14) +
              "}::-webkit-input-placeholder{color:" +
              this.options.fieldPlaceholderColor +
              ";font-size:" +
              this.calcBaseFontSize(16) +
              "}*:-moz-placeholder {color:" +
              this.options.fieldPlaceholderColor +
              ";font-size:" +
              this.calcBaseFontSize(16) +
              "}*::-moz-placeholder {color:" +
              this.options.fieldPlaceholderColor +
              ";font-size:" +
              this.calcBaseFontSize(16) +
              "}*:-ms-input-placeholder{color:" +
              this.options.fieldPlaceholderColor +
              ";font-size:" +
              this.calcBaseFontSize(16) +
              "}#offline {display:none;position:relative;}.offline-header{background-color:" +
              this.options.offlineHeader.bgColor +
              ";color:" +
              this.options.offlineHeader.fontColor +
              ";font-weight:" +
              this.options.offlineHeader.fontWeight +
              ";height:100%;}.offline-header-text{font-size:" +
              this.calcBaseFontSize(this.options.offlineHeader.fontSize) +
              "}#chat {display:none;}.chat-header{background-color:" +
              this.options.chatHeader.bgColor +
              ";color:" +
              this.options.chatHeader.fontColor +
              ";font-weight:" +
              this.options.chatHeader.fontWeight +
              ";width:100%;}.chat-header-text{font-size:" +
              this.calcBaseFontSize(this.options.chatHeader.fontSize) +
              "}#textarea-div{font-size:" +
              this.calcBaseFontSize(this.options.chatTextarea.fontSize) +
              "position:absolute;bottom:" +
              this.em(30, this.options.chatTextarea.fontSize) +
              "width:calc(100% - " +
              this.em(40, this.options.chatTextarea.fontSize, !0) +
              ");margin:0px 20px;display:inline;}#textarea-div.rtl{right:0;}.text-entry{background-color:" +
              this.options.chatTextarea.bgColor +
              ";color:" +
              this.options.chatTextarea.fontColor +
              ";font-size:" +
              this.calcBaseFontSize(this.options.chatTextarea.fontSize) +
              "padding-top:" +
              this.em(
                this.options.chatTextarea.padding,
                this.options.chatTextarea.fontSize
              ) +
              "padding-bottom:" +
              this.em(
                this.options.chatTextarea.padding,
                this.options.chatTextarea.fontSize
              ) +
              "padding-left:" +
              this.em(
                this.options.chatTextarea.padding,
                this.options.chatTextarea.fontSize
              ) +
              "padding-right:" +
              this.em(32, this.options.chatTextarea.fontSize) +
              "width:100%;border-top:" +
              this.em(
                this.options.chatTextarea.borderWidth,
                this.options.chatTextarea.fontSize
              ) +
              "border-right:" +
              (this.options.chatTextarea.isTopBorderOnly
                ? "0;"
                : this.em(
                    this.options.chatTextarea.borderWidth,
                    this.options.chatTextarea.fontSize
                  )) +
              "border-bottom:" +
              (this.options.chatTextarea.isTopBorderOnly
                ? "0;"
                : this.em(
                    this.options.chatTextarea.borderWidth,
                    this.options.chatTextarea.fontSize
                  )) +
              "border-left:" +
              (this.options.chatTextarea.isTopBorderOnly
                ? "0;"
                : this.em(
                    this.options.chatTextarea.borderWidth,
                    this.options.chatTextarea.fontSize
                  )) +
              "border-radius:" +
              this.em(
                this.options.chatTextarea.borderRadius,
                this.options.chatTextarea.fontSize
              ) +
              "border-color:" +
              this.options.chatTextarea.borderColor +
              ";border-style:solid;display:block;height:" +
              this.em(
                this.textEntryHeight,
                this.options.chatTextarea.fontSize
              ) +
              "bottom:0;}.text-entry.actionarea{padding-right:" +
              this.em(32, this.options.chatTextarea.fontSize) +
              "}#action-area-chat{display:flex;flex-flow:column nowrap;width:" +
              this.em(32, this.options.chatTextarea.fontSize) +
              "height:" +
              this.em(64, this.options.chatTextarea.fontSize) +
              "position:absolute;top:0;right:0;margin:" +
              this.em(8, this.options.chatTextarea.fontSize, !0) +
              " 0;}.action-item{cursor:pointer;align-items:center;justify-content:center;fill:" +
              this.options.chatSendButton.bgColor +
              ";width:" +
              this.em(24, this.options.chatTextarea.fontSize) +
              "height:" +
              this.em(24, this.options.chatTextarea.fontSize) +
              "align-self:center;margin-bottom:" +
              this.em(8, this.options.chatTextarea.fontSize) +
              "}.action-item:last-of-type {margin-bottom:0;}#action-area-chat svg{fill-rule:evenodd;clip-rule:evenodd;}#action-item-menu{position:relative;}#action-item-menu svg{fill:" +
              this.options.chatSendButton.bgColor +
              ";transform:rotate(0deg);transition:fill 0.2s linear, transform 0.1s linear;}#action-item-menu:hover svg{fill:#949494;transition:fill 0.2s linear, transform 0.1s linear;;}#action-item-menu.open svg{transform:rotate(90deg);transition:transform 0.1s linear;}.menu-list{position:absolute;list-style-type:none;padding: 0;background-color:" +
              (this.options.bgColor ? this.options.bgColor : "#fdfdfd") +
              ";white-space:nowrap;}.menu-list.bottom{bottom:" +
              this.em(8, this.options.chatTextarea.fontSize) +
              "}#action-item-menu .menu-list{right:0;font-size:" +
              this.calcBaseFontSize(16) +
              "}#action-item-menu li{color:" +
              this.options.fieldLabelColor +
              ";padding:" +
              this.em(16, this.options.chatTextarea.fontSize) +
              "transition:all 0.1s ease-in;cursor:pointer;}#action-item-menu li:hover, #action-item-menu li:focus{background-color:" +
              this.chatPrimaryButton.bgColor +
              ";transition:all 0.1s ease-in;color:" +
              this.chatPrimaryButton.fontColor +
              ";}#textarea-div.bottom-position{bottom:" +
              this.em(
                this.footerHeightExpand,
                this.options.chatTextarea.fontSize
              ) +
              "margin-bottom:8px;}.messages-expand + textarea-div.bottom-position{bottom:0;}.text-entry::-webkit-input-placeholder{color:" +
              this.options.chatTextarea.placeholderColor +
              ";}.text-entry::-moz-placeholder{color:" +
              this.options.chatTextarea.placeholderColor +
              ";}.text-entry:-ms-input-placeholder{color:" +
              this.options.chatTextarea.placeholderColor +
              ";}.text-entry:-moz-placeholder{color:" +
              this.options.chatTextarea.placeholderColor +
              ";}#button-error-dismiss{position:relative;bottom:1;}.messages-content{position:absolute;left:0;padding:" +
              this.em(20, this.basePx) +
              "padding-bottom:0;width:100%;overflow-x:hidden;overflow-y:scroll;font-family:" +
              this.font.family +
              ";font-weight:" +
              this.font.weight +
              ";box-sizing:border-box;}.messages-content::-webkit-scrollbar {display:none;width: 0 !important;}.messages-expand{height:" +
              this.calcMessagesHeight("messages-expand") +
              "}.messages-notextarea{height:" +
              this.calcMessagesHeight("messages-notextarea") +
              "}.messages-notextarea-with-expand{height:" +
              this.calcMessagesHeight("messages-notextarea-with-expand") +
              "}.messages-collapse{height:" +
              this.calcMessagesHeight("messages-collapse") +
              "}.container-agent-message-bubble, .container-visitor-message-bubble{display:block;overflow:hidden;position:relative;width:100%;}.container-agent-message, .container-agent-message-bubble{font-size:" +
              this.calcBaseFontSize(this.options.agentMessage.fontSize) +
              "margin-bottom:" +
              this.em(5, this.options.agentMessage.fontSize) +
              "}.container-visitor-message, .container-visitor-message-bubble{font-size:" +
              this.calcBaseFontSize(this.options.visitorMessage.fontSize) +
              "margin-bottom:" +
              this.em(5, this.options.visitorMessage.fontSize) +
              "}.container-agent-message, .container-visitor-message{display:block;overflow:hidden;}.message-text{word-wrap:break-word;overflow-wrap:break-word;}.agent-message > .message-text, .agent-message-bubble > .message-text{padding:" +
              this.em(10, this.options.agentMessage.fontSize, !0) +
              " " +
              this.em(14, this.options.agentMessage.fontSize) +
              "line-height:" +
              this.em(20, this.options.agentMessage.fontSize) +
              "}.visitor-message > .message-text, .visitor-message-bubble > .message-text{padding:" +
              this.em(10, this.options.visitorMessage.fontSize, !0) +
              " " +
              this.em(14, this.options.visitorMessage.fontSize) +
              "line-height:" +
              this.em(20, this.options.visitorMessage.fontSize) +
              "}.link-message{cursor:pointer;}.message-text a{text-decoration:" +
              (this.options.linkUnderlined ? "underline" : "none") +
              ";}.message-text a:link{color:" +
              this.options.linkDefaultColor +
              ";}.message-text a:visited{color:" +
              this.options.linkVisitedColor +
              ";}.message-text a:hover{color:" +
              this.options.linkHoverColor +
              ";}.message-text a:active{color:" +
              this.options.linkActiveColor +
              ";}.agent-message{background-color:" +
              this.options.agentMessage.bgColor +
              ";border-width:" +
              this.em(
                this.options.agentMessage.borderWidth,
                this.options.agentMessage.fontSize
              ) +
              "border-color:" +
              this.options.agentMessage.borderColor +
              ";border-style:solid;border-radius:" +
              this.em(
                this.options.agentMessage.borderRadius,
                this.options.agentMessage.fontSize
              ) +
              "color:" +
              this.options.agentMessage.fontColor +
              ";min-height:" +
              this.em(60, this.options.agentMessage.fontSize) +
              "}.visitor-message, .visitor-message-bubble{min-height:" +
              this.em(
                this.messageMinHeight,
                this.options.visitorMessage.fontSize
              ) +
              "}.agent-message.full, .agent-message-bubble.full{margin: 0 0 " +
              this.em(10, this.options.agentMessage.fontSize, !0) +
              " 0;margin-left:0;min-height:" +
              this.em(
                this.messageMinHeight,
                this.options.agentMessage.fontSize
              ) +
              "border-radius:" +
              this.em(
                this.options.agentMessage.borderRadius,
                this.options.agentMessage.fontSize
              ) +
              "max-width:100%;min-width:100%;width:100%;box-sizing:border-box;}.agent-message.no-avatar, .agent-message-bubble.no-avatar{margin-left:0;}.no-avatar.agent-message-bubble.rtl{margin: 0;}.agent-message-bubble{min-height:" +
              this.em(
                this.messageMinHeight,
                this.options.agentMessage.fontSize
              ) +
              "max-width:calc(100% - " +
              this.em(50, this.options.agentMessage.fontSize, !0) +
              ");float:left;margin-left:" +
              this.em(50, this.options.agentMessage.fontSize) +
              "background-color:" +
              this.options.agentMessage.bgColor +
              ";border-style:solid;border-width:" +
              this.em(
                this.options.agentMessage.borderWidth,
                this.options.agentMessage.fontSize
              ) +
              "border-color:" +
              this.options.agentMessage.borderColor +
              ";border-top-left-radius:" +
              this.em(
                this.options.agentMessage.borderRadius,
                this.options.agentMessage.fontSize
              ) +
              "border-top-right-radius:" +
              this.em(
                this.options.agentMessage.borderRadius,
                this.options.agentMessage.fontSize
              ) +
              "border-bottom-left-radius:0;border-bottom-right-radius:" +
              this.em(
                this.options.agentMessage.borderRadius,
                this.options.agentMessage.fontSize
              ) +
              "color:" +
              this.options.agentMessage.fontColor +
              ";max-width:75%;}.agent-message-bubble:nth-child(n+3), .agent-message-bubble.no-avatar:nth-child(n+2){border-top-left-radius:0;margin-top:" +
              this.em(5, this.options.agentMessage.fontSize) +
              "clear:both}.agent-message-bubble:nth-child(n+3):nth-last-child(2), .agent-message-bubble.no-avatar:nth-child(n+2):nth-last-child(2){border-bottom-left-radius:" +
              this.em(
                this.options.agentMessage.borderRadius,
                this.options.agentMessage.fontSize
              ) +
              "}.visitor-message{line-height:" +
              this.em(15.75, this.options.visitorMessage.fontSize) +
              "background-color:" +
              this.options.visitorMessage.bgColor +
              ";border-width:" +
              this.em(
                this.options.visitorMessage.borderWidth,
                this.options.visitorMessage.fontSize
              ) +
              "border-color:" +
              this.options.visitorMessage.borderColor +
              ";border-radius:" +
              this.em(
                this.options.visitorMessage.borderRadius,
                this.options.visitorMessage.fontSize
              ) +
              "border-style:solid;color:" +
              this.options.visitorMessage.fontColor +
              ";}.visitor-message-bubble{background-color:" +
              this.options.visitorMessage.bgColor +
              ";border-style:solid;border-width:" +
              this.em(
                this.options.visitorMessage.borderWidth,
                this.options.visitorMessage.fontSize
              ) +
              "border-color:" +
              this.options.visitorMessage.borderColor +
              ";border-top-left-radius:" +
              this.em(
                this.options.visitorMessage.borderRadius,
                this.options.visitorMessage.fontSize
              ) +
              "border-top-right-radius:" +
              this.em(
                this.options.visitorMessage.borderRadius,
                this.options.visitorMessage.fontSize
              ) +
              "border-bottom-left-radius:" +
              this.em(
                this.options.visitorMessage.borderRadius,
                this.options.visitorMessage.fontSize
              ) +
              "border-bottom-right-radius:0;color:" +
              this.options.visitorMessage.fontColor +
              ";float:right;max-width:85%;}.visitor-message-bubble:not(:first-child){border-top-right-radius:0;margin-top:" +
              this.em(5, this.options.visitorMessage.fontSize) +
              "clear:both}.visitor-message-bubble:nth-child(n+2):nth-last-child(2){border-bottom-right-radius:" +
              this.em(
                this.options.visitorMessage.borderRadius,
                this.options.visitorMessage.fontSize
              ) +
              "}.visitor-details{width:" +
              this.em(100, this.options.visitorMessage.fontSize) +
              "float:right;}.visitor-details-bubble{clear:both;}.agent-details, .agent-details-bubble{height:" +
              this.em(
                this.messageMinHeight,
                this.options.agentMessage.fontSize
              ) +
              "width:" +
              this.em(
                this.messageMinHeight,
                this.options.agentMessage.fontSize
              ) +
              "}.agent-details{position:relative;float:left;overflow:hidden;margin:" +
              this.em(10, this.options.agentMessage.fontSize, !0) +
              " " +
              this.em(14, this.options.agentMessage.fontSize, !0) +
              " " +
              this.em(1, this.options.agentMessage.fontSize, !0) +
              " " +
              this.em(14, this.options.agentMessage.fontSize) +
              "border-radius:" +
              this.em(
                this.options.agentMessage.avatarBorderRadius,
                this.basePx
              ) +
              "}.agent-message.close-warning, .agent-message.offline-message{padding:0}.agent-details-bubble{bottom:" +
              this.em(18, this.basePx) +
              "position: absolute;}img.agent-avatar {display:inline;margin:0 auto;height:100%;width:auto;border-radius:" +
              this.em(
                this.options.agentMessage.avatarBorderRadius,
                this.options.agentMessage.fontSize
              ) +
              "}.agent-alias, .visitor-alias{margin:" +
              this.em(5, this.basePx, !0) +
              " 0 0;position:relative;color:#949494;font-size:" +
              this.calcBaseFontSize(11) +
              "font-weight:" +
              this.font.weight +
              ";text-overflow:ellipsis;min-height:" +
              this.em(18, this.basePx) +
              "display:inline-block;}.visitor-alias{float:right;}.agent-alias{clear:both;float:left;}.agent-message-bubble.rtl{float:right;margin-left:0;margin-right:" +
              this.em(50, this.options.agentMessage.fontSize) +
              "border-bottom-right-radius:0;border-bottom-left-radius:" +
              this.em(
                this.options.agentMessage.borderRadius,
                this.options.agentMessage.fontSize
              ) +
              "}.agent-message-bubble.rtl:nth-child(n+3), .agent-message-bubble.no-avatar.rtl:nth-child(n+2){border-top-right-radius:0;border-top-left-radius:" +
              this.em(
                this.options.agentMessage.borderRadius,
                this.options.agentMessage.fontSize
              ) +
              "margin-top:" +
              this.em(5, this.options.agentMessage.fontSize) +
              "clear:both}.agent-message-bubble.rtl:nth-child(n+3):nth-last-child(2), .agent-message-bubble.rtl.no-avatar:nth-child(n+2):nth-last-child(2){border-bottom-right-radius:" +
              this.em(
                this.options.agentMessage.borderRadius,
                this.options.agentMessage.fontSize
              ) +
              "}.agent-details.rtl{float:right;}.visitor-message-bubble.rtl{border-bottom-right-radius:" +
              this.em(
                this.options.visitorMessage.borderRadius,
                this.options.visitorMessage.fontSize
              ) +
              "border-bottom-left-radius:0;}.visitor-message-bubble.rtl:not(:first-child){border-top-left-radius:0;border-top-right-radius:" +
              this.em(
                this.options.visitorMessage.borderRadius,
                this.options.visitorMessage.fontSize
              ) +
              "margin-top:" +
              this.em(5, this.options.visitorMessage.fontSize) +
              "clear:both}.visitor-message-bubble.rtl:nth-child(n+2):nth-last-child(2){border-bottom-left-radius:" +
              this.em(
                this.options.visitorMessage.borderRadius,
                this.options.visitorMessage.fontSize
              ) +
              "}.visitor-details-bubble.rtl, .visitor-message-bubble.rtl{float:left;}.visitor-details.rtl{float:left;width:initial;}.agent-alias.rtl{float:right;}.long-alias{left:0;width:100%;}.short-alias{text-align:center;width:" +
              this.messageMinHeight / this.helpers.getScale() +
              "px;}object, svg, svg:root{pointer-events:none;width:100%;}#icon-custom > object{width:85%;}#icon-minimize > object{left:0;width:85%;}#icon-close > object{right:0;width:85%;}#message-error{z-index:1;position:absolute;top:0;left:0;padding:" +
              this.em(20, this.options.agentMessage.fontSize) +
              "width:calc(100% - " +
              this.em(40, this.options.agentMessage.fontSize, !0) +
              ");height:calc(100% - " +
              this.em(40, this.options.agentMessage.fontSize, !0) +
              ");background-color:rgba(147,147,147,0.5);}.agent-message.error-message{position: relative;top: 50%;left: 50%;transform: translate(-50%, -50%);padding:0;}.message-error-text{color:" +
              this.options.agentMessage.fontColor +
              ";}#post-chat-content{text-align:center;font-size:" +
              this.calcBaseFontSize(12) +
              "overflow-x:none;overflow-y:auto;-webkit-overflow-scrolling:touch;min-height:50%;}#post-chat-content .card{margin: 12px 6px;}#post-chat-content #wrapper-email-request{text-align:left;}#post-chat-content > iframe{height:100%;}#surveyQuestion, #chatSurveyRatingText{font-family:" +
              this.font.family +
              ";font-weight:" +
              this.font.weight +
              ";}#chatSurveyRating{margin-top:" +
              this.em(8, this.options.agentMessage.fontSize) +
              "height:" +
              this.em(40, this.options.agentMessage.fontSize) +
              "}#endchat-timer-helper-text{color:#999999;margin:" +
              this.em(12, this.options.agentMessage.fontSize) +
              "}.survey-rating-img{width:" +
              this.em(32, this.options.agentMessage.fontSize) +
              "height:" +
              this.em(32, this.options.agentMessage.fontSize) +
              "cursor:pointer;}#chatSurveyRatingText{height:" +
              this.em(10, this.options.agentMessage.fontSize) +
              "line-height:" +
              this.em(10, this.options.agentMessage.fontSize) +
              "}#chatSurveyCommentsContainer{padding:" +
              this.em(5, this.options.agentMessage.fontSize) +
              "display:none;}#chatSurveyComments{margin:" +
              this.em(5, this.options.agentMessage.fontSize, !0) +
              " 0 " +
              this.em(18, this.options.agentMessage.fontSize, !0) +
              ";height:140px;width:100%;padding:" +
              this.em(5, this.options.agentMessage.fontSize) +
              "resize:none;outline:none;border:" +
              this.em(
                this.options.fieldBorderWidth,
                this.options.agentMessage.fontSize,
                !0
              ) +
              " solid " +
              this.options.fieldBorderColor +
              ";border-radius:" +
              this.em(
                this.options.borderRadius,
                this.options.agentMessage.fontSize
              ) +
              "font-family:" +
              this.font.family +
              ";font-weight:" +
              this.font.weight +
              ";font-size:" +
              this.calcBaseFontSize(this.options.agentMessage.fontSize) +
              'font-style:normal;line-height:normal;box-sizing:border-box}#chatSurveyComments[disabled="true"]{background-color:#F4F4F4;}#iframe-chatSurveyCustomContainer{width:100%;border:none;}#container-intelliPrechat{height:calc(100% - ' +
              this.em(105, this.basePx, !0) +
              ");width:100%;position:absolute;top:" +
              this.em(45, this.basePx) +
              "background-color:" +
              this.options.bgColor +
              ";}#form-intelliPrechatSearchQuestionForm{height:" +
              this.em(102, this.basePx) +
              "margin:" +
              this.em(10, this.basePx, !0) +
              " " +
              this.em(20, this.basePx, !0) +
              " 0;width:calc(100% - " +
              this.em(40, this.basePx, !0) +
              ");}label#ele-intelliPrechatSearchLabel{display:block;margin:0;}#input-intelliPrechatQuestion{width:100%;margin:" +
              this.em(5, this.basePx, !0) +
              " auto;padding:" +
              this.em(5, this.basePx) +
              "}#submit-intelliPrechatQuestion{margin-top:" +
              this.em(5, this.basePx) +
              "float:right;border-style:solid;color:" +
              this.chatPrimaryButton.fontColor +
              ";background-color:" +
              this.chatPrimaryButton.bgColor +
              ";background-clip:padding-box;border-color:" +
              this.chatPrimaryButton.borderColor +
              ";border-width:" +
              this.em(this.chatPrimaryButton.borderWidth, 10) +
              "border-radius:" +
              this.em(this.chatPrimaryButton.borderRadius, 10) +
              "padding:0 " +
              this.em(this.chatPrimaryButton.padding, 10) +
              "}ele-intelliPrechatSearchLoading{position:absolute;width:100%;top:" +
              this.em(200, this.basePx) +
              "}#img-loading{position:absolute;left:50%;top:50%;margin-left:" +
              this.em(-15, this.basePx) +
              "margin-top:" +
              this.em(-15, this.basePx) +
              "}#ul-intelliPrechatResults{display:block;list-style-type:none;padding:0;margin:0;height:100%;}.li-intelliPrechatResults{font-size:" +
              this.calcBaseFontSize(12) +
              "padding:" +
              this.em(15, 12) +
              "margin-bottom:" +
              this.em(10, 12) +
              "background-color:" +
              this.options.agentMessage.bgColor +
              ";border-color:" +
              this.options.agentMessage.borderColor +
              ";border-style:solid;border-width:" +
              this.em(this.options.agentMessage.borderWidth, 12) +
              "border-radius:" +
              this.em(this.options.agentMessage.borderRadius, 12) +
              "color:" +
              this.options.agentMessage.fontColor +
              ";}.li-intelliPrechatResults:last-child{margin-bottom:0;}#img-doc{width:" +
              this.em(12, this.basePx) +
              "}#ele-intelliPrechatResultsHeader, .intelliPrechat_title{font-weight:400;margin-bottom:" +
              this.em(5, this.basePx) +
              "}.intelliPrechat_title, .intelliPrechat_summary{color:" +
              this.options.agentMessage.fontColor +
              ";}.intelliPrechat_title{font-size:" +
              this.calcBaseFontSize(13) +
              "margin-left:" +
              this.em(5, 13) +
              "display:inline;}.intelliPrechat_title.rtl{margin-left:0;margin-right:" +
              this.em(5, 13) +
              "}#container-intelliPrechatResults{overflow-y:auto;height:calc(100% - " +
              this.em(125, this.basePx, !0) +
              ");width:calc(100% - " +
              this.em(40, this.basePx, !0) +
              ");padding:0 " +
              this.em(20, this.basePx) +
              "}#intelliprechat-next{border-style:solid;color:" +
              this.chatPrimaryButton.fontColor +
              ";background-color:" +
              this.chatPrimaryButton.bgColor +
              ";background-clip:padding-box;border-color:" +
              this.chatPrimaryButton.borderColor +
              ";border-width:" +
              this.em(this.chatPrimaryButton.borderWidth, 10) +
              "border-radius:" +
              this.em(this.chatPrimaryButton.borderRadius, 10) +
              "padding:0 " +
              this.em(this.chatPrimaryButton.padding, 10) +
              "}input::-moz-focus-inner{border:0;padding:0;}.wrapper--progress{height:" +
              this.em(19.5, this.basePx) +
              ";}.agent-line-typing, .visitor-line-upload{display:inline-block;width:" +
              this.em(8, this.basePx) +
              "height:" +
              this.em(8, this.basePx) +
              "border-radius:" +
              this.em(8, this.basePx) +
              "margin:0 " +
              this.em(2, this.basePx) +
              ";}.agent-line-typing, .line-upload{background-color:" +
              this.options.agentMessage.fontColor +
              ";opacity:0.7;}.visitor-line-upload{background-color:" +
              this.options.visitorMessage.fontColor +
              ";opacity:0.7;}.agent-line-typing:nth-last-child(3), .visitor-line-upload:nth-last-child(3){animation:progress .8s .3s linear infinite;}.agent-line-typing:nth-last-child(2), .visitor-line-upload:nth-last-child(2){animation:progress .8s .2s linear infinite;}.agent-line-typing:nth-last-child(1), .visitor-line-upload:nth-last-child(1){animation:progress .8s .1s linear infinite;}@keyframes progress {0 {transform:translate(0,0);}50% {transform:translate(0," +
              Math.round(8 / this.scale) +
              "px);100% {transform:translate(0,0);} }</style>"
            );
          },
          customSurveyStylesheet: function () {
            return '<style type="text/css">html, body{margin:0;padding:0;border:0;-ms-overflow-style: -ms-autohiding-scrollbar;}</style>';
          },
        }),
          (t.chat_custom_design = t.chat_custom_design || {}),
          (t.chat_custom_design.Style = i);
      })(window);
      !(function (e) {
        function t(t, i) {
          (this.options = t),
            (this.target = i),
            (this.helpers =
              this.helpers ||
              new e.chat_custom_design.Helpers(this.options, this.target)),
            (this.stylesheet =
              this.stylesheet ||
              new e.chat_custom_design.Style(this.options, this.helpers)),
            (this.isMobile = this.helpers.isMobileDevice()),
            (this.isVisible = !1),
            (this.clickCounter = 0),
            (this.fontFrameContext =
              "designstudio-frame" + (this.target ? "-" + this.target : ""));
        }
        (t.prototype = {
          bind: function (t, i) {
            var n = this;
            "windowBlur" === t
              ? e.addEventListener("blur", function () {
                  i();
                })
              : "windowFocus" === t
              ? e.addEventListener("focus", function () {
                  i();
                })
              : "minimizeIconClick" === t
              ? (n.minimizeIcon.addEventListener("click", function () {
                  i();
                }),
                n.minimizeIcon.addEventListener("keydown", function (e) {
                  (13 !== e.keyCode && 32 !== e.keyCode) || i();
                }))
              : "closeIconClick" === t
              ? (n.closeIcon.addEventListener("click", function () {
                  n.clickCounter++, i(n.clickCounter);
                }),
                n.closeIcon.addEventListener("keydown", function (e) {
                  (13 !== e.keyCode && 32 !== e.keyCode) ||
                    (n.clickCounter++, i(n.clickCounter));
                }))
              : "escapeKeyClose_iframe" === t
              ? this.iframe.addEventListener("keyup", function (e) {
                  n.isVisible &&
                    27 === e.keyCode &&
                    (e.stopPropagation(), n.clickCounter++, i(n.clickCounter));
                })
              : "mouseDown" === t
              ? n.designstudio.addEventListener("mousedown", function (e) {
                  i(e);
                })
              : "mouseMove" === t
              ? document.addEventListener("mousemove", function (e) {
                  i(e);
                })
              : "mouseUp" === t &&
                (document.addEventListener("mouseup", function () {
                  i();
                }),
                this.iframe.addEventListener("mouseup", function (e) {
                  i(e);
                }));
          },
          postBind: function (e, t) {
            "dismissErrorClick" === e &&
              this.iframe
                .getElementById("message-error")
                .addEventListener("click", function () {
                  t();
                });
          },
          addIpadScrollingListener: function (t, i) {
            "ipadScrollListener" === t &&
              ((this.iosTouchMove = !1),
              e.addEventListener(
                "touchmove",
                function (t) {
                  (!this.getIsVisible() && t.pageY > e.innerHeight) ||
                    (this.iosTouchMove = !0);
                }.bind(this)
              ),
              e.addEventListener(
                "touchend",
                function () {
                  this.isScrolling,
                    this.getIsVisible() &&
                      e.addEventListener(
                        "scroll",
                        this.iPadScrollListener.bind(this, i),
                        !1
                      );
                }.bind(this)
              ));
          },
          iPadScrollListener: function (t) {
            SnapEngage.getCustomDesignUI().mainView.getIsVisible() &&
              this.iosTouchMove &&
              ((this.iosTouchMove = !1),
              e.clearTimeout(this.isScrolling),
              (this.isScrolling = setTimeout(
                function () {
                  t(e.scrollY),
                    e.removeEventListener("scroll", this.iPadScrollListener);
                }.bind(this),
                150
              )));
          },
          setFontConfig: function () {
            e.chat_custom_design.FontConfig.prototype.injectFontLoader({
              context: this.fontFrameContext,
              view: this,
              options: this.options,
            });
          },
          render: function () {
            if (
              (this.helpers.isInsideGWT()
                ? document
                    .getElementById(this.target)
                    .children[0].appendChild(this.iframeTemplate())
                : ((this.popover = this.template()),
                  document.body.appendChild(this.popover),
                  this.popover.appendChild(this.iframeTemplate())),
              (this.overlay = this.overlayTemplate()),
              (this.main = this.mainTemplate(this.isMobile)),
              (this.header = this.headerTemplate()),
              (this.background = this.backgroundTemplate()),
              (this.prechat = this.prechatTemplate()),
              (this.offline = this.offlineTemplate()),
              (this.chat = this.chatTemplate()),
              (this.footer = this.footerTemplate()),
              (this.callme = this.callmeTemplate()),
              this.main.appendChild(this.overlay),
              this.main.appendChild(this.header),
              this.main.appendChild(this.background),
              this.main.appendChild(this.prechat),
              this.main.appendChild(this.offline),
              this.main.appendChild(this.chat),
              this.main.appendChild(this.footer),
              this.main.appendChild(this.callme),
              this.helpers.isInsideGWT() && !this.isMobile)
            ) {
              var e = document.getElementById(this.helpers.getIframeId())
                  .clientWidth,
                t = document.getElementById(this.helpers.getIframeId())
                  .clientHeight,
                i = this.stylesheet.getPlacementInsidePreview(
                  this.options.placement,
                  this.options.height,
                  this.options.width,
                  t,
                  e
                );
              this.main.setAttribute("style", i);
            }
            (this.iframe = document.getElementById(
              this.helpers.getIframeId()
            ).contentWindow.document),
              this.iframe.open(),
              this.iframe.write(this._headerDetailsViewport()),
              this.iframe.write(this.stylesheet.iframeStylesheet()),
              this.iframe.write(this.main.outerHTML),
              this.iframe.close(),
              this.helpers.setDomLanguageDirection(this.iframe),
              (this.minimizeIcon = this.iframe.getElementById("icon-minimize")),
              (this.closeIcon = this.iframe.getElementById("icon-close")),
              (this.customIcon = this.iframe.getElementById("icon-custom")),
              (this.header = this.iframe.getElementById("header")),
              (this.offline = this.iframe.getElementById("offline")),
              (this.prechat = this.iframe.getElementById("prechat")),
              (this.chat = this.iframe.getElementById("chat")),
              (this.designstudio = document.getElementById("designstudio")),
              (this.footerEl = this.iframe.getElementById("footer"));
          },
          toggle: function () {
            this.isVisible ? this.hide() : this.show();
          },
          show: function () {
            (this.iframe = document.getElementById(
              this.helpers.getIframeId()
            ).contentWindow.document),
              (this.designstudio = document.getElementById("designstudio")),
              (this.main = this.iframe.getElementById(
                "main-" + (this.isMobile ? "mobile" : "desktop")
              )),
              null !== this.designstudio &&
                (this.designstudio.style.display = "inline"),
              null !== this.main && (this.main.style.display = "inline"),
              this.mainViewLoading && this.addLoadingIndicator(),
              (this.isVisible = !0),
              this.helpers.disableScrolling(),
              this.updateMobileCSS(),
              this.helpers.iosScrollToTop();
          },
          hide: function () {
            e.removeEventListener("scroll", this.iPadScrollListener),
              (this.iframe = document.getElementById(
                this.helpers.getIframeId()
              ).contentWindow.document),
              (this.designstudio = document.getElementById("designstudio")),
              (this.main = this.iframe.getElementById(
                "main-" + (this.isMobile ? "mobile" : "desktop")
              )),
              null !== this.designstudio &&
                (this.designstudio.style.display = "none"),
              null !== this.main && (this.main.style.display = "none"),
              (this.isVisible = !1),
              this.helpers.enableScrolling(),
              this.updateMobileCSS();
          },
          setUpAnimations: function () {
            this.helpers.isInsideGWT() ||
              document.querySelector("style#design-studio-animate") ||
              (SnapEngage.getCustomDesignUI() &&
                void 0 !== SnapEngage.getCustomDesignUI().animateView &&
                document.body.appendChild(
                  SnapEngage.getCustomDesignUI().animateView.animateStylesheet()
                ));
          },
          addLoadingIndicator: function () {
            this.helpers.elementAddClass(
              this.iframe.getElementById("background"),
              "loading-flex"
            ),
              this.helpers.elementAddClass(
                this.iframe.getElementById("header"),
                "loading"
              );
            var e = document.createElement("div");
            (e.id = "indicator-loading"),
              this.iframe.getElementById("background").appendChild(e);
          },
          removeLoadingIndicator: function () {
            this.helpers.elementRemoveClass(
              this.iframe.getElementById("header"),
              "loading"
            ),
              this.helpers.elementRemoveClass(
                this.iframe.getElementById("background"),
                "loading-flex"
              ),
              this.helpers.removeElement(
                this.iframe.getElementById("indicator-loading")
              );
          },
          getIsVisible: function () {
            return this.isVisible;
          },
          destroy: function () {
            this.helpers.removeElement(this.popover);
          },
          _headerDetailsViewport: function () {
            return '<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"><title>Chat Box</title>';
          },
          mainTemplate: function () {
            var e = document.createElement("main");
            return (
              (e.className = "main"),
              (e.id = "main-" + (this.isMobile ? "mobile" : "desktop")),
              e.setAttribute("tabindex", "0"),
              e
            );
          },
          backgroundTemplate: function () {
            var e = document.createElement("div");
            return (e.id = "background"), e;
          },
          overlayTemplate: function () {
            var e = document.createElement("div");
            return (
              (e.id = "overlay"),
              null === this.options.logoImageUrl ||
                this.isMobile ||
                "overlay" !== this.options.logoPlacement ||
                e.appendChild(this._logoTemplate()),
              e
            );
          },
          headerTemplate: function () {
            var e = document.createElement("div");
            e.id = "header-" + (this.isMobile ? "mobile" : "desktop");
            var t = document.createElement("div");
            (t.id = "header"), e.appendChild(t);
            var i = document.createElement("div");
            (i.id = "icon-custom"), t.appendChild(i);
            var n = document.createElement("div");
            (n.id = "header-text"), t.appendChild(n);
            var s = document.createElement("div");
            (s.id = "icon-minimize"),
              s.setAttribute("tabindex", "0"),
              s.setAttribute("role", "button"),
              t.appendChild(s);
            var o = document.createElement("div");
            return (
              (o.id = "icon-close"),
              o.setAttribute("aria-label", "Close"),
              o.setAttribute("tabindex", "0"),
              o.setAttribute("role", "button"),
              t.appendChild(o),
              e
            );
          },
          prechatTemplate: function () {
            var e = document.createElement("div");
            return (e.id = "prechat"), e;
          },
          chatTemplate: function () {
            var e = document.createElement("div");
            return (
              (e.id = "chat"),
              (e.className = "chat-" + (this.isMobile ? "mobile" : "desktop")),
              e
            );
          },
          offlineTemplate: function () {
            var e = document.createElement("div");
            return (e.id = "offline"), e;
          },
          footerTemplate: function () {
            var e = document.createElement("div");
            (e.id = "footer-" + (this.isMobile ? "mobile" : "desktop")),
              (e.className = "footer-expand");
            var t = document.createElement("div");
            (t.id = "footer"), e.appendChild(t);
            var i = document.createElement("div");
            (i.id = "buttons-offline-div"), t.appendChild(i);
            var n = document.createElement("div");
            (n.id = "button-send-email"), i.appendChild(n);
            var s = document.createElement("div");
            (s.id = "buttons-prechat-div"), t.appendChild(s);
            var o = document.createElement("div");
            (o.id = "button-start-chat"), s.appendChild(o);
            var a = document.createElement("div");
            (a.id = "buttons-chat-div"), t.appendChild(a);
            var d = document.createElement("div");
            (d.id = "button-call-me"),
              (d.style.display = "none"),
              a.appendChild(d);
            var l = document.createElement("div");
            (l.id = "wrapper-buttons-end-chat"),
              (l.className = "wrapper-multi-buttons"),
              (l.style.display = "none"),
              a.appendChild(l);
            var r = document.createElement("div");
            (r.id = "button-cancel-end-chat"),
              (r.className = "multi-button-first"),
              l.appendChild(r);
            var m = document.createElement("div");
            (m.id = "button-end-chat"),
              (m.className = "multi-button-second"),
              l.appendChild(m);
            var h = document.createElement("div");
            (h.id = "button-close-chat"),
              (h.style.display = "none"),
              a.appendChild(h);
            var c = document.createElement("div");
            (c.id = "button-cancel-callme"),
              (c.style.display = "none"),
              a.appendChild(c);
            var u = document.createElement("div");
            (u.id = "wrapper-buttons-file-upload"),
              (u.className = "wrapper-multi-buttons"),
              (u.style.display = "none"),
              a.appendChild(u);
            var p = document.createElement("div");
            (p.id = "button-cancel-file-upload"),
              (p.className = "multi-button-first"),
              u.appendChild(p);
            var g = document.createElement("div");
            (g.id = "button-file-upload"),
              (g.className = "multi-button-second"),
              u.appendChild(g);
            var f = document.createElement("div");
            (f.id = "wrapper-buttons-cobrowse"),
              (f.className = "wrapper-multi-buttons"),
              (f.style.display = "none"),
              a.appendChild(f);
            var v = document.createElement("div");
            (v.id = "button-cobrowse-decline"),
              (v.className = "multi-button-first"),
              f.appendChild(v);
            var b = document.createElement("div");
            (b.id = "button-cobrowse-accept"),
              (b.className = "multi-button-second"),
              f.appendChild(b);
            var y = document.createElement("form");
            y.setAttribute("id", "upload-form"),
              y.setAttribute("name", "uploadData"),
              y.setAttribute("method", "post"),
              y.setAttribute("enctype", "multipart/form-data"),
              t.appendChild(y);
            var E = document.createElement("input");
            (E.id = "file-input"),
              E.setAttribute("type", "file"),
              E.setAttribute("name", "visitorFile"),
              y.appendChild(E);
            var C = document.createElement("iframe");
            return (
              (C.id = "hiddenFileUploadIframe"),
              C.setAttribute("name", "hiddenFileUploadIframe"),
              C.setAttribute("style", "display: none"),
              t.appendChild(C),
              null !== this.options.logoImageUrl &&
                "footer" === this.options.logoPlacement &&
                t.appendChild(this._logoTemplate()),
              this.options.showPoweredBy &&
                e.appendChild(this._poweredByTemplate()),
              e
            );
          },
          _logoTemplate: function () {
            var e = document.createElement("div");
            e.id = "logo";
            var t = document.createElement("img");
            return (
              t.setAttribute("alt", ""),
              (t.className = "logo " + this.options.logoPosition),
              (t.src = this.options.logoImageUrl),
              e.appendChild(t),
              e
            );
          },
          _poweredByTemplate: function () {
            if (this.options.showPoweredBy) {
              var e,
                t = document.createElement("a");
              return (
                (t.href = this.options.logoUrl),
                (t.target = "_blank"),
                (t.className = "link-powered-by"),
                ((e = document.createElement("img")).className = "powered-by"),
                (e.id = "img-powered-by"),
                e.setAttribute("alt", ""),
                e.setAttribute(
                  "src",
                  this.options.staticUrl + "/images/png/img-powered-by.png"
                ),
                t.appendChild(e),
                t
              );
            }
          },
          callmeTemplate: function () {
            var e = document.createElement("div");
            return (e.id = "callme-div"), e;
          },
          template: function () {
            var e = document.createElement("div");
            if (
              ((e.id = "designstudio"),
              e.setAttribute("style", this.stylesheet.mainCss()),
              !this.isMobile)
            ) {
              var t = document.createElement("div");
              (t.id = "draggable"),
                t.setAttribute("style", this.stylesheet.draggableCss()),
                e.appendChild(t);
            }
            return e;
          },
          iframeTemplate: function () {
            var e = document.createElement("iframe");
            return (
              (e.id = this.helpers.getIframeId()),
              e.setAttribute("style", this.stylesheet.iframeCss()),
              e.setAttribute(
                "name",
                "designstudio-frame" + (this.target ? "-" + this.target : "")
              ),
              e.setAttribute("title", "Live Chat Box"),
              (e.allowtransparency = "true"),
              (e.frameborder = 0),
              e
            );
          },
          setIsMobile: function (e) {
            this.helpers.isInsideGWT() && (this.isMobile = e);
          },
          updateMobileCSS: function () {
            this.isMobile && this.isVisible
              ? this.iframe
                  .getElementsByTagName("body")[0]
                  .setAttribute(
                    "style",
                    "background-color: rgba(210, 215, 211, .75);"
                  )
              : this.iframe
                  .getElementsByTagName("body")[0]
                  .setAttribute("style", "background-color: transparent;");
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.MainView = t);
      })(window);
      !(function (e) {
        function t(t, i) {
          (this.messageView =
            this.messageView || new e.chat_custom_design.MessageView(t)),
            (this.options = t),
            (this.buttonViewOptions = i),
            (this.helpers =
              this.helpers ||
              new e.chat_custom_design.Helpers(this.buttonViewOptions)),
            (this.stylesheet =
              this.stylesheet ||
              new e.chat_custom_design.Style(this.options, this.helpers)),
            (this.isVisible = !1),
            (this.direction = e.chat_custom_design.direction
              ? " " + e.chat_custom_design.direction
              : ""),
            (this.notifyCount = 0),
            (this.scale = this.helpers.getScale()),
            (this.latestMessage = ""),
            (this.fontFrameContext =
              "designstudio-minimize-frame" +
              (this.target ? "-" + this.target : "")),
            (this.minimizeStashCookie = {}),
            (this.proactiveButtons = []),
            this.minMessageProactive,
            (this.isCloseIconEnabled = !0),
            (this.quadrant = this.stylesheet.getQuadrant(
              this.buttonViewOptions
            )),
            (this.minimizedContentMaxWidth = 250),
            (this.closeIconDimension = 25),
            (this.closeIconPadding = 10),
            (this.buttonHeight = 36);
        }
        (t.prototype = {
          bind: function (e, t) {
            "minimizeClickToMaximize" === e &&
              this.iframe.addEventListener("click", function () {
                t();
              });
          },
          setFontConfig: function () {
            e.chat_custom_design.FontConfig.prototype.injectFontLoader({
              context: this.fontFrameContext,
              view: this,
              options: this.options,
            });
          },
          render: function () {
            (this.designStudioMinimize = this.template()),
              document.body.appendChild(this.designStudioMinimize),
              (this.minimizeContent = this.minimizeContentTemplate()),
              (this.iframeTemplate = this.iframeMinimizeTemplate()),
              this.designStudioMinimize.appendChild(this.iframeTemplate),
              this.iframeTemplate.appendChild(this.minimizeContent),
              (this.iframe = document.getElementById(
                "iframe-minimize"
              ).contentWindow.document),
              this.iframe.open(),
              this.iframe.write(this._headerDetailsViewport()),
              this.iframe.write(
                this.stylesheet.iframeButtonStylesheet(this.buttonViewOptions)
              ),
              this.iframe.write(this.stylesheet.minimizeStylesheet()),
              this.iframe.write(this.minimizeContent.outerHTML),
              this.iframe.close(),
              this.helpers.setDomLanguageDirection(this.iframe),
              (this.designStudioMinimize = document.getElementById(
                "designstudio-minimize"
              )),
              (this.minimizeContent = this.iframe.getElementById(
                "minimize-content"
              )),
              (this.minimizeSvg = this.iframe.getElementById("minimize-svg")),
              (this.minimizeAvatar = this.iframe.getElementById(
                "minimize-avatar"
              )),
              (this.minimizeAvatarContainer = this.iframe.getElementById(
                "minimize-avatar-container"
              )),
              (this.minimizeMessages = this.iframe.getElementById(
                "minimize-messages"
              )),
              (this.minimizeText = this.iframe.getElementById("minimize-text")),
              (this.notifyDiv = this.iframe.getElementById("minimize-notify")),
              (this.notifyCounter = this.iframe.getElementById(
                "minimize-notify-counter"
              ));
          },
          setProactiveChatView: function (e) {
            var t = this.proactiveButtons;
            if (e.length > 0) {
              var i = decodeURIComponent(e).replace(/\%20/g, " ");
              if (
                ((i = i.substr(5)),
                (i = JSON.parse(i)),
                !this.helpers.isMobileDevice() && i.length < 4)
              )
                for (var s = 0; s < i.length; s++)
                  t.push(this.messageView.buttonMessageTemplate(i[s], s));
            }
            t = t.reverse();
            for (
              var n = this.iframe.getElementById("minimize-message-proactive"),
                a = this.iframe.getElementById("minimize-text-proactive"),
                o = this.iframe.getElementById("minimize-avatar"),
                h = this.iframe.getElementById("minimize-avatar-container"),
                m = 0;
              m < t.length;
              m++
            )
              (t[m].className = "button-message"),
                this.minimizeContent.appendChild(t[m]);
            (this.minMessageProactive = n),
              this.stylesProactiveChatElements(t, a, o, h);
          },
          addProperPositionToStyleToObject: function (e, t) {
            return (
              (this.quadrant !== this.stylesheet.quadrant.BOTTOM_RIGHT &&
                this.quadrant !== this.stylesheet.quadrant.TOP_RIGHT) ||
                (e.right = t),
              (this.quadrant !== this.stylesheet.quadrant.BOTTOM_LEFT &&
                this.quadrant !== this.stylesheet.quadrant.TOP_LEFT) ||
                (e.left = t),
              e
            );
          },
          stylesProactiveChatElements: function (e, t, i, s) {
            var n = this.helpers.parseBaseFontOption(this.options.baseFont),
              a = this.options.inlineMessagePrimaryButton,
              o = "black";
            a && a.fontColor ? (o = a.fontColor) : (a = "black");
            var h = o,
              m = "Lato";
            n && n.name && (m = n.name),
              (this.iframeElement = document.getElementById("iframe-minimize")),
              this.helpers.setStyle(t, {
                "font-weight": 500,
                "font-size": "14px",
                "line-height": "20px",
                "font-family": m,
              }),
              this.helpers.setStyle(i, {
                width: "64px",
                height: "64px",
              });
            var r = this.iframe.getElementById("minimize-messages");
            this.quadrant === this.stylesheet.quadrant.BOTTOM_RIGHT &&
              ((this.notifyDiv.className =
                "minimize-notify-right-avatar minimize-notify-bottom"),
              (r.className = "message-left bottom"),
              (s.className = "bottom right"),
              (this.minimizeSvg.className = "bottom right")),
              this.quadrant === this.stylesheet.quadrant.BOTTOM_LEFT &&
                ((s.className = "bottom left"),
                (this.minimizeSvg.className = "bottom left"),
                (r.className = "message-right bottom"),
                (this.notifyDiv.className =
                  "minimize-notify-left-avatar minimize-notify-bottom")),
              this.quadrant === this.stylesheet.quadrant.TOP_RIGHT &&
                (r.className = "message-left"),
              this.quadrant === this.stylesheet.quadrant.TOP_LEFT &&
                (r.className = "message-right"),
              this.helpers.setStyle(s, {
                width: "64px",
                height: "64px",
              }),
              this.proactiveButtons.length > 0 &&
                this.styleProactiveChatButtons(e, "86px", h, "14px", "20px", m);
            var l = this.getButtonHeight(this.proactiveButtons),
              d = 10;
            0 === l && (d = 0);
            var g = {
              bottom: l + (d = this.proactiveButtons.length * d),
              "max-width": this.minimizedContentMaxWidth + "px",
              cursor: "default",
              position: "absolute",
            };
            0 !== this.proactiveButtons.length ||
              (this.quadrant !== this.stylesheet.quadrant.TOP_LEFT &&
                this.quadrant !== this.stylesheet.quadrant.TOP_RIGHT) ||
              ((g.top = "10"), delete g.bottom),
              (g = this.addProperPositionToStyleToObject(g, "86px")),
              this.helpers.setStyle(this.minimizeMessages, g),
              this.resizeDivs(!0);
          },
          setIframeHeight: function () {
            var e = Math.max(
                this.iframe.getElementById("minimize-messages").offsetHeight,
                this.iframe.getElementById("minimize-message-proactive")
                  .offsetHeight
              ),
              t = this.iframe.getElementById("minimize-messages"),
              i = getComputedStyle(t);
            e += parseInt(i.marginBottom);
            var s =
              this.getButtonHeight(this.proactiveButtons) +
              10 * this.proactiveButtons.length +
              e +
              10;
            if (0 === this.proactiveButtons.length) {
              var n = this.iframe.getElementById("minimize-avatar-container"),
                a = this.helpers.getOuterHeight(n);
              s < a && (s = a), (s += this.closeIconPadding);
            }
            this.iframeElement.height = s + "px";
          },
          styleProactiveChatButtons: function (e, t, i, s, n) {
            for (
              var a = {
                  position: "absolute",
                  height: this.buttonHeight + "px",
                  "text-overflow": "ellipsis",
                  "white-space": "nowrap",
                  overflow: "hidden",
                  "max-width": this.minimizedContentMaxWidth + "px",
                  "font-size": i,
                  "line-height": s,
                  "font-family": n,
                },
                o = 10,
                h = 0;
              h < e.length;
              h++
            )
              (o = (this.buttonHeight + 10) * h),
                0 === h && (o = 10),
                1 === h && (o = 20 + this.buttonHeight),
                2 === h && (o = 30 + 2 * this.buttonHeight),
                (a.bottom = o + "px"),
                (a = this.addProperPositionToStyleToObject(a, t)),
                this.helpers.setStyle(e[h], a);
          },
          setCloseProactiveIconView: function () {
            var e = this.helpers.addStaticSvgIcon(
              "close-proactive",
              "close-proactive"
            );
            e.id = "close-proactive-icon";
            var t = this.iframe.getElementById("minimize-messages"),
              i = this.getButtonHeight(this.proactiveButtons);
            this.iframeElement = document.getElementById("iframe-minimize");
            var s = {
              position: "absolute",
              top: this.closeIconPadding + "px",
              display: "none",
              right: "20px",
            };
            this.quadrant === this.stylesheet.quadrant.TOP_RIGHT &&
              ((s.top = this.closeIconPadding + "px"),
              0 === i && (s.top = "0px"),
              (s.right = "auto"),
              (s.left = "0px")),
              this.quadrant === this.stylesheet.quadrant.TOP_LEFT &&
                ((s.top = this.closeIconPadding + "px"),
                0 === i && (s.top = "0px"),
                (s.right = "0px")),
              this.quadrant === this.stylesheet.quadrant.BOTTOM_RIGHT &&
                ((s.top = this.closeIconPadding + "px"),
                0 === i && (s.top = "0px")),
              this.quadrant === this.stylesheet.quadrant.BOTTOM_LEFT &&
                ((s.top = this.closeIconPadding + "px"), (s.right = "0px")),
              this.helpers.setStyle(e, s),
              e.setAttribute("width", this.closeIconDimension + "px"),
              e.setAttribute("height", this.closeIconDimension + "px"),
              this.minimizeContent.appendChild(e),
              this.setOnCloseProactiveIconClick(e, t);
          },
          setOnCloseProactiveIconClick: function (e, t) {
            var i = this;
            e.addEventListener("click", function (s) {
              s.stopPropagation(),
                s.preventDefault(),
                i.helpers.setStyle(e, {
                  display: "none",
                }),
                i.helpers.setStyle(t, {
                  display: "none",
                });
              for (var n = 0; n < i.proactiveButtons.length; n++)
                i.helpers.setStyle(i.proactiveButtons[n], {
                  display: "none",
                });
              SnapEngage.preventProactiveChat(),
                (i.isCloseIconEnabled = !1),
                i.resizeDivs();
            });
          },
          getButtonHeight: function (e) {
            var t = 0;
            if (e.length > 0)
              for (var i = 0; i < e.length; i++) t += e[i].offsetHeight;
            return t;
          },
          template: function () {
            var e = document.createElement("div");
            return (
              (e.id = "designstudio-minimize"),
              e.setAttribute("style", this.outerMinimizeCss()),
              e
            );
          },
          outerMinimizeCss: function () {
            return "position:fixed;z-index:999998;display:none;";
          },
          iframeMinimizeTemplate: function () {
            var e = document.createElement("iframe");
            return (
              (e.id = "iframe-minimize"),
              e.setAttribute("style", this.iFrameCss()),
              e.setAttribute(
                "name",
                "designstudio-minimize-frame" +
                  (this.target ? "-" + this.target : "")
              ),
              e.setAttribute("title", "Live Chat Button"),
              (e.allowtransparency = "true"),
              (e.frameborder = 0),
              (e.scrolling = "no"),
              e
            );
          },
          iFrameCss: function () {
            return (
              "border:none;display:block;font-size:" +
              this.stylesheet.calcBaseFontSize(
                this.options.agentMessage.fontSize
              )
            );
          },
          _headerDetailsViewport: function () {
            return '<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"><title>Minimized Chat Box</title>';
          },
          minimizeContentTemplate: function () {
            var e = document.createElement("div");
            e.id = "minimize-content";
            var t = this.notifyTemplate();
            e.appendChild(t);
            var i = document.createElement("div");
            i.id = "minimize-avatar-container";
            var s = document.createElement("img");
            (s.id = "minimize-avatar"),
              s.setAttribute("alt", "minimized chat"),
              i.appendChild(s),
              e.appendChild(i);
            var n = document.createElement("div");
            (n.id = "minimize-svg"),
              n.appendChild(this.helpers.svgButtonTemplate(!0)),
              e.appendChild(n);
            var a = this.messagesTemplate();
            return (
              e.appendChild(a),
              this.stylesheet.getMinimizeContentsPlacement(
                i,
                n,
                a,
                t,
                this.buttonViewOptions
              ),
              e
            );
          },
          messagesTemplate: function () {
            var e = document.createElement("div");
            return (e.id = "minimize-messages"), e;
          },
          messageTemplate: function (e, t) {
            var i = document.createElement("div");
            i.className = "minimize-message ";
            var s = document.createElement("div");
            return (
              (s.id = "minimize-text"),
              t &&
                ((i.className = "minimize-message-proactive"),
                (i.id = "minimize-message-proactive"),
                (s.id = "minimize-text-proactive")),
              e
                ? (s.innerHTML = e)
                : this.helpers.setStyle(i, {
                    "box-shadow": "none",
                  }),
              (s.className = this.direction),
              (s.style.cursor = "pointer"),
              i.appendChild(s),
              i
            );
          },
          notifyTemplate: function () {
            var e = document.createElement("div");
            e.id = "minimize-notify";
            var t = document.createElement("span");
            return (t.id = "minimize-notify-counter"), e.appendChild(t), e;
          },
          showNotify: function () {
            this.notifyDiv.style.display = "flex";
          },
          hideNotify: function () {
            (this.notifyDiv.style.display = "none"), (this.notifyCount = 0);
          },
          incrementNotify: function (e) {
            (this.notifyStyle = getComputedStyle(this.notifyDiv)),
              "inline" !== this.notifyStyle.display && this.showNotify(),
              e ? (this.notifyCount = e) : this.notifyCount++,
              (this.notifyCounter.innerHTML = this.notifyCount);
          },
          _isAvatarAvailable: function () {
            return SnapEngage.getCustomDesignUI()
              .chatView.getMessageView()
              .getState("agentAvatarUrl");
          },
          updateMessage: function (e, t, i, s, n) {
            this._setLatestMessage(e);
            var a = e;
            i && e && (a = i ? this._removeInlineFormatting(e) : e);
            var o,
              h = this.messageTemplate(a, s);
            this.helpers.isMobileDevice() &&
              this.helpers.setStyle(this.minimizeMessages, {
                display: "none",
              });
            var m = this.stylesheet.getQuadrant(this.buttonViewOptions);
            if (
              (m === this.stylesheet.quadrant.TOP_RIGHT ||
              m === this.stylesheet.quadrant.TOP_LEFT
                ? (this.minimizeMessages.insertBefore(
                    h,
                    this.minimizeMessages.firstChild
                  ),
                  (o = 0))
                : (this.minimizeMessages.appendChild(h),
                  (o = this.minimizeMessages.children.length - 1)),
              this.showMessageContainer(),
              this.resizeDivs(s),
              s &&
                (this.setProactiveChatView(n),
                this.setCloseProactiveIconView(),
                this.setCloseProactiveIconEvents()),
              SnapEngageChat.isMinimized() &&
                (this.quadrant === this.stylesheet.quadrant.TOP_RIGHT ||
                this.quadrant === this.stylesheet.quadrant.TOP_LEFT
                  ? this.helpers.setStyle(this.minimizeMessages, {
                      bottom: "auto",
                    })
                  : this.helpers.setStyle(this.minimizeMessages, {
                      bottom: "0",
                    })),
              SnapEngage.getCustomDesignUI() &&
                void 0 !== SnapEngage.getCustomDesignUI().animateView)
            ) {
              if (this.minimizeMessages.children.length > 0)
                for (
                  var r = this.minimizeMessages.children.length - 1;
                  r >= 0;
                  r--
                )
                  r !== o &&
                    !1 === this.isCloseIconEnabled &&
                    (SnapEngage.getCustomDesignUI().animateView.removeAnimation(
                      this.minimizeMessages.children[r],
                      SnapEngage.getCustomDesignUI().animateView.getAnimationIn(
                        SnapEngage.getCustomDesignUI().animateView
                          .animatedElement.MINIMIZE_MESSAGE
                      )
                    ),
                    SnapEngage.getCustomDesignUI().animateView.addAnimation(
                      this.minimizeMessages.children[r],
                      SnapEngage.getCustomDesignUI().animateView.getAnimationOut(
                        SnapEngage.getCustomDesignUI().animateView
                          .animatedElement.MINIMIZE_MESSAGE
                      )
                    ));
              SnapEngage.getCustomDesignUI().animateController._updateMessageBindings(
                h
              ),
                SnapEngage.getCustomDesignUI().animateView.addAnimation(
                  h,
                  SnapEngage.getCustomDesignUI().animateView.getAnimationIn(
                    SnapEngage.getCustomDesignUI().animateView.animatedElement
                      .MINIMIZE_MESSAGE
                  )
                ),
                SnapEngageChat.isMinimized() &&
                  this.minimizeMessages.children.length > 1 &&
                  (this.helpers.removeElement(
                    this.minimizeMessages.children[0]
                  ),
                  this.resizeDivs());
            } else
              this.minimizeMessages.children.length > 1 &&
                (this.helpers.removeElement(this.minimizeMessages.children[0]),
                this.resizeDivs());
          },
          setCloseProactiveIconEvents: function () {
            var e = this,
              t = document.getElementById("iframe-minimize"),
              i = this.iframe.getElementById("close-proactive-icon");
            this.helpers.isMobileDevice() ||
              (t.addEventListener("mouseenter", function () {
                "none" !==
                  e.iframe.getElementById("minimize-messages").style.display &&
                  !0 === e.isCloseIconEnabled &&
                  e.helpers.setStyle(i, {
                    display: "inline",
                  });
              }),
              t.addEventListener("mouseout", function () {
                !0 === e.isCloseIconEnabled &&
                  e.helpers.setStyle(i, {
                    display: "none",
                  });
              }));
          },
          _removeInlineFormatting: function (e) {
            return (
              "[" +
              e.replace(/\<br\>|\<br\s*\/>/gi, " ").replace(/<b>|<\/b>/gi, "") +
              "]"
            );
          },
          clearMessages: function () {
            var e = this.proactiveButtons,
              t = this.helpers;
            if (
              (this._getLatestMessage() !== SnapEngage.getMessage(35) &&
                (this.minimizeMessages.innerHTML = ""),
              e)
            )
              for (var i = 0; i < e.length; i++)
                t.setStyle(e[i], {
                  display: "none",
                });
          },
          setUpAnimations: function () {
            this.stylesheet.setUpAnimations(this.designStudioMinimize);
          },
          show: function () {
            SnapEngage.getCustomDesignUI().setAgentAvatar(
              SnapEngageChat.getAgentAvatarCookie()
            ),
              this.showAvatarOrSVG(),
              (this.isVisible = !0),
              (this.designStudioMinimize.style.display = "inline"),
              this.setPlacement();
          },
          hide: function () {
            (this.isVisible = !1),
              (this.designStudioMinimize.style.display = "none"),
              this.hideNotify();
          },
          setPlacementOffset: function (e) {
            var t = this.options.onlineButton.offset,
              i = this.options.onlineButton.offsetValue,
              s = this.options.onlineButton.offsetUnit;
            return (
              "bottom" === t && (e.bottom = i + s),
              "right" === t && (e.right = i + s),
              "left" === t && (e.left = i + s),
              "top" === t && (e.top = i + s),
              e
            );
          },
          setPlacement: function () {
            this.stylesheet.updateElementPlacement(
              this.designStudioMinimize,
              this.minimizeContent,
              this.buttonViewOptions
            );
            var e = this.designStudioMinimize,
              t = {};
            this.quadrant === this.stylesheet.quadrant.BOTTOM_RIGHT &&
              (t = this.setPlacementOffset(t)),
              this.quadrant === this.stylesheet.quadrant.TOP_RIGHT &&
                (t = this.setPlacementOffset(t)),
              this.quadrant === this.stylesheet.quadrant.BOTTOM_LEFT &&
                (t = this.setPlacementOffset(t)),
              this.quadrant === this.stylesheet.quadrant.TOP_LEFT &&
                (t = this.setPlacementOffset(t)),
              this.helpers.setStyle(e, t),
              this.resizeDivs();
          },
          hideTargetMessage: function (e) {
            e.target.style.display = "none";
          },
          showAvatarOrSVG: function () {
            var e = this._isAvatarAvailable();
            e
              ? ((this.minimizeAvatar.src = e),
                this.showAvatar(),
                this.hideSVG())
              : (this.hideAvatar(), this.showSVG());
          },
          isViewVisible: function () {
            return this.isVisible;
          },
          showAvatar: function () {
            this.minimizeAvatarContainer.style.display = "inline";
          },
          hideAvatar: function () {
            this.minimizeAvatarContainer.style.display = "none";
          },
          showSVG: function () {
            this.iframe.getElementById("svg-container").style.display =
              "inline";
          },
          hideSVG: function () {
            this.iframe.getElementById("svg-container").style.display = "none";
          },
          showMessageContainer: function () {
            this.minimizeMessages.style.display = "inline";
          },
          hideMessageContainer: function () {
            this.minimizeMessages.style.display = "none";
          },
          destroy: function () {
            this.helpers.removeElement(this.designStudioMinimize);
          },
          refresh: function () {
            this.destroy(), this.render();
          },
          getProactiveButtonsMaxWidth: function () {
            var e = 0;
            if (this.proactiveButtons.length)
              for (var t = 0; t < this.proactiveButtons.length; t++)
                e < this.proactiveButtons[t].offsetWidth &&
                  (e = this.proactiveButtons[t].offsetWidth);
            return e;
          },
          resizeDivs: function (e) {
            this.iframeElement = document.getElementById("iframe-minimize");
            var t = 0;
            this.iframe.getElementById("close-proactive-icon") &&
              (t = this.closeIconDimension + 10);
            var i = this.getButtonHeight(this.proactiveButtons);
            this.iframeElement.height =
              Math.max(
                this.helpers.getOuterHeight(this.minimizeMessages),
                this.helpers.getOuterHeight(this.minimizeSvg),
                this.helpers.getOuterHeight(this.minimizeAvatarContainer)
              ) +
              i +
              t;
            var s = 0;
            "inline" === this.minimizeMessages.style.display &&
              ((s = this.helpers.getOuterWidth(this.minimizeMessages)),
              e ||
                this.helpers.setStyle(this.minimizeMessages, {
                  width: "auto",
                }));
            var n = this.helpers.getOuterWidth(this.minimizeSvg),
              a = this.getProactiveButtonsMaxWidth(),
              o = n + Math.max(a, s) + this.closeIconDimension + 10;
            if (
              (e &&
                ((this.quadrant !== this.stylesheet.quadrant.TOP_RIGHT &&
                  this.quadrant !== this.stylesheet.quadrant.TOP_LEFT) ||
                  this.helpers.setStyle(this.iframeElement, {
                    "margin-top": "15px",
                  }),
                (this.iframeElement.width = o),
                this.setIframeHeight()),
              SnapEngageChat.isMinimized())
            ) {
              var h = this._isAvatarAvailable()
                ? this.helpers.getOuterWidth(this.minimizeAvatarContainer)
                : this.helpers.getOuterWidth(this.minimizeSvg);
              this.iframeElement.width =
                this.minimizeMessages.offsetWidth + h + t;
            }
          },
          _getLatestMessage: function () {
            return this.latestMessage;
          },
          _setLatestMessage: function (e) {
            this.latestMessage = e;
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.MinimizeView = t);
      })(window);
      !(function (t) {
        function e(e, i, n, s) {
          (this.isOnline = i),
            (this.options = e),
            (this.target = n),
            (this.buttonViewOptions = s),
            this._determineIconType(),
            (this.helpers =
              this.helpers ||
              new t.chat_custom_design.Helpers(
                this.buttonViewOptions,
                this.target
              )),
            (this.isMobile = this.helpers.isMobileDevice()),
            (this.stylesheet =
              this.stylesheet ||
              new t.chat_custom_design.Style(this.options, this.helpers)),
            (this.isVisible = !1),
            (this.allowOffline = !0),
            (this.basePx = this.buttonViewOptions.fontSize),
            (this.scale = this.helpers.getScale()),
            (this.fontFrameContext =
              "designstudio-button-frame" +
              (this.target ? "-" + this.target : ""));
        }
        (e.prototype = {
          em: function (t, e, i) {
            return t / (e || this.basePx) + (i ? "em" : "em;");
          },
          setButtonViewOptions: function (t) {
            this.buttonViewOptions = t;
          },
          getButtonViewOptions: function () {
            return this.buttonViewOptions;
          },
          setFontConfig: function () {
            t.chat_custom_design.FontConfig.prototype.injectFontLoader({
              context: this.fontFrameContext,
              view: this,
              options: this.options,
            });
          },
          _determineIconType: function () {
            (this.isText = null !== this.buttonViewOptions.text),
              (this.isSvg = null !== this.buttonViewOptions.svgIcon),
              (this.isImage = null !== this.buttonViewOptions.imageUrl);
          },
          bind: function (t, e) {
            "buttonClick" === t
              ? (this.iframe.addEventListener("click", function () {
                  e();
                }),
                (this.mainButtonTemplate.onkeydown = function (t) {
                  (13 !== t.keyCode && 32 !== t.keyCode) || e();
                }))
              : "buttonTouchStart" === t
              ? this.iframe.addEventListener("touchstart", function () {
                  e();
                })
              : "buttonTouchMove" === t
              ? this.iframe.addEventListener("touchmove", function (t) {
                  e(t);
                })
              : "buttonTouchEnd" === t &&
                this.iframe.addEventListener("touchend", function () {
                  e();
                });
          },
          outerButtonCss: function () {
            return (
              "position:fixed;z-index:999998;left:-9999px;font-size:" +
              this.buttonViewOptions.fontSize +
              "px;"
            );
          },
          iFrameCss: function () {
            var t = "border:none;display:block;";
            return this.isSvg && (t += this.buttonSvgCss()), t;
          },
          iframeButtonTemplate: function () {
            var t = document.createElement("iframe");
            return (
              (t.id =
                "iframe-designstudio-button" +
                (this.target ? "-" + this.target : "")),
              t.setAttribute("style", this.iFrameCss()),
              t.setAttribute(
                "name",
                "designstudio-button-frame" +
                  (this.target ? "-" + this.target : "")
              ),
              t.setAttribute("title", "Live Chat Button"),
              (t.allowtransparency = "true"),
              (t.frameborder = 0),
              (t.scrolling = "no"),
              this.isText && (t.className = "iframe-button-text"),
              t
            );
          },
          buttonContainer: function () {
            var t = document.createElement("div");
            return (t.id = "iframe-button-container"), t;
          },
          buttonContent: function () {
            var t = document.createElement("div");
            return (
              (t.id = "iframe-button-content"),
              this.isSvg
                ? ((t.className = "button-svg"),
                  t.appendChild(this.helpers.svgButtonTemplate()))
                : this.isImage
                ? ((t.className = "button-image"),
                  t.appendChild(this.imageButtonTemplate()))
                : this.isText &&
                  ((t.className = "button-text"),
                  t.appendChild(this.textButtonTemplate())),
              t
            );
          },
          template: function () {
            var t = document.createElement("div");
            return (
              (t.id = "designstudio-button"),
              t.setAttribute("style", this.outerButtonCss()),
              t.setAttribute("tabindex", "0"),
              t.setAttribute("role", "button"),
              (this.mainButtonTemplate = t),
              t
            );
          },
          textButtonTemplate: function () {
            var t = document.createElement("span");
            return (
              (t.id = "designstudio-button-text"),
              (t.textContent = this.buttonViewOptions.text),
              t
            );
          },
          imageButtonTemplate: function () {
            var t = document.createElement("img");
            return (
              (t.id =
                "designstudio-button-image-" +
                (this.isMobile ? "mobile" : "desktop")),
              t.setAttribute("alt", ""),
              (t.src = this.buttonViewOptions.imageUrl),
              t
            );
          },
          buttonSvgCss: function () {
            var t = "margin:" + this.em(10);
            return (
              1 === this.scale &&
                (t += "width:" + this.em(60) + "height:" + this.em(60)),
              t
            );
          },
          render: function () {
            (this.button = this.template()),
              this.helpers.isInsideGWT()
                ? document
                    .getElementById(this.target)
                    .children[0].appendChild(this.button)
                : document.body.appendChild(this.button),
              (this.container = this.buttonContainer()),
              (this.mainDiv = this.buttonContent()),
              this.button.appendChild(this.iframeButtonTemplate()),
              this.container.appendChild(this.mainDiv),
              (this.iframe = document.getElementById(
                "iframe-designstudio-button" +
                  (this.target ? "-" + this.target : "")
              ).contentWindow.document),
              this.iframe.open(),
              this.iframe.write(this._headerDetailsViewport()),
              this.iframe.write(
                this.stylesheet.iframeButtonStylesheet(this.buttonViewOptions)
              ),
              this.iframe.write(this.container.outerHTML),
              this.iframe.close(),
              this.helpers.setDomLanguageDirection(this.iframe),
              (this.mainButtonContainer = this.iframe.getElementById(
                "iframe-button-container"
              )),
              (this.buttonElementContent = this.iframe.getElementById(
                "iframe-button-content"
              )),
              this.setUpAnimations();
          },
          destroy: function () {
            this.helpers.removeElement(this.button);
          },
          refresh: function () {
            this.destroy(),
              this.helpers.setButtonViewOptions(this.buttonViewOptions),
              this.render();
          },
          _headerDetailsViewport: function () {
            return '<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"><title>Live Chat Button</title>';
          },
          setPlacement: function () {
            this.stylesheet.updateElementPlacement(
              this.button,
              this.buttonElementContent,
              this.buttonViewOptions
            ),
              this.stylesheet.updateButtonRotation(this.button),
              this.stylesheet.updateOffset(this.button),
              this.setUpAnimations(),
              this.resizeDivs();
          },
          resizeDivs: function () {
            this.iframeElement = document.getElementById(
              "iframe-designstudio-button" +
                (this.target ? "-" + this.target : "")
            );
            var t = this.iframe
                .getElementById("iframe-button-content")
                .getBoundingClientRect().width,
              e = this.iframe
                .getElementById("iframe-button-content")
                .getBoundingClientRect().height;
            (this.mainButtonContainer.style.height = e),
              (this.mainButtonContainer.style.width = t),
              (this.iframeElement.height = this.mainButtonContainer.offsetHeight),
              (this.iframeElement.width = this.mainButtonContainer.offsetWidth);
          },
          setUpAnimations: function () {
            this.stylesheet.setUpAnimations(this.button);
          },
          getButton: function () {
            return this.button;
          },
          toggle: function () {
            this.isVisible ? this.hide() : this.show();
          },
          show: function () {
            this._doNotShowOffline()
              ? this.hide()
              : ((this.isVisible = !0), this.setPlacement());
          },
          hide: function () {
            (this.isVisible = !1),
              (this.button.style.left = "-9999px"),
              (this.button.style.right = "");
          },
          setIsOnline: function (t) {
            this.isOnline = t;
          },
          getIsOnline: function () {
            return this.isOnline;
          },
          _doNotShowOffline: function () {
            return !this.allowOffline && !this.getIsOnline();
          },
          isShowNoButton: function () {
            return (
              null === this.buttonViewOptions.text &&
              null === this.buttonViewOptions.imageUrl &&
              null === this.buttonViewOptions.svgIcon
            );
          },
          isViewVisible: function () {
            return this.isVisible;
          },
          setIsMobile: function (t) {
            this.helpers.isInsideGWT() && (this.isMobile = t);
          },
        }),
          (t.chat_custom_design = t.chat_custom_design || {}),
          (t.chat_custom_design.ButtonView = e);
      })(window);
      !(function (e) {
        function t(t, s, i) {
          (this.options = t),
            (this.target = s),
            (this.helpers =
              this.helpers ||
              new e.chat_custom_design.Helpers(this.options, this.target)),
            (this.stylesheet =
              this.stylesheet ||
              new e.chat_custom_design.Style(this.options, this.helpers)),
            (this.messageView =
              this.messageView ||
              new e.chat_custom_design.MessageView(
                this.options,
                this.target,
                i
              )),
            (this.mainView =
              this.mainView ||
              new e.chat_custom_design.MainView(this.options, this.target)),
            (this.isVisible = !1),
            (this.isOnline = !1),
            (this.isTyping = !1),
            (this.textareaTypingValue = ""),
            (this.isMobile = this.helpers.isMobileDevice()),
            (this.iframe = document.getElementById(
              this.helpers.getIframeId()
            ).contentWindow.document),
            (this.chat = this.iframe.getElementById("chat")),
            (this.callmeCancel = this.iframe.getElementById(
              "button-cancel-callme"
            )),
            (this.googleTranslateLogo = null),
            (this.iosScrollandler = null),
            (this.state = {
              closeChatWarningDisplay: !1,
              emailTranscriptEnabled: !1,
              sendButtonEnabled: !!this.options.chatSendButton.svgIcon,
              isMenuOpen: !1,
              menuItems: [],
            }),
            (this.emailTranscriptCard = null);
        }
        (t.prototype = {
          bind: function (t, s) {
            var i = this;
            if ("formClick" === t)
              i.iframe.addEventListener("click", function () {
                s();
              });
            else if ("callmeCancelClick" === t) ga(i.callmeCancel, s);
            else if ("fileUploadButtonClick" === t)
              i.chatFileUploadButton.addEventListener("click", function () {
                s();
              });
            else if ("chatCancelFileUploadButtonClick" === t)
              i.chatCancelFileUpload.addEventListener("click", function () {
                s();
              });
            else if ("chatFileSelect" === t)
              i.chatFileInput.addEventListener("change", function (e) {
                s(e);
              });
            else if ("closeActionMenu" === t)
              i.chatMessageTextarea.addEventListener("focus", function () {
                s();
              });
            else if ("chatSendMessage" === t) {
              var a = !1,
                n = !1;
              i.chatMessageTextarea.addEventListener(
                "compositionstart",
                function () {
                  (a = !0), (n = !0);
                }
              ),
                i.chatMessageTextarea.addEventListener(
                  "compositionend",
                  function (e) {
                    e.preventDefault(), (a = !1);
                  }
                ),
                i.chatMessageTextarea.addEventListener("keyup", function (e) {
                  if ((e.preventDefault(), 13 !== e.keyCode))
                    return (
                      i.setIsVisitorTyping(
                        i.chatMessageTextarea.value.length > 0
                      ),
                      s(e, "messageCookie")
                    );
                  if (13 === e.keyCode) {
                    if (n) return (n = !1), void (a = !1);
                    if (!a) return s(e);
                  }
                });
            } else
              "chatCloseChat" === t
                ? i.chatCloseButton.addEventListener("click", function () {
                    s();
                  })
                : "chatCancelCloseChat" === t
                ? i.cancelEndChatButton.addEventListener("click", function () {
                    s();
                  })
                : "chatEndChat" === t
                ? i.endChatButton.addEventListener("click", function () {
                    s();
                  })
                : "chatMessageTextareaFocus" === t
                ? ((i.iosScrollHandler = function () {
                    var t;
                    e.clearTimeout(t),
                      (t = setTimeout(
                        function () {
                          return s();
                        }.bind(i),
                        300
                      ));
                  }),
                  i.chatMessageTextarea.addEventListener("focus", function (t) {
                    i.helpers.isIos()
                      ? ((e.iosScrollPositionY = e.scrollY),
                        e.addEventListener("scroll", i.iosScrollHandler))
                      : (SnapEngage.isIE() || SnapEngage.isIE11()) &&
                        t.target.select();
                  }))
                : "chatMessageTextareaBlur" === t
                ? i.chatMessageTextarea.addEventListener("blur", function () {
                    e.removeEventListener("scroll", i.iosScrollHandler), s();
                  })
                : "acceptCobrowseButtonClick" === t
                ? i.acceptCobrowseButton.addEventListener("click", function () {
                    s();
                  })
                : "declineCobrowseButtonClick" === t &&
                  i.declineCobrowseButton.addEventListener(
                    "click",
                    function () {
                      s();
                    }
                  );
          },
          setState: function (e, t) {
            this.state[e] = t;
          },
          getState: function (e) {
            return this.state[e];
          },
          render: function () {
            (this.iframe = this.iframe),
              (this.footer = this.iframe.getElementById("footer")),
              this.messageView.render(),
              this.chat.appendChild(this.textEntryAreaTemplate()),
              (this.specialFeatureButtonsContainer = this.iframe.getElementById(
                "buttons-chat-div"
              )),
              (this.chatFileUploadButton = this.iframe.getElementById(
                "button-file-upload"
              )),
              (this.chatMessageTextarea = this.iframe.getElementById(
                "message-textarea"
              )),
              (this.textareaDiv = this.iframe.getElementById("textarea-div")),
              (this.chatMessageSendButton = this.iframe.getElementById(
                "action-item-send"
              )),
              (this.chatFileInput = this.iframe.getElementById("file-input")),
              (this.chatCancelFileUpload = this.iframe.getElementById(
                "button-cancel-file-upload"
              )),
              (this.chatCloseButton = this.iframe.getElementById(
                "button-close-chat"
              )),
              (this.messagesContent = this.iframe.getElementById(
                "messages-content"
              )),
              (this.fileUploadForm = this.iframe.getElementById("upload-form")),
              (this.cancelEndChatButton = this.iframe.getElementById(
                "button-cancel-end-chat"
              )),
              (this.endChatButton = this.iframe.getElementById(
                "button-end-chat"
              )),
              (this.acceptCobrowseButton = this.iframe.getElementById(
                "button-cobrowse-accept"
              )),
              (this.declineCobrowseButton = this.iframe.getElementById(
                "button-cobrowse-decline"
              )),
              (this.fileUploadButtonWrapper = this.iframe.getElementById(
                "wrapper-buttons-file-upload"
              )),
              (this.coBrowseButtonWrapper = this.iframe.getElementById(
                "wrapper-buttons-cobrowse"
              )),
              (this.endChatButtonWrapper = this.iframe.getElementById(
                "wrapper-buttons-end-chat"
              )),
              (this.inputEmailTranscript = this.iframe.getElementById(
                "input-email-request"
              )),
              this.resizeMessageInputArea();
          },
          destroy: function () {
            this.helpers.removeElement(this.chat),
              this.helpers.removeChildren(
                this.iframe.getElementById("button-call-me")
              );
          },
          toggle: function () {
            this.isVisible ? this.hide() : this.show();
          },
          disableComponents: function () {
            this.setState("isMenuOpen", !1),
              this.hideCancelCallmeButtons(),
              this.hideInput(),
              this.resizeMessageInputArea("notextarea");
          },
          showCloseChatWarning: function (e) {
            this.helpers.isInsideGWT() &&
              (this.disableComponents(),
              this.addMessageToGWT(
                this.messageView._chatCloseWarning(e),
                !1,
                !0
              ),
              this.enableWarningEndChatButtons());
          },
          show: function () {
            (this.isVisible = !0),
              this.mainView.show(),
              (this.chat.style.display = "inline"),
              this.helpers.toggleHeader("chat"),
              this.helpers.toggleFooterButtons("chat"),
              this.focusMessageInputArea(),
              this.helpers.isInsideGWT() ||
                ((this.iframe.getElementById(
                  "chat-cancel-callme"
                ).value = SnapEngage.getMessage(40).toUpperCase()),
                (this.iframe.getElementById(
                  "chat-cancel-file-upload"
                ).value = SnapEngage.getMessage(42).toUpperCase()),
                (this.iframe.getElementById(
                  "chat-file-upload"
                ).value = SnapEngage.getMessage(57).toUpperCase()),
                (this.iframe.getElementById(
                  "chat-close"
                ).value = SnapEngage.getMessage(58).toUpperCase()),
                (this.iframe.getElementById(
                  "chat-cobrowse-decline"
                ).value = SnapEngage.getMessage(63).toUpperCase()),
                (this.iframe.getElementById(
                  "chat-cobrowse-accept"
                ).value = SnapEngage.getMessage(62).toUpperCase())),
              this.messageView.updateScroll(),
              this.updateActionArea();
          },
          hide: function () {
            (this.isVisible = !1),
              (this.chat.style.display = "none"),
              this.helpers.toggleHeader("none"),
              this.helpers.toggleFooterButtons("none");
          },
          getVisitorTyping: function () {
            return this.chatMessageTextarea.value;
          },
          setIsVisitorTyping: function (e) {
            this.isTyping = e;
          },
          isVisitorTyping: function () {
            var e =
              this.isTyping &&
              this.textareaTypingValue !== this.chatMessageTextarea.value;
            return (
              (this.textareaTypingValue = this.chatMessageTextarea.value), e
            );
          },
          updateHeaderText: function (e) {
            (this.headerText = this.iframe.getElementById("header-text")),
              (this.headerText.innerHTML = e);
          },
          hideInput: function () {
            (this.textareaDiv.style.display = "none"),
              (this.chatMessageTextarea.disabled = !0),
              (this.chatMessageTextarea.placeholder = ""),
              this.resizeMessageInputArea("notextarea");
          },
          showInput: function () {
            if (!SnapEngage.isChatInProgress()) return !1;
            (this.textareaDiv.style.display = "inline"),
              (this.chatMessageTextarea.disabled = !1),
              (this.chatMessageTextarea.placeholder = ""),
              this.resizeMessageInputArea(),
              this.focusMessageInputArea();
          },
          showCancelCallmeButtons: function () {
            (this.callmeCancel.style.display = "inline"),
              this.resizeMessageInputArea();
          },
          hideCancelCallmeButtons: function () {
            (this.callmeCancel.style.display = "none"),
              this.resizeMessageInputArea();
          },
          enableFileUploadButtons: function () {
            (this.fileUploadButtonWrapper.style.display = "flex"),
              (this.chatFileInput.style.display = "inline"),
              this.resizeMessageInputArea("notextarea");
          },
          disableFileUploadButtons: function () {
            (this.fileUploadButtonWrapper.style.display = "none"),
              (this.chatFileInput.style.display = "none"),
              this.resizeMessageInputArea();
          },
          enableCobrowsingButtons: function (e, t) {
            (this.coBrowseButtonWrapper.style.display = "flex"),
              (this.acceptCobrowseButton.dataset.key = e),
              (this.acceptCobrowseButton.dataset.token = t),
              this.resizeMessageInputArea("notextarea");
          },
          disableCobrowsingButtons: function () {
            (this.coBrowseButtonWrapper.style.display = "none"),
              this.acceptCobrowseButton.removeAttribute("data-key"),
              this.acceptCobrowseButton.removeAttribute("data-token"),
              this.resizeMessageInputArea();
          },
          toggleCloseButton: function () {
            "none" !== this.chatCloseButton.style.display
              ? (this.chatCloseButton.style.display = "none")
              : (this.chatCloseButton.style.display = "inline");
          },
          enableWarningEndChatButtons: function () {
            (this.endChatButtonWrapper.style.display = "flex"),
              (this.iframe.getElementById(
                "warning-cancel-end"
              ).value = this.helpers.isInsideGWT()
                ? "Continue Chat"
                : SnapEngage.getMessage(49)),
              (this.iframe.getElementById(
                "warning-end-chat"
              ).value = this.helpers.isInsideGWT()
                ? "End Chat"
                : SnapEngage.getMessage(48)),
              this.resizeMessageInputArea("notextarea");
          },
          disableWarningEndChatButtons: function () {
            (this.endChatButtonWrapper.style.display = "none"),
              this.resizeMessageInputArea();
          },
          setMenuState: function (e) {
            var t = this.getState("menuItems"),
              s = [].concat(t, [e]);
            this.setState("menuItems", s);
          },
          textEntryAreaTemplate: function () {
            var t = this.iframe.createElement("div");
            (t.id = "textarea-div"),
              (t.className =
                "rtl" === e.chat_custom_design.direction ? " rtl" : "");
            var s = this.iframe.createElement("textarea");
            return (
              (s.id = "message-textarea"),
              (s.className =
                "text-entry text-entry-" +
                (this.isMobile ? "mobile" : "desktop") +
                " actionarea"),
              (s.role = "textarea"),
              (s.autocomplete = "off"),
              s.setAttribute("type", this.options.chatTextarea.type),
              (s.value = ""),
              (s.placeholder = this.options.chatTextarea.placeholder),
              t.appendChild(s),
              t
            );
          },
          renderActionArea: function () {
            var e = this.iframe.createElement("div");
            e.id = "action-area-chat";
            var t = [];
            return (
              this.getState("sendButtonEnabled") &&
                t.push({
                  name: "send",
                  icon: this.options.chatSendButton.svgIcon,
                  color: this.options.chatSendButton.bgColor,
                  alt: this.options.chatSendButton.text,
                  registerEvents: [
                    {
                      type: "touchstart",
                      callback: this.helpers.isInsideGWT()
                        ? null
                        : SnapEngage.getCustomDesignUI().chatController.sendMessage.bind(
                            SnapEngage.getCustomDesignUI().chatController
                          ),
                    },
                    {
                      type: "click",
                      callback: this.helpers.isInsideGWT()
                        ? null
                        : SnapEngage.getCustomDesignUI().chatController.sendMessage.bind(
                            SnapEngage.getCustomDesignUI().chatController
                          ),
                    },
                  ],
                }),
              this.getState("menuItems").length &&
                t.push({
                  name: "menu",
                  icon: "icn-menu",
                  alt: "chat menu actions",
                  registerEvents: [
                    {
                      type: "click",
                      callback: SnapEngage.getCustomDesignUI().chatController.toggleMenu.bind(
                        SnapEngage.getCustomDesignUI().chatController
                      ),
                    },
                  ],
                }),
              t.forEach(
                function (t) {
                  var s = document.createElement("div");
                  (s.id = "action-item-" + t.name),
                    (s.className = "action-item"),
                    s.setAttribute("alt", t.alt),
                    s.setAttribute("tabindex", "0"),
                    s.appendChild(this.helpers.addSvgIcon(t.icon, t.color)),
                    t.registerEvents &&
                      t.registerEvents.length &&
                      t.registerEvents.forEach(function (e) {
                        "click" !== e.type
                          ? s.addEventListener([e.type], function (t) {
                              if (t.target !== s) return !1;
                              e.callback(t);
                            })
                          : ga(s, e.callback);
                      }),
                    e.appendChild(s);
                }.bind(this)
              ),
              e
            );
          },
          updateActionArea: function () {
            this.iframe.getElementById("action-area-chat") &&
              this.helpers.removeElement(
                this.iframe.getElementById("action-area-chat")
              ),
              this.textareaDiv.appendChild(this.renderActionArea());
          },
          resizeMessageInputArea: function (e) {
            var t = this._isExpandNeeded();
            this.helpers.expandFooter(t),
              t
                ? this.helpers.elementAddClass(
                    this.iframe.getElementById("textarea-div"),
                    "bottom-position"
                  )
                : this.iframe.querySelector("#textarea-div.bottom-position") &&
                  this.helpers.elementRemoveClass(
                    this.iframe.getElementById("textarea-div"),
                    "bottom-position"
                  );
            var s = this.iframe.getElementById("messages-content");
            if (s) {
              var i =
                "messages-content messages-" + (t ? "collapse" : "expand");
              ("notextarea" !== e && "special-feature" !== e) ||
                ((i = "messages-content"),
                (i += t
                  ? " messages-notextarea-with-expand"
                  : " messages-notextarea")),
                (s.className = i);
            }
          },
          createMenu: function () {
            var e = new ListView(),
              t = {
                direction: e.direction.BOTTOM,
                id: "chat-menu",
              },
              s = e.createWrapper(t);
            return (
              this.getState("menuItems").forEach(function (t, i) {
                s.appendChild(e.createItem(t, i));
              }),
              s
            );
          },
          _isExpandNeeded: function () {
            var e = !1;
            null !== this.options.logoImageUrl &&
              "footer" === this.options.logoPlacement &&
              (e = !0);
            for (
              var t = this.iframe.getElementById("buttons-chat-div").childNodes,
                s = 0;
              s < t.length;
              s++
            )
              if ("none" !== t[s].style.display) {
                e = !0;
                break;
              }
            return e;
          },
          setIsMobile: function (e) {
            this.helpers.isInsideGWT() && (this.isMobile = e);
          },
          addMessageToGWT: function (e, t, s) {
            this.helpers.isInsideGWT() &&
              this.messageView.addMessageToGWT(e, t, s);
          },
          addButtonOptionsToGWT: function (e) {
            this.helpers.isInsideGWT() &&
              this.messageView.addButtonOptionsToGWT(JSON.parse(e));
          },
          setAgentDetailsinGWT: function (e, t) {
            this.helpers.isInsideGWT() &&
              (this.messageView.setAgentName(e),
              this.messageView.setAgentAvatar(this.options.staticUrl + t));
          },
          getMessageView: function () {
            return this.messageView;
          },
          focusMessageInputArea: function () {
            this.helpers.isInsideGWT() ||
              !SnapEngage.isChatInProgress() ||
              this.isMobile ||
              (this.chatMessageTextarea.focus(),
              SnapEngageChat.getMessageCookie() &&
                (this.chatMessageTextarea.value = SnapEngageChat.getMessageCookie()));
          },
          getIsVisible: function () {
            return this.isVisible;
          },
          renderEmailActionButton: function () {
            var e = {
                name: "email",
                icon: "icn-envelope",
                color: this.options.chatSendButton.bgColor,
                alt: "request email transcript",
              },
              t = document.createElement("div");
            (t.id = "action-item-" + e.name),
              (t.className = "action-item hidden"),
              t.setAttribute("alt", e.alt),
              t.setAttribute("tabindex", "0"),
              t.appendChild(this.helpers.addSvgIcon(e.icon, e.color)),
              this.iframe.getElementById("action-area-chat").appendChild(t);
          },
          setUiElementVariable: function (e, t) {
            this[e] = this.iframe.getElementById(t);
          },
          showGoogleLogo: function () {
            var e;
            this.googleTranslateLogo =
              (((e = document.createElement("img")).src =
                SnapEngage.getBaseURL() +
                "/hub/images/auto-translate/color-regular@3x.png"),
              (e.id = "google-translate-logo"),
              e);
            var t = this.messagesContent;
            t && t.insertBefore(this.googleTranslateLogo, t.firstChild);
          },
          removeGoogleLogo: function () {
            this.helpers.removeElement(this.googleTranslateLogo);
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.ChatView = t);
      })(window);
      var wa = 13,
        va = 32;
      function ga(e, t) {
        e &&
          t &&
          (e.addEventListener("click", function (e) {
            t(e);
          }),
          e.addEventListener("keydown", function (e) {
            (e.keyCode !== wa && e.keyCode !== va) || t(e);
          }));
      }
      !(function (t) {
        function e(e, i) {
          (this.target = i),
            (this.options = e),
            (this.helpers =
              this.helpers ||
              new t.chat_custom_design.Helpers(this.options, this.target)),
            (this.fieldsView =
              this.fieldsView ||
              new t.chat_custom_design.FieldsView(this.options, this.target)),
            (this.mainView =
              this.mainView ||
              new t.chat_custom_design.MainView(this.options, this.target)),
            (this.isVisible = !1),
            (this.showPrechat = !1),
            (this.isOnline = !0),
            (this.allowOffline = !0),
            (this.isMobile = this.helpers.isMobileDevice()),
            (this.iframe = document.getElementById(
              this.helpers.getIframeId()
            ).contentWindow.document),
            (this.prechat = this.iframe.getElementById("prechat")),
            (this.footer = this.iframe.getElementById("footer"));
        }
        (e.prototype = {
          bind: function (t, e) {
            "prechatChatButtonClick" === t &&
              this.prechatChatButton.addEventListener("click", function () {
                e();
              });
          },
          render: function () {
            (this.prechat = this.iframe.getElementById("prechat")),
              (this.prechatContent = this.prechatContentTemplate()),
              this.prechat.appendChild(this.prechatContent),
              (this.prechatForm = this.prechatFormTemplate()),
              this.prechatContent.appendChild(this.prechatForm),
              this.prechatForm.addEventListener("keydown", function (t) {
                if (13 === t.keyCode) return t.preventDefault(), !1;
              }),
              this.fieldsView.renderFields("prechat"),
              (this.prechatChatButton = this.iframe.getElementById(
                "button-start-chat"
              ));
          },
          destroy: function () {
            this.helpers.removeElement(this.prechatContent),
              this.helpers.removeChildren(
                this.iframe.getElementById("button-start-chat")
              );
          },
          refresh: function () {
            this.destroy(), this.render();
          },
          getFieldsView: function () {
            return this.fieldsView;
          },
          _setFieldFontSize: function (t, e) {},
          toggle: function () {
            this.isVisible ? this.hide() : this.show();
          },
          show: function () {
            (this.isVisible = !0),
              this.mainView.show(),
              (this.prechat.style.display = "inline"),
              this.helpers.toggleHeader("prechat"),
              this.helpers.toggleFooterButtons("prechat");
          },
          hide: function () {
            (this.isVisible = !1),
              this.mainView.hide(),
              (this.prechat.style.display = "none"),
              this.helpers.toggleHeader("none"),
              this.helpers.toggleFooterButtons("none");
          },
          setShowPrechat: function (t) {
            this.showPrechat = t;
          },
          getShowPrechat: function () {
            return this.showPrechat;
          },
          prechatContentTemplate: function () {
            var t = this.iframe.createElement("div");
            return (
              (t.id = "prechat-content"), (t.className = "prechat-content"), t
            );
          },
          prechatFormTemplate: function () {
            var t = this.iframe.createElement("form");
            return (
              (t.className = "prechat-form"),
              (t.id = "prechat-form"),
              t.setAttribute("name", "prechat-form"),
              t
            );
          },
          setIsMobile: function (t) {
            this.helpers.isInsideGWT() && (this.isMobile = t);
          },
        }),
          (t.chat_custom_design = t.chat_custom_design || {}),
          (t.chat_custom_design.PrechatView = e);
      })(window);
      !(function (e) {
        function i(i, t) {
          (this.options = i),
            (this.target = t),
            (this.helpers =
              this.helpers ||
              new e.chat_custom_design.Helpers(this.options, this.target)),
            (this.fieldsView =
              this.fieldsView ||
              new e.chat_custom_design.FieldsView(this.options, this.target)),
            (this.mainView =
              this.mainView ||
              new e.chat_custom_design.MainView(this.options, this.target)),
            (this.isVisible = !1),
            (this.isOnline = !0),
            (this.allowOffline = !0),
            (this.isMobile = this.helpers.isMobileDevice()),
            (this.iframe = document.getElementById(
              this.helpers.getIframeId()
            ).contentWindow.document),
            (this.footer = this.iframe.getElementById("footer"));
        }
        (i.prototype = {
          bind: function (e, i) {
            "offlineSendEmailButtonClick" === e &&
              this.offlineSendEmailButton.addEventListener("click", function (
                e
              ) {
                e.preventDefault(), i();
              });
          },
          render: function () {
            (this.offline = this.iframe.getElementById("offline")),
              (this.offlineContent = this.offlineContentTemplate()),
              this.offline.appendChild(this.offlineContent),
              (this.offlineForm = this.offlineFormTemplate()),
              this.offlineContent.appendChild(this.offlineForm),
              this.offlineForm.addEventListener("keydown", function (e) {
                if (13 === e.keyCode) return e.preventDefault(), !1;
              }),
              this.getFieldsView().renderFields("offline"),
              (this.offlineSendEmailButton = this.iframe.getElementById(
                "button-send-email"
              ));
          },
          destroy: function () {
            this.helpers.removeElement(this.offlineContent),
              this.helpers.removeChildren(
                this.iframe.getElementById("button-send-email")
              );
          },
          getFieldsView: function () {
            return this.fieldsView;
          },
          _setFieldFontSize: function (e, i) {},
          toggle: function () {
            this.isVisible ? this.hide() : this.show();
          },
          show: function () {
            this.offlineMessageSubmitted ||
              (this.offline ||
                (this.offline = this.iframe.getElementById("offline")),
              (this.isVisible = !0),
              this.mainView.show(),
              (this.offline.style.display = "inline"),
              this.helpers.toggleHeader("offline"),
              this.helpers.toggleFooterButtons("offline"));
          },
          hide: function () {
            (this.isVisible = !1),
              this.mainView.hide(),
              (this.offline.style.display = "none"),
              this.helpers.toggleHeader("none"),
              this.helpers.toggleFooterButtons("none");
          },
          setShowOffline: function (e) {
            this.showOffline = e;
          },
          offlineContentTemplate: function () {
            var e = this.iframe.createElement("div");
            return (
              (e.id = "offline-content"), (e.className = "offline-content"), e
            );
          },
          offlineFormTemplate: function () {
            var e = this.iframe.createElement("form");
            return (
              (e.className = "offline-form"),
              (e.id = "offline-form"),
              e.setAttribute("name", "offline-form"),
              e
            );
          },
          setIsMobile: function (e) {
            this.helpers.isInsideGWT() && (this.isMobile = e);
          },
          initOfflineConfirmMsg: function (e) {
            var i = this.iframe.createElement("div");
            (i.id = "container-offline-message-confirm"),
              (i.className = "container-agent-message");
            var t = this.iframe.createElement("div");
            (t.className = "agent-message offline-message"), i.appendChild(t);
            var n = this.iframe.createElement("div");
            (n.className = "message-text message-offline-confirm"),
              (n.innerHTML = SnapEngage.getMessage(7)),
              t.appendChild(n),
              (e
                ? this.iframe.getElementById("prechat-content")
                : this.offlineContent
              ).appendChild(i);
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.OfflineView = i);
      })(window);
      function ua() {
        var e = ((SnapABug.getCustomDesignUI() || {}).searchResultsView || {})
          .lastCardsResults;
        return (
          !!e && (e.parentElement && e.parentElement.lastElementChild) === e
        );
      }
      !(function (e) {
        function t(t, s, i) {
          (this.options = t),
            (this.target = s),
            (this.helpers =
              this.helpers ||
              new e.chat_custom_design.Helpers(this.options, this.target)),
            (this.stylesheet =
              this.stylesheet ||
              new e.chat_custom_design.Style(this.options, this.helpers)),
            (this.iframe = document.getElementById(
              this.helpers.getIframeId()
            ).contentWindow.document),
            (this.isMobile = this.helpers.isMobileDevice()),
            (this.systemMessageToBeRemoved = []),
            (this.isVisible = !1),
            (this.messageAlreadyShowing = !1),
            (this.isOnline = !1),
            (this.isSystemMessage = !1),
            (this.direction = e.chat_custom_design.direction
              ? " " + e.chat_custom_design.direction
              : ""),
            (this.lastMsgElement = null),
            (this.systemIds = i),
            (this.state = {
              lastMessageType: null,
              currentMessageType: null,
              agentName: null,
              agentAvatarUrl: null,
              isTransfer: !1,
              agentIsTyping: !1,
            }),
            (this.TYPE = {
              SYSTEM: 0,
              AGENT: 1,
              VISITOR: 2,
              BUTTON: 3,
              PAPER: 4,
            });
        }
        (t.prototype = {
          bind: function (e, t) {
            "autoResponderCancelChat" === e &&
              this.cancelChatLink.addEventListener("click", function () {
                t();
              });
          },
          setState: function (e, t) {
            this.state[e] = t;
          },
          getState: function (e) {
            return this.state[e];
          },
          render: function () {
            (this.iframe = this.iframe),
              (this.chat = this.iframe.getElementById("chat")),
              (this.messagesContent = this.messagesContentTemplate()),
              this.chat.appendChild(this.messagesContent),
              (this.cancelChatLink = this.iframe.createElement("a"));
          },
          showButtonUI: function (e) {
            this.helpers.isInsideGWT() ||
              (this.setIsSystemMessage(this.systemIds.BUTTON_OPTIONS),
              this.setSystemMessageToBeRemoved(this.systemIds.BUTTON_OPTIONS),
              this.setState("currentMessageType", this.TYPE.BUTTON));
            var t = document.createElement("div");
            (t.className = "message-block container-buttons-message"),
              this.helpers.isInsideGWT() ||
                (t.id = this.systemIds.BUTTON_OPTIONS),
              e.map(function (e, s) {
                t.appendChild(this.buttonMessageTemplate(e, s));
              }, this),
              this.messagesContent.appendChild(t);
          },
          buttonMessageTemplate: function (e, t) {
            var s = document.createElement("button");
            (s.id = e.id || "button-message-" + t),
              (s.className = "button-message"),
              (s.type = "button"),
              s.setAttribute("tabIndex", "0"),
              (s.innerHTML = e.text),
              (s.value = e.value ? e.value : e.text);
            return (
              ["click", "keypress"].forEach(function (t) {
                s.addEventListener(
                  t,
                  function (t) {
                    if (
                      (t.preventDefault(),
                      "keypress" === t.type &&
                        ("Enter" !== t.code || "Enter" !== t.key))
                    )
                      return !1;
                    SnapEngage.getCustomDesignUI().chatController.handleButtonMessageClick(
                      t,
                      e.text,
                      s.id
                    );
                  },
                  this
                );
              }),
              s
            );
          },
          addMessageToGWT: function (e, t, s) {
            var i;
            this.helpers.isInsideGWT() &&
              ((i = t
                ? this.agentMessageTemplate(e)
                : s
                ? this.systemMessageTemplate(e, !1)
                : this.visitorMessageTemplate(e, !1)),
              this.messagesContent.appendChild(i),
              this.updateScroll());
          },
          addButtonOptionsToGWT: function (e) {
            this.helpers.isInsideGWT() && this.showButtonUI(e);
          },
          setAgentName: function (e) {
            (e && "" !== e) || (e = " "),
              this.state.agentName &&
                this.state.agentName !== e &&
                (this.setState("isTransfer", !0),
                SnapEngage.getCustomDesignUI().setAgentAvatar(null),
                SnapABugChat.deleteCookie("SnapABugAgentAvatar")),
              this.setState("agentName", e),
              (this.lastMsgElement = null),
              this._setIsShortAlias(e);
          },
          setAgentAvatar: function (e) {
            this.setState("agentAvatarUrl", e);
          },
          updateChat: function (e, t, s, i) {
            var a;
            this.setLastMessageEl(),
              this.setState("lastMessageType", this.state.currentMessageType),
              (a = this.isSystemMessage
                ? this.TYPE.SYSTEM
                : t
                ? this.TYPE.VISITOR
                : this.TYPE.AGENT),
              this.setState("currentMessageType", a),
              (this.messageAlreadyShowing = !0),
              e &&
                (t
                  ? this._visitorChatMessage(e, s)
                  : this.state.currentMessageType === this.TYPE.SYSTEM
                  ? this._systemChatMessage(e, s, i)
                  : this.state.currentMessageType === this.TYPE.AGENT &&
                    (this.setState("agentIsTyping", !1),
                    this._agentChatMessage(e),
                    this.state.isTransfer && this.setState("isTransfer", !1)),
                this.updateScroll());
          },
          showAutoResponder: function (e) {
            var t = this.helpers.splitMessageAndLink(e);
            return this.updateChatAutoResponder(
              t.message1,
              t.message2,
              t.linkStr
            );
          },
          _systemChatMessage: function (e, t, s) {
            var i =
              this.isSystemMessage === this.systemIds.WAGT_AUTO_RESPOND
                ? this.showAutoResponder(e)
                : this.systemMessageTemplate(e, t);
            this.iframe.getElementById("messages-content").appendChild(i),
              (this.isSystemMessage = !1);
          },
          setLastMessageEl: function () {
            var e = this.chat.querySelectorAll(".message-block");
            (e = e[e.length - 1]), (this.lastMsgElement = e);
          },
          _visitorChatMessage: function (e, t) {
            if (
              this.options.visitorMessage.bubble &&
              this.lastMsgElement &&
              this.state.lastMessageType === this.TYPE.VISITOR
            ) {
              var s = this.innerVisitorMessageTemplate(e, "-bubble", t);
              this.insertMessageWithGroup(s, ".visitor-details-bubble");
            } else {
              var i = this.visitorMessageTemplate(e, t);
              this.iframe.getElementById("messages-content").appendChild(i);
            }
          },
          _agentChatMessage: function (e) {
            var t, s;
            if (
              (SnapEngageChat.setIsHumanResponded(
                SnapEngageChat.getNickname().length > 0
              ),
              this.removeAgentIsTyping(),
              this.systemMessageToBeRemoved.length)
            )
              for (
                var i = this.systemMessageToBeRemoved.length - 1;
                i >= 0;
                --i
              )
                switch (this.systemMessageToBeRemoved[i]) {
                  case this.systemIds.CLOSE_WARN:
                  case this.systemIds.FURV_FILE_UPLOAD:
                    this.setState(
                      "lastMessageType",
                      this.lastMsgElement.className.indexOf("agent") >=
                        this.TYPE.SYSTEM
                        ? this.TYPE.AGENT
                        : this.TYPE.VISITOR
                    );
                    break;
                  default:
                    this.messageToBeRemoved(this.systemMessageToBeRemoved[i]);
                }
            if (this.options.visitorMessage.bubble && this.lastMsgElement) {
              if (
                this.state.lastMessageType === this.TYPE.AGENT &&
                !this.state.isTransfer
              ) {
                if (ua(this.iframe))
                  return this.iframe
                    .getElementById("messages-content")
                    .appendChild(this.agentMessageTemplate(e));
                var a = this.innerAgentMessageTemplate(
                  e,
                  "-bubble",
                  this._isAvatarAvailable()
                );
                return this.insertMessageWithGroup(a, ".agent-alias");
              }
              if (
                this.state.lastMessageType === this.TYPE.VISITOR &&
                this.systemMessageToBeRemoved.length
              )
                return (
                  (t = ".system-message"),
                  (s = this.agentMessageTemplate(e)),
                  this.insertMessageBeforeLastOnOwn(s, t)
                );
              if (this.state.lastMessageType === this.TYPE.PAPER)
                return (
                  (t = ".card"),
                  (s = this.agentMessageTemplate(e)),
                  this.insertMessageWithGroup(s, t)
                );
            }
            (s = this.agentMessageTemplate(e)),
              this.iframe.getElementById("messages-content").appendChild(s);
          },
          _setIsShortAlias: function (e) {
            if (null != e) {
              var t = document.createElement("span");
              (t.style.visibility = "hidden"),
                (t.style.whiteSpace = "nowrap"),
                (t.innerHTML = e),
                (t.className = "agent-alias"),
                (t.id = "hidden-alias");
              var s = this.helpers.isInsideGWT()
                ? document.getElementById(this.target).children[0]
                : this.iframe.body;
              s.appendChild(t);
              var i = s.querySelector("#hidden-alias");
              i.offsetWidth <= 40 / this.helpers.getScale() && i.offsetWidth > 0
                ? (this.isShortAlias = !0)
                : (this.isShortAlias = !1),
                this.helpers.removeElement(i);
            } else this.isShortAlias = !1;
          },
          clearMessages: function () {
            this.messagesContent.innerHTML = "";
          },
          setSystemMessageToBeRemoved: function (e) {
            e !== this.systemIds.START &&
              e !== this.systemIds.SDTM_SECURE_DATA &&
              this.systemMessageToBeRemoved.push(e);
          },
          messageToBeRemoved: function (e) {
            var t = this.systemMessageToBeRemoved.indexOf(e);
            t >= 0 &&
              (this.helpers.removeElement(
                this.iframe.getElementById(this.systemMessageToBeRemoved[t])
              ),
              this.systemMessageToBeRemoved.splice(t, 1));
          },
          setIsSystemMessage: function (e) {
            this.isSystemMessage = e;
          },
          clearSystemMessage: function (e) {
            this.setIsSystemMessage(!1),
              this.messageToBeRemoved(e),
              this.setState(
                "currentMessageType",
                this.state.currentMessageType !== this.TYPE.SYSTEM
                  ? this.state.currentMessageType
                  : this.state.lastMessageType
              ),
              this.setLastMessageEl();
          },
          isMessageAlreadyShowing: function () {
            return this.messageAlreadyShowing;
          },
          triggerAgentIsTyping: function (e) {
            this.setState("agentIsTyping", e),
              e ? this.addAgentIsTyping() : this.removeAgentIsTyping();
          },
          addAgentIsTyping: function () {
            this.isAgentTyping ||
              ((this.isAgentTyping = !0),
              this.iframe
                .getElementById("messages-content")
                .appendChild(this.agentIsTypingTemplate()),
              this.updateScroll());
          },
          removeAgentIsTyping: function () {
            var e = this.iframe.getElementById("agent-is-typing");
            e &&
              ((this.isAgentTyping = !1),
              this.helpers.removeElement(e),
              this.setLastMessageEl());
          },
          setVisitorIsUploading: function () {
            (this.messagesContent = this.iframe.getElementById(
              "messages-content"
            )),
              this.isVisitorUploading ||
                ((this.isVisitorUploading = !0),
                this.messagesContent.appendChild(
                  this.visitorIsUploadingTemplate()
                ),
                this.updateScroll());
          },
          _removeVisitorIsUploading: function () {
            var e = this.iframe.getElementById("visitor-is-uploading");
            e &&
              ((this.isVisitorUploading = !1), this.helpers.removeElement(e));
          },
          updateScroll: function () {
            var e = this;
            setTimeout(function () {
              var t = e.iframe.getElementById("messages-content");
              void 0 !== t && (t.scrollTop = t.scrollHeight);
            }, 30);
          },
          messagesContentTemplate: function () {
            var e = this.iframe.createElement("div");
            return (
              (e.className = "messages-content"),
              (e.id = "messages-content"),
              e.setAttribute("role", "log"),
              e
            );
          },
          botButtonTemplate: function (e) {
            var t = this.iframe.createElement("input");
            return (
              (t.className = "button"),
              (t.id = "bot-button-" + e),
              t.setAttribute("type", "button"),
              (t.value = e),
              t
            );
          },
          agentMessageTemplate: function (e) {
            var t = this.options.agentMessage.bubble ? "-bubble" : "",
              s = this.iframe.createElement("div");
            if (
              ((s.className = "message-block container-agent-message" + t),
              this._isAvatarAvailable())
            ) {
              var i = this.iframe.createElement("div");
              (i.className = "agent-details" + t), s.appendChild(i);
              var a = this.iframe.createElement("img");
              a.setAttribute("alt", ""),
                (a.className = "agent-avatar"),
                a.setAttribute("src", this.state.agentAvatarUrl),
                i.appendChild(a);
            }
            var n = this.innerAgentMessageTemplate(
              e,
              t,
              this._isAvatarAvailable()
            );
            s.appendChild(n);
            var r = this.iframe.createElement("div");
            return (
              (r.className = "agent-alias" + this.direction),
              this.state.agentName && "Chat Bot" !== this.state.agentName
                ? ((r.innerHTML = this.state.agentName),
                  this.getState("agentIsTyping")
                    ? (r.innerHTML += " " + SnapEngage.getMessage(66))
                    : (r.className += this._shortAliasCSS()))
                : (r.innerHTML = ""),
              s.appendChild(r),
              s
            );
          },
          visitorMessageTemplate: function (e, t) {
            var s = this.options.visitorMessage.bubble ? "-bubble" : "",
              i = this.iframe.createElement("div");
            i.className = "message-block container-visitor-message" + s;
            var a = this.innerVisitorMessageTemplate(e, s, t);
            i.appendChild(a);
            var n = this.iframe.createElement("div");
            (n.className = "visitor-details" + s + this.direction),
              i.appendChild(n);
            var r = this.iframe.createElement("div");
            return (
              (r.className = "visitor-alias"),
              (r.innerHTML = this.helpers._deactivateHTML(
                this.options.visitorName
              )),
              n.appendChild(r),
              i
            );
          },
          systemMessageTemplate: function (e, t) {
            if (t && "<" !== e.charAt(0)) {
              e = "<span>" + e + "</span>";
            }
            var s = this.options.agentMessage.bubble ? "-bubble" : "",
              i = this.iframe.createElement("div");
            (i.className = "container-agent-message" + s + " system-message"),
              (i.id = this.isSystemMessage);
            var a = this.iframe.createElement("div");
            (a.className = "agent-message" + s + " full"), i.appendChild(a);
            var n = this.iframe.createElement("div");
            return (
              (n.className = "message-text"),
              (n.innerHTML = e),
              a.appendChild(n),
              i
            );
          },
          _shortAliasCSS: function () {
            return (
              " " +
              (this.isShortAlias &&
              this._isAvatarAvailable() &&
              this.options.agentMessage.bubble
                ? "short-alias"
                : "long-alias")
            );
          },
          innerVisitorMessageTemplate: function (e, t, s) {
            var i = this.iframe.createElement("div");
            i.className = "visitor-message" + t + this.direction;
            var a = this.iframe.createElement("div");
            return (
              (a.className = "message-text"),
              (a.innerHTML =
                this.helpers.isInsideGWT() || s
                  ? e
                  : SnapEngage.deactivateHTML(e)),
              i.appendChild(a),
              i
            );
          },
          innerAgentMessageTemplate: function (e, t, s) {
            var i = this.iframe.createElement("div");
            i.className =
              "agent-message" +
              t +
              (s ? " has-avatar" : " no-avatar") +
              this.direction;
            var a = this.iframe.createElement("div");
            return (
              (a.className = "message-text"),
              (a.innerHTML = e),
              i.appendChild(a),
              i
            );
          },
          insertMessageWithGroup: function (e, t) {
            var s = this.lastMsgElement.parentNode.querySelectorAll(t);
            (s = s[s.length - 1]).parentNode.insertBefore(e, s);
          },
          insertMessageBeforeLastOnOwn: function (e, t) {
            var s = this.chat.querySelectorAll(t);
            (s = s[s.length - 1]).parentNode.insertBefore(e, s);
          },
          agentIsTypingTemplate: function () {
            var e = this.agentMessageTemplate(
              '<div class="wrapper--progress"><div class="agent-line-typing"></div><div class="agent-line-typing"></div><div class="agent-line-typing"></div></div>'
            );
            return e.setAttribute("id", "agent-is-typing"), e;
          },
          visitorIsUploadingTemplate: function () {
            var e = this.visitorMessageTemplate(
              '<div class="wrapper--progress"><div class="visitor-line-upload"></div><div class="visitor-line-upload"></div><div class="visitor-line-upload"></div></div>',
              !0
            );
            return e.setAttribute("id", "visitor-is-uploading"), e;
          },
          _isAvatarAvailable: function () {
            return !!this.state.agentAvatarUrl;
          },
          updateChatAutoResponder: function (e, t, s) {
            var i = this.iframe.createElement("div");
            (i.className = "container-agent-message"),
              (i.id = this.systemIds.WAGT_AUTO_RESPOND);
            var a = this.iframe.createElement("div");
            (a.className = "agent-message full"), i.appendChild(a);
            var n = this.iframe.createElement("div");
            if (
              ((n.className = "message-text"),
              (n.innerHTML = e),
              a.appendChild(n),
              s &&
                ((this.cancelChatLink.innerHTML = s),
                (this.cancelChatLink.className = "link-message"),
                n.appendChild(this.cancelChatLink)),
              t && "" !== t)
            ) {
              var r = this.iframe.createElement("span");
              (r.innerHTML = t), n.appendChild(r);
            }
            return i;
          },
          errorMessage: function () {
            var e = this.iframe.createElement("div");
            (e.id = this.systemIds.ERROR_MSG),
              (e.className = "container-agent-message");
            var t = this.iframe.createElement("div");
            (t.className = "agent-message error-message"), e.appendChild(t);
            var s = this.iframe.createElement("div");
            (s.className = "message-text message-error-text"),
              (s.innerHTML = SnapEngage.getMessage(8)),
              t.appendChild(s);
            var i = document.createElement("div");
            (i.id = "button-error-dismiss"), s.appendChild(i);
            var a = this.iframe.createElement("input");
            (a.className = "button btn-primary"),
              (a.id = "error-dismiss"),
              a.setAttribute("type", "button"),
              (a.value = "OK"),
              i.appendChild(a),
              this.iframe
                .getElementById(
                  "main-" + (this.isMobile ? "mobile" : "desktop")
                )
                .appendChild(e);
          },
          _chatCloseWarning: function (e) {
            return (
              (this.helpers.isInsideGWT()
                ? "End this chat?"
                : SnapEngage.getMessage(46)) +
              "<br><br>" +
              (this.helpers.isInsideGWT()
                ? "Closing this box will end the chat with {alias}."
                : SnapEngage.getMessage(47)
              ).replace("{alias}", e)
            );
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.MessageView = t);
      })(window);
      !(function (e) {
        function t(t, i) {
          (this.target = i),
            (this.options = t),
            (this.helpers =
              this.helpers ||
              new e.chat_custom_design.Helpers(this.options, this.target)),
            (this.iframe = document.getElementById(
              this.helpers.getIframeId()
            ).contentWindow.document),
            (this.direction = e.chat_custom_design.direction
              ? " " + e.chat_custom_design.direction
              : "");
        }
        (t.prototype = {
          bind: function (e, t, i) {
            var a,
              r = this,
              l = this.iframe.querySelectorAll(".field-input");
            for (a = 0; a < l.length; a++)
              l[a].className.indexOf(t) >= 0 &&
                ("fieldFocusPreChat" === e
                  ? r.addEvent(l[a], "focus", i)
                  : "fieldBlurPreChat" === e
                  ? r.addEvent(l[a], "blur", i)
                  : "fieldFocusOffline" === e
                  ? l[a].classList.contains(t) && r.addEvent(l[a], "focus", i)
                  : "fieldBlurOffline" === e && r.addEvent(l[a], "blur", i));
            var n = r.iframe.querySelector(
              "." + t + "-dropdown#widgetselector"
            );
            if (
              (n &&
                ("widgetOptionsPreChat" === e
                  ? r.addEvent(n, "change", i)
                  : "widgetOptionsOffline" === e && r.addEvent(n, "change", i)),
              "checkboxPreChat" === e || "checkboxOffline" === e)
            ) {
              var s = r.iframe.querySelectorAll("." + t + "-checkbox");
              0 !== s.length &&
                Array.prototype.forEach.call(s, function (e) {
                  r.addEvent(e, "change", i);
                });
            }
          },
          addEvent: function (e, t, i) {
            e.addEventListener(t, function (e) {
              i(e);
            });
          },
          renderFields: function (e) {
            var t, i;
            if (
              ("prechat" === e
                ? ((t = this.iframe.getElementById("prechat-form")),
                  (i = this.options.prechatFields))
                : "offline" === e &&
                  ((t = this.iframe.getElementById("offline-form")),
                  (i = this.options.offlineFields)),
              void 0 !== i)
            ) {
              for (var a, r, l, n = 0, s = 0; s < i.length; s++)
                "textarea" === i[s].type && n++;
              for (r = i.length - 1; r >= 0; r--)
                switch ((a = i[r]).type) {
                  case "textarea":
                    (l = this.textAreaTemplate(a, e)),
                      t.insertBefore(l, t.firstChild),
                      i.length <= 2 &&
                        n <= 1 &&
                        this.helpers.elementAddClass(
                          this.iframe.querySelector("." + e + "-textarea"),
                          "textarea-tall"
                        );
                    break;
                  case "text":
                  case "email":
                  case "tel":
                    (l = this.textInputTemplate(a, e)),
                      t.insertBefore(l, t.firstChild);
                    break;
                  case "radio":
                  case "checkbox":
                    (l = this.checkboxTemplate(a, e)),
                      t.insertBefore(l, t.firstChild);
                    break;
                  case "label":
                    (l = this.freeFormLabelTemplate(a, e)),
                      t.insertBefore(l, t.firstChild);
                    break;
                  case "dropdown":
                  case "widgetselector":
                    (l = this.dropdownTemplate(a, e)),
                      t.insertBefore(l, t.firstChild);
                }
            }
          },
          addRequiredSymbol: function (e) {
            return e ? "*" : "";
          },
          labelSpan: function (e) {
            var t = this.iframe.createElement("span");
            return (t.className = "required-symbol"), (t.innerHTML = e), t;
          },
          textInputTemplate: function (e, t) {
            var i,
              a = this.addRequiredSymbol(e.required),
              r = t + "-" + e.name,
              l = this.iframe.createElement("div");
            l.setAttribute("data-ref", r),
              (l.className = "field div-text"),
              ((i = this.iframe.createElement("label")).className =
                t + "-textinput-label"),
              (i.innerHTML = e.label),
              i.setAttribute("for", e.name),
              a && i.appendChild(this.labelSpan(a)),
              l.appendChild(i),
              (i = l);
            var n = this.iframe.createElement("input");
            return (
              (n.className = t + "-textinput field-input"),
              n.setAttribute("id", e.name),
              n.setAttribute("name", e.name),
              n.setAttribute("type", e.type),
              n.setAttribute("label", e.label),
              n.setAttribute("placeholder", e.placeholder),
              this.addRequiredAttribute(n, e.required),
              l.appendChild(n),
              l
            );
          },
          textAreaTemplate: function (e, t) {
            var i,
              a = this.addRequiredSymbol(e.required),
              r = t + "-" + e.name,
              l = this.iframe.createElement("div");
            l.setAttribute("data-ref", r),
              (l.className = "field div-textarea"),
              ((i = this.iframe.createElement("label")).className =
                t + "-textarea-label"),
              (i.innerHTML = e.label),
              i.setAttribute("for", e.name),
              l.appendChild(i),
              a && i.appendChild(this.labelSpan(a)),
              (i = l);
            var n = this.iframe.createElement("textarea");
            return (
              (n.className = t + "-textarea field-input"),
              n.setAttribute("id", e.name),
              n.setAttribute("name", e.name),
              n.setAttribute("type", e.type),
              n.setAttribute("label", e.label),
              n.setAttribute("placeholder", e.placeholder),
              this.addRequiredAttribute(n, e.required),
              l.appendChild(n),
              l
            );
          },
          checkboxTemplate: function (e, t) {
            var i,
              a,
              r = this,
              l = t + "-" + e.name,
              n = this.iframe.createElement("div");
            n.setAttribute("data-ref", l), (n.className = "field div-checkbox");
            var s = this.iframe.createElement("div");
            (s.className = "checkbox-name"),
              (s.innerHTML = e.label),
              n.appendChild(s);
            var d = r.iframe.createElement("div");
            (d.className = t + "-checkbox-wrapper"),
              d.setAttribute("required", e.required),
              n.appendChild(d),
              e.options.forEach(function (i) {
                var n = r.iframe.createElement("div");
                (n.className = t + "-checkbox-item"), d.appendChild(n);
                var s = r.iframe.createElement("input");
                (s.className = t + "-checkbox field-input"),
                  s.setAttribute("id", l),
                  s.setAttribute("name", e.name),
                  s.setAttribute("type", "checkbox"),
                  s.setAttribute("value", "false"),
                  n.appendChild(s),
                  ((a = r.iframe.createElement("label")).className =
                    t + "-checkbox-label"),
                  (a.id = "checkbox-label"),
                  (a.innerHTML = i.displayText),
                  a.setAttribute("for", l),
                  n.appendChild(a);
              });
            var c = this.addRequiredSymbol(e.required);
            return (
              c &&
                (((i = r.iframe.createElement("span")).className =
                  "required-symbol"),
                (i.innerHTML = c),
                e.label ? s.appendChild(i) : a.appendChild(i)),
              n
            );
          },
          freeFormLabelTemplate: function (e, t) {
            var i = this.iframe.createElement("div");
            i.className = "field label-freeform";
            var a = this.iframe.createElement("label");
            return (
              (a.className = t + "-label-freeform"),
              a.setAttribute("name", e.name),
              (a.innerHTML = e.label),
              i.appendChild(a),
              i
            );
          },
          dropdownTemplate: function (e, t) {
            var i,
              a,
              r,
              l = t + "-" + e.name,
              n = this.iframe.createElement("div");
            n.setAttribute("data-ref", l), (n.className = "field div-dropdown");
            var s = this.iframe.createElement("span");
            (s.className = "dropdown" + this.direction),
              (s.id = "dropdown-form"),
              n.appendChild(s);
            var d = this.iframe.createElement("select");
            if (
              ((d.className = t + "-dropdown field-input"),
              d.setAttribute("id", e.name),
              d.setAttribute("name", e.name),
              d.setAttribute("selected", "selected"),
              e.required && d.setAttribute("required", !0),
              ((i = this.iframe.createElement("option")).innerHTML =
                e.placeholder),
              i.setAttribute("value", ""),
              i.setAttribute("selected", !0),
              i.setAttribute("disabled", !0),
              d.appendChild(i),
              null !== e.options)
            )
              for (var c = 0; c < e.options.length; c++)
                (a = this.iframe.createElement("option")).setAttribute(
                  "value",
                  e.options[c].value
                ),
                  a.setAttribute("id", e.name + "-" + (c + 1)),
                  (a.innerHTML = e.options[c].displayText),
                  d.appendChild(a);
            s.appendChild(d);
            var m = this.addRequiredSymbol(e.required);
            return (
              ((r = this.iframe.createElement("label")).className =
                t + "-textinput-label"),
              (r.innerHTML = e.label),
              r.setAttribute("for", e.name),
              n.appendChild(r),
              m && r.appendChild(this.labelSpan(m)),
              (r = n),
              n.appendChild(s),
              n
            );
          },
          telInputTemplate: function (e, t) {
            var i,
              a = t + "-" + e.name,
              r = this.addRequiredSymbol(e.required),
              l = this.iframe.createElement("div");
            l.setAttribute("data-ref", a),
              (l.className = "field div-tel"),
              ((i = this.iframe.createElement("label")).className =
                t + "-textinput-label"),
              (i.innerHTML = e.label),
              i.setAttribute("for", e.name),
              r && i.appendChild(this.labelSpan(r)),
              (i = l);
            var n = this.iframe.createElement("input");
            return (
              (n.className = t + "-textinput field-input"),
              n.setAttribute("id", e.name),
              n.setAttribute("name", e.name),
              n.setAttribute("type", e.type),
              n.setAttribute("label", e.label),
              n.setAttribute("placeholder", e.placeholder),
              this.addRequiredAttribute(n, e.required),
              l.appendChild(n),
              l
            );
          },
          addRequiredAttribute: function (e, t) {
            t && e.setAttribute("required", t);
          },
          _setFields: function (e, t) {
            var i = this.iframe.getElementsByName(e);
            if (i)
              for (var a = 0; a < i.length; a++)
                (i[a].value = t), "label" === i[a].type && (i[a].innerHTML = t);
          },
          setEmailField: function (e, t, i) {
            var a = i.querySelector('input[type="email"]');
            a &&
              ((a.value = e),
              t &&
                (a.setAttribute("readonly", !0),
                a.setAttribute("disabled", !0)));
          },
          setDescriptionField: function (e) {
            this._setFields("description", e);
          },
          setUserNameField: function (e) {
            this._setFields("name", e);
          },
          setCustomField: function (e, t) {
            this._setFields(e, t);
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.FieldsView = t);
      })(window);
      function la(t) {
        return (la =
          "function" == typeof Symbol && "symbol" == typeof Symbol.iterator
            ? function (t) {
                return typeof t;
              }
            : function (t) {
                return t &&
                  "function" == typeof Symbol &&
                  t.constructor === Symbol &&
                  t !== Symbol.prototype
                  ? "symbol"
                  : typeof t;
              })(t);
      }
      var qa = window.chat_custom_design.EmailTranscriptRequest,
        pa = window.chat_custom_design.Card;
      !(function (t) {
        function e(e) {
          (this.app = e),
            (this.options = e.options),
            (this.helpers =
              this.helpers ||
              new t.chat_custom_design.Helpers(this.options, this.target)),
            (this.stylesheet =
              this.stylesheet ||
              new t.chat_custom_design.Style(this.options, this.helpers)),
            (this.state = {
              isVisible: !1,
              isSurveyVisible: !1,
            });
        }
        (e.prototype = {
          setState: function (t, e) {
            this.state[t] = e;
          },
          getState: function (t) {
            return this.state[t];
          },
          bind: function (t, e) {
            var n,
              i,
              a = function () {
                e(this.id);
              };
            if ("mouseOverChatAgentSurveyRating" === t)
              for (
                i = this.iframe.querySelectorAll(".survey-rating-img"), n = 0;
                n < i.length;
                n++
              )
                i[n].addEventListener("mouseover", a);
            else if ("mouseOutChatAgentSurveyRating" === t)
              for (
                i = this.iframe.querySelectorAll(".survey-rating-img"), n = 0;
                n < i.length;
                n++
              )
                i[n].addEventListener("mouseout", a);
            else if ("mouseDownSetChatAgentSurveyRating" === t)
              for (
                i = this.iframe.querySelectorAll(".survey-rating-img"), n = 0;
                n < i.length;
                n++
              )
                i[n].addEventListener("click", a);
            else
              "submitSurveyComments" === t
                ? this.chatSurveySubmitButton.addEventListener(
                    "click",
                    function () {
                      e();
                    }
                  )
                : "cancelSubmitSurvey" === t &&
                  this.chatSurveyCancel.addEventListener("click", function () {
                    e();
                  });
          },
          render: function (t) {
            (this.iframe = document.getElementById(
              this.helpers.getIframeId()
            ).contentWindow.document),
              (this.messagesContent = this.iframe.getElementById(
                "messages-content"
              ));
            var e = document.createElement("div");
            if (
              ((e.id = "post-chat-content"),
              this.messagesContent.appendChild(e),
              (this.postChatContent = this.iframe.getElementById(
                "post-chat-content"
              )),
              this.renderTimerText(t.timeOut),
              (this.timerText = this.iframe.getElementById("postchat-timer")),
              this.renderEmailTranscript(t),
              "standard" === t.surveyContent)
            )
              (this.chatAgentSurveySettings = t.chatAgentSurvey),
                (this.selectedAgentSurveyRating = null),
                (this.populateChatAgentSurvey = this._populateChatAgentSurvey(
                  t
                )),
                e.appendChild(this.populateChatAgentSurvey),
                (this.chatSurveySubmitButton = this.iframe.getElementById(
                  "chatSurveySubmitButton"
                )),
                (this.chatSurveyCancel = this.iframe.getElementById(
                  "chatSurveyCancel"
                ));
            else if ("custom" === t.surveyContent)
              if (
                (this.findReplaceVariables(t),
                t.postChatSurveyContent.indexOf('src="') >= 0)
              )
                (t.postChatSurveyContent = t.postChatSurveyContent.replace(
                  "<iframe ",
                  '<iframe id="iframe-postchatsurvey-source" '
                )),
                  (e.innerHTML = t.postChatSurveyContent),
                  (this.postChatSurveyContentIframe = this.iframe.getElementById(
                    "iframe-postchatsurvey-source"
                  )),
                  this.postChatSurveyContentIframe.setAttribute(
                    "frameborder",
                    "0"
                  ),
                  this.postChatSurveyContentIframe.setAttribute(
                    "scrolling",
                    "true"
                  ),
                  this.postChatSurveyContentIframe.setAttribute(
                    "width",
                    "100%"
                  ),
                  this.postChatSurveyContentIframe.setAttribute(
                    "height",
                    "75%"
                  );
              else {
                (this.populateCustomSurveyIframe = this._populateCustomSurveyIframe(
                  t.surveyContent
                )),
                  e.appendChild(this.populateCustomSurveyIframe),
                  (this.customSurveyIframe = this.iframe.getElementById(
                    "iframe-chatSurveyCustomContainer"
                  ).contentWindow.document),
                  (this.populateCustomSurveyContents = this._populateCustomSurveyContents(
                    t
                  )),
                  this.customSurveyIframe.open(),
                  this.customSurveyIframe.write(
                    this.stylesheet.customSurveyStylesheet()
                  ),
                  this.customSurveyIframe.write(
                    this.populateCustomSurveyContents.outerHTML
                  ),
                  this.customSurveyIframe.close(),
                  this.searchForAnchor();
                var n = this.customSurveyIframe.childNodes[0].offsetHeight;
                this.iframe
                  .getElementById("iframe-chatSurveyCustomContainer")
                  .setAttribute("style", "height: " + n + "px;");
              }
            this.setState("isVisible", !0),
              t.surveyContent && this.setState("isSurveyVisible", !0);
          },
          toggle: function () {
            this.getState("isVisible") ? this.hide() : this.show();
          },
          show: function () {
            this.setState("isVisible", !0);
          },
          hide: function () {
            this.setState("isVisible", !1),
              (this.populateChatAgentSurvey.style.display = "none");
          },
          renderTimerText: function (t) {
            if (t > -1) {
              var e = document.createElement("div"),
                n = t / 60;
              (e.innerHTML =
                "The below content will close in <span id='endchat-counter'>" +
                Math.ceil(n) +
                " minutes</span>"),
                (e.id = "endchat-timer-helper-text"),
                this.postChatContent.appendChild(e);
            }
          },
          renderEmailTranscript: function (t) {
            if (
              this.app.chatView.getState("emailTranscriptEnabled") &&
              t.timeOut > -1 &&
              (!this.app.chatView.emailTranscriptCard ||
                !this.app.chatView.emailTranscriptCard.getState("isSubmitted"))
            ) {
              if (
                ((this.emailTranscriptCard = new qa({
                  helpers: this.helpers,
                  removeEmailTranscriptCallback: this.checkDisplayCloseButton.bind(
                    this
                  ),
                })),
                !Object.keys(this.emailTranscriptCard).length)
              )
                return !1;
              var e = this.emailTranscriptCard.createUI();
              this.emailTranscriptCard.getTranscriptEmailAddress(),
                this.postChatContent.appendChild(e),
                this.emailTranscriptCard.setState(
                  "emailTranscriptUiVisible",
                  !0
                ),
                this.emailTranscriptCard.setElementsRef(),
                this.emailTranscriptCard.bindEvents(),
                this.emailTranscriptCard.fadeInRequestWrapper();
            }
          },
          checkDisplayCloseButton: function () {
            if (!this.getState("isSurveyVisible")) {
              var t = SnapEngage.getCustomDesignUI().postChatController;
              t._showCloseButton(), t.removePostChatContent();
            }
          },
          _populateChatAgentSurvey: function (t) {
            var e = t.chatAgentSurvey,
              n = t.nickname,
              i = new pa({
                id: "chatSurveyRatingContainer",
              }).createUI();
            this.postChatContent.appendChild(i);
            var a = document.createElement("div");
            if (((a.id = "surveyQuestion"), n.length > 0)) {
              var s = SnapEngage.getMessage(22);
              (s = s.replace("{alias}", n)), (a.innerHTML = s);
            } else a.innerHTML = SnapEngage.getMessage(21);
            i.appendChild(a);
            var r = document.createElement("div");
            (r.id = "chatSurveyRating"), i.appendChild(r);
            for (var o = e.ratings, u = 0; u < o.length; u++) {
              var h = document.createElement("img");
              (h.className = "survey-rating-img"),
                (h.id = o[u].id),
                h.setAttribute("alt", o[u].text),
                (h.src = SnapEngage.getBaseURL() + o[u].defaultImg),
                r.appendChild(h);
            }
            var c = document.createElement("div");
            (c.id = "chatSurveyRatingText"), i.appendChild(c);
            var l = document.createElement("div");
            (l.id = "chatSurveyCommentsContainer"), i.appendChild(l);
            var m = document.createElement("textarea");
            (m.id = "chatSurveyComments"),
              (m.maxlength = "500"),
              (m.placeholder = SnapEngage.getMessage(23)),
              l.appendChild(m);
            var d = document.createElement("div");
            (d.id = "survey-buttons-wrapper"),
              (d.className = "wrapper-multi-buttons flex"),
              l.appendChild(d);
            var p = document.createElement("input");
            (p.type = "button"),
              (p.className = "multi-button-first btn-secondary button"),
              (p.id = "chatSurveyCancel"),
              (p.value = SnapEngage.getMessage(25).toUpperCase()),
              d.appendChild(p);
            var g = document.createElement("input");
            return (
              (g.type = "button"),
              (g.className = "multi-button-second button btn-primary"),
              (g.id = "chatSurveySubmitButton"),
              (g.type = "submit"),
              (g.value = SnapEngage.getMessage(24).toUpperCase()),
              d.appendChild(g),
              i
            );
          },
          findReplaceVariables: function (t) {
            return (
              (t.postChatSurveyContent = t.postChatSurveyContent.replace(
                /\{alias\}/g,
                t.nickname
              )),
              (t.postChatSurveyContent = t.postChatSurveyContent.replace(
                /\{case\}/g,
                t.caseId
              )),
              t
            );
          },
          _populateCustomSurveyIframe: function () {
            var t = document.createElement("iframe");
            return (
              (t.id = "iframe-chatSurveyCustomContainer"),
              (t.allowtransparency = "true"),
              (t.frameborder = 0),
              this.postChatContent.appendChild(t),
              t
            );
          },
          _populateCustomSurveyContents: function (t) {
            var e = document.createElement("div");
            return (
              (e.id = "chatSurveyHTML"),
              (e.innerHTML = t.postChatSurveyContent),
              e
            );
          },
          searchForAnchor: function () {
            this.customSurveyIframe.querySelectorAll("a").forEach(function (t) {
              t.setAttribute("target", "_blank");
            });
          },
          mouseoverChatAgentSurveyRating: function (t) {
            for (
              var e = this.chatAgentSurveySettings.ratings, n = 0;
              n < e.length;
              n++
            ) {
              this.iframe.getElementById(e[n].id).src =
                SnapEngage.getBaseURL() + e[n].selectedImg;
              var i = this.iframe.getElementById("chatSurveyRatingText");
              if (
                ((i.innerHTML = e[n].text),
                (i.style.display = "block"),
                e[n].id === t)
              ) {
                (this.iframe.getElementById(e[n].id).src =
                  SnapEngage.getBaseURL() + e[n].selectedImg),
                  (this.iframe.getElementById(
                    "chatSurveyRatingText"
                  ).innerHTML = e[n].text);
                break;
              }
            }
          },
          mouseoutChatAgentSurveyRating: function () {
            for (
              var t = this.chatAgentSurveySettings.ratings, e = t.length - 1;
              e >= 0;
              e--
            )
              this.iframe.getElementById(t[e].id).src =
                SnapEngage.getBaseURL() + t[e].defaultImg;
            this.selectedAgentSurveyRating
              ? this.mouseoverChatAgentSurveyRating(
                  this.selectedAgentSurveyRating.id
                )
              : (this.iframe.getElementById("chatSurveyRatingText").innerHTML =
                  "");
          },
          setChatAgentSurveyRating: function (t) {
            for (
              var e = this.chatAgentSurveySettings.ratings, n = 0;
              n < e.length;
              n++
            )
              if (e[n].id === t) {
                (this.selectedAgentSurveyRating = e[n]),
                  this.sendChatAgentSurveyRating(!1),
                  this.mouseoutChatAgentSurveyRating();
                break;
              }
            (this.iframe.getElementById(
              "chatSurveyCommentsContainer"
            ).style.display = "block"),
              (this.iframe.getElementById("messages-content").style.height =
                "calc(100% - " + this.stylesheet.em(100, 16) + ");");
          },
          sendChatAgentSurveyRating: function (t) {
            if (this.selectedAgentSurveyRating) {
              var e =
                SnapEngage.getBaseURL() +
                "/chatjs/postChat/recordSurvey?publicCaseId=" +
                SnapEngage.getCaseId() +
                "&rating=" +
                this.selectedAgentSurveyRating.id;
              if (t) {
                var n = this.iframe.getElementById("chatSurveyComments").value;
                n !== la("") &&
                  (e =
                    e + "&comments=" + encodeURIComponent(SnapEngage.trim(n)));
              }
              SnapEngage.rpc(e, 3, !0);
            }
          },
        }),
          (t.chat_custom_design = t.chat_custom_design || {}),
          (t.chat_custom_design.PostChatView = e);
      })(window);
      !(function (e) {
        function t(t) {
          (this.options = t),
            (this.isVisible = !1),
            (this.helpers =
              this.helpers ||
              new e.chat_custom_design.Helpers(this.options, this.target)),
            (this.stylesheet =
              this.stylesheet ||
              new e.chat_custom_design.Style(this.options, this.helpers)),
            (this.chatView =
              this.chatView || new e.chat_custom_design.ChatView(this.options)),
            (this.iframe = document.getElementById(
              this.helpers.getIframeId()
            ).contentWindow.document);
        }
        (t.prototype = {
          bind: function (e, t) {
            "callmeOnPhoneOptionClick" === e
              ? this.callmeOnPhoneOption.addEventListener("click", function () {
                  t();
                })
              : "callmeOnComputerOptionClick" === e
              ? this.callmeOnComputerOption.addEventListener(
                  "click",
                  function () {
                    t();
                  }
                )
              : "callmeOnPhoneSubmit" === e &&
                this.callmeOnPhoneSubmit.addEventListener("click", function () {
                  t();
                });
          },
          render: function () {
            (this.callmeDiv = this.iframe.getElementById("callme-div")),
              this.callmeDiv.appendChild(this.callmeMainViewTemplate()),
              this.callmeDiv.appendChild(this.callmeOnMyPhoneViewTemplate()),
              (this.callmeMainView = this.iframe.getElementById(
                "callme-main-view"
              )),
              (this.callmeOnMyPhoneView = this.iframe.getElementById(
                "callme-on-phone-view"
              )),
              (this.callmeOnComputerOption = this.iframe.getElementById(
                "SnapABug_CMW"
              )),
              (this.callmeOnPhoneOption = this.iframe.getElementById(
                "SnapABug_CMP"
              )),
              (this.callmeOnPhoneSubmit = this.iframe.getElementById(
                "callme-on-phone-submit"
              )),
              (this.callmeForm = this.iframe.getElementById("callme-form")),
              (this.phonenumber = this.iframe.getElementById("phonenumber")),
              this.callmeForm.addEventListener("keydown", function (e) {
                if (13 === e.keyCode) return e.preventDefault(), !1;
              });
          },
          refresh: function () {
            this.helpers.removeChildren(this.callmeDiv), this.render();
          },
          showCallMeView: function () {
            (this.isVisible = !0),
              (this.callmeDiv.style.display = "inline"),
              (this.callmeMainView.style.display = "inline"),
              (this.callmeOnMyPhoneView.style.display = "none"),
              this.chatView.showCancelCallmeButtons(),
              this.addPhonePickerScript();
          },
          showCallmeOnMyPhoneView: function () {
            (this.callmeMainView.style.display = "none"),
              (this.callmeOnMyPhoneView.style.display = "inline"),
              this.callmeForm.focus(),
              this.addPhonePickerUI();
          },
          hideCallmeViews: function () {
            (this.isVisible = !1),
              (this.callmeDiv.style.display = "none"),
              this.chatView.hideCancelCallmeButtons();
          },
          _callmeCss: function () {
            return [
              "position:absolute;display:block;margin:auto " +
                this.stylesheet.em(20, 12) +
                "padding:0;border:none;float:none;clear:none;width:calc(100% - " +
                this.stylesheet.em(40, 12, !0) +
                ");max-width:calc(100% - " +
                this.stylesheet.em(40, 12, !0) +
                ");min-width:calc(100% - " +
                this.stylesheet.em(40, 12, !0) +
                ");z-index:2;font-style:normal;font-weight:normal;line-height:normal;text-shadow:none;list-style:none;text-align:left;outline:none;text-indent:0;-moz-box-shadow:none;-webkit-box-shadow:none;font-family:Helvetica Neue, Helvetica, lucida grande, Arial, sans-serif;font-size:" +
                this.stylesheet.calcBaseFontSize(12) +
                "font-weight:normal;z-index: 2;color:#000;overflow:hidden;text-align:center;",
              "position:relative;text-align:center;padding:" +
                this.stylesheet.em(25, 12, !0) +
                " 0;height:100%;",
              "margin:" +
                this.stylesheet.em(10, 12, !0) +
                " 0;height:" +
                this.stylesheet.em(86, 12) +
                "background-size:" +
                this.stylesheet.em(200, 12) +
                "background-image:url(&quot;https://storage.googleapis.com/code.snapengage.com/wbg/callme_web_grey.png&quot;);background-repeat:no-repeat;background-position:center center;cursor:pointer;position:relative;color:rgb(77, 77, 77);",
              "width:100%;position:absolute;bottom:" +
                this.stylesheet.em(10, 12) +
                "font-family:arial, sans-serif;font-weight:normal;font-weight:bold;",
              "margin:" +
                this.stylesheet.em(10, 12, !0) +
                " 0;height:" +
                this.stylesheet.em(86, 12) +
                "background-size:" +
                this.stylesheet.em(200, 12) +
                "background-image: url(&quot;https://storage.googleapis.com/code.snapengage.com/wbg/callme_phone_grey.png&quot;);background-repeat: no-repeat;background-position: center center;cursor:pointer;position:relative;color:rgb(77, 77, 77);",
              "width:100%;position:absolute;bottom:" +
                this.stylesheet.em(10, 12) +
                "font-family:arial, sans-serif;font-weight:normal;font-weight:bold;",
            ];
          },
          callmeMainViewTemplate: function () {
            var e = document.createElement("div"),
              t = this._callmeCss();
            return (
              (e.id = "callme-main-view"),
              (e.innerHTML =
                '<div style="' +
                t[0] +
                '"><div id="SnapABug_CM" style="' +
                t[1] +
                '"><div id="SnapABug_CMW" style="' +
                t[2] +
                "\" onmouseover=\"document.getElementById('SnapABug_CMW').style.backgroundImage='url(" +
                SnapEngage.getStaticBaseURL() +
                "/wbg/callme_web_black.png)';document.getElementById('SnapABug_CMW').style.color='#FFFFFF';\" onmouseout=\"if (document.getElementById('SnapABug_CMW')) {document.getElementById('SnapABug_CMW').style.backgroundImage='url(" +
                SnapEngage.getStaticBaseURL() +
                "/wbg/callme_web_grey.png)';document.getElementById('SnapABug_CMW').style.color='#4d4d4d';}\"><div style=\"" +
                t[3] +
                '">' +
                SnapEngage.getMessage(38) +
                '</div></div><div id="SnapABug_CMP" style="' +
                t[4] +
                "\" onmouseover=\"document.getElementById('SnapABug_CMP').style.backgroundImage='url(" +
                SnapEngage.getStaticBaseURL() +
                "/wbg/callme_phone_black.png)';document.getElementById('SnapABug_CMP').style.color='#FFFFFF';\" onmouseout=\"if (document.getElementById('SnapABug_CMP')) {document.getElementById('SnapABug_CMP').style.backgroundImage='url(" +
                SnapEngage.getStaticBaseURL() +
                "/wbg/callme_phone_grey.png)';document.getElementById('SnapABug_CMP').style.color='#4d4d4d'};\"><div style=\"" +
                t[5] +
                '">' +
                SnapEngage.getMessage(39) +
                "</div></div></div></div>"),
              e
            );
          },
          _callmePhoneCss: function () {
            return [
              "text-align:center;position:absolute;height:calc(100% - " +
                this.stylesheet.em(80, 12, !0) +
                ");top:0;width:calc(100% - " +
                this.stylesheet.em(40, 12, !0) +
                ");padding:" +
                this.stylesheet.em(20, 12),
              "margin-top:" +
                this.stylesheet.em(6, 12) +
                "margin-bottom:" +
                this.stylesheet.em(6, 12) +
                "font-family:lucida grande, Helvetica Neue, Helvetica, Arial, sans-serif;font-size:" +
                this.stylesheet.calcBaseFontSize(12) +
                "color:grey;",
              "margin:0 " + this.stylesheet.em(10, 12),
              "height:" +
                this.stylesheet.em(30, 13) +
                "display:block;width:100%;margin:" +
                this.stylesheet.em(10, 13, !0) +
                " auto;font-family:lucida grande, Helvetica Neue, Helvetica, Arial, sans-serif;font-size:" +
                this.stylesheet.calcBaseFontSize(13) +
                "color:black;border:" +
                this.stylesheet.em(1, 13, !0) +
                " solid " +
                this.options.chatHeader.bgColor +
                ";",
            ];
          },
          callmeOnMyPhoneViewTemplate: function () {
            var e = document.createElement("div"),
              t = this._callmePhoneCss();
            return (
              (e.id = "callme-on-phone-view"),
              (e.innerHTML =
                '<div id="SnapABug_CMPFORM" style="' +
                t[0] +
                '"><div id="SnapABug_phone" style="' +
                t[1] +
                '">Enter your phone number</div><form name="callme-form" action="#" id="callme-form" accept-charset="UTF-8" style="' +
                t[2] +
                '"><input style="' +
                t[3] +
                '" type="tel" id="phonenumber" name="phonenumber" autofocus value="" size="16"><div id="callme-submit"><input type="button" class="button btn-primary" id="callme-on-phone-submit" value="' +
                SnapEngage.getMessage(41) +
                '"></div></form>'),
              e
            );
          },
          addPhonePickerUI: function () {
            if (this.getIsPhonePickerLoaded()) {
              var e = SnapEngage.getVisitorCountry();
              SnapEngage.phonePicker.init("phonenumber", e),
                SnapEngageChat.selectPhoneInputCountry(e),
                SnapEngage.phonePicker.setCountryListWindowHeight(150);
            }
          },
          addPhonePickerScript: function () {
            if (
              ((document.getElementById(
                this.helpers.getIframeId()
              ).contentWindow.window._1a058890_5788_4457_aa0e_3453f3f878a0 = SnapEngage),
              !this.getIsPhonePickerLoaded())
            ) {
              var e = document.createElement("script");
              (e.type = "text/javascript"),
                (e.src =
                  SnapEngage.getBaseURL() +
                  "/js/i18nphonepicker/i18nphonepicker-min.js"),
                this.iframe.head.appendChild(e),
                (e.onload = function () {
                  SnapEngage.getCustomDesignUI().callmeView.setIsPhonePickerLoaded(
                    !0
                  );
                  var e = document.createElement("link");
                  (e.rel = "stylesheet"),
                    (e.type = "text/css"),
                    (e.href =
                      SnapEngage.getBaseURL() +
                      "/js/i18nphonepicker/css/intlTelInput.css"),
                    SnapEngage.getCustomDesignIframe()
                      .getElementsByTagName("head")[0]
                      .appendChild(e);
                });
            }
          },
          setIsPhonePickerLoaded: function (e) {
            this.isPhonePickerLoaded = e;
          },
          getIsPhonePickerLoaded: function () {
            return this.isPhonePickerLoaded;
          },
          getIsVisible: function () {
            return this.isVisible;
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.CallmeView = t);
      })(window);
      !(function (e) {
        function t(t) {
          (this.options = t),
            (this.helpers =
              this.helpers || new e.chat_custom_design.Helpers(this.options)),
            (this.mainView =
              this.mainView || new e.chat_custom_design.MainView(this.options)),
            (this.isVisible = !1),
            (this.isMobile = this.helpers.isMobileDevice()),
            (this.searchInProgress = !1),
            (this.iframe = document.getElementById(
              this.helpers.getIframeId()
            ).contentWindow.document);
        }
        (t.prototype = {
          bind: function (e, t) {
            var i = this;
            "submitPrechatQuestion" === e
              ? (i.submitIntelliPrechatQuestion.addEventListener(
                  "click",
                  function () {
                    i.searchInput.value.length && t();
                  }
                ),
                i.searchInput.addEventListener("keyup", function (e) {
                  e.preventDefault(),
                    13 === e.keyCode && i.searchInput.value.length && t();
                }))
              : "contact" === e &&
                i.intelliNextButton.addEventListener("click", function () {
                  t();
                });
          },
          render: function () {
            this.helpers.expandFooter(!0),
              this.searchInProgress ||
                ((this.main = this.iframe.getElementById(
                  "main-" + (this.isMobile ? "mobile" : "desktop")
                )),
                (this.intelliPrechatContent = this._intelliPrechatTemplate()),
                this.main.appendChild(this.intelliPrechatContent),
                this._intelliPrechatFooterButtons(),
                (this.intelliPrechatButtonDiv = this.iframe.getElementById(
                  "buttons-special-div"
                )),
                (this.intelliNextButton = this.iframe.getElementById(
                  "button-next"
                )),
                (this.intelliPrechat = this.iframe.getElementById(
                  "container-intelliPrechat"
                )),
                this.intelliPrechat.appendChild(this._intelliPrechatForm()),
                (this.submitIntelliPrechatQuestion = this.iframe.getElementById(
                  "submit-intelliPrechatQuestion"
                )),
                (this.intelliPrechatForm = this.iframe.getElementById(
                  "form-intelliPrechatSearchQuestionForm"
                )),
                (this.searchInput = this.iframe.getElementById(
                  "input-intelliPrechatQuestion"
                )));
          },
          destroy: function () {
            this.helpers.removeElement(this.intelliPrechat);
          },
          refresh: function () {
            this.destroy();
          },
          toggle: function () {
            this.isVisible ? this.hide() : this.show();
          },
          show: function () {
            (this.isVisible = !0),
              (this.searchInProgress = !0),
              this.mainView.show(),
              (this.intelliPrechat.style.display = "block"),
              this.helpers.toggleHeader("prechat");
          },
          hide: function () {
            (this.isVisible = !1),
              (this.searchInProgress = !1),
              this.mainView.hide(),
              (this.intelliPrechat.style.display = "none"),
              this.helpers.toggleHeader("none"),
              this.disableFooterButtons();
          },
          enableFooterButtons: function () {
            this.intelliPrechatButtonDiv.style.display = "inline";
          },
          disableFooterButtons: function () {
            this.intelliPrechatButtonDiv.style.display = "none";
          },
          setIsMobile: function (e) {
            this.helpers.isInsideGWT() && (this.isMobile = e);
          },
          _intelliPrechatFooterButtons: function () {
            var e = document.createElement("div");
            (e.id = "buttons-special-div"),
              (e.style.display = "none"),
              this.iframe.getElementById("footer").appendChild(e);
            var t = document.createElement("div");
            (t.id = "button-next"), e.appendChild(t);
            var i = this.iframe.createElement("input");
            (i.className = "button"),
              (i.id = "intelliprechat-next"),
              i.setAttribute("type", "button"),
              (i.value = SnapEngage.getMessage(52)),
              t.appendChild(i);
          },
          _intelliPrechatTemplate: function () {
            var e = document.createElement("div");
            return (e.id = "container-intelliPrechat"), e;
          },
          _intelliPrechatForm: function () {
            var e = document.createElement("div");
            e.id = "form-intelliPrechatSearchQuestionForm";
            var t = document.createElement("div");
            (t.id = "ele-intelliPrechatSearch"), e.appendChild(t);
            var i = document.createElement("label");
            (i.id = "ele-intelliPrechatSearchLabel"),
              i.setAttribute("for", "input-intelliPrechatQuestion"),
              (i.innerHTML = SnapEngage.getMessage(16)),
              t.appendChild(i);
            var n = document.createElement("input");
            (n.type = "text"),
              (n.id = "input-intelliPrechatQuestion"),
              (n.name = "input-intelliPrechatQuestion"),
              (n.autofocus = !0),
              t.appendChild(n);
            var l = document.createElement("input");
            return (
              (l.className = "button"),
              (l.id = "submit-intelliPrechatQuestion"),
              (l.type = "submit"),
              (l.value = SnapEngage.getMessage(50)),
              e.appendChild(l),
              e
            );
          },
          loadingResults: function () {
            var e = document.createElement("div");
            e.id = "ele-intelliPrechatSearchLoading";
            var t = document.createElement("img");
            (t.id = "img-loading"),
              t.setAttribute("alt", ""),
              (t.src = SnapEngage.getStaticBaseURL() + "/wbg/loading.gif"),
              e.appendChild(t),
              this.intelliPrechat.appendChild(e);
          },
          intelliPrechatResults: function (t) {
            var i = document.createElement("div");
            if (
              ((i.id = "container-intelliPrechatResults"), !t || t.length <= 0)
            ) {
              var n = document.createElement("div");
              (n.innerHTML = SnapEngage.getMessage(53)), i.appendChild(n);
            } else {
              var l = document.createElement("div");
              (l.id = "ele-intelliPrechatResultsHeader"),
                (l.innerHTML = SnapABug.getMessage(17)),
                i.appendChild(l);
              var a = document.createElement("ul");
              a.id = "ul-intelliPrechatResults";
              for (var s = 0; s < t.length; s++) {
                var r = document.createElement("li");
                (r.className = "li-intelliPrechatResults"), a.appendChild(r);
                var h = document.createElement("a");
                (h.id = "ele-intelliPrechatResults_" + s),
                  (h.className = "intelliPrechat_results"),
                  (h.href = t[s].link),
                  (h.target = "_blank"),
                  r.appendChild(h);
                var c = document.createElement("img");
                (c.id = "img-doc"),
                  c.setAttribute("alt", ""),
                  (c.src = SnapEngage.getBaseURL() + "/img/document.png"),
                  h.appendChild(c);
                var o = document.createElement("div");
                (o.id = "ele-title--intelliPrechatResults_" + s),
                  (o.className =
                    "intelliPrechat_title" +
                    (e.chat_custom_design.direction ? " rtl" : "")),
                  (o.innerHTML = t[s].title),
                  h.appendChild(o);
                var d = document.createElement("div");
                (d.id = "ele-summary--intelliPrechatResults_" + s),
                  (d.className = "intelliPrechat_summary"),
                  (d.innerHTML = t[s].summary),
                  h.appendChild(d),
                  i.appendChild(a);
              }
            }
            this.intelliPrechat.appendChild(i);
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.IntelliPrechatView = t);
      })(window);
      !(function (t) {
        function e(e, s) {
          (this.options = e),
            (this.isVisible = !1),
            (this.helpers =
              this.helpers ||
              new t.chat_custom_design.Helpers(this.options, this.target)),
            (this.chatView =
              this.chatView ||
              new t.chat_custom_design.ChatView(this.options, this.target)),
            (this.stylesheet =
              this.stylesheet ||
              new t.chat_custom_design.Style(this.options, this.helpers)),
            (this.chatPrimaryButton =
              void 0 === this.options.chatPrimaryButton ||
              null === this.options.chatPrimaryButton
                ? this.options.chatCallMeButton
                : this.options.chatPrimaryButton),
            (this.app = s);
        }
        (e.prototype = {
          bind: function (t, e) {
            "cancelSecureDataClick" === t &&
              this.cancelSecureDataBtn.addEventListener("click", function () {
                e();
              });
          },
          render: function (t, e) {
            (this.iframe = document.getElementById(
              this.helpers.getIframeId()
            ).contentWindow.document),
              (this.messagesContent = this.iframe.getElementById(
                "messages-content"
              )),
              this.chatView
                .getMessageView()
                .systemMessageToBeRemoved.push(
                  this.app.systemMessageIds.NFO_INITIAL
                ),
              this.chatView
                .getMessageView()
                .messageToBeRemoved(this.app.systemMessageIds.NFO_INITIAL),
              (this.populateSecureDataView = this._populateSecureDataView(
                t,
                e
              )),
              this.messagesContent.appendChild(this.populateSecureDataView),
              this.chatView.messageView.updateScroll(),
              (this.isVisible = !0),
              (this.cancelSecureDataBtn = this.iframe.getElementById(
                "button-cancel-secureFileTransfer"
              )),
              (this.secureDataTransferDiv = this.iframe.getElementById(
                "securedata-div"
              ));
          },
          destroy: function (t) {
            (this.app = t),
              this.helpers.removeElement(this.secureDataTransferDiv),
              delete this.app.secureDataView,
              delete this.app.secureDataController;
          },
          _secureDataCss: function (t) {
            return [
              "display:inline-block;margin-top:" +
                this.stylesheet.em(10, this.stylesheet.basePx) +
                "width:100%;",
              "height:" +
                this.stylesheet.em(t, this.stylesheet.basePx) +
                "border:none;width:100%;",
              "position:relative;right:0;bottom:0;float:right;margin-top:" +
                this.stylesheet.em(10, this.stylesheet.basePx),
              "color:" +
                this.chatPrimaryButton.fontColor +
                ";background-color:" +
                this.chatPrimaryButton.bgColor +
                ";border-radius:" +
                this.stylesheet.em(this.chatPrimaryButton.borderRadius, 10),
            ];
          },
          _populateSecureDataView: function (t, e) {
            var s = this._secureDataCss(e),
              i = document.createElement("div");
            (i.id = "securedata-div"), i.setAttribute("style", s[0]);
            var a = document.createElement("iframe");
            (a.id = "securedata-iframe"),
              a.setAttribute("src", t),
              a.setAttribute("style", s[1]),
              a.setAttribute("scrolling", "no"),
              a.setAttribute("horizontalscrolling", "no"),
              a.setAttribute("verticalscrolling", "no"),
              i.appendChild(a);
            var n = document.createElement("div");
            (n.id = "button-cancel-secureFileTransfer"),
              (n.className = "button"),
              n.setAttribute("style", s[2]),
              i.appendChild(n);
            var r = this.iframe.createElement("input");
            return (
              (r.className = "button"),
              (r.id = "cancel-secure-data"),
              r.setAttribute("type", "button"),
              r.setAttribute("style", s[3]),
              (r.value = SnapEngage.getMessage(42)),
              n.appendChild(r),
              i
            );
          },
        }),
          (t.chat_custom_design = t.chat_custom_design || {}),
          (t.chat_custom_design.SecureDataView = e);
      })(window);
      !(function (i) {
        function t(t, e, s) {
          (this.app = t),
            (this.options = e),
            (this.target = s),
            (this.helpers =
              this.helpers ||
              new i.chat_custom_design.Helpers(this.options, this.target)),
            (this.stylesheet =
              this.stylesheet ||
              new i.chat_custom_design.Style(this.options, this.helpers)),
            (this.isMobile = this.helpers.isMobileDevice()),
            (this.state = {
              isVisible: !1,
              isProactiveInvite: !1,
            });
        }
        (t.prototype = {
          toggleState: function (i) {
            this.state[i] = !this.state[i];
          },
          init: function (i) {
            this.toggleState("isVisible"),
              this.toggleState("isProactiveInvite"),
              SnapABugChat.setCookie("isProactiveInvite", !0),
              i && !0 === i
                ? ((this.app.hideButtonSettingUsed ||
                    this.app.buttonView.isVisible) &&
                    this.app.buttonView.hide(),
                  this.app.mainView.getIsVisible() && this.app.mainView.hide(),
                  this.app.minimizeView.show(),
                  this.helpers.elementAddClass(
                    document.querySelector("#iframe-minimize"),
                    "minimize-proactive"
                  ))
                : this.isMobile
                ? ((this.app.hideButtonSettingUsed ||
                    this.app.buttonView.isVisible) &&
                    this.app.buttonView.hide(),
                  this.app.mainView.getIsVisible() && this.app.mainView.hide(),
                  this.app.minimizeView.show(),
                  this.helpers.elementAddClass(
                    document.querySelector("#iframe-minimize"),
                    "minimize-proactive"
                  ))
                : (this.app.buttonView.hide(),
                  (this.app.mainView.isVisible = !0),
                  this.app.chatView.getMessageView().clearMessages(),
                  this.app.chatView.show(),
                  void 0 !== this.app.animateController &&
                    this.app.animateController.proactiveAnimation()),
              (this.proactiveMinimizeView = document.querySelector(
                "#iframe-minimize.minimize-proactive"
              ));
          },
          getIsVisible: function () {
            return this.state.isVisible;
          },
          getIsProactiveInvite: function () {
            return this.state.isProactiveInvite;
          },
        }),
          (i.chat_custom_design = i.chat_custom_design || {}),
          (i.chat_custom_design.ProactiveView = t);
      })(window);
      !(function (t) {
        function i() {
          (this.helpers =
            this.helpers ||
            new t.chat_custom_design.Helpers(this.options, this.target)),
            (this.isMobile = this.helpers.isMobileDevice()),
            (this.mainDiv = document.getElementById("designstudio")),
            (this.minimizeDiv = document.getElementById(
              "designstudio-minimize"
            )),
            (this.animatedElement = {
              BUTTON: "button",
              BOX: "box",
              MINIMIZE: "minimize",
              MINIMIZE_MESSAGE: "minimize-message",
            });
        }
        (i.prototype = {
          bind: function (t, i) {
            "mainDivAnimationEnd" === t
              ? (this.mainDiv.addEventListener("webkitAnimationEnd", function (
                  t
                ) {
                  i(t);
                }),
                this.mainDiv.addEventListener("animationend", function (t) {
                  i(t);
                }),
                this.mainDiv.addEventListener("oanimationend", function (t) {
                  i(t);
                }))
              : "minimizeDivAnimationEnd" === t &&
                (this.minimizeDiv.addEventListener(
                  "webkitAnimationEnd",
                  function (t) {
                    i(t);
                  }
                ),
                this.minimizeDiv.addEventListener("animationend", function (t) {
                  i(t);
                }),
                this.minimizeDiv.addEventListener("oanimationend", function (
                  t
                ) {
                  i(t);
                }));
          },
          bindNewMessageListener: function (t, i) {
            t.addEventListener("webkitAnimationEnd", function (t) {
              i(t);
            }),
              t.addEventListener("animationend", function (t) {
                i(t);
              }),
              t.addEventListener("oanimationend", function (t) {
                i(t);
              });
          },
          getAnimationIn: function (t) {
            var i = "";
            switch (t) {
              case this.animatedElement.BUTTON:
                i = this.animationInButton;
                break;
              case this.animatedElement.BOX:
                i = this.animationInBox;
                break;
              case this.animatedElement.MINIMIZE:
                i = this.animationInMinimize;
                break;
              case this.animatedElement.MINIMIZE_MESSAGE:
                i = this.animationInMessage;
            }
            return i;
          },
          setAnimationIn: function (t, i) {
            var n = "designstudio-animated designstudio-";
            switch (t) {
              case this.animatedElement.BUTTON:
                this.animationInButton = n + i;
                break;
              case this.animatedElement.BOX:
                this.animationInBox = n + i;
                break;
              case this.animatedElement.MINIMIZE:
                this.animationInMinimize = n + i;
                break;
              case this.animatedElement.MINIMIZE_MESSAGE:
                this.animationInMessage = n + i;
            }
          },
          getAnimationOut: function (t) {
            var i = "";
            switch (t) {
              case this.animatedElement.BUTTON:
                i = this.animationOutButton;
                break;
              case this.animatedElement.BOX:
                i = this.animationOutBox;
                break;
              case this.animatedElement.MINIMIZE:
                i = this.animationOutMinimize;
                break;
              case this.animatedElement.MINIMIZE_MESSAGE:
                i = this.animationOutMessage;
            }
            return i;
          },
          setAnimationOut: function (t, i) {
            var n = "designstudio-animated designstudio-";
            switch (t) {
              case this.animatedElement.BUTTON:
                this.animationOutButton = n + i;
                break;
              case this.animatedElement.BOX:
                this.animationOutBox = n + i;
                break;
              case this.animatedElement.MINIMIZE:
                this.animationOutMinimize = n + i;
                break;
              case this.animatedElement.MINIMIZE_MESSAGE:
                this.animationOutMessage = n + i;
            }
          },
          addAnimation: function (t, i, n) {
            this.helpers.isInsideGWT() ||
              (this.helpers.elementAddClass(t, i),
              n && this.setAnimationCallback(n));
          },
          removeAnimation: function (t, i) {
            this.helpers.isInsideGWT() || this.helpers.elementRemoveClass(t, i);
          },
          setAnimationCallback: function (t) {
            t && (this.callback = t);
          },
          callAnimationCallback: function (t) {
            this.callback && this.callback(t), (this.callback = "");
          },
          animateStylesheet: function () {
            var t = document.createElement("style");
            return (
              (t.id = "design-studio-animate"),
              (t.innerHTML =
                ".designstudio-animated {-webkit-animation-duration: .5s;animation-duration: .5s;-webkit-animation-fill-mode: both;animation-fill-mode: both;}@keyframes designstudio-fadeOut {from {opacity: 1;}to {opacity: 0;}}.designstudio-fadeOut {animation-name: designstudio-fadeOut;}@-webkit-keyframes designstudio-fadeInUp {from {opacity: 0;-webkit-transform: translate3d(0, 100%, 0);transform: translate3d(0, 100%, 0);}to {opacity: 1;-webkit-transform: none;transform: none;}}@keyframes designstudio-fadeInUp {from {opacity: 0;-webkit-transform: translate3d(0, 100%, 0);transform: translate3d(0, 100%, 0);}to {opacity: 1;-webkit-transform: none;transform: none;}}.designstudio-fadeInUp {-webkit-animation-name: designstudio-fadeInUp;animation-name: designstudio-fadeInUp;}@-webkit-keyframes designstudio-fadeInDown {from {opacity: 0;-webkit-transform: translate3d(0, -100%, 0);transform: translate3d(0, -100%, 0);}to {opacity: 1;-webkit-transform: none;transform: none;}}@keyframes designstudio-fadeInDown {from {opacity: 0;-webkit-transform: translate3d(0, -100%, 0);transform: translate3d(0, -100%, 0);}to {opacity: 1;-webkit-transform: none;transform: none;}}.designstudio-fadeInDown {-webkit-animation-name: designstudio-fadeInDown;animation-name: designstudio-fadeInDown;}@-webkit-keyframes designstudio-fadeInLeft {from {opacity: 0;-webkit-transform: translate3d(-100%, 0, 0);transform: translate3d(-100%, 0, 0);}to {opacity: 1;-webkit-transform: none;transform: none;}}@keyframes designstudio-fadeInLeft {from {opacity: 0;-webkit-transform: translate3d(-100%, 0, 0);transform: translate3d(-100%, 0, 0);}to {opacity: 1;-webkit-transform: none;transform: none;}}.designstudio-fadeInLeft {-webkit-animation-name: designstudio-fadeInLeft;animation-name: designstudio-fadeInLeft;}@-webkit-keyframes designstudio-fadeInRight {from {opacity: 0;-webkit-transform: translate3d(100%, 0, 0);transform: translate3d(100%, 0, 0);}to {opacity: 1;-webkit-transform: none;transform: none;}}@keyframes designstudio-fadeInRight {from {opacity: 0;-webkit-transform: translate3d(100%, 0, 0);transform: translate3d(100%, 0, 0);}to {opacity: 1;-webkit-transform: none;transform: none;}}.designstudio-fadeInRight {-webkit-animation-name: designstudio-fadeInRight;animation-name: designstudio-fadeInRight;}@-webkit-keyframes designstudio-fadeOutUp {from {opacity: 1;}to {opacity: 0;-webkit-transform: translate3d(0, -100%, 0);transform: translate3d(0, -100%, 0);}}@keyframes designstudio-fadeOutUp {from {opacity: 1;}to {opacity: 0;-webkit-transform: translate3d(0, -100%, 0);transform: translate3d(0, -100%, 0);}}.designstudio-fadeOutUp {-webkit-animation-name: designstudio-fadeOutUp;animation-name: designstudio-fadeOutUp;}@-webkit-keyframes designstudio-fadeOutDown {from {opacity: 1;}to {opacity: 0;-webkit-transform: translate3d(0, 100%, 0);transform: translate3d(0, 100%, 0);}}@keyframes designstudio-fadeOutDown {from {opacity: 1; }to {opacity: 0;-webkit-transform: translate3d(0, 100%, 0);transform: translate3d(0, 100%, 0);}}.designstudio-fadeOutDown {-webkit-animation-name: designstudio-fadeOutDown;animation-name: designstudio-fadeOutDown;}@-webkit-keyframes designstudio-fadeOutLeft {from {opacity: 1;}to {opacity: 0;-webkit-transform: translate3d(-100%, 0, 0);transform: translate3d(-100%, 0, 0);}}@keyframes designstudio-fadeOutLeft {from {opacity: 1;}to {opacity: 0;-webkit-transform: translate3d(-100%, 0, 0);transform: translate3d(-100%, 0, 0);}}.designstudio-fadeOutLeft {-webkit-animation-name: designstudio-fadeOutLeft;animation-name: designstudio-fadeOutLeft;}@-webkit-keyframes designstudio-fadeOutRight {from {opacity: 1;}to {opacity: 0;-webkit-transform: translate3d(100%, 0, 0);transform: translate3d(100%, 0, 0);}}@keyframes designstudio-fadeOutRight {from {opacity: 1;}to {opacity: 0;-webkit-transform: translate3d(100%, 0, 0);transform: translate3d(100%, 0, 0);}}.designstudio-fadeOutRight {-webkit-animation-name: designstudio-fadeOutRight;animation-name: designstudio-fadeOutRight;}@-webkit-keyframes designstudio-slideInDown {from {-webkit-transform: translate3d(0, -100% , 0);transform: translate3d(0, -100% , 0);visibility: visible;}to {-webkit-transform: translate3d(0, 0, 0);transform: translate3d(0, 0, 0);}}@keyframes designstudio-slideInDown {from {-webkit-transform: translate3d(0, -100% , 0);transform: translate3d(0, -100% , 0);visibility: visible;}to {-webkit-transform: translate3d(0, 0, 0);transform: translate3d(0, 0, 0);}}.designstudio-slideInDown {-webkit-animation-name: designstudio-slideInDown;animation-name: designstudio-slideInDown;}@-webkit-keyframes designstudio-slideInLeft {from {-webkit-transform: translate3d(-100% , 0, 0);transform: translate3d(-100% , 0, 0);visibility: visible;}to {-webkit-transform: translate3d(0, 0, 0);transform: translate3d(0, 0, 0);}}@keyframes designstudio-slideInLeft {from {-webkit-transform: translate3d(-100% , 0, 0);transform: translate3d(-100% , 0, 0);visibility: visible;}to {-webkit-transform: translate3d(0, 0, 0);transform: translate3d(0, 0, 0);}}.designstudio-slideInLeft {-webkit-animation-name: designstudio-slideInLeft;animation-name: designstudio-slideInLeft;}@-webkit-keyframes designstudio-slideInRight {from {-webkit-transform: translate3d(100% , 0, 0);transform: translate3d(100% , 0, 0);visibility: visible;}to {-webkit-transform: translate3d(0, 0, 0);transform: translate3d(0, 0, 0);}}@keyframes designstudio-slideInRight {from {-webkit-transform: translate3d(100% , 0, 0);transform: translate3d(100% , 0, 0);visibility: visible;}to {-webkit-transform: translate3d(0, 0, 0);transform: translate3d(0, 0, 0);}}.designstudio-slideInRight {-webkit-animation-name: designstudio-slideInRight;animation-name: designstudio-slideInRight;}@-webkit-keyframes designstudio-slideInUp {from {-webkit-transform: translate3d(0, 100% , 0);transform: translate3d(0, 100% , 0);visibility: visible;}to {-webkit-transform: translate3d(0, 0, 0);transform: translate3d(0, 0, 0);}}@keyframes designstudio-slideInUp {from {-webkit-transform: translate3d(0, 100% , 0);transform: translate3d(0, 100% , 0);visibility: visible;}to {-webkit-transform: translate3d(0, 0, 0);transform: translate3d(0, 0, 0);}}.designstudio-slideInUp {-webkit-animation-name: designstudio-slideInUp;animation-name: designstudio-slideInUp;}"),
              t
            );
          },
        }),
          (t.chat_custom_design = t.chat_custom_design || {}),
          (t.chat_custom_design.AnimateView = i);
      })(window);
      !(function (e) {
        function i(e) {
          (this.app = e),
            (this.selected = null),
            (this.x_mouse = 0),
            (this.y_mouse = 0),
            (this.x_elem = 0),
            (this.y_elem = 0);
          var i = this;
          i.app.mainView.bind("windowBlur", function () {
            i.app.setState("windowIsFocused", !1);
          }),
            i.app.mainView.bind("windowFocus", function () {
              i.app.setState("windowIsFocused", !0);
            }),
            i.app.mainView.bind("minimizeIconClick", function () {
              i.minimizeIconClick();
            }),
            i.app.mainView.bind("closeIconClick", function (e) {
              i.closeIconClick(!0, e);
            }),
            i.app.mainView.bind("dismissErrorClick", function () {
              i.dismissErrorClick();
            }),
            i.app.mainView.isMobile ||
              (i.app.mainView.bind("mouseDown", function (e) {
                i.mouseDown(e);
              }),
              i.app.mainView.bind("mouseMove", function (e) {
                i.mouseMove(e);
              }),
              i.app.mainView.bind("mouseUp", function () {
                i.mouseUp();
              }),
              i.app.mainView.bind("escapeKeyClose_document", function (e) {
                i.closeIconClick(!0, e);
              }),
              i.app.mainView.bind("escapeKeyClose_iframe", function (e) {
                i.closeIconClick(!0, e);
              })),
            this.app.helpers.isIpad() &&
              this.app.mainView.addIpadScrollingListener(
                "ipadScrollListener",
                function (e) {
                  SnapEngage.getCustomDesignUI().helpers.debounce(
                    this.handleIpadScrollingChange(e),
                    50
                  );
                }.bind(this)
              );
        }
        (i.prototype = {
          _updateBinding: function () {
            var e = this;
            e.app.mainView.postBind("dismissErrorClick", function () {
              e.dismissErrorClick();
            });
          },
          handleIpadScrollingChange: function (i) {
            this.app.mainView.designstudio.setAttribute(
              "style",
              this.app.mainView.stylesheet.mainCss(i)
            ),
              (this.app.mainView.designstudio.style.top = i + "px"),
              (this.app.mainView.designstudio.style.height =
                "calc(100% - " + top + "px;)"),
              (e.iosScrollPositionY = i);
          },
          mouseDown: function (e) {
            return (
              e.preventDefault(),
              (SnapEngage.dragging = !0),
              this.app.setVisitorNotification(!1),
              (this.selected = document.getElementById("designstudio")),
              (this.x_elem = this.x_mouse - this.selected.offsetLeft),
              (this.y_elem = this.y_mouse - this.selected.offsetTop),
              !1
            );
          },
          mouseMove: function (i) {
            return (
              (this.x_mouse = document.all ? e.event.clientX : i.pageX),
              (this.y_mouse = document.all ? e.event.clientY : i.pageY),
              null !== this.selected &&
                SnapEngage.dragging &&
                ((this.leftPx = this.x_mouse - this.x_elem),
                (this.topPx = this.y_mouse - this.y_elem),
                this.leftPx < 0 && (this.leftPx = 0),
                this.leftPx >
                  SnapEngage.getWindowWidth() - this.selected.offsetWidth &&
                  (this.leftPx =
                    SnapEngage.getWindowWidth() - this.selected.offsetWidth),
                this.topPx < 0 && (this.topPx = 0),
                this.topPx >
                  SnapEngage.getWindowHeight() - this.selected.offsetHeight &&
                  (this.topPx =
                    SnapEngage.getWindowHeight() - this.selected.offsetHeight),
                (this.selected.style.left = this.leftPx + "px"),
                (this.selected.style.top = this.topPx + "px"),
                this.selected.style.marginTop.length > 0 &&
                  (this.selected.style.marginTop = ""),
                this.selected.style.marginLeft.length > 0 &&
                  (this.selected.style.marginLeft = "")),
              !1
            );
          },
          _formWasDragged: function () {
            return this.leftPx && this.topPx;
          },
          mouseUp: function () {
            if (SnapEngage.dragging) {
              if (this._formWasDragged()) {
                var e = [this.leftPx, this.topPx];
                SnapEngageChat.setChatWindowCookieData("chatBoxPosition", e);
              }
              (this.selected = null), (SnapEngage.dragging = !1);
            }
          },
          minimizeIconClick: function () {
            var e = this.app.proactiveView.getIsProactiveInvite();
            this.app.minimizeView.clearMessages(),
              e &&
                (this.app.setState("isMinimized", !0),
                this.app.proactiveView.toggleState("isVisible")),
              this.app.minimizeChatBoxToggle(),
              this.app.minimizeCallback(),
              void 0 !== this.app.animateController &&
              void 0 !== this.app.animateView
                ? this.app.animateController.minimizeIconClickAnimation(
                    this.finishMinimize.bind(this)
                  )
                : this.finishMinimize.call(this);
          },
          finishMinimize: function () {
            this.app.mainView.hide(),
              SnapEngage.isChatInProgress() ||
              this.app.proactiveView.getIsProactiveInvite()
                ? this.app.showMinimize()
                : (this._refreshApp(),
                  e.iPadScrollPositionY &&
                    !SnapEngage.isChatInProgress() &&
                    delete e.iPadScrollPositionY),
              this.app.helpers.toggleViewport(),
              this.app.helpers.iosScrollToTop();
          },
          closeIconClick: function (e, i) {
            1 === i
              ? (this.disableSpecialFeatureViews(),
                (this.app.mainView.isMinimized = !1),
                this.app.getChatAnsweredStatus() && e
                  ? (SnapEngage.isChatInProgress()
                      ? (this.app.chatView.disableComponents(),
                        this.app.chatController.closeChatWarning(
                          this.app.getSystemCommandsCustomDesign().nickname
                        ))
                      : this.app.chatController.closeChat(),
                    this.app.setVisitorNotification(!1))
                  : this.app.getChatAnsweredStatus() ||
                    (SnapEngage.isChatInProgress()
                      ? this.app.chatController.endChat(e, !1)
                      : (this.app.chatController.closeChat(),
                        this.resetProactive())))
              : i >= 2 &&
                (SnapEngage.isChatInProgress()
                  ? this.app.chatController.endChat(e, !1)
                  : (this.resetProactive(),
                    this.app.chatController.closeChat())),
              this.app.setVisitorNotification(!1);
          },
          refreshMainView: function () {
            (this.app.mainView.clickCounter = 0),
              this._clearCookies(),
              this.app.helpers.enableScrolling(),
              this._refreshApp(),
              this.app.widgetSelectStatus &&
                (this.app.widgetSelectStatus = void 0);
          },
          _clearCookies: function () {
            SnapEngageChat.setChatWindowCookieData("isMinimized", !1),
              SnapEngageChat.setChatWindowCookieData("chatBoxPosition", "");
          },
          runCloseCallbackAPI: function () {
            var e, i;
            (e =
              this.app.getTypeOfChat() ===
              this.app.TYPEOFCHAT.ONLINE_PROACTIVE_CHAT
                ? "proactive"
                : this.app.chatView.getMessageView().isMessageAlreadyShowing()
                ? "chat"
                : "form"),
              (i = SnapEngage.getAgentStatus() ? "online" : "offline"),
              SnapEngage.callCallback("Close", e, i);
          },
          resetProactive: function () {
            SnapABugChat.deleteCookie("isProactiveInvite"),
              SnapEngageChat.setNoProactiveChatCookie(),
              SnapEngageChat.clearProactive();
          },
          enableComponents: function () {
            this.app.chatView.showInput(),
              this.app.chatView.resizeMessageInputArea();
          },
          dismissErrorClick: function () {
            var e = this.app.chatView.iframe.getElementById(
              this.app.systemMessageIds.ERROR_MSG
            );
            e && this.app.helpers.removeElement(e);
          },
          disableSpecialFeatureViews: function () {
            this.app.callmeView.isVisible &&
              this.app.callmeView.hideCallmeViews(),
              this.app.mainView.iframe.getElementById(
                this.app.systemMessageIds.COBR_COBROWSE_INVITE
              ) && this.app.chatController.declineCobrowseButtonClick(),
              this.app.mainView.iframe.getElementById("securedata-div") &&
                this.app.secureDataController.cancelSecureDataClick(),
              this.app.mainView.iframe.getElementById(
                this.app.systemMessageIds.FURV_FILE_UPLOAD
              ) && this.app.chatController.cancelFileUploadButtonClick(),
              this.app.chatView.emailTranscriptCard &&
                this.app.chatView.emailTranscriptCard.getState(
                  "emailTranscriptUiVisible"
                ) &&
                this.app.chatController.removeTranscriptRequestUi(),
              this.app.chatView.getState("isMenuOpen") &&
                this.app.chatController.closeMenu(),
              this.app.chatView.getState("closeChatWarningDisplay") &&
                (this.app.chatView.setState("closeChatWarningDisplay", !1),
                this.app.chatView.disableWarningEndChatButtons());
          },
          _refreshApp: function () {
            this.app.getState("isMobileUI")
              ? this.app.refreshKeepState()
              : this.app.refresh();
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.MainController = i);
      })(window);
      !(function (i) {
        function e(i) {
          this.app = i;
          var e = this;
          e.app.minimizeView.bind("minimizeClickToMaximize", function () {
            e.minimizeClickToMaximize();
          });
        }
        (e.prototype = {
          minimizeClickToMaximize: function () {
            this.app.helpers.isIos() && (i.iosScrollPositionY = i.scrollY),
              SnapEngageChat.isMinimized() && this.app.minimizeChatBoxToggle(),
              this.app.minimizeView.isViewVisible() &&
                (this.app.proactiveView.getIsProactiveInvite() &&
                  !this.app.proactiveView.getIsVisible() &&
                  this.app.proactiveView.toggleState("isVisible"),
                this.app.minimizeView.hide(),
                this.app.minimizeView.hideMessageContainer()),
              void 0 !== this.app.animateController &&
                this.app.animateController.maximizeAnimation(),
              this.app.minimizeCallback(),
              this.app.mainView.show(),
              this.app.chatView.getState("closeChatWarningDisplay") ||
                this.app.chatView.show(),
              (this.app.chatView.chatMessageTextarea.placeholder = ""),
              this.app.helpers.toggleViewport(),
              this.deleteMinimizeStashCookie();
          },
          setMinimizeStashCookie: function (i) {
            (this.app.minimizeView.minimizeStashCookie.hasBeenRead = !1),
              (this.app.minimizeView.minimizeStashCookie.lastMinimizeMessage = i),
              (this.app.minimizeView.minimizeStashCookie.notifications = this.app.minimizeView.notifyCount),
              SnapEngageChat.setCookie(
                "SnapABugMinimizeStashCookie",
                encodeURIComponent(
                  JSON.stringify(this.app.minimizeView.minimizeStashCookie)
                )
              );
          },
          deleteMinimizeStashCookie: function () {
            SnapEngageChat.deleteCookie("SnapABugMinimizeStashCookie");
          },
        }),
          (i.chat_custom_design = i.chat_custom_design || {}),
          (i.chat_custom_design.MinimizeController = e);
      })(window);
      !(function (t) {
        function e(t) {
          (this.app = t), this._updateBindings();
        }
        (e.prototype = {
          _updateBindings: function () {
            var t = this;
            t.app.buttonView.bind("buttonClick", function () {
              t.buttonClick();
            }),
              t.app.buttonView.bind("buttonTouchStart", function () {
                t.buttonTouchStart();
              }),
              t.app.buttonView.bind("buttonTouchMove", function (e) {
                t.buttonTouchMove(e);
              }),
              t.app.buttonView.bind("buttonTouchEnd", function () {
                t.buttonTouchEnd();
              });
          },
          buttonClick: function (t) {
            if (!this.app.mainView.getIsVisible()) {
              this.app.getTypeOfChat() !==
                this.app.TYPEOFCHAT.ONLINE_PROACTIVE_CHAT &&
                (this.app.setTypeOfChat(this.app.TYPEOFCHAT.ONLINE_MANUAL_CHAT),
                SnapABugChat.getCookie("isProactiveInvite") &&
                  SnapABugChat.deleteCookie("isProactiveInvite")),
                SnapEngage.preventProactiveChat(),
                this._addAnimationToChatWindow(),
                this._checkIfButtonViewShouldToggle(),
                this._checkStatusBeforeShowForm(t),
                this.app.helpers.toggleViewport(),
                SnapABug.preReqestChatAgent();
              var e = this.app.mainView.main || {};
              "function" == typeof e.focus && e.focus();
            }
          },
          buttonTouchStart: function () {
            this._toggleBtnMoveState();
          },
          buttonTouchMove: function (t) {
            var e,
              i,
              a = this.app.buttonView.iframe;
            t.preventDefault(),
              (this.app.buttonView.isMoving = !0),
              (a.style.position = "absolute"),
              (e = t.targetTouches[0].pageX),
              (i = t.targetTouches[0].pageY),
              (a.style.left = e + "px"),
              (a.style.top = i + "px"),
              (a.style.bottom = null),
              (a.style.right = null),
              (this.lastX = e),
              (this.lastY = i);
          },
          buttonTouchEnd: function () {
            this._toggleBtnMoveState();
          },
          _toggleBtnMoveState: function () {
            var t = this.app.buttonView.button,
              e = this.app.buttonView.button.style.borderWidth.length;
            (t.style.position = "fixed"),
              this.app.buttonView.isMoving
                ? (e && (t.style.borderStyle = "solid"),
                  (t.style.opacity = 1),
                  (this.app.buttonView.isMoving = !1))
                : (e && (t.style.borderStyle = "dashed"),
                  (t.style.opacity = 0.5),
                  (this.app.buttonView.isMoving = !0));
          },
          _switchViews: function (t) {
            if (SnapEngage.isChatInProgress())
              this.app.chatView.show(),
                this.app.setState("boxType", "chatManual"),
                this.app.state.chatType ||
                  this.app.setState("chatType", this.app.getTypeOfChat()),
                (this.app.chatView.chatMessageTextarea.placeholder = "");
            else {
              if (
                (SnapEngage.callCallback(
                  "Open",
                  this.app.buttonView.getIsOnline() ? "online" : "offline"
                ),
                this.app.prechatView.setShowPrechat(
                  "" === SnapEngage.getStartChat()
                ),
                this._isIntelligentPrechatSetToShow())
              )
                return (
                  this.app.initIntelliPrechatView(),
                  this.app.intelliPrechatView.show(),
                  void this.app.setState("boxType", "intelliPrechat")
                );
              if (this.app.buttonView.getIsOnline()) {
                if (this._isPrechatSetToShow())
                  return (
                    this.app.setState("boxType", "prechat"),
                    void this.app.prechatView.show()
                  );
                if (
                  !this.app.chatView.getMessageView().isMessageAlreadyShowing()
                ) {
                  var e = t || SnapEngage.getStartChat();
                  this.app.updateChat(e, !1, !1, "START", !1, !1);
                }
                this.app.chatView.show(),
                  this.app.setState("boxType", "chatManual");
                var i = SnapEngage.getStartChatOptions();
                Array.isArray(i.buttons) &&
                  i.buttons.forEach(function (t) {
                    SnapABugChat.callbackMessage(!0, t);
                  });
              } else
                this.app.offlineView.show(),
                  this.app.setState("boxType", "offline");
            }
          },
          _checkStatusBeforeShowForm: function (e) {
            var i = this;
            SnapEngage.setCallback("agentOnline", function () {
              i.callbackChatStatusFunction(e);
            }),
              SnapEngage.sendGetWidgetConfig(!1),
              (this.app.mainView.mainViewLoading = !0),
              this.app.helpers.isIos() && (t.iosScrollPositionY = t.scrollY),
              this.app.mainView.show();
          },
          callbackChatStatusFunction: function (t) {
            var e = 1 === SnapEngage.getAgentStatus();
            this.app.buttonView.setIsOnline(e),
              (this.app.mainView.mainViewLoading = !1),
              this.app.mainView.isVisible &&
                (this.app.mainView.removeLoadingIndicator(),
                this._switchViews(t));
          },
          checkStatusShowButton: function () {
            var t = this;
            SnapEngage.getAgentStatusAsync(function (e) {
              t.app.buttonView.setIsOnline(
                "1" !== SnapEngageChat.getBannedCookie() && e
              ),
                t.app.showTab(),
                t.app.helpers.iosScrollToTop(),
                t.app.buttonController._addAnimationToButton();
            });
          },
          refreshButton: function (t) {
            this.app.buttonView.setButtonViewOptions(t),
              this.app.buttonView._determineIconType(),
              this.app.buttonView.refresh(),
              this._updateBindings();
          },
          _isIntelligentPrechatSetToShow: function () {
            return (
              SnapEngage.getPreChatSearchEnabled() &&
              1 === SnapEngage.getPreChatSearch()
            );
          },
          _isPrechatSetToShow: function () {
            return (
              this.app.prechatView.getShowPrechat() &&
              !this.app.chatView.getMessageView().isMessageAlreadyShowing()
            );
          },
          _addAnimationToButton: function () {
            void 0 !== this.app.animateView &&
              this.app.animateController.buttonLoadAnimation();
          },
          _addAnimationToChatWindow: function () {
            void 0 !== this.app.animateView &&
              this.app.animateController.buttonClickAnimation();
          },
          _checkIfButtonViewShouldToggle: function () {
            !this.app.buttonView.isViewVisible() ||
              (this.app.buttonView.isShowNoButton() &&
                !SnapEngage.isChatInProgress()) ||
              this.app.buttonView.toggle();
          },
        }),
          (t.chat_custom_design = t.chat_custom_design || {}),
          (t.chat_custom_design.ButtonController = e);
      })(window);
      var ma = window.chat_custom_design.EmailTranscriptRequest;
      function ta(e) {
        e &&
          e.firstElementChild &&
          e.firstElementChild.focus &&
          e.firstElementChild.focus();
      }
      !(function (e) {
        function t(e) {
          this.app = e;
          var t = this;
          t.app.chatView.bind("formClick", function () {
            t.formClick();
          }),
            t.app.chatView.bind("callmeCancelClick", function () {
              t.callmeCancelClick();
            }),
            t.app.chatView.bind("fileUploadButtonClick", function () {
              t.fileUploadButtonClick();
            }),
            t.app.chatView.bind("closeActionMenu", function () {
              e.chatController.closeMenu();
            }),
            t.app.chatView.bind("chatCancelFileUploadButtonClick", function () {
              t.cancelFileUploadButtonClick();
            }),
            t.app.chatView.bind("chatSendMessage", function (e, a) {
              a ? t.setMessageCookie(e) : t.sendMessage(e);
            }),
            t.app.chatView.bind("chatFileSelect", function (e) {
              t.fileSelect(e);
            }),
            t.app.chatView.bind("chatCloseChat", function () {
              t.closeChat(!0);
            }),
            t.app.chatView.messageView.bind(
              "autoResponderCancelChat",
              function () {
                t.autoResponderCancelChat();
              }
            ),
            t.app.chatView.bind("chatCancelCloseChat", function () {
              t.cancelCloseChat();
            }),
            t.app.chatView.bind("chatEndChat", function () {
              t.endChat(!0, !1);
            }),
            t.app.chatView.bind("chatMessageTextareaFocus", function () {
              t.chatMessageTextareaFocus();
            }),
            t.app.chatView.bind("chatMessageTextareaBlur", function () {
              t.chatMessageTextareaBlur();
            }),
            t.app.chatView.bind("acceptCobrowseButtonClick", function () {
              t.acceptCobrowseButtonClick();
            }),
            t.app.chatView.bind("declineCobrowseButtonClick", function () {
              t.declineCobrowseButtonClick();
            });
        }
        (t.prototype = {
          toggleMenu: function (e) {
            if (
              (e.stopPropagation(),
              e.preventDefault(),
              this.app.chatView.getState("isMenuOpen"))
            )
              return this.closeMenu();
            this.toggleMenuState();
            var t = this.app.chatView.createMenu();
            (this.app.chatView.actionAreaMenu = t),
              this.app.chatView.iframe
                .getElementById("action-item-menu")
                .appendChild(t),
              ta(t);
          },
          closeMenu: function () {
            this.app.chatView.actionAreaMenu &&
              this.app.chatView.getState("isMenuOpen") &&
              (this.toggleMenuState(),
              this.app.helpers.removeElement(this.app.chatView.actionAreaMenu),
              (this.app.chatView.actionAreaMenu = null));
          },
          toggleMenuState: function () {
            this.app.chatView.setState(
              "isMenuOpen",
              !this.app.chatView.getState("isMenuOpen")
            ),
              this.app.helpers.elementToggleClass(
                this.app.chatView.iframe.getElementById("action-item-menu"),
                "open"
              );
          },
          handleEmailTranscriptRequest: function () {
            if (
              ((this.app.chatView.emailTranscriptCard =
                this.app.chatView.emailTranscriptCard ||
                new ma({
                  helpers: this.app.helpers,
                  removeEmailTranscriptCallback: this.removeEmailTranscriptCallback.bind(
                    this
                  ),
                })),
              !Object.keys(this.app.chatView.emailTranscriptCard).length)
            )
              return !1;
            var e = this.app.chatView.emailTranscriptCard.createUI();
            this.app.chatView.emailTranscriptCard.getTranscriptEmailAddress(),
              this.closeMenu(),
              this.app.chatView.hideInput(),
              this.chatMessageTextareaBlur(),
              this.app.chatView.messagesContent.appendChild(e),
              this.app.chatView.emailTranscriptCard.setState(
                "emailTranscriptUiVisible",
                !0
              ),
              this.app.chatView.resizeMessageInputArea("notextarea"),
              this.app.updateScroll(),
              this.app.chatView.emailTranscriptCard.setElementsRef(),
              this.app.chatView.emailTranscriptCard.bindEvents(),
              this.app.chatView.emailTranscriptCard.fadeInRequestWrapper(),
              this.app.chatView
                .getMessageView()
                .setState(
                  "lastMessageType",
                  this.app.chatView
                    .getMessageView()
                    .getState("currentMessageType")
                ),
              this.app.chatView
                .getMessageView()
                .setState(
                  "currentMessageType",
                  this.app.chatView.getMessageView().TYPE.PAPER
                );
          },
          removeTranscriptRequestUi: function () {
            this.app.chatView.emailTranscriptCard.removeTranscriptRequestUi();
          },
          removeEmailTranscriptCallback: function () {
            this.app.chatView.showInput(),
              this.app.chatView.resizeMessageInputArea(),
              this.chatMessageTextareaBlur(),
              this.app.updateScroll();
            var e = this.app.chatView
              .getMessageView()
              .getState("lastMessageType");
            this.app.chatView
              .getMessageView()
              .setState("currentMessageType", e),
              this.app.chatView.getMessageView().setState("lastMessageType", e);
          },
          setMessageCookie: function (e) {
            SnapEngageChat.setMessageCookie(e.target.value);
          },
          formClick: function () {
            this.app.setState("windowIsFocused", !0),
              this.app.setVisitorNotification(!1),
              this.closeMenu();
          },
          callmeButtonClick: function () {
            this.app.callmeView.showCallMeView();
          },
          callmeCancelClick: function () {
            this.app.callmeView.hideCallmeViews();
          },
          fileUploadButtonClick: function () {
            this.app.chatView.chatFileInput.click();
          },
          cancelFileUploadButtonClick: function () {
            this.removeUploadBubbles(
              this.app.systemMessageIds.FURV_FILE_UPLOAD,
              this.app.systemMessageIds.FILE_UPLOAD_ERR
            ),
              this.app.chatView.disableFileUploadButtons(),
              SnapEngageChat.sendChatMessage(
                6,
                "Visitor has cancelled the request."
              ),
              this.app.chatView.showInput(),
              this.app.updateScroll();
          },
          fileSelect: function (e) {
            if ((e.preventDefault(), !e.target.files.length)) return !1;
            this.app.chatView.disableFileUploadButtons(),
              this.removeUploadBubbles(
                this.app.systemMessageIds.FILE_UPLOAD_ERR
              ),
              this.app.chatView.getMessageView().setVisitorIsUploading(),
              this.submitUploadFormData();
          },
          submitUploadFormData: function () {
            var e = new FormData(),
              t = this.app.chatView.chatFileInput.files[0];
            e.append("file", t);
            var a = this.app.chatView.iframe.getElementById(
              this.app.systemMessageIds.FILE_UPLOAD_ERR
            );
            a && this.app.helpers.removeElement(a);
            var s = {
              url:
                "/fileuploads?widgetPublicId=" +
                SnapEngage.getWidgetId() +
                "&casePublicId=" +
                SnapEngage.getCaseId(),
              method: "POST",
              visitorData: e,
            };
            SnapEngage.sendXMLHttpRequest(
              s,
              this.fileUploadSuccess.bind(this),
              this.fileUploadError.bind(this)
            ),
              this.app.chatView.fileUploadForm.reset();
          },
          fileUploadSuccess: function () {
            if (
              (this.app.chatView.getMessageView()._removeVisitorIsUploading(),
              this.removeUploadBubbles(
                this.app.systemMessageIds.FURV_FILE_UPLOAD
              ),
              this.app.chatView.iframe.getElementById(
                this.app.systemMessageIds.FURV_FILE_UPLOAD
              ))
            ) {
              this.app.helpers.removeElement(
                this.app.chatView.iframe.getElementById(
                  this.app.systemMessageIds.FURV_FILE_UPLOAD
                )
              );
            }
            this.app.chatView.showInput();
          },
          fileUploadError: function (e) {
            (this.app.chatView.getMessageView()._removeVisitorIsUploading(),
            0 == e.status)
              ? (this.app.mainView.iframe
                  .getElementById("upload-form")
                  .setAttribute("target", "hiddenFileUploadIframe"),
                (this.app.chatView.fileUploadForm.action =
                  SnapEngage.getBaseURL() +
                  "/fileuploads?widgetPublicId=" +
                  SnapEngage.getWidgetId() +
                  "&casePublicId=" +
                  SnapEngage.getCaseId()),
                this.app.chatView.fileUploadForm.submit())
              : this.app.chatView.iframe.getElementById(
                  this.app.systemMessageIds.FILE_UPLOAD_ERR
                ) ||
                (SnapABugChat.appendTextToChat(
                  "",
                  e.statusText
                    ? e.statusText
                    : "There was an error. Please try again.",
                  !1,
                  "FILE_UPLOAD_ERR",
                  !0
                ),
                this.app.helpers.elementAddId(
                  "container-agent-message" +
                    (this.app.options.agentMessage.bubble ? "-bubble" : ""),
                  this.app.systemMessageIds.FILE_UPLOAD_ERR
                ),
                SnapABugChat.sendChatMessage(
                  6,
                  e.statusText ? e.statusText : "There was an error."
                ));
            this.app.chatView.enableFileUploadButtons();
          },
          removeUploadBubbles: function () {
            for (var e = 0; e < arguments.length; e++)
              this.app.chatView
                .getMessageView()
                .messageToBeRemoved(arguments[e]);
          },
          sendMessage: function (e, t) {
            var a;
            e.preventDefault(),
              t
                ? (a = t.value)
                : ((a = this.app.chatView.chatMessageTextarea.value.replace(
                    /\n/g,
                    ""
                  )),
                  (this.app.chatView.chatMessageTextarea.value = ""),
                  this.app.chatView.setIsVisitorTyping(!1)),
              a &&
                (this.app.chatView.getMessageView().setIsSystemMessage(!1),
                this.app.chatView.getMessageView().updateChat(a, !0, !1, !1),
                this.sendChat(a, !0, t),
                this.app.getTypeOfChat() ===
                  this.app.TYPEOFCHAT.ONLINE_PROACTIVE_CHAT &&
                  this.app.setState("boxType", "proactive"),
                (this.app.chatView.chatMessageTextarea.placeholder = ""));
          },
          sendChat: function (e, t, a) {
            (this.message = e), this.message || (this.message = "");
            var s = SnapABug.isChatInProgress();
            if (s && t)
              SnapEngageChat.sendChatMessage(
                1,
                this.message.replace("\n", ""),
                a
              ),
                this.app.chatView.setIsVisitorTyping(!1);
            else if (!s) {
              var i = {
                address: SnapEngage.getUserEmail(),
                description: this.message,
                isOnlineForm: !0,
              };
              SnapEngage.sendCreateCase(i);
            }
            SnapEngageChat.deleteCookie("SnapABugChatMessage"),
              this.app.setVisitorNotification(!1);
          },
          endChat: function (t, a) {
            this.app.mainController.disableSpecialFeatureViews(),
              this.app.chatView.hideInput(),
              this.app.mainController._clearCookies(),
              this.app.setVisitorNotification(!1),
              SnapEngage.setChatInProgress(!1),
              t &&
                SnapEngage.getCaseId() &&
                (SnapEngageChat.sendChatMessage(2, ""),
                this.app.getChatAnsweredStatus() && this.endChatMessage()),
              a
                ? this.app.offlineController.autoResponderPopulateForm(
                    this.message
                  )
                : (this.app.getChatAnsweredStatus() &&
                    !SnapEngageChat.getBannedCookie() &&
                    (this.app.chatView.iframe.getElementById(
                      "post-chat-content"
                    ) ||
                      this.app.initPostChatUI()),
                  (this.app.postChatView &&
                    this.app.postChatView.getState("isVisible")) ||
                    (t
                      ? this.closeChat()
                      : (this.app.chatView.toggleCloseButton(),
                        this.app.chatView.resizeMessageInputArea(
                          "notextarea"
                        )))),
              SnapEngageChat.getCookie("SnapABugMinimizeStashCookie") &&
                this.app.minimizeController.deleteMinimizeStashCookie(),
              this.app.mainController.resetProactive(),
              SnapEngageChat.stopPolling(),
              SnapABug.setCallMePhone(""),
              SnapEngageChat.resetCaseIdFromCustomDesign(),
              SnapEngageChat.deleteChatCookies(),
              SnapEngageChat.reInit(),
              e.Cobrowse && e.Cobrowse.isSupported() && e.Cobrowse.end();
          },
          endChatMessage: function () {
            this.app.chatView
              .getMessageView()
              .setIsSystemMessage(this.app.systemMessageIds.CLOSE),
              this.app.updateChat(
                SnapEngage.getMessage(55),
                !1,
                !1,
                "CLOSE",
                !1,
                !1
              );
          },
          closeChat: function () {
            this.app.mainController.runCloseCallbackAPI(),
              this.app.mainController.refreshMainView();
          },
          autoResponderCancelChat: function () {
            this.endChat(!0, !0);
          },
          cancelCloseChat: function () {
            this.app.chatView.setState("closeChatWarningDisplay", !1),
              (this.app.mainView.clickCounter = 0),
              this.app.chatView.disableWarningEndChatButtons(),
              this.app.chatView
                .getMessageView()
                .clearSystemMessage(this.app.systemMessageIds.CLOSE_WARN),
              this.app.mainController.enableComponents(),
              this.app.chatView.showInput(),
              this.app.updateScroll();
          },
          closeChatWarning: function (e) {
            this.app.chatView.setState("closeChatWarningDisplay", !0),
              this.app.updateChat(
                this.app.chatView.getMessageView()._chatCloseWarning(e),
                !1,
                !1,
                "CLOSE_WARN",
                !1,
                !0
              ),
              this.app.chatView.enableWarningEndChatButtons(),
              this.app.chatView.hideInput();
          },
          chatMessageTextareaFocus: function (e) {
            if (!this.app.helpers.isIos()) return !1;
            this.app.mainView.designstudio.setAttribute(
              "style",
              this.app.mainView.stylesheet.mobileCssWithKeyboard(e)
            ),
              this.app.helpers.iosScrollToTop(),
              this.app.chatView.getMessageView().updateScroll();
          },
          chatMessageTextareaBlur: function () {
            if (!this.app.helpers.isIos()) return !1;
            (e.isoScrollPositionY = e.scrollY),
              this.app.mainView.designstudio.setAttribute(
                "style",
                this.app.mainView.stylesheet.mainCss()
              ),
              (this.app.mainView.designstudio.style.display = "inline"),
              this.app.helpers.iosScrollToTop();
          },
          acceptCobrowseButtonClick: function () {
            this.app.chatView
              .getMessageView()
              .clearSystemMessage(
                this.app.systemMessageIds.COBR_COBROWSE_INVITE
              ),
              SnapEngageChat.sendChatMessage(
                6,
                "Visitor has accepted your invitation to cobrowse."
              );
            var t = SnapEngage.getMessage(64).replace(
              "{alias}",
              this.app.chatView.getMessageView().getState("agentName")
            );
            this.app.updateChat(t, !1, !1, "COBROWSE_ACCEPT", !1, !1);
            var a = this.app.chatView.acceptCobrowseButton.dataset.key,
              s = this.app.chatView.acceptCobrowseButton.dataset.token;
            this.app.chatView.disableCobrowsingButtons(),
              this.app.chatView.showInput(),
              this.app.updateScroll(),
              e.Cobrowse.begin(a, s);
          },
          declineCobrowseButtonClick: function () {
            this.app.chatView
              .getMessageView()
              .clearSystemMessage(
                this.app.systemMessageIds.COBR_COBROWSE_INVITE
              ),
              SnapEngageChat.sendChatMessage(
                6,
                "Visitor has declined your invitation to cobrowse."
              ),
              this.app.updateChat(
                SnapEngage.getMessage(65),
                !1,
                !1,
                "COBROWSE_DECLINE",
                !1,
                !1
              ),
              this.app.chatView.disableCobrowsingButtons(),
              this.app.chatView.showInput(),
              this.app.updateScroll();
          },
          handleButtonMessageClick: function (e, t, a) {
            this.setMessageCookie(e);
            var s = {
              value: e.target.value,
              buttonId: a,
            };
            this.sendMessage(e, s),
              this.app.chatView
                .getMessageView()
                .clearSystemMessage(this.app.systemMessageIds.BUTTON_OPTIONS),
              this.app.chatView.showInput(),
              SnapABug.getCustomDesignUI()
                .chatView.getMessageView()
                .triggerAgentIsTyping(!0),
              SnapEngage.callCallback(
                SnapEngage.callbacks.INLINE_BUTTON_CLICKED,
                {
                  botName: this.app.chatView
                    .getMessageView()
                    .getState("agentName"),
                  buttonValue: s.value,
                  buttonLabel: t,
                  buttonId: s.buttonId,
                }
              );
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.ChatController = t);
      })(window);
      !(function (t) {
        function e(t) {
          this.app = t;
          var e = this;
          e.app.prechatView.bind("prechatChatButtonClick", function () {
            e.chatButtonClick();
          });
        }
        (e.prototype = {
          chatButtonClick: function () {
            var t = this.app.mainView.iframe.getElementById("prechat");
            this.app.widgetSelectStatus &&
              (t =
                "inline" ===
                this.app.mainView.iframe.getElementById("prechat").style.display
                  ? this.app.mainView.iframe.getElementById("prechat")
                  : this.app.mainView.iframe.getElementById("offline")),
              this.app.fieldsController.checkFieldInputs(t);
          },
          submitMessage: function (t, e, i) {
            this.switchView(i),
              this.app.chatController.sendChat(t, !0),
              this.app.chatView.getMessageView().setIsSystemMessage(!1),
              this.app.chatView.messageView.updateChat(t, !0, !1, !1),
              e && (this.app.email = e);
          },
          switchView: function (t) {
            t
              ? this.app.offlineView.hide()
              : (this.app.prechatView.refresh(), this.app.prechatView.toggle()),
              this.app.chatView.toggle(),
              this.app.setState("boxType", "chatManual");
          },
        }),
          (t.chat_custom_design = t.chat_custom_design || {}),
          (t.chat_custom_design.PrechatController = e);
      })(window);
      !(function (e) {
        function i(e) {
          this.app = e;
          var i = this;
          i.app.offlineView.bind("offlineSendEmailButtonClick", function () {
            i.sendEmailButtonClick();
          });
        }
        (i.prototype = {
          sendEmailButtonClick: function () {
            var e = this.app.mainView.iframe.getElementById("offline");
            this.app.widgetSelectStatus &&
              (e =
                "inline" ===
                this.app.mainView.iframe.getElementById("prechat").style.display
                  ? this.app.mainView.iframe.getElementById("prechat")
                  : this.app.mainView.iframe.getElementById("offline")),
              this.app.fieldsController.checkFieldInputs(e);
          },
          submitMessage: function (e, i, t) {
            e || (e = "");
            var n = {
              address: i,
              description: e,
              isOnlineForm: !1,
            };
            SnapEngage.sendCreateCase(n),
              this.switchView(t),
              (this.app.offlineView.offlineMessageSubmitted = !0);
          },
          switchView: function (e) {
            e && (this.app.prechatView.prechatForm.style.display = "none"),
              (this.app.offlineView.offlineForm.style.display = "none"),
              this.app.helpers.toggleFooterButtons("none"),
              this.app.offlineView.initOfflineConfirmMsg(e);
          },
          autoResponderPopulateForm: function (e) {
            this.app.chatView.toggle(),
              this.app.offlineView.toggle(),
              SnapEngage.setDescription(e),
              this.app.email && SnapEngage.setUserEmail(this.app.email);
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.OfflineController = i);
      })(window);
      !(function (t) {
        function e(t, e) {
          this.defaultCloseSurvey(),
            (this.app = t),
            (this.systemCommandSettings = e),
            (this.surveyIntervalId = null),
            (this.defaultCloseTimeoutId = null),
            "standard" === e.surveyContent
              ? this.standardSurveyEventBinding()
              : "custom" === e.surveyContent && this._showCloseButton();
        }
        (e.prototype = {
          standardSurveyEventBinding: function () {
            var t = this;
            t.app.postChatView.bind("mouseOverChatAgentSurveyRating", function (
              e
            ) {
              t.app.postChatView.getState("isSurveyVisible") &&
                t.mouseOverRating(e);
            }),
              t.app.postChatView.bind(
                "mouseOutChatAgentSurveyRating",
                function (e) {
                  t.app.postChatView.getState("isSurveyVisible") &&
                    t.mouseOutRating(e);
                }
              ),
              t.app.postChatView.bind(
                "mouseDownSetChatAgentSurveyRating",
                function (e) {
                  t.app.postChatView.getState("isSurveyVisible") &&
                    t.mouseSetSurveyRating(e);
                }
              ),
              t.app.postChatView.bind("submitSurveyComments", function () {
                t.app.postChatView.getState("isSurveyVisible") &&
                  t.submitSurveyComments();
              }),
              t.app.postChatView.bind("cancelSubmitSurvey", function () {
                t.cancelSubmitSurvey();
              });
          },
          mouseOverRating: function (t) {
            this.app.postChatView.mouseoverChatAgentSurveyRating(t);
          },
          mouseOutRating: function () {
            this.app.postChatView.mouseoutChatAgentSurveyRating();
          },
          mouseSetSurveyRating: function (t) {
            this.app.postChatView.setChatAgentSurveyRating(t),
              this.app.updateScroll();
          },
          submitSurveyComments: function () {
            this.app.postChatView.emailTranscriptCard &&
            this.app.postChatView.emailTranscriptCard.getState(
              "emailTranscriptUiVisible"
            )
              ? this.removeSurveyTextArea()
              : this.clearAndRemovePostChat(),
              this.app.postChatView.setState("isSurveyVisible", !1),
              this.app.postChatView.sendChatAgentSurveyRating(!0),
              this.app.chatView.getMessageView().setIsSystemMessage(!1),
              this.app.chatView
                .getMessageView()
                .updateChat(SnapEngage.getMessage(26), !1, !1, !1);
          },
          removePostChatContent: function () {
            SnapEngageChat.animateFadeOut(
              document
                .getElementById(this.app.helpers.getIframeId())
                .contentWindow.document.getElementById("post-chat-content")
            );
          },
          clearAndRemovePostChat: function () {
            clearTimeout(this.defaultCloseTimeoutId),
              clearInterval(this.surveyIntervalId),
              this.removePostChatContent(),
              this._showCloseButton();
          },
          cancelSubmitSurvey: function () {
            this.app.postChatView.emailTranscriptCard &&
            this.app.postChatView.emailTranscriptCard.getState(
              "emailTranscriptUiVisible"
            )
              ? this.removeSurveyTextArea()
              : this.clearAndRemovePostChat();
          },
          _showCloseButton: function () {
            this.app.chatView.toggleCloseButton(),
              this.app.chatView.resizeMessageInputArea("notextarea");
          },
          defaultCloseSurvey: function () {
            this.defaultCloseTimeoutId = setTimeout(
              function () {
                clearInterval(this.surveyIntervalId);
                var t = document
                  .getElementById(this.app.helpers.getIframeId())
                  .contentWindow.document.getElementById("post-chat-content");
                t && SnapEngageChat.animateFadeOut(t);
              }.bind(this),
              36e6
            );
          },
          removeSurveyTextArea: function () {
            SnapEngageChat.animateFadeOut(
              document
                .getElementById(this.app.helpers.getIframeId())
                .contentWindow.document.getElementById(
                  "chatSurveyRatingContainer"
                )
            );
          },
          initTimeout: function (t) {
            var e,
              a = this.app.postChatView.iframe.getElementById(
                "endchat-counter"
              ),
              i = t;
            this.surveyIntervalId = setInterval(
              function () {
                --i > 60
                  ? (e = Math.ceil(i / 60) + " minutes")
                  : i > 30
                  ? (e = "1 minute")
                  : i < 30 && i > 15
                  ? (e = "30 seconds")
                  : i < 15 &&
                    i > 0 &&
                    ((e = i + " seconds"), 1 === i && (e = i + " second")),
                  (a.innerText = e),
                  i <= 0 && this.clearAndRemovePostChat();
              }.bind(this),
              1e3
            );
          },
        }),
          (t.chat_custom_design = t.chat_custom_design || {}),
          (t.chat_custom_design.PostChatController = e);
      })(window);
      !(function (e) {
        function n(e) {
          (this.app = e), this._updateBindings();
        }
        (n.prototype = {
          _updateBindings: function () {
            var e = this;
            e.app.callmeView.bind("callmeOnPhoneOptionClick", function () {
              e.callmeOnPhoneOptionClick();
            }),
              e.app.callmeView.bind("callmeOnComputerOptionClick", function () {
                e.callmeOnComputerOptionClick();
              }),
              e.app.callmeView.bind("callmeOnPhoneSubmit", function () {
                e.callmeOnPhoneSubmit();
              });
          },
          callmeOnComputerOptionClick: function () {
            SnapEngageChat.submitFormCallMe(!0, !0),
              this.app.callmeView.hideCallmeViews();
          },
          callmeOnPhoneOptionClick: function () {
            this.app.callmeView.showCallmeOnMyPhoneView();
          },
          callmeOnPhoneSubmit: function () {
            SnapEngageChat.isPhoneNumberValid()
              ? (SnapEngageChat.submitFormCallMe(!0, !1),
                this.app.callmeView.hideCallmeViews(),
                this.app.callmeView.refresh(),
                this._updateBindings())
              : (this.app.callmeView.iframe.getElementById(
                  "SnapABug_phone"
                ).innerHTML = "Please enter a valid phone number.");
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.CallmeController = n);
      })(window);
      !(function (e) {
        function t(e) {
          this.app = e;
          var t = this;
          t.app.intelliPrechatView.bind("submitPrechatQuestion", function () {
            t.submitPrechatQuery(), t.removePreviousQuery();
          }),
            t.app.intelliPrechatView.bind("contact", function () {
              t.submitMessage();
            });
        }
        (t.prototype = {
          submitPrechatQuery: function () {
            this.app.intelliPrechatView.searchInput.focus(),
              this.app.intelliPrechatView.loadingResults(),
              (this.app.intelliPrechatView.submitIntelliPrechatQuestion.value = SnapEngage.getMessage(
                51
              ));
            var e = this.app.intelliPrechatView.searchInput.value,
              t =
                SnapEngage.getBaseURL() +
                "/chatjs/preChatSearch?criteria=" +
                encodeURIComponent(e) +
                "&widget=" +
                SnapEngage.getWidgetId() +
                "&locale=" +
                SnapEngage.getLocale();
            SnapEngage.rpc(t, 3, !0);
          },
          callbackSearchResults: function (e) {
            this.app.intelliPrechatView.intelliPrechatResults(e),
              this.app.helpers.removeElement(
                this.app.intelliPrechatView.iframe.getElementById(
                  "ele-intelliPrechatSearchLoading"
                )
              ),
              this.app.intelliPrechatView.enableFooterButtons();
          },
          removePreviousQuery: function () {
            var e = this.app.intelliPrechatView.iframe.getElementById(
              "container-intelliPrechatResults"
            );
            e && this.app.helpers.removeElement(e);
          },
          submitMessage: function () {
            var e = this.app.intelliPrechatView.iframe.getElementById(
              "input-intelliPrechatQuestion"
            ).value;
            this.switchView(e);
          },
          switchView: function (e) {
            if (
              (this.app.intelliPrechatView.refresh(),
              this.app.intelliPrechatView.toggle(),
              this.app.buttonView.getIsOnline())
            ) {
              if (this.app.prechatView.getShowPrechat())
                this.app.prechatView.show(),
                  this._prefillDescription("prechat", e),
                  this.app.setState("boxType", "prechat");
              else {
                var t = SnapEngage.getMessage(54) + ': "' + e + '".';
                this.app.chatController.sendChat(t, !0),
                  this.app.chatView.getMessageView().setIsSystemMessage(!1),
                  this.app.chatView.messageView.updateChat(t, !0, !1, !1),
                  this.app.chatView.toggle();
              }
            } else
              this.app.offlineView.toggle(),
                this._prefillDescription("offline", e),
                this.app.setState("boxType", "offline");
          },
          _prefillDescription: function (e, t) {
            var i = this.app.mainView.iframe.querySelector(
              "." + e + "-textarea#description"
            );
            i && (i.value = SnapEngage.getMessage(54) + ': "' + t + '".');
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.IntelliPrechatController = t);
      })(window);
      !(function (e) {
        function t(e) {
          this.app = e;
          var t = this;
          t.app.prechatView.fieldsView.bind(
            "fieldFocusPreChat",
            "prechat",
            function (e) {
              t.app.helpers.iosScrollToTop(),
                t.scrollToFocusedField(e, "prechat-content");
            }
          ),
            t.app.offlineView.fieldsView.bind(
              "fieldFocusOffline",
              "offline",
              function (e) {
                t.app.helpers.iosScrollToTop(),
                  t.scrollToFocusedField(e, "offline-content");
              }
            ),
            t.app.prechatView.fieldsView.bind(
              "fieldBlurPreChat",
              "prechat",
              function () {
                t.app.helpers.iosScrollToTop();
              }
            ),
            t.app.offlineView.fieldsView.bind(
              "fieldBlurOffline",
              "offline",
              function () {
                t.app.helpers.iosScrollToTop();
              }
            ),
            t.app.prechatView.fieldsView.bind(
              "widgetOptionsPreChat",
              "prechat",
              function (e) {
                t.app.setWidgetStatus(e);
              }
            ),
            t.app.offlineView.fieldsView.bind(
              "widgetOptionsOffline",
              "offline",
              function (e) {
                t.app.setWidgetStatus(e);
              }
            ),
            t.app.prechatView.fieldsView.bind(
              "checkboxPreChat",
              "prechat",
              function (e) {
                t.toggleChecked(e);
              }
            ),
            t.app.offlineView.fieldsView.bind(
              "checkboxOffline",
              "offline",
              function (e) {
                t.toggleChecked(e);
              }
            );
        }
        (t.prototype = {
          checkFieldInputs: function (e) {
            for (
              var t, i = this.app.options[e.id + "Fields"], a = 0;
              a < i.length;
              a++
            )
              (i[a].required || "email" === i[a].type) &&
                this.validate(i[a], e);
            var l = "",
              s = e.querySelectorAll(".field-input");
            for (a = 0; a < s.length; a++)
              this.setCvval(s[a]),
                "email" === s[a].name && "email" === s[a].type
                  ? ((t = s[a].value),
                    SnapEngage.setUserEmail(t),
                    SnapEngageChat.setUserEmailCookie(t))
                  : "description" === s[a].name && "textarea" === s[a].type
                  ? (l = s[a].value)
                  : "name" === s[a].name &&
                    "text" === s[a].type &&
                    SnapEngage.setUserName(s[a].value);
            var n = e.getElementsByClassName("invalid");
            n.length > 0
              ? this.scrollToInvalidField(n[0], e)
              : "offline" !== e.id ||
                (this.app.widgetSelectStatus &&
                  "offline" !== this.app.widgetSelectStatus)
              ? "prechat" !== e.id ||
                (this.app.widgetSelectStatus &&
                  "prechat" !== this.app.widgetSelectStatus)
                ? "prechat" === e.id &&
                  "offline" === this.app.widgetSelectStatus
                  ? this.app.offlineController.submitMessage(l, t, !0)
                  : "offline" === e.id &&
                    "prechat" === this.app.widgetSelectStatus &&
                    this.app.prechatController.submitMessage(l, t, !0)
                : this.app.prechatController.submitMessage(l, t)
              : this.app.offlineController.submitMessage(l, t);
          },
          scrollToFocusedField: function (e, t) {
            /android/i.test(navigator.userAgent) &&
              setTimeout(function () {
                (this.iframe = document.getElementById(
                  "designstudio-iframe"
                ).contentWindow.document),
                  (this.iframe.getElementById(t).scrollTop =
                    e.target.parentElement.offsetTop -
                    this.iframe.getElementById(t).offsetTop);
              }, 500);
          },
          scrollToInvalidField: function (e, t) {
            t.querySelector(
              '[data-ref="' + t.id + "-" + e.name + '"]'
            ).scrollIntoView({
              behavior: "smooth",
              block: "start",
            });
          },
          setCvval: function (e) {
            "email" !== e.name &&
              "description" !== e.name &&
              SnapEngage.setCvval(e.name, e.value);
          },
          validate: function (e, t) {
            var i = t.querySelectorAll("#" + e.name)[0];
            if ("email" === e.name && "email" === e.type)
              this.validateEmailDiv(i);
            else if ("phone" === e.name && "tel" === e.type)
              this.validateTelDiv(i);
            else if ("dropdown" === e.type || "widgetselector" === e.type)
              this.validateDropdownsDiv(i);
            else if ("checkbox" === e.type) {
              var a = t.querySelectorAll("." + t.id + "-checkbox-wrapper");
              if (a.length) {
                var l = this;
                Array.prototype.forEach.call(a, function (e) {
                  "true" === e.getAttribute("required") &&
                    l.validateCheckboxDiv(e);
                });
              }
            } else
              ("textarea" !== e.type && "text" !== e.type) ||
                this.validateTextDiv(i);
          },
          _validateEmail: function (e) {
            return /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(
              e
            );
          },
          _validateRadioCheckbox: function (e) {
            return !!e.checked;
          },
          _validateDropdowns: function (e) {
            return 0 !== e.selectedIndex;
          },
          _validateTel: function (e) {
            return !/([<>[\]\\,;:@"!@#$%^&*'\/a-zA-Z ])/g.test(e);
          },
          validateTextDiv: function (e) {
            var t = !0;
            return (
              !e || (e.value && e.value.trim().length)
                ? this.app.helpers.elementRemoveClass(e, "invalid")
                : ((t = !1), this.app.helpers.elementAddClass(e, "invalid")),
              t
            );
          },
          validateEmailDiv: function (e) {
            var t = !0,
              i = this._validateEmail(e.value),
              a = e.value.trim().length,
              l = e.required;
            return (
              e &&
                (i
                  ? this.app.helpers.elementRemoveClass(e, "invalid")
                  : l || (!l && a)
                  ? ((t = !1), this.app.helpers.elementAddClass(e, "invalid"))
                  : this.app.helpers.elementRemoveClass(e, "invalid")),
              t
            );
          },
          validateTelDiv: function (e) {
            var t = !0;
            return (
              !e ||
              (e.value && e.value.trim().length && this._validateTel(e.value))
                ? this.app.helpers.elementRemoveClass(e, "invalid")
                : ((t = !1), this.app.helpers.elementAddClass(e, "invalid")),
              t
            );
          },
          validateCheckboxDiv: function (e) {
            var t = this,
              i = e.querySelectorAll('input[type="checkbox"]');
            Array.prototype.forEach.call(i, function (e) {
              e.checked
                ? t.app.helpers.elementHasClass(e, "invalid") &&
                  t.app.helpers.elementRemoveClass(e, "invalid")
                : t._validateRadioCheckbox(e) ||
                  t.app.helpers.elementAddClass(e, "invalid");
            });
          },
          validateDropdownsDiv: function (e) {
            var t = !0;
            return (
              e && !this._validateDropdowns(e)
                ? ((t = !1), this.app.helpers.elementAddClass(e, "invalid"))
                : this.app.helpers.elementRemoveClass(e, "invalid"),
              t
            );
          },
          returnFalseWidget: function (e) {
            (e.target.options[e.target.selectedIndex].innerHTML =
              "Invalid Selection Made"),
              (e.target.options[e.target.selectedIndex].disabled = !0);
          },
          setRequiredOfflineFields: function () {
            var e;
            this.view =
              "inline" === this.app.prechatView.prechat.style.display
                ? this.app.prechatView.prechat
                : this.app.offlineView.offline;
            var t = this.view.querySelector('.field-input[type="email"]'),
              i = this.view.querySelector('.field-input[type="tel"]');
            (t && t.hasAttribute("required")) ||
              (i && i.hasAttribute("required")) ||
              (t && !t.hasAttribute("required")
                ? (t.setAttribute("required", "true"),
                  this.app.helpers.elementAddClass(
                    t,
                    "widget-selector-require-input"
                  ),
                  (e = this.view.querySelector('label[for="email"]')))
                : i &&
                  !i.hasAttribute("required") &&
                  (i.setAttribute("required", "true"),
                  this.app.helpers.elementAddClass(
                    i,
                    "widget-selector-require-input"
                  ),
                  (e = this.view.querySelector('label[for="phone"]'))),
              this.app.helpers.elementAddClass(
                e.parentNode,
                "widget-selector-required"
              ),
              this.app.helpers.elementAddClass(
                e.appendChild(
                  this.app.prechatView.getFieldsView().labelSpan("*")
                ),
                "widget-selector-required-symbol"
              ));
          },
          toggleChecked: function (e) {
            e.target.hasAttribute("checked")
              ? e.target.removeAttribute("checked")
              : e.target.setAttribute("checked", !0),
              e.target.setAttribute("value", e.target.checked);
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.FieldsController = t);
      })(window);
      !(function (e) {
        function t(e) {
          this.app = e;
          var t = this;
          t.app.secureDataView.bind("cancelSecureDataClick", function () {
            t.cancelSecureDataClick();
          });
        }
        (t.prototype = {
          restoreChatViewComponents: function () {
            (this.app.secureDataView.isVisible = !1),
              this.app.chatView.showInput(),
              this.app.secureDataView.destroy(this.app),
              this.app.chatView.messageView.updateScroll();
          },
          cancelSecureDataClick: function () {
            SnapABugChat.cancelVisitorRequest(),
              this.restoreChatViewComponents();
          },
          submitSecureDataClick: function () {
            this.restoreChatViewComponents();
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.SecureDataController = t);
      })(window);
      !(function (t) {
        function i(t) {
          this.app = t;
        }
        (i.prototype = {
          clearInvite: function () {
            this.app.proactiveView.getIsProactiveInvite() &&
              (this.app.proactiveView.toggleState("isProactiveInvite"),
              this.app.proactiveView.toggleState("isVisible"),
              this.app.mainController.resetProactive());
          },
          finishProactiveTimeout: function () {
            this.proactiveView.getIsProactiveInvite() &&
              this.setNoProactiveCookies(),
              this.refresh(),
              this.setVisitorNotification(!1),
              SnapEngageChat.reInit();
          },
        }),
          (t.chat_custom_design = t.chat_custom_design || {}),
          (t.chat_custom_design.ProactiveController = i);
      })(window);
      !(function (i) {
        function n(i) {
          this.app = i;
          var n = this;
          n.app.animateView.bind("mainDivAnimationEnd", function (i) {
            n.mainDivAnimationEnd(i);
          }),
            n.app.animateView.bind("minimizeDivAnimationEnd", function (i) {
              n.minimizeDivAnimationEnd(i);
            });
        }
        (n.prototype = {
          _updateMessageBindings: function (i) {
            var n = this;
            n.app.animateView.bindNewMessageListener(i, function (i) {
              n.messageDivAnimationEnd(i);
            });
          },
          _removeAnimation: function (i) {
            SnapEngage.getCustomDesignUI() &&
              SnapEngage.getCustomDesignUI().helpers &&
              SnapEngage.getCustomDesignUI().helpers.elementRemoveClass(
                i.target,
                "designstudio-animated " + i.animationName
              );
          },
          _callAnimationCallback: function (i) {
            SnapEngage.getCustomDesignUI() &&
              SnapEngage.getCustomDesignUI().animateView &&
              SnapEngage.getCustomDesignUI().animateView.callAnimationCallback(
                i
              );
          },
          buttonLoadAnimation: function () {
            this.app.animateView.addAnimation(
              document.getElementById("iframe-designstudio-button"),
              this.app.animateView.getAnimationIn(
                this.app.animateView.animatedElement.BUTTON
              )
            );
          },
          buttonClickAnimation: function () {
            (!this.app.state.isMinimized && SnapEngage.isChatInProgress()) ||
              this.app.animateView.addAnimation(
                document.getElementById("designstudio"),
                this.app.animateView.getAnimationIn(
                  this.app.animateView.animatedElement.BOX
                )
              );
          },
          minimizeIconClickAnimation: function (i) {
            var n;
            (n =
              SnapEngage.isChatInProgress() ||
              this.app.proactiveView.getIsProactiveInvite()
                ? this.app.animateView.getAnimationOut(
                    this.app.animateView.animatedElement.MINIMIZE
                  )
                : this.app.animateView.getAnimationOut(
                    this.app.animateView.animatedElement.BOX
                  )),
              this.app.animateView.addAnimation(
                document.getElementById("designstudio"),
                n,
                i
              );
          },
          maximizeAnimation: function () {
            this.app.animateView.addAnimation(
              document.getElementById("designstudio"),
              this.app.animateView.getAnimationIn(
                this.app.animateView.animatedElement.MINIMIZE
              )
            );
          },
          proactiveAnimation: function () {
            this.app.animateView.addAnimation(
              document.getElementById("designstudio"),
              this.app.animateView.getAnimationIn(
                this.app.animateView.animatedElement.BOX
              )
            );
          },
          proactiveTimeoutAnimation: function (i) {
            this.app.mainView.getIsVisible()
              ? this.app.animateView.addAnimation(
                  document.getElementById("designstudio"),
                  this.app.animateView.getAnimationOut(
                    this.app.animateView.animatedElement.BOX
                  ),
                  i
                )
              : this.app.proactiveView.getIsVisible() &&
                this.app.animateView.addAnimation(
                  document.getElementById("designstudio-minimize"),
                  this.app.animateView.getAnimationOut(
                    this.app.animateView.animatedElement.BOX
                  ),
                  i
                );
          },
          mainDivAnimationEnd: function (i) {
            this._removeAnimation(i), this._callAnimationCallback();
          },
          minimizeDivAnimationEnd: function (i) {
            this._removeAnimation(i), this._callAnimationCallback();
          },
          messageDivAnimationEnd: function (i) {
            SnapEngage.getCustomDesignUI()
              .animateView.getAnimationIn(
                SnapEngage.getCustomDesignUI().animateView.animatedElement
                  .MINIMIZE_MESSAGE
              )
              .indexOf(i.animationName) >= 0
              ? this._removeAnimation(i)
              : (this.app.minimizeView.hideTargetMessage(i),
                this.app.minimizeView.resizeDivs()),
              this._callAnimationCallback(i);
          },
        }),
          (i.chat_custom_design = i.chat_custom_design || {}),
          (i.chat_custom_design.AnimateController = n);
      })(window);
      var aa = {
        HORIZONTAL: "HORIZONTAL",
        VERTICAL: "VERTICAL",
      };
      function oa() {
        return "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTggNEgzQzIuNDQ3NzIgNCAyIDQuNDQ3NzIgMiA1VjEzQzIgMTMuNTUyMyAyLjQ0NzcyIDE0IDMgMTRIMTFDMTEuNTUyMyAxNCAxMiAxMy41NTIzIDEyIDEzVjhIMTFWMTNIM1Y1SDhWNFoiIGZpbGw9IiMxRTI4MzMiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMy44NTM2IDIuMTQ2NDVDMTQuMDQ4OCAyLjM0MTcxIDE0LjA0ODggMi42NTgyOSAxMy44NTM2IDIuODUzNTVMNy4zNTM1NSA5LjM1MzU1QzcuMTU4MjkgOS41NDg4MiA2Ljg0MTcxIDkuNTQ4ODIgNi42NDY0NSA5LjM1MzU1QzYuNDUxMTggOS4xNTgyOSA2LjQ1MTE4IDguODQxNzEgNi42NDY0NSA4LjY0NjQ1TDEzLjE0NjQgMi4xNDY0NUMxMy4zNDE3IDEuOTUxMTggMTMuNjU4MyAxLjk1MTE4IDEzLjg1MzYgMi4xNDY0NVoiIGZpbGw9IiMxRTI4MzMiLz4KPHBhdGggZD0iTTkgMi41QzkgMi4yMjM4NiA5LjIyMzg2IDIgOS41IDJIMTMuNUMxMy43NzYxIDIgMTQgMi4yMjM4NiAxNCAyLjVDMTQgMi43NzYxNCAxMy43NzYxIDMgMTMuNSAzSDkuNUM5LjIyMzg2IDMgOSAyLjc3NjE0IDkgMi41WiIgZmlsbD0iIzFFMjgzMyIvPgo8cGF0aCBkPSJNMTMgMi41QzEzIDIuMjIzODYgMTMuMjIzOSAyIDEzLjUgMkMxMy43NzYxIDIgMTQgMi4yMjM4NiAxNCAyLjVWNi41QzE0IDYuNzc2MTQgMTMuNzc2MSA3IDEzLjUgN0MxMy4yMjM5IDcgMTMgNi43NzYxNCAxMyA2LjVWMi41WiIgZmlsbD0iIzFFMjgzMyIvPgo8L3N2Zz4K";
      }
      function ka(t) {
        var e = 2;
        return (
          "excerpt" === t && (e = 3),
          ";overflow: hidden;text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: " +
            e +
            ";-webkit-box-orient:vertical;"
        );
      }
      function ja(t, e) {
        var i = e - 3;
        return (t.substring(0, i) + "...").replace(/\......([^.]*?)$/, "...");
      }
      !(function (t) {
        function e(e) {
          (this.options = e && e.agentMessage),
            (this.helpers = new t.chat_custom_design.Helpers(this.options)),
            (this.searchInProgress = !1),
            (this.iframe = document.getElementById(
              this.helpers.getIframeId()
            ).contentWindow.document),
            (this.messageContents = this.iframe.getElementById(
              "messages-content"
            )),
            (this.containerWidth = e.width),
            (this.lastCardsResults = null);
        }
        function i(t, e) {
          for (var i in e) t.style[i] = e[i];
        }
        (e.prototype = {
          render: function (t) {
            var e = document.createElement("div");
            e.setAttribute("className", "search-results-container"),
              e.setAttribute("data-testid", "search-results-container");
            var i = "visible";
            t.layout === aa.VERTICAL && (i = ""),
              e.setAttribute(
                "style",
                "width: 100%;overflow-x: " +
                  i +
                  "; position:relative; padding-bottom: 10px;"
              ),
              this.messageContents.appendChild(e),
              (this.lastCardsResults = e);
            var r = t.cards;
            t.layout === aa.VERTICAL
              ? (this.stacked({
                  container: e,
                  data: r,
                }),
                this.focusFirstCard(this.iframe))
              : t.layout === aa.HORIZONTAL &&
                this.carousel({
                  container: e,
                  data: r,
                });
          },
          carousel: function (t) {
            var e = this,
              r = document.createElement("a"),
              n = document.createElement("a"),
              s = document.createElement("div"),
              a = this.containerWidth - 40,
              o = 8,
              l = 8,
              d = [];
            t.data.length > 1 &&
              (function () {
                (r.innerHTML =
                  '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M14.5 5.5L8 12L14.5 18.5" stroke="#1E2833" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>'),
                  (n.innerHTML =
                    '        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M9.5 18.5L16 12L9.5 5.5" stroke="#1E2833" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>');
                var t =
                  "border-radius: 25px;height: 25px;width: 25px;background-color: white; box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.2); cursor: pointer; z-index: 1000;";
                r.setAttribute("style", t),
                  n.setAttribute("style", t),
                  i(r, {
                    visibility: "hidden",
                  });
              })();
            var c = 0,
              u = t.container,
              g = t.data,
              p = g.length;
            function h() {
              var t = d[(c += 1)];
              x(),
                i(s, {
                  transform: "translateX(-" + t + "px)",
                });
            }
            function M() {
              var t = d[(c -= 1)];
              x(),
                i(s, {
                  transform: "translateX(-" + t + "px)",
                });
            }
            function x() {
              var t = c < p - 1;
              i(r, {
                visibility: c > 0 ? "visible" : "hidden",
              }),
                i(n, {
                  visibility: t ? "visible" : "hidden",
                });
            }
            !(function (t) {
              s.setAttribute("class", "carousel-result-container"),
                (function (t, e, i, r, n) {
                  var s = document.createElement("div");
                  s.setAttribute("class", "carousel-navigation"),
                    s.setAttribute(
                      "style",
                      "top: 40%;margin-top: -5px;position: absolute;width: 100%;display: flex; justify-content: space-between; height: 0;"
                    ),
                    (i.onclick = t),
                    s.appendChild(i),
                    (r.onclick = e),
                    s.appendChild(r),
                    n.appendChild(s);
                })(M, h, r, n, t.container),
                t.data.forEach(function (t, i) {
                  var r = 0 === i,
                    n = i === g.length - 1,
                    c = a - 2 * o - l;
                  r || n || (c -= l),
                    0 === i ? d.push(0) : d.push(d[i - 1] + c + l);
                  var u = e.getCard(t, c, o);
                  s.appendChild(u);
                });
              var i = 2 * d[d.length - 1] || "auto";
              s.setAttribute(
                "style",
                "display:inline-flex;transform: translateX(0px);transition: 0.3s transform linear; width: " +
                  i +
                  "px;"
              ),
                t.container.appendChild(s);
            })({
              container: u,
              data: g,
            });
          },
          stacked: function (t) {
            var e = this,
              i = document.createElement("div"),
              r = t.data;
            !(function (t) {
              t.data.forEach(function (t, r) {
                var n = e.getCard(t);
                0 === r && n.classList.add("first-search-card"),
                  i.appendChild(n);
              }),
                t.container.appendChild(i);
            })({
              container: t.container,
              data: r,
            });
          },
          getCard: function (t, e, i) {
            var r = "number" != typeof e,
              n = document.createElement("div"),
              s = document.createElement("a"),
              a = document.createElement("div"),
              o = document.createElement("span");
            o.setAttribute("class", "cardTitle");
            var l = document.createElement("p");
            s.setAttribute(
              "style",
              "text-decoration: none; color:" +
                this.options.fontColor +
                "; max-height: 130px"
            );
            var d = "",
              c =
                "background: " +
                this.options.bgColor +
                ";border: " +
                this.options.borderColor +
                " solid " +
                this.options.borderWidth +
                "px; word-break: break-word; box-sizing: border-box; margin-right: 8px; border-radius:" +
                this.options.borderRadius +
                "px;max-height: 130px;";
            r
              ? ((e = "100%"), (d = "8px 0px"))
              : ((e += "px"),
                n.setAttribute("class", "searchResultCard"),
                (d = i)),
              (c += "margin: " + d + ";width: " + e + ";"),
              n.setAttribute("style", c),
              s.setAttribute("href", t.link),
              s.setAttribute("target", "_blank"),
              s.setAttribute("class", "card-link"),
              a.setAttribute("class", "card-content"),
              a.setAttribute("style", "padding: 0.71em 1em;"),
              this.setStyles(o, l, this.options),
              (o.innerText = t.title),
              (l.innerText = t.excerpt),
              SnapEngage.isIE11() &&
                ((o.innerText = ja(t.title, 90)),
                (l.innerText = ja(t.excerpt, 100)));
            var u = document.createElement("div"),
              g = document.createElement("img");
            return (
              u.setAttribute("style", "display: flex;align-items: center;"),
              g.setAttribute("style", "width: 12px;height: 12px"),
              g.setAttribute("src", oa()),
              u.appendChild(g),
              u.appendChild(o),
              n.appendChild(s),
              s.appendChild(a),
              a.appendChild(u),
              a.appendChild(l),
              n
            );
          },
          focusFirstCard: function (t) {
            var e = t.querySelectorAll(".first-search-card");
            if (0 === e.length) return !1;
            e[e.length - 1].querySelector(".card-link").focus();
          },
          setStyles: function (t, e, i) {
            var r =
                "font-size: 12px; margin: 2px 0 0 0; font-style: normal; font-weight: normal; line-height: 16px; color:" +
                i.fontColor +
                "; word-break: break-word",
              n =
                "margin-left: 10px; word-break: break-word; color: " +
                i.fontColor +
                "; line-height: 20px; font-weight: bold;  font-size: 14px;";
            t.setAttribute("style", n + ka("title")),
              e.setAttribute("style", r + ka("excerpt"));
          },
        }),
          (t.chat_custom_design = t.chat_custom_design || {}),
          (t.chat_custom_design.SearchResultsView = e);
      })(window);
      !(function (e) {
        function t(t, n) {
          (this.app = n),
            (this.options = t),
            (this.helpers = new e.chat_custom_design.Helpers(this.options)),
            (this.iframe = document.getElementById(
              this.helpers.getIframeId()
            ).contentWindow.document),
            (this.messageContents = this.iframe.getElementById(
              "messages-content"
            )),
            (this.containerWidth = this.messageContents.clientWidth),
            (this.offlineView =
              this.offlineView ||
              new e.chat_custom_design.OfflineView(this.options));
        }
        (t.prototype = {
          closeChatViewAndNotifyBackEnd: function (e) {
            var t = SnapABug.getCaseId();
            SnapABugChat.cancelChat(),
              e.chatController.endChat(!1, !1),
              SnapABug.setChatInProgress(!1),
              SnapABugChat.setCaseId(t),
              SnapEngageChat.sendChatMessage(2, ""),
              SnapABug.setCaseId("");
          },
          render: function (e) {
            var t = this,
              n = this.app.chatView.messageView.agentMessageTemplate(e.preText),
              s = n.getElementsByClassName("message-text"),
              i = document.createElement("a");
            i.innerText = e.linkText;
            var a = this.offlineView,
              o = this.app;
            !(function (e, t) {
              for (var n in t) e.style[n] = t[n];
            })(i, {
              cursor: "pointer",
            }),
              i.addEventListener("click", function () {
                e &&
                  e.action &&
                  e.action.widgetId &&
                  SnapABug.switchWidget(e.action.widgetId),
                  t.closeChatViewAndNotifyBackEnd(o),
                  o.chatView.toggle(),
                  a.toggle();
              }),
              s[0].appendChild(i),
              s[0].appendChild(document.createTextNode(e.postText)),
              this.messageContents.appendChild(n),
              (this.messageContents.scrollTop = this.messageContents.scrollHeight);
          },
        }),
          (e.chat_custom_design = e.chat_custom_design || {}),
          (e.chat_custom_design.TextLinkView = t);
      })(window);
      var ra = window.chat_custom_design.EmailTranscriptRequest;
      !(function (t) {
        function e(t) {
          (this.options = t),
            (this.email = SnapEngageChat.getUserEmailCookie()),
            (this.systemMessageIds = {
              WAGT_AUTO_RESPOND: "msg-autorespond",
              BYE_BYE: "msg-bye-bye",
              CLOSE: "message-close",
              CLOSE_WARN: "message-closewarn",
              COBR_COBROWSE_INVITE: "message-cobrowse-invite",
              COBROWSE_ACCEPT: "message-cobrowse-accept",
              COBROWSE_DECLINE: "message-cobrowse-decline",
              ERROR_MSG: "message-error",
              FURV_FILE_UPLOAD: "message-fileupload-request",
              FILE_UPLOAD_ERR: "message-fileupload-err",
              NFO_INITIAL: "msg-initial-nfo",
              GO2_REDIRECT: "message-redirect",
              SDTM_SECURE_DATA: "message-securedata-sdtm",
              START: "message-start",
              API_SYSTEM_MSG: "msg-system-api",
              WAI_WAITING: "msg-waiting-wai",
              BUTTON_OPTIONS: "button-options",
            }),
            (this.TYPEOFCHAT = {
              OFFLINE: "offline",
              ONLINE_MANUAL_CHAT: "manual",
              ONLINE_PROACTIVE_CHAT: "proactive",
            });
        }
        (e.prototype = {
          initState: function () {
            (this.state = this.getInitialState()), this.setTypeOfChat();
          },
          init: function () {
            this.initState(), this.initApp();
          },
          initApp: function () {
            (this.helpers =
              this.helpers || new t.chat_custom_design.Helpers(this.options)),
              this.setState("isMobileDevice", this.helpers.isMobileDevice()),
              (this.callbackStore =
                this.callbackStore || new t.chat_custom_design.CallbackStore()),
              this.helpers.checkFontForImport() &&
                ((this.importFont = !0),
                (this.fontConfig = new t.chat_custom_design.FontConfig(
                  this.options
                ))),
              this.helpers.initViewport(),
              this.helpers.setLanguageDirection(SnapEngage.getLocale()),
              (this.buttonView =
                this.buttonView ||
                new t.chat_custom_design.ButtonView(
                  this.options,
                  !1,
                  !1,
                  this.getState().buttonViewOptions
                )),
              this.buttonView.render(),
              (this.options.logoUrl = this.helpers.getLogoChatBoxURL(
                this.options.logoUrl,
                SnapEngage.getWidgetId(),
                SnapEngage.getLocale()
              )),
              (this.mainView =
                this.mainView ||
                new t.chat_custom_design.MainView(this.options)),
              this.mainView.render(),
              (this.prechatView =
                this.prechatView ||
                new t.chat_custom_design.PrechatView(this.options)),
              this.prechatView.render(),
              (this.offlineView =
                this.offlineView ||
                new t.chat_custom_design.OfflineView(this.options)),
              this.offlineView.render(),
              (this.chatView =
                this.chatView ||
                new t.chat_custom_design.ChatView(
                  this.options,
                  !1,
                  this.systemMessageIds
                )),
              this.chatView.render(),
              (this.callmeView =
                this.callmeView ||
                new t.chat_custom_design.CallmeView(this.options)),
              this.callmeView.render(),
              this.helpers.isInsideGWT() ||
                ((this.minimizeView =
                  this.minimizeView ||
                  new t.chat_custom_design.MinimizeView(
                    this.options,
                    this.getButtonViewOptions(this.options, !0)
                  )),
                this.minimizeView.render()),
              this.helpers.isInsideGWT() ||
                (this.animateView =
                  this.animateView || new t.chat_custom_design.AnimateView()),
              (this.proactiveView =
                this.proactiveView ||
                new t.chat_custom_design.ProactiveView(this, this.options)),
              (this.proactiveController =
                this.proactiveController ||
                new t.chat_custom_design.ProactiveController(this)),
              (this.mainController =
                this.mainController ||
                new t.chat_custom_design.MainController(this)),
              (this.buttonController =
                this.buttonController ||
                new t.chat_custom_design.ButtonController(this)),
              (this.minimizeController =
                this.minimizeController ||
                new t.chat_custom_design.MinimizeController(this)),
              (this.prechatController =
                this.prechatController ||
                new t.chat_custom_design.PrechatController(this)),
              (this.chatController =
                this.chatController ||
                new t.chat_custom_design.ChatController(this)),
              (this.offlineController =
                this.offlineController ||
                new t.chat_custom_design.OfflineController(this)),
              (this.callmeController =
                this.callmeController ||
                new t.chat_custom_design.CallmeController(this)),
              (this.fieldsController =
                this.fieldsController ||
                new t.chat_custom_design.FieldsController(this)),
              (this.searchResultsView =
                this.searchResultsView ||
                new t.chat_custom_design.SearchResultsView(this)),
              this.helpers.isInsideGWT() ||
                (this.animateController =
                  this.animateController ||
                  new t.chat_custom_design.AnimateController(this)),
              this.setDefaultFields(),
              this.state.isMinimized
                ? this.showMinimize()
                : this.checkStatusShowButton(),
              this.setUpAnimations();
          },
          setState: function (t, e) {
            this.state[t] = e;
          },
          getState: function (t) {
            return t ? this.state[t] : this.state;
          },
          getInitialState: function () {
            return {
              boxType: null,
              chatType: null,
              isFakeNotInProgressMinimize: !1,
              isMinimized: SnapEngageChat.isMinimized(),
              windowIsFocused: !0,
              isMobileUI: null,
              agentHasPhone: !1,
              isMobileDevice: t.chat_custom_design.Helpers.prototype.isMobileDevice(),
              buttonViewOptions: this.getButtonViewOptions(this.options, !1),
            };
          },
          getButtonViewOptions: function (e, i) {
            var s = i ? e.onlineButton : e.offlineButton;
            return (
              (function (t) {
                return (
                  t.hasOwnProperty("useDesktopOnlineButtonSettings") &&
                  t.hasOwnProperty("useDesktopOfflineButtonSettings") &&
                  null !== t.useDesktopOnlineButtonSettings &&
                  null !== t.useDesktopOfflineButtonSettings
                );
              })(e) &&
                ((this.getState() && this.getState().isMobileDevice) ||
                  t.chat_custom_design.Helpers.prototype.isMobileDevice()) &&
                (i && !e.useDesktopOnlineButtonSettings
                  ? (s = e.mobileOnlineButton)
                  : i ||
                    e.useDesktopOfflineButtonSettings ||
                    (s = e.mobileOfflineButton)),
              s
            );
          },
          setDefaultFields: function () {
            this.setUserEmail(
              SnapEngage.getUserEmail()
                ? SnapEngage.getUserEmail()
                : SnapEngageChat.getUserEmailCookie(),
              SnapEngage.getEmailLocked()
            ),
              this.setUserName();
          },
          enableEmailTranscriptRequest: function () {
            if (this.chatView.getState("emailTranscriptEnabled")) return !1;
            (this.chatView.emailTranscriptCard &&
              this.chatView.emailTranscriptCard.getState(
                "emailTranscriptAddress"
              )) ||
              ((this.chatView.emailTranscriptCard = new ra({
                helpers: this.helpers,
                removeEmailTranscriptCallback: this.chatController.removeEmailTranscriptCallback.bind(
                  this.chatController
                ),
              })),
              this.chatView.emailTranscriptCard.getTranscriptEmailAddress()),
              this.chatView.setState("emailTranscriptEnabled", !0);
            var t = {
              name: "emailTranscriptEnabled",
              text: SnapEngage.getMessage(72),
              registerEvent: this.chatController.handleEmailTranscriptRequest.bind(
                this.chatController
              ),
            };
            this.chatView.setMenuState(t), this.chatView.updateActionArea();
          },
          injectFontToFrames: function () {
            this.importFont &&
              (!this.hideButtonSettingUsed &&
                this.buttonView.isText &&
                this.buttonView.setFontConfig(),
              this.mainView.setFontConfig(),
              this.minimizeView.setFontConfig());
          },
          checkStatusShowButton: function () {
            this.buttonController.checkStatusShowButton();
          },
          getSystemMessageObj: function () {
            return this.systemMessageIds;
          },
          destroy: function () {
            this.buttonView.destroy(),
              this.mainView.destroy(),
              this.minimizeView.destroy(),
              delete this.helpers,
              delete this.fontConfig,
              delete this.buttonView,
              delete this.mainView,
              delete this.minimizeView,
              delete this.prechatView,
              delete this.chatView,
              delete this.offlineView,
              delete this.postChatView,
              delete this.callmeView,
              delete this.intelliPrechatView,
              delete this.secureDataView,
              delete this.animateView,
              delete this.proactiveView,
              delete this.mainController,
              delete this.buttonController,
              delete this.prechatController,
              delete this.chatController,
              delete this.offlineController,
              delete this.fieldsController,
              delete this.postChatController,
              delete this.callmeController,
              delete this.minimizeController,
              delete this.intelliPrechatController,
              delete this.secureDataController,
              delete this.animateController,
              delete this.proactiveController,
              delete this.searchResultsView;
          },
          refresh: function () {
            this.destroy(), this.init();
          },
          refreshKeepState: function () {
            this.destroy(), this.initApp();
          },
          setUpAnimations: function () {
            this.mainView.setUpAnimations(),
              this.buttonView.setUpAnimations(),
              this.minimizeView.setUpAnimations();
          },
          setAgentDetailsinGWT: function (t, e) {
            this.helpers.isInsideGWT() &&
              (this.chatView.getMessageView().setAgentName(t),
              this.chatView.getMessageView().setAgentAvatar(e));
          },
          setSystemMessageToBeRemoved: function (t) {
            this.chatView.getMessageView().setSystemMessageToBeRemoved(t);
          },
          updateChat: function (t, e, i, s, n, a, o, h) {
            s
              ? (this.chatView
                  .getMessageView()
                  .setIsSystemMessage(this.systemMessageIds[s]),
                -1 === ["COBROWSE_ACCEPT", "COBROWSE_DECLINE"].indexOf(s) &&
                  this.chatView
                    .getMessageView()
                    .setSystemMessageToBeRemoved(this.systemMessageIds[s]))
              : this.chatView
                  .getMessageView()
                  .systemMessageToBeRemoved.indexOf(
                    this.systemMessageIds.BUTTON_OPTIONS
                  ) >= 0 &&
                (this.chatView
                  .getMessageView()
                  .clearSystemMessage(this.systemMessageIds.BUTTON_OPTIONS),
                this.chatView.showInput()),
              i ||
                s ||
                (this.minimizeView.isVisible &&
                  this.minimizeView.incrementNotify()),
              this.chatView.getMessageView().updateChat(t, e, n, a),
              !this.minimizeView.isVisible ||
                e ||
                i ||
                (this.minimizeView.updateMessage(t, e, s, o, h),
                this.minimizeController.setMinimizeStashCookie(t));
          },
          hideTab: function () {
            this.buttonView.hide();
          },
          showTab: function () {
            this.setState(
              "buttonViewOptions",
              this.getButtonViewOptions(
                this.options,
                this.buttonView.getIsOnline()
              )
            ),
              this.buttonController.refreshButton(
                this.getState().buttonViewOptions
              ),
              (this.hideButtonSettingUsed =
                this.buttonView.isShowNoButton() ||
                SnapEngage.getHideButtonAPIUsed()),
              this.injectFontToFrames(),
              (!SnapEngage.getShowButtonAPIUsed() &&
                this.mainView.getIsVisible()) ||
                this.hideButtonSettingUsed ||
                this.buttonView.show(),
              SnapEngage.isChatInProgress() && !this.state.isMinimized
                ? this.buttonController.buttonClick()
                : SnapEngage.isChatInProgress() &&
                  this.state.isMinimized &&
                  this.minimizeChatBoxToggle();
          },
          showMinimize: function () {
            var t = decodeURIComponent(
              SnapEngageChat.getCookie("SnapABugMinimizeStashCookie")
            );
            t && (t = JSON.parse(t)),
              this.minimizeView.show(),
              t &&
                !t.hasBeenRead &&
                (this.minimizeView.updateMessage(t.lastMinimizeMessage, !1, !1),
                this.minimizeView.incrementNotify(t.notifications));
          },
          showChat: function () {
            this.buttonView.isVisible && this.buttonView.toggle(),
              this.minimizeView.isVisible && this.minimizeView.hide(),
              this.chatView.show();
          },
          showPrechat: function () {
            this.prechatView.setShowPrechat(!0),
              this.buttonController.buttonClick();
          },
          showOffline: function () {
            this.offlineView.setShowOffline(!0),
              this.offlineController.sendEmailButtonClick();
          },
          proactive: function (t, e, i, s, n) {
            if (SnapEngage.getStartChatRequested())
              return (
                (t = SnapEngage.getStartChatRequested()),
                void this.buttonController.buttonClick(t)
              );
            (!SnapEngageChat.getIsForcedProactive() &&
              SnapEngageChat.isNoProactiveChatCookie()) ||
              (this.setAgentName(e),
              this.setAgentAvatar(i),
              this.proactiveView.init(n),
              SnapEngage.setProactiveChatAutocloseTimeout(),
              this.setTypeOfChat(this.TYPEOFCHAT.ONLINE_PROACTIVE_CHAT),
              this.setState("boxType", "proactiveInvite"),
              this.updateChat(t, !1, !1, !1, !1, !1, n, s),
              Array.isArray(s) &&
                s.forEach(function (t) {
                  SnapABugChat.callbackMessage(!0, t);
                }),
              SnapEngage.callCallback("OpenProactive", e, t));
          },
          proactiveTimeout: function () {
            this.caseExists() ||
              (this.setTypeOfChat(),
              this.proactiveView.getIsVisible() &&
              void 0 !== this.animateController
                ? this.animateController.proactiveTimeoutAnimation(
                    this.proactiveController.finishProactiveTimeout.bind(this)
                  )
                : this.proactiveController.finishProactiveTimeout.call(this));
          },
          setNoProactiveCookies: function () {
            SnapABugChat.setNoProactiveChatCookie(),
              SnapABugChat.deleteCookie("isProactiveInvite");
          },
          caseExists: function () {
            return (
              SnapEngage.getCaseId() ||
              SnapEngage.getDbCaseId() ||
              this.chatView.chatMessageTextarea.value.length
            );
          },
          setAgentName: function (t) {
            this.chatView.getMessageView().setAgentName(t);
          },
          setAgentAvatar: function (t) {
            this.chatView.getMessageView().setAgentAvatar(t),
              this.minimizeView.showAvatarOrSVG(),
              SnapEngageChat.setAgentAvatarCookie(t);
          },
          setTypeOfChat: function (t) {
            var e = t || null;
            this.setState("chatType", e);
          },
          getTypeOfChat: function () {
            return this.getState("chatType");
          },
          isVisitorTyping: function () {
            return this.chatView.isVisitorTyping();
          },
          getVisitorTyping: function () {
            return this.chatView.getVisitorTyping();
          },
          triggerIsTyping: function (t) {
            this.chatView.getMessageView().triggerAgentIsTyping(t);
          },
          endChat: function (t) {
            this.chatController.endChat(t, !1);
          },
          setRequiredFields: function (t, e) {
            (this.isEmailRequired = 1 === t),
              (this.isMessageRequired = 1 === e);
          },
          enableFileUploadButtons: function () {
            this.chatView.iframe.getElementById(
              this.systemMessageIds.FURV_FILE_UPLOAD
            ) ||
              (this.mainView.iframe.getElementById(
                this.systemMessageIds.CLOSE_WARN
              ) && this.chatController.cancelCloseChat(),
              this.mainController.disableSpecialFeatureViews(),
              this.chatView.setState("isMenuOpen", !1),
              this.chatView.hideInput(),
              this.updateChat(
                SnapEngage.getMessage(56),
                !1,
                !1,
                "FURV_FILE_UPLOAD",
                !1,
                !1
              ),
              this.helpers.elementAddId(
                "container-agent-message" +
                  (this.options.agentMessage.bubble ? "-bubble" : ""),
                this.systemMessageIds.FURV_FILE_UPLOAD
              ),
              this.chatView.enableFileUploadButtons());
          },
          hideUploadButtons: function () {
            this.chatView.disableFileUploadButtons();
          },
          setAllowCallMe: function (t) {
            this.setState("agentHasPhone", t);
          },
          enableCallMeOption: function () {
            if (
              function () {
                return this.chatView.state.menuItems.some(function (t) {
                  return t.name.indexOf("callMe") >= 0;
                });
              }.call(this) ||
              !this.getState("agentHasPhone")
            )
              return !1;
            var t = {
              name: "callMe",
              text: SnapEngage.getMessage(41),
              registerEvent: this.chatController.callmeButtonClick.bind(
                this.chatController
              ),
            };
            this.chatView.setMenuState(t), this.chatView.updateActionArea();
          },
          removeCallMeOption: function () {
            var t = this.chatView.getState("menuItems").filter(function (t) {
              return -1 === t.name.indexOf("callMe");
            });
            this.chatView.setState("menuItems", t),
              this.chatView.updateActionArea();
          },
          enableCobrowsingButtons: function (t, e) {
            this.helpers.elementAddId(
              "container-agent-message" +
                (this.options.agentMessage.bubble ? "-bubble" : ""),
              this.systemMessageIds.COBR_COBROWSE_INVITE
            ),
              this.chatView.hideInput(),
              this.chatView.enableCobrowsingButtons(t, e);
          },
          disableCobrowsingButtons: function () {
            this.chatView.disableCobrowsingButtons();
          },
          showButtonUI: function (t) {
            this.chatView.hideInput(),
              this.chatView.getMessageView().showButtonUI(t);
          },
          updateScroll: function () {
            this.chatView.getMessageView().updateScroll();
          },
          getSystemCommandsCustomDesign: function () {
            var t = SnapEngageChat.getSystemCommandsCustomDesign(),
              e = {};
            return (
              (e.timeOut = t.timeOut),
              (e.nickname = t.nickname),
              (e.surveyContent = t.chatAgentSurvey
                ? "standard"
                : t.postChatHTML
                ? "custom"
                : null),
              "standard" === e.surveyContent
                ? (e.chatAgentSurvey = t.chatAgentSurvey)
                : "custom" === e.surveyContent &&
                  ((e.postChatSurveyContent = t.postChatHTML),
                  (e.caseId = t.caseId)),
              e
            );
          },
          initPostChatUI: function () {
            var e = this.getSystemCommandsCustomDesign();
            this.hasPostChatContent(e) &&
              ((this.postChatView =
                this.postChatView ||
                new t.chat_custom_design.PostChatView(this)),
              this.postChatView.render(e),
              (this.postChatController =
                this.postChatController ||
                new t.chat_custom_design.PostChatController(this, e)),
              e.timeOut > -1 && this.postChatController.initTimeout(e.timeOut),
              this.chatView.messageView.updateScroll());
          },
          hasPostChatContent: function (t) {
            return (
              this.hasPostChatSurvey(t) ||
              (t.timeOut > -1 && this.hasPostChatEmailTranscript())
            );
          },
          hasPostChatSurvey: function (t) {
            return !!t.surveyContent;
          },
          hasPostChatEmailTranscript: function () {
            return (
              this.chatView.getState("emailTranscriptEnabled") &&
              !this.chatView.emailTranscriptCard.getState("isSubmitted")
            );
          },
          minimizeChatBoxToggle: function () {
            var t = !SnapEngage.isChatInProgress();
            t
              ? this.setState("isFakeNotInProgressMinimize", t)
              : SnapEngageChat.minimizeToggle(),
              this.setState(
                "isMinimized",
                !!this.state.isFakeNotInProgressMinimize ||
                  SnapEngageChat.isMinimized()
              ),
              this.setVisitorNotification(!1);
          },
          initIntelliPrechatView: function () {
            (this.intelliPrechatView =
              this.intelliPrechatView ||
              new t.chat_custom_design.IntelliPrechatView(this.options)),
              this.intelliPrechatView.render(),
              (this.intelliPrechatController =
                this.intelliPrechatController ||
                new t.chat_custom_design.IntelliPrechatController(this));
          },
          initSearchResultsView: function (e) {
            (this.searchResultsView = new t.chat_custom_design.SearchResultsView(
              this.options
            )),
              this.searchResultsView.render(e);
          },
          initTextLinkView: function (e) {
            (this.TextLinkView = new t.chat_custom_design.TextLinkView(
              this.options,
              this
            )),
              this.TextLinkView.render(e);
          },
          initErrorMessage: function () {
            this.chatView.getMessageView().errorMessage(),
              this.mainController._updateBinding();
          },
          getChatAnsweredStatus: function () {
            return SnapEngageChat.getChatAnsweredStatus();
          },
          initSecureFileDataTransfer: function (e, i) {
            this.callmeView.getIsVisible() && this.callmeView.hideCallmeViews(),
              this.mainView.iframe.getElementById(
                this.systemMessageIds.CLOSEWARN
              ) && this.chatController.cancelCloseChat(),
              this.mainController.disableSpecialFeatureViews(),
              this.chatView.hideCancelCallmeButtons(),
              this.chatView.hideInput(),
              (this.secureDataView =
                this.secureDataView ||
                new t.chat_custom_design.SecureDataView(this.options, this)),
              this.secureDataView.render(e, i),
              (this.secureDataController =
                this.secureDataController ||
                new t.chat_custom_design.SecureDataController(this));
          },
          disableButton: function (t) {
            (this.iframe = document.getElementById(
              "designstudio-iframe"
            ).contentWindow.document),
              this.iframe &&
                this.iframe.getElementById(t) &&
                (this.iframe.getElementById(t).disabled = !0);
          },
          setWidgetStatus: function (t) {
            var e = this;
            this.iframe = document.getElementById(
              "designstudio-iframe"
            ).contentWindow.document;
            var i = this.iframe.querySelectorAll(".widget-selector-required");
            i.length > 0 &&
              i.forEach(function (t) {
                var i = t.querySelector(".widget-selector-required-symbol"),
                  s = t.querySelector(".widget-selector-require-input");
                e.helpers.elementRemoveClass(t, "widget-selector-required"),
                  e.helpers.elementRemoveClass(s, "invalid"),
                  s.removeAttribute("required"),
                  e.helpers.removeElement(i);
              });
            var s = {
              event: t,
              originalStatus: SnapEngage.getAgentStatus(),
              newWidgetId: t.target.value,
            };
            (s.originalButtonElement =
              0 === s.originalStatus ? "offline" : "prechat"),
              SnapEngage.switchWidget(
                s.newWidgetId,
                this.widgetSelectorCallbackFunction.bind(this, s)
              );
          },
          widgetSelectorCallbackFunction: function (t) {
            var e,
              i = SnapEngage.getAgentStatus();
            if (-1 === i)
              return (
                (t.originalStatus = -1),
                (this.widgetSelectStatus = "invalid"),
                this.fieldsController.returnFalseWidget(
                  t.event,
                  t.originalButtonElement
                ),
                this.helpers.disableViewButton(t.originalButtonElement),
                SnapEngage.setCallback("agentOnline", null),
                !1
              );
            -1 === t.originalStatus &&
              ((this.widgetSelectStatus = 1 === i ? "prechat" : "offline"),
              (e = this.iframe.querySelector(
                'input[type="button"][disabled="true"'
              )),
              (t.originalStatus = e.id.indexOf("offline") >= 0 ? 0 : 1)),
              1 === i && 0 === t.originalStatus
                ? ((this.widgetSelectStatus = "prechat"),
                  (t.originalButtonElement = "offline"))
                : 0 === i &&
                  1 === t.originalStatus &&
                  ((this.widgetSelectStatus = "offline"),
                  (t.originalButtonElement = "prechat")),
              e && this.helpers.enableViewButton(e),
              this.widgetSelectStatus &&
                this.helpers.toggleFooterButtons(this.widgetSelectStatus),
              0 === i && this.fieldsController.setRequiredOfflineFields(),
              "function" ==
                typeof this.callbackStore.getCallback("SWITCH_WIDGET") &&
                this.callbackStore.callCallback(
                  this.callbackStore.CALLBACKS.SWITCH_WIDGET.name,
                  t.newWidgetId
                ),
              SnapEngage.setCallback("agentOnline", null);
          },
          setVisitorNotification: function (t) {
            var e = 0;
            if (
              "visible" !== document.visibilityState ||
              (!this.getState("windowIsFocused") && t)
            )
              return (
                clearInterval(this.blinkTimerId),
                (this.blinkTimerId = null),
                void (this.blinkTimerId = setInterval(
                  function () {
                    if (
                      SnapEngage.isChatInProgress() ||
                      this.proactiveView.getIsProactiveInvite()
                    )
                      document.title = e % 2 ? t.state2 : t.state1;
                    else if (
                      this.blinkTimerId &&
                      !SnapEngage.isChatInProgress()
                    )
                      return (
                        clearInterval(this.blinkTimerId),
                        void (this.blinkTimerId = null)
                      );
                    e++;
                  }.bind(this),
                  1e3
                ))
              );
            clearInterval(this.blinkTimerId),
              (this.blinkTimerId = null),
              (document.title = SnapABugChat.getPageTitle(!1));
          },
          setDescription: function (t) {
            this.offlineView.getFieldsView().setDescriptionField(t),
              this.prechatView.getFieldsView().setDescriptionField(t);
          },
          setUserEmail: function (t, e) {
            t &&
              (this.prechatView
                .getFieldsView()
                .setEmailField(t, e, this.prechatView.prechat),
              this.offlineView
                .getFieldsView()
                .setEmailField(t, e, this.offlineView.offline));
          },
          setUserName: function (t) {
            var e = t || SnapABugChat.getUserAliasCookie();
            e &&
              !SnapEngage.isChatInProgress() &&
              (this.offlineView.getFieldsView().setUserNameField(e),
              this.prechatView.getFieldsView().setUserNameField(e)),
              (this.options.visitorName = e || this.options.visitorName);
          },
          setCustomField: function (t, e) {
            this.offlineView.getFieldsView().setCustomField(t, e),
              this.prechatView.getFieldsView().setCustomField(t, e);
          },
          setMobileUI: function (t) {
            this.setState("isMobileUI", t), this.refreshKeepState();
          },
          minimizeCallback: function () {
            var t;
            this.state.isFakeNotInProgressMinimize &&
              (t = function () {
                this.setState("isFakeNotInProgressMinimize", !1),
                  this.setState("isMinimized", SnapEngageChat.isMinimized());
              }.bind(this)),
              "function" == typeof this.callbackStore.getCallback("MINIMIZE") &&
                this.callbackStore.callCallback(
                  this.callbackStore.CALLBACKS.MINIMIZE.name,
                  this.state.isMinimized,
                  this.getTypeOfChat(),
                  this.state.boxType,
                  t
                );
          },
        }),
          (t.chat_custom_design = t.chat_custom_design || {}),
          (t.chat_custom_design.SnapEngageCustomDesign = e);
      })(window);
      function sa(e) {
        var s = ha(),
          n = s.getBaseURL(),
          a = "c=" + encodeURIComponent(e);
        (a = s.appendTagsParameter(a)),
          s.rpc(
            n + "/chatjs/ServiceAgentReassign?" + a,
            3,
            "callAssignNewAgent"
          );
      }
      function ia() {
        return window.SnapABugChat;
      }
      function ha() {
        return window.SnapABug;
      }
      var da;
      function ea(e) {
        var t = ha(),
          $ = ia(),
          a = t.getCaseId(),
          r = $.getIsHumanResponded(),
          n = $.getBannedCookie(),
          o = t.getCallMePhone();
        a && !r && "1" != n && "" == o ? e || sa(a) : ba();
      }
      function xa(e) {
        var t = ia();
        da && ba(),
          (da = window.setInterval(function () {
            ea(t.isAgentTyping());
          }, 1e3 * e));
      }
      function ba() {
        da && (window.clearInterval(da), (da = void 0));
      }
      (window.requestChatReassignment = ea),
        (window.clearChatReassignmentTimer = ba),
        (window.setChatReassignmentTimer = xa);
      function za(r) {
        var e = r;
        if ("string" != typeof e)
          return console.error("URL is not of type string"), e;
        var t,
          n,
          o,
          a,
          i,
          s = /%(([a-z A-Z 0-9]){2})\b/;
        return e.length <= 2e3
          ? e
          : (!0 ===
              !!(t = (e = e.substring(0, 2e3)).substring(
                e.length - 20,
                e.length
              )).match(s) &&
              ((n = t.match(s)[0]),
              (o = e.lastIndexOf(n)),
              (e = e.substring(0, o))),
            (a = fa(e.substring(e.indexOf("&m=") + 3, e.length))),
            (i = e.indexOf("&m=") + 3),
            (e = e.substring(0, i)),
            (e += a));
      }
      function fa(r) {
        if ("string" == typeof r && -1 != r.indexOf("%"))
          try {
            decodeURIComponent(r);
          } catch (e) {
            return fa(r.substring(0, r.length - 1));
          }
        return r;
      }
      (window.snapEngageUtils = window.snapEngageUtils || {}),
        (window.snapEngageUtils.formatRpcUrl = za);
    })();

    /*
Copyright (c) 2010, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.8.2r1 + fix from Duncan Walker to support ember.js:
B.versions.push(H);B.builds.push(G); --> B.versions?B.versions.push(H):false;B.builds?B.builds.push(G):false;
*/
    if (typeof YAHOO == "undefined" || !YAHOO) {
      var YAHOO = {};
    }
    YAHOO.namespace = function () {
      var A = arguments,
        E = null,
        C,
        B,
        D;
      for (C = 0; C < A.length; C = C + 1) {
        D = ("" + A[C]).split(".");
        E = YAHOO;
        for (B = D[0] == "YAHOO" ? 1 : 0; B < D.length; B = B + 1) {
          E[D[B]] = E[D[B]] || {};
          E = E[D[B]];
        }
      }
      return E;
    };
    YAHOO.log = function (D, A, C) {
      var B = YAHOO.widget.Logger;
      if (B && B.log) {
        return B.log(D, A, C);
      } else {
        return false;
      }
    };
    YAHOO.register = function (A, E, D) {
      var I = YAHOO.env.modules,
        B,
        H,
        G,
        F,
        C;
      if (!I[A]) {
        I[A] = {
          versions: [],
          builds: [],
        };
      }
      B = I[A];
      H = D.version;
      G = D.build;
      F = YAHOO.env.listeners;
      B.name = A;
      B.version = H;
      B.build = G;
      B.versions ? B.versions.push(H) : false;
      B.builds ? B.builds.push(G) : false;
      B.mainClass = E;
      for (C = 0; C < F.length; C = C + 1) {
        F[C](B);
      }
      if (E) {
        E.VERSION = H;
        E.BUILD = G;
      } else {
        YAHOO.log("mainClass is undefined for module " + A, "warn");
      }
    };
    YAHOO.env = YAHOO.env || {
      modules: [],
      listeners: [],
    };
    YAHOO.env.getVersion = function (A) {
      return YAHOO.env.modules[A] || null;
    };
    YAHOO.env.ua = (function () {
      var D = function (H) {
          var I = 0;
          return parseFloat(
            H.replace(/\./g, function () {
              return I++ == 1 ? "" : ".";
            })
          );
        },
        G = navigator,
        F = {
          ie: 0,
          opera: 0,
          gecko: 0,
          webkit: 0,
          mobile: null,
          air: 0,
          caja: G.cajaVersion,
          secure: false,
          os: null,
        },
        C = navigator && navigator.userAgent,
        E = window && window.location,
        B = E && E.href,
        A;
      F.secure = B && B.toLowerCase().indexOf("https") === 0;
      if (C) {
        if (/windows|win32/i.test(C)) {
          F.os = "windows";
        } else {
          if (/macintosh/i.test(C)) {
            F.os = "macintosh";
          }
        }
        if (/KHTML/.test(C)) {
          F.webkit = 1;
        }
        A = C.match(/AppleWebKit\/([^\s]*)/);
        if (A && A[1]) {
          F.webkit = D(A[1]);
          if (/ Mobile\//.test(C)) {
            F.mobile = "Apple";
          } else {
            A = C.match(/NokiaN[^\/]*/);
            if (A) {
              F.mobile = A[0];
            }
          }
          A = C.match(/AdobeAIR\/([^\s]*)/);
          if (A) {
            F.air = A[0];
          }
        }
        if (!F.webkit) {
          A = C.match(/Opera[\s\/]([^\s]*)/);
          if (A && A[1]) {
            F.opera = D(A[1]);
            A = C.match(/Opera Mini[^;]*/);
            if (A) {
              F.mobile = A[0];
            }
          } else {
            A = C.match(/MSIE\s([^;]*)/);
            if (A && A[1]) {
              F.ie = D(A[1]);
            } else {
              A = C.match(/Gecko\/([^\s]*)/);
              if (A) {
                F.gecko = 1;
                A = C.match(/rv:([^\s\)]*)/);
                if (A && A[1]) {
                  F.gecko = D(A[1]);
                }
              }
            }
          }
        }
      }
      return F;
    })();
    (function () {
      YAHOO.namespace("util", "widget", "example");
      if ("undefined" !== typeof YAHOO_config) {
        var B = YAHOO_config.listener,
          A = YAHOO.env.listeners,
          D = true,
          C;
        if (B) {
          for (C = 0; C < A.length; C++) {
            if (A[C] == B) {
              D = false;
              break;
            }
          }
          if (D) {
            A.push(B);
          }
        }
      }
    })();
    YAHOO.lang = YAHOO.lang || {};
    (function () {
      var B = YAHOO.lang,
        A = Object.prototype,
        H = "[object Array]",
        C = "[object Function]",
        G = "[object Object]",
        E = [],
        F = ["toString", "valueOf"],
        D = {
          isArray: function (I) {
            return A.toString.apply(I) === H;
          },
          isBoolean: function (I) {
            return typeof I === "boolean";
          },
          isFunction: function (I) {
            return typeof I === "function" || A.toString.apply(I) === C;
          },
          isNull: function (I) {
            return I === null;
          },
          isNumber: function (I) {
            return typeof I === "number" && isFinite(I);
          },
          isObject: function (I) {
            return (I && (typeof I === "object" || B.isFunction(I))) || false;
          },
          isString: function (I) {
            return typeof I === "string";
          },
          isUndefined: function (I) {
            return typeof I === "undefined";
          },
          _IEEnumFix: YAHOO.env.ua.ie
            ? function (K, J) {
                var I, M, L;
                for (I = 0; I < F.length; I = I + 1) {
                  M = F[I];
                  L = J[M];
                  if (B.isFunction(L) && L != A[M]) {
                    K[M] = L;
                  }
                }
              }
            : function () {},
          extend: function (L, M, K) {
            if (!M || !L) {
              throw new Error(
                "extend failed, please check that " +
                  "all dependencies are included."
              );
            }
            var J = function () {},
              I;
            J.prototype = M.prototype;
            L.prototype = new J();
            L.prototype.constructor = L;
            L.superclass = M.prototype;
            if (M.prototype.constructor == A.constructor) {
              M.prototype.constructor = M;
            }
            if (K) {
              for (I in K) {
                if (B.hasOwnProperty(K, I)) {
                  L.prototype[I] = K[I];
                }
              }
              B._IEEnumFix(L.prototype, K);
            }
          },
          augmentObject: function (M, L) {
            if (!L || !M) {
              throw new Error("Absorb failed, verify dependencies.");
            }
            var I = arguments,
              K,
              N,
              J = I[2];
            if (J && J !== true) {
              for (K = 2; K < I.length; K = K + 1) {
                M[I[K]] = L[I[K]];
              }
            } else {
              for (N in L) {
                if (J || !(N in M)) {
                  M[N] = L[N];
                }
              }
              B._IEEnumFix(M, L);
            }
          },
          augmentProto: function (L, K) {
            if (!K || !L) {
              throw new Error("Augment failed, verify dependencies.");
            }
            var I = [L.prototype, K.prototype],
              J;
            for (J = 2; J < arguments.length; J = J + 1) {
              I.push(arguments[J]);
            }
            B.augmentObject.apply(this, I);
          },
          dump: function (I, N) {
            var K,
              M,
              P = [],
              Q = "{...}",
              J = "f() {...}",
              O = ", ",
              L = " => ";
            if (!B.isObject(I)) {
              return I + "";
            } else {
              if (I instanceof Date || ("nodeType" in I && "tagName" in I)) {
                return I;
              } else {
                if (B.isFunction(I)) {
                  return J;
                }
              }
            }
            N = B.isNumber(N) ? N : 3;
            if (B.isArray(I)) {
              P.push("[");
              for (K = 0, M = I.length; K < M; K = K + 1) {
                if (B.isObject(I[K])) {
                  P.push(N > 0 ? B.dump(I[K], N - 1) : Q);
                } else {
                  P.push(I[K]);
                }
                P.push(O);
              }
              if (P.length > 1) {
                P.pop();
              }
              P.push("]");
            } else {
              P.push("{");
              for (K in I) {
                if (B.hasOwnProperty(I, K)) {
                  P.push(K + L);
                  if (B.isObject(I[K])) {
                    P.push(N > 0 ? B.dump(I[K], N - 1) : Q);
                  } else {
                    P.push(I[K]);
                  }
                  P.push(O);
                }
              }
              if (P.length > 1) {
                P.pop();
              }
              P.push("}");
            }
            return P.join("");
          },
          substitute: function (Y, J, R) {
            var N,
              M,
              L,
              U,
              V,
              X,
              T = [],
              K,
              O = "dump",
              S = " ",
              I = "{",
              W = "}",
              Q,
              P;
            for (;;) {
              N = Y.lastIndexOf(I);
              if (N < 0) {
                break;
              }
              M = Y.indexOf(W, N);
              if (N + 1 >= M) {
                break;
              }
              K = Y.substring(N + 1, M);
              U = K;
              X = null;
              L = U.indexOf(S);
              if (L > -1) {
                X = U.substring(L + 1);
                U = U.substring(0, L);
              }
              V = J[U];
              if (R) {
                V = R(U, V, X);
              }
              if (B.isObject(V)) {
                if (B.isArray(V)) {
                  V = B.dump(V, parseInt(X, 10));
                } else {
                  X = X || "";
                  Q = X.indexOf(O);
                  if (Q > -1) {
                    X = X.substring(4);
                  }
                  P = V.toString();
                  if (P === G || Q > -1) {
                    V = B.dump(V, parseInt(X, 10));
                  } else {
                    V = P;
                  }
                }
              } else {
                if (!B.isString(V) && !B.isNumber(V)) {
                  V = "~-" + T.length + "-~";
                  T[T.length] = K;
                }
              }
              Y = Y.substring(0, N) + V + Y.substring(M + 1);
            }
            for (N = T.length - 1; N >= 0; N = N - 1) {
              Y = Y.replace(new RegExp("~-" + N + "-~"), "{" + T[N] + "}", "g");
            }
            return Y;
          },
          trim: function (I) {
            try {
              return I.replace(/^\s+|\s+$/g, "");
            } catch (J) {
              return I;
            }
          },
          merge: function () {
            var L = {},
              J = arguments,
              I = J.length,
              K;
            for (K = 0; K < I; K = K + 1) {
              B.augmentObject(L, J[K], true);
            }
            return L;
          },
          later: function (P, J, Q, L, M) {
            P = P || 0;
            J = J || {};
            var K = Q,
              O = L,
              N,
              I;
            if (B.isString(Q)) {
              K = J[Q];
            }
            if (!K) {
              throw new TypeError("method undefined");
            }
            if (O && !B.isArray(O)) {
              O = [L];
            }
            N = function () {
              K.apply(J, O || E);
            };
            I = M ? setInterval(N, P) : setTimeout(N, P);
            return {
              interval: M,
              cancel: function () {
                if (this.interval) {
                  clearInterval(I);
                } else {
                  clearTimeout(I);
                }
              },
            };
          },
          isValue: function (I) {
            return (
              B.isObject(I) || B.isString(I) || B.isNumber(I) || B.isBoolean(I)
            );
          },
        };
      B.hasOwnProperty = A.hasOwnProperty
        ? function (I, J) {
            return I && I.hasOwnProperty(J);
          }
        : function (I, J) {
            return !B.isUndefined(I[J]) && I.constructor.prototype[J] !== I[J];
          };
      D.augmentObject(B, D, true);
      YAHOO.util.Lang = B;
      B.augment = B.augmentProto;
      YAHOO.augment = B.augmentProto;
      YAHOO.extend = B.extend;
    })();
    YAHOO.register("yahoo", YAHOO, {
      version: "2.8.2r1",
      build: "7",
    });
    YAHOO.util.Get = (function () {
      var M = {},
        L = 0,
        R = 0,
        E = false,
        N = YAHOO.env.ua,
        S = YAHOO.lang;
      var J = function (W, T, X) {
        var U = X || window,
          Y = U.document,
          Z = Y.createElement(W);
        for (var V in T) {
          if (T[V] && YAHOO.lang.hasOwnProperty(T, V)) {
            Z.setAttribute(V, T[V]);
          }
        }
        return Z;
      };
      var I = function (U, V, T) {
        var W = {
          id: "yui__dyn_" + R++,
          type: "text/css",
          rel: "stylesheet",
          href: U,
        };
        if (T) {
          S.augmentObject(W, T);
        }
        return J("link", W, V);
      };
      var P = function (U, V, T) {
        var W = {
          id: "yui__dyn_" + R++,
          type: "text/javascript",
          src: U,
        };
        if (T) {
          S.augmentObject(W, T);
        }
        return J("script", W, V);
      };
      var A = function (T, U) {
        return {
          tId: T.tId,
          win: T.win,
          data: T.data,
          nodes: T.nodes,
          msg: U,
          purge: function () {
            D(this.tId);
          },
        };
      };
      var B = function (T, W) {
        var U = M[W],
          V = S.isString(T) ? U.win.document.getElementById(T) : T;
        if (!V) {
          Q(W, "target node not found: " + T);
        }
        return V;
      };
      var Q = function (W, V) {
        var T = M[W];
        if (T.onFailure) {
          var U = T.scope || T.win;
          T.onFailure.call(U, A(T, V));
        }
      };
      var C = function (W) {
        var T = M[W];
        T.finished = true;
        if (T.aborted) {
          var V = "transaction " + W + " was aborted";
          Q(W, V);
          return;
        }
        if (T.onSuccess) {
          var U = T.scope || T.win;
          T.onSuccess.call(U, A(T));
        }
      };
      var O = function (V) {
        var T = M[V];
        if (T.onTimeout) {
          var U = T.scope || T;
          T.onTimeout.call(U, A(T));
        }
      };
      var G = function (V, Z) {
        var U = M[V];
        if (U.timer) {
          U.timer.cancel();
        }
        if (U.aborted) {
          var X = "transaction " + V + " was aborted";
          Q(V, X);
          return;
        }
        if (Z) {
          U.url.shift();
          if (U.varName) {
            U.varName.shift();
          }
        } else {
          U.url = S.isString(U.url) ? [U.url] : U.url;
          if (U.varName) {
            U.varName = S.isString(U.varName) ? [U.varName] : U.varName;
          }
        }
        var c = U.win,
          b = c.document,
          a = b.getElementsByTagName("head")[0],
          W;
        if (U.url.length === 0) {
          if (
            U.type === "script" &&
            N.webkit &&
            N.webkit < 420 &&
            !U.finalpass &&
            !U.varName
          ) {
            var Y = P(null, U.win, U.attributes);
            Y.innerHTML = 'YAHOO.util.Get._finalize("' + V + '");';
            U.nodes.push(Y);
            a.appendChild(Y);
          } else {
            C(V);
          }
          return;
        }
        var T = U.url[0];
        if (!T) {
          U.url.shift();
          return G(V);
        }
        if (U.timeout) {
          U.timer = S.later(U.timeout, U, O, V);
        }
        if (U.type === "script") {
          W = P(T, c, U.attributes);
        } else {
          W = I(T, c, U.attributes);
        }
        F(U.type, W, V, T, c, U.url.length);
        U.nodes.push(W);
        if (U.insertBefore) {
          var e = B(U.insertBefore, V);
          if (e) {
            e.parentNode.insertBefore(W, e);
          }
        } else {
          a.appendChild(W);
        }
        if ((N.webkit || N.gecko) && U.type === "css") {
          G(V, T);
        }
      };
      var K = function () {
        if (E) {
          return;
        }
        E = true;
        for (var T in M) {
          var U = M[T];
          if (U.autopurge && U.finished) {
            D(U.tId);
            delete M[T];
          }
        }
        E = false;
      };
      var D = function (Z) {
        if (M[Z]) {
          var T = M[Z],
            U = T.nodes,
            X = U.length,
            c = T.win.document,
            a = c.getElementsByTagName("head")[0],
            V,
            Y,
            W,
            b;
          if (T.insertBefore) {
            V = B(T.insertBefore, Z);
            if (V) {
              a = V.parentNode;
            }
          }
          for (Y = 0; Y < X; Y = Y + 1) {
            W = U[Y];
            if (W.clearAttributes) {
              W.clearAttributes();
            } else {
              for (b in W) {
                delete W[b];
              }
            }
            a.removeChild(W);
          }
          T.nodes = [];
        }
      };
      var H = function (U, T, V) {
        var X = "q" + L++;
        V = V || {};
        if (L % YAHOO.util.Get.PURGE_THRESH === 0) {
          K();
        }
        M[X] = S.merge(V, {
          tId: X,
          type: U,
          url: T,
          finished: false,
          aborted: false,
          nodes: [],
        });
        var W = M[X];
        W.win = W.win || window;
        W.scope = W.scope || W.win;
        W.autopurge =
          "autopurge" in W ? W.autopurge : U === "script" ? true : false;
        if (V.charset) {
          W.attributes = W.attributes || {};
          W.attributes.charset = V.charset;
        }
        S.later(0, W, G, X);
        return {
          tId: X,
        };
      };
      var F = function (c, X, W, U, Y, Z, b) {
        var a = b || G;
        if (N.ie) {
          X.onreadystatechange = function () {
            var d = this.readyState;
            if ("loaded" === d || "complete" === d) {
              X.onreadystatechange = null;
              a(W, U);
            }
          };
        } else {
          if (N.webkit) {
            if (c === "script") {
              if (N.webkit >= 420) {
                X.addEventListener("load", function () {
                  a(W, U);
                });
              } else {
                var T = M[W];
                if (T.varName) {
                  var V = YAHOO.util.Get.POLL_FREQ;
                  T.maxattempts = YAHOO.util.Get.TIMEOUT / V;
                  T.attempts = 0;
                  T._cache = T.varName[0].split(".");
                  T.timer = S.later(
                    V,
                    T,
                    function (j) {
                      var f = this._cache,
                        e = f.length,
                        d = this.win,
                        g;
                      for (g = 0; g < e; g = g + 1) {
                        d = d[f[g]];
                        if (!d) {
                          this.attempts++;
                          if (this.attempts++ > this.maxattempts) {
                            var h = "Over retry limit, giving up";
                            T.timer.cancel();
                            Q(W, h);
                          } else {
                          }
                          return;
                        }
                      }
                      T.timer.cancel();
                      a(W, U);
                    },
                    null,
                    true
                  );
                } else {
                  S.later(YAHOO.util.Get.POLL_FREQ, null, a, [W, U]);
                }
              }
            }
          } else {
            X.onload = function () {
              a(W, U);
            };
          }
        }
      };
      return {
        POLL_FREQ: 10,
        PURGE_THRESH: 20,
        TIMEOUT: 2000,
        _finalize: function (T) {
          S.later(0, null, C, T);
        },
        abort: function (U) {
          var V = S.isString(U) ? U : U.tId;
          var T = M[V];
          if (T) {
            T.aborted = true;
          }
        },
        script: function (T, U) {
          return H("script", T, U);
        },
        css: function (T, U) {
          return H("css", T, U);
        },
      };
    })();
    YAHOO.register("get", YAHOO.util.Get, {
      version: "2.8.2r1",
      build: "7",
    });
    window.YAHOO = YAHOO;

    /*
     * SnapEngage Customer Engagement Widget
     * Copyright (c) 2008-2019 SnapEngage, LLC
     */
    window.statusCodes = {
      SUCCESS: 1,
      NO_DATA: 3,
      DUPLICATE: 2201,
      INVALID: 2201,
      RETRY: 5008,
    };

    var SnapABug = (function () {
      var baseURL = "https://www.snapengage.com";
      var staticBaseURL = "https://storage.googleapis.com/code.snapengage.com";

      var newCaseJSON = {};
      var webCapture = true;
      var ready = true;
      var chatInProgress = false;
      // Chat in progress (gets set on creation of chat, end of chat, etc.)
      var previousProactiveRulesJSON = null;
      var widgetId = "";
      var dbCaseId = "";
      var caseId = "";
      var jsvars = "";
      var buttonImgUrl = "";
      var buttonPosition = "left";
      var buttonOffset = "55%";
      var buttonWidth = 35;
      var buttonHeight = 73;
      var email = "";
      var userName = "";
      var emailLocked = false;
      var description = "";
      var vval = "";
      // JS Variables collected by the finalize
      var cvval = {};
      // Additional variables captured in the custom forms
      var cvvalRequired = "";
      // List of the Additional variables that are mandatory (this variable is set in the populateForm() function
      var locale = "en";
      var buttonPos = "-4px";
      var formTopPos = 0;
      // Offset from the top of the browser of the pre-chat window
      var chatFormPos = "";
      // Code of the initial position of the chat window
      var logoLinkEnabled = true;
      // Is the link on the logo clickable
      var errorCode = -1;
      var sshot = 0;
      var domain = "";
      // Domain setting for cookies used by chat (to allow chat from www.domain.com to blog.domain.com)
      var jre = "";
      // Keep the JRE version information once we have determined it once
      var labelColor = "";
      var lightboxColor = "white";
      // Color of the transparent lightbox on the pre-chat form, or empty string for no lightbox

      // Required PreChat marks.
      // These are disabled if the following 2 vars are not populated.
      var requiredColor = "";
      // Color of "Required Marker"
      var requiredMarker = "";
      // Character/string for "Required Marker"

      // Variables received by the getConfig()
      var fbkText = "";
      // Feedback bottom section - prefix text
      var fbkLink = "";
      // Feedback bottom section - link URL
      var fbkLinkText = "";
      // Feedback bottom section - link text
      var chatDescriptionRequired = 1;
      // Require a problem description before chat starts
      var agentStatus = 0;
      // Widget status (0: offline, 1: online, -1: invalid)
      var chatSound = true;
      // Should the chat emit sound on new message?

      //##INCLUDE##:sab_vars.js
      var bgURL = staticBaseURL + "/wbg/snapengage_form.png";
      //lightboxColor = 'white';
      //##END##
      var waitImgLoaded = false;

      var dragFromX = 0;
      // Dragging in progress parameters
      var dragFromY = 0;
      var formPosX = -1;
      // Remembered form position
      var formPosY = -1;
      var dragging = false;
      var onmouseupPrev = null;
      var onmousemovePrev = null;
      var onmouseupInstalled = false;
      var onmousemoveInstalled = false;

      // Total width and height of the form
      var formWidth;
      var formHeight;

      var rpcUrl = "";
      var rpcStack;
      var rpcStackInitialLength = 0;
      var rpcSendOfflineMessage = false;

      var proactiveMsg = "";
      var proactiveCommands = [];
      var proactiveNotify = false;
      var proactiveAgentNumber = "";
      var proactiveOfflineFallback = false;
      var proactiveAutocloseTimerDelay = 2;
      // Default delay for proactive chat closing is 2 mins
      var callmeButton = "";
      var useCustomCallMeButton = false;
      var callmePhone = "";
      var noProactiveChatDelay = 30;
      // Time without proactive chat after closing a chat form
      var visitorCookieLifeTime = 0;

      var offlineAllowed = true;
      var chatAllowed = true;
      var proactiveChatAllowed = true;
      var startChatMessage = "";
      // Non empty when the startLink() should do a startChat() instead
      var startChatOptions = undefined;
      var pageChangeNotificationAllowed = true;
      var visitorChatHistoryCookie = true;
      // Can we track (cookie) the chat sessions of this user

      var startChatRequested = false;
      // track that a direct chat start was requested

      var direction = "";
      // Special CSS to be added to relevant HTML elements for right to left languages

      var callbackOpen = null;
      // agent online/offline
      var callbackOpenProactive = null;
      // with agent alias, message
      var callbackClose = null;
      // form/chat/rejected, agent online/offline
      var callbackMessageSubmit = null;
      // with email, message
      var callbackStartChat = null;
      // with email, message, type (manual or proactive)
      var callbackChatMessageSent = null;
      // with message
      var callbackChatMessageReceived = null;
      // with agent, message
      var callbackBeforeCallme = null;
      // with ID (TODO documentation and enhance the ID)
      var callbackStartCallme = null;
      // with phone number
      var callbackAgentOnline = null;
      // with online (true/false) -- not setup directly but through API
      var callbackAgentCommand = null;
      // with string from the agent command
      var callbackManager = new CallbackManager();

      var callCallbackOpen = false;

      var historyCookieEnabled = true;
      // Flag to enable/disable the history cookie (used on FB Fan page for instance)

      var country = "";
      // The visitor's country, based on AppEngine IP->Geo
      var fromUrlOverride = "";
      // Override the "From:" information for Popup mode.

      var expiredAccount = false;
      // Flag to know if the widget is from an expired account

      var agentStatusLastCheck = 0;
      // Time of the last agent status API check
      var agentStatusCheckInterval = 110;
      // Delay in second between 2 agent status checks -- this interval grows by 10% after each check

      var mobileUI = null;
      // pointer to the view object of the Mobile Optimized UI
      var mobileStyle = null;

      var customDesignUI = null;
      // pointer to the view object of the Custom Design Tool UI
      var customDesignStyle = null;
      // custom design settings passed from datastore
      var hideButtonAPIUsed = false;
      var showButtonAPIUsed = false;

      var enableInternationalPhoneCalls = false;

      var agentTags = "";

      // PROACTIVE V2 variables
      var ruleSetArray = null;
      var visitorClicks = 0;
      var visitorLocalTime = 0;
      var visitorCountry = "";
      var visitorRegion = "";
      var visitorCity = "";
      var visitorLanguages = "";
      var geoRPCSent = false;
      var isInstanceProactiveV2 = false;
      var currentEvaluationStep = 0;
      var routingAvailabilityCache = {};
      var routingAvailabilityCacheLifetime = 30 * 1000;
      var routingList = [];
      var proactiveChatAgentRoutingRuleSetIndex = -1;
      var waitingRPCResponce = false;
      var proactiveChatEvaluationFinishedCallback = null;
      // To be able to add proactive chat V2 and at the same allow our users to call the 'openProactiveChat' api call with no parameters.
      // Traditionally this was used so that a customer could trigger a proactive chat based on any criteria, events, different time on a certain page,
      // or whatever.
      // We had to add this part of the logic, set a ruleSet and it will later be picked up if the client calls the api.
      var openProactiveChatAPIRule = null;

      // SnapEngage Style Tag
      var styleTag = null;

      // Chat Box Menu vars
      var menuButtonIconSpriteSheetURL = null;
      var menuIconSpriteSheetURL = null;
      var menuButtonStylesAdded = false;
      var menuStylesAdded = false;

      // PreChat Search variables
      var preChatSearchStatus = -1;
      var preChatSearchQuestion = "";
      var visitorFirstMessage = "";
      // chatSearch-specific (for now), if we have a visitorFirstMessage, create the case on Open.
      var animating = false;
      // Animating flag.

      var entryPageRefOverride = null;
      var entryPageOverride = null;

      var minimizedProactiveChatBox = false;
      var chatHandledByBot = false;

      var sendGetProactiveChatAgentForIsBotOnly = false;
      var proactiveEventListenersAdded = false;

      return {
        callbacks: callbackManager.events,
        pendingXHR: false,
        rpcRetries: {},
        offlineRpcArray: [],
        RPC_ERROR_CALLBACK: {
          sendGetWidgetConfig: false,
          sendGetProactiveChatAgent: false,
          sendUpdateCase: false,
          sendCheckPhone: false,
          sendGetProactiveGeoData: false,
          sendGetAvailableAgentList: false,
          sendProactiveRoutingHashAndNumber: false,
          preChatSearchSubmit: false,
          callAssignNewAgent: false,
          pollChat: false,
          sendChatMessage: true,
          sendChatAgentSurveyRating: false,
          trackConversion: false,
          sendClickToCall: false,
          sendGetCallConfig: false,
        },
        setBaseURL: function (setUrl) {
          baseURL = setUrl;
        },
        setStaticBaseURL: function (setUrl) {
          staticBaseURL = setUrl;
        },
        // ----------------------------------- Public API
        setLocale: function (loc) {
          // Doc'd
          if (loc) {
            locale = loc;
            if (loc.length > 6) {
              locale = loc.substr(0, 5);
            }
          }
        },
        startLink: function () {
          // Doc'd and can be overridden in a custom form to have a pre-pre chat form (like exacttarget)
          if (SnapABug.getTypeOfChat() !== "proactive") {
            SnapABug.startPreChat();
          }
          return false;
        },
        startChat: function (prompt) {
          // Doc'd
          SnapABug._isReactiveChat = true;
          if (expiredAccount) {
            SnapABug.populateFormStatus(-2 /* Expired */);
            return;
          }
          this.preventProactiveChat();
          this._hideButton();
          if (!chatInProgress) {
            if (!this.handleChatInProgress()) {
              startChatRequested = true;
              proactiveMsg = prompt;
              //this.showLoading();
              this.sendGetWidgetConfig(false);
            }
          }
          return false;
        },
        startCall: function () {
          // Doc'd
          SnapABug._isReactiveChat = true;
          if (expiredAccount) {
            SnapABug.populateFormStatus(-2 /* Expired */);
            return;
          }
          this.preventProactiveChat();
          if (!chatInProgress) {
            this.showLoading();
            this.sendGetCallConfig();
          }
          return false;
        },
        // ----------------------------------- FAQ Documented API
        setUserEmail: function (uemail, locked) {
          // Doc'd
          if (uemail && uemail != "invalid@example.com") {
            // Strip the email string
            try {
              email = uemail.replace(/^[\s\+]+|[\s\+]+$/g, "");
            } catch (e) {}
          }
          if (locked == true) {
            emailLocked = true;
          }

          // Design Studio API hook
          if (SnapABug.isCustomDesignEnabled()) {
            SnapABug.getCustomDesignUI().setUserEmail(email, locked);
          }
        },
        setDescription: function (desc) {
          // Doc'd
          description = desc;

          // Design Studio API hook
          if (SnapABug.isCustomDesignEnabled()) {
            SnapABug.getCustomDesignUI().setDescription(desc);
          }
        },
        setCustomField: function (fieldName, value) {
          // Doc'd
          // Design Studio API hook
          if (SnapABug.isCustomDesignEnabled()) {
            SnapABug.getCustomDesignUI().setCustomField(fieldName, value);
          }

          /*
        Note: Legacy chat is not supported because email, name, and description fields already have setUserEmail, setUserName, and setDescription API methods. Custom forms are not supported because populateForm() is called on click of the button after the API call, and populateForm() appends the field HTML with blank field values. If the user wants to set a custom field value on a custom form, they can just use javascript i.e. document.getElementById('customFieldName').value = 'something'
      */
        },
        setUserName: function (uName) {
          if (uName) {
            try {
              userName = uName.replace(/^[\s\+]+|[\s\+]+$/g, "");
            } catch (e) {}
          }
          SnapABugChat.setUserAliasCookie(userName);

          // Design Studio API hook
          if (SnapABug.isCustomDesignEnabled()) {
            SnapABug.getCustomDesignUI().setUserName(userName);
          }
        },
        setButtonEffect: function (bPos) {
          // Doc'd
          buttonPos = bPos;
          this.buttonOut();
        },
        setFormTopPosition: function (pos) {
          formTopPos = pos;
        },
        setChatFormPosition: function (pos) {
          // pos values: tl, tr, bl, br, c
          chatFormPos = pos;
        },
        getChatFormPosition: function () {
          // The mobile activated code doesn't respect this value, leave it as default in the case of mobile optimized.
          if (SnapABug.isMobileEnabled()) {
            return "";
          } else if (SnapABug.isCustomDesignEnabled()) {
            // TODO CustomDesign - This value is included in custom design config
            return "";
          }
          return chatFormPos;
        },
        setDomain: function (dom) {
          // setDomain() must be called before init/addButton
          // This now accepts multiple domains in a comma-delimited string.

          if (widgetId == "") {
            // Remove all whitespace and split the string into an array (by commas)
            var arr = dom.replace(/\s+/g, "").split(",");

            for (var i = 0; i < arr.length; i++) {
              if (
                arr[i].length &&
                document.location.href.indexOf(arr[i]) != -1
              ) {
                domain = arr[i];
                return;
              }
            }
          }
        },
        setStartChat: function (options) {
          if (typeof options === "string") {
            startChatMessage = decodeURIComponent(options);
          } else if (Array.isArray(options)) {
            var textMessage;
            var textMessageArray = options.filter(function (msg) {
              return msg.type === MESSAGE_TYPES.TEXT;
            });
            if (textMessageArray.length > 0) {
              textMessage = textMessageArray[0];
            }

            var buttons = options.filter(function (msg) {
              return msg.type === MESSAGE_TYPES.BUTTON;
            });
            var prompt = textMessage.text || "";

            startChatMessage = prompt;
            startChatOptions = {
              buttons: buttons,
            };
          } else {
            console.warn("Invalid parameter");
          }
        },
        getStartChat: function () {
          return startChatMessage;
        },
        getStartChatOptions: function () {
          return startChatOptions || {};
        },
        allowOffline: function (allow) {
          offlineAllowed = allow;
        },
        allowChat: function (allow) {
          // TODO documentation
          chatAllowed = allow;
          if (!chatAllowed) {
            agentStatus = false;
          }
        },
        allowProactiveChat: function (allow) {
          proactiveChatAllowed = allow;
        },
        setWidgetId: function (wid) {
          // Deprecated. Use switchWidget()
          widgetId = wid;
        },
        switchWidget: function (newWidget, switchCB) {
          // Doc'd
          if (!newWidget) {
            // check to make sure newWidget is provided
            console.warn(
              'Please provide required parameter "newWidget" when using this API.'
            );
            return false;
          }

          if (switchCB) {
            SnapEngage.setCallback("agentOnline", function () {
              switchCB();
            });
          }
          this.setWidgetId(newWidget);
          this.sendGetWidgetConfig(false);
          //This will send another RPC to get new Widget Status, which calls a callback with the new WidgetConfig.  Then the `agentOnline` callback from above can run if needed
        },
        setMobileUI: function (isMobileUI) {
          // Not Doc'd (API for one client)
          if (SnapEngage.isCustomDesignEnabled()) {
            SnapEngage.getCustomDesignUI().setMobileUI(isMobileUI);
          }
        },
        allowChatSound: function (allow) {
          // Doc'd
          if (allow == true) {
            chatSound = true;
          } else {
            chatSound = false;
          }
        },
        allowPageChangeNotification: function (allow) {
          pageChangeNotificationAllowed = allow;
        },
        allowChatHistory: function (allow) {
          // Not documented
          historyCookieEnabled = allow;
        },
        clearAllCookies: function () {
          // Doc'd
          SnapABugChat.deleteChatCookies();
          SnapABugChat.setCookie("SnapABugRef", "", 0);
          SnapABugChat.deleteCookie("SnapABugRef");
          SnapABugChat.setCookie("SnapABugNoProactiveChat", "", 0);
          SnapABugChat.deleteCookie("SnapABugNoProactiveChat");
          SnapABugChat.setCookie("SnapABugUserEmail", "", 0);
          SnapABugChat.deleteCookie("SnapABugUserEmail");
          SnapABugChat.setCookie("SnapABugVisit", "", 0);
          SnapABugChat.deleteCookie("SnapABugVisit");
          SnapABugChat.setCookie("SnapABugHistory", "", 0);
          SnapABugChat.deleteCookie("SnapABugHistory");
          SnapABugChat.setCookie("SnapABugUserName", "", 0);
          SnapABugChat.deleteCookie("SnapABugUserName");
          SnapABugChat.setCookie("SnapABugUserAlias", "", 0);
          SnapABugChat.deleteCookie("SnapABugUserAlias");
          SnapABugChat.setCookie("isProactiveInvite", "", 0);
          SnapABugChat.deleteCookie("isProactiveInvite");
          SnapABugChat.setCookie("SnapABugApproval", "", 0);
          SnapABugChat.deleteCookie("SnapABugApproval");
          email = "";
          userName = "";
        },
        sendTextToChat: function (text, to) {
          // Doc'd
          if (chatInProgress) {
            if (to === "visitor") {
              systemMsgId = "API_SYSTEM_MSG";
              SnapABugChat.appendTextToChat(
                "",
                text,
                false,
                systemMsgId,
                false,
                true
              );
            } else {
              SnapABugChat.sendChatMessage(6, text);
              // API event

              return true;
            }
          }
          return false;
        },
        openProactiveChat: function openProactiveChat(
          forced,
          offlineFallback,
          msg
        ) {
          // Doc'd
          if (SnapABug.isCustomDesignEnabled()) {
            // The value of 'forced' parameter needs to be referenced inside the Custom Design code
            SnapABugChat.setIsForcedProactive(forced);
          }

          if (SnapEngage.getIsInstanceProactiveV2()) {
            SnapABug.openProactiveV2APICall(forced, offlineFallback, msg);
          } else {
            SnapABug.openProactiveChatDo(forced, offlineFallback, msg);
          }
        },
        setNoProactiveChatDelay: function (delayInMinutes) {
          // Doc'd
          noProactiveChatDelay = delayInMinutes;
        },
        setVisitorCookieLifeTime: function (delayInMinutes) {
          visitorCookieLifeTime = delayInMinutes;
        },
        getVisitorCookieLifeTime: function () {
          return visitorCookieLifeTime;
        },
        getProactiveAutocloseDelay: function () {
          return proactiveAutocloseTimerDelay;
        },
        setProactiveAutocloseDelay: function (delay) {
          // Doc'd
          proactiveAutocloseTimerDelay = delay;
          // A delay set to 0 disable the auto close
        },

        getIsInstanceProactiveV2: function () {
          return isInstanceProactiveV2;
        },

        setIsInstanceProactiveV2: function (value) {
          isInstanceProactiveV2 = value;
        },

        setChatHandledByBot: function (value) {
          chatHandledByBot = value;
        },

        getChatHandledByBot: function () {
          return chatHandledByBot;
        },

        setCallback: function (name, fctn) {
          // Doc'd
          switch (name.toLowerCase()) {
            case "open":
              callbackOpen = fctn;
              break;
            case "openproactive":
              callbackOpenProactive = fctn;
              break;
            case "messagesubmit":
              callbackMessageSubmit = fctn;
              break;
            case "startchat":
              callbackStartChat = fctn;
              break;
            case "chatmessagesent":
              callbackChatMessageSent = fctn;
              break;
            case "chatmessagereceived":
              callbackChatMessageReceived = fctn;
              break;
            case "beforecallme":
              callbackBeforeCallme = fctn;
              break;
            case "startcallme":
              callbackStartCallme = fctn;
              break;
            case "agentonline":
              if (fctn != null) {
                if (!callbackAgentOnline) {
                  callbackAgentOnline = new Array();
                }
                callbackAgentOnline.push(fctn);
              } else {
                callbackAgentOnline = null;
              }
              break;
            case "agentcommand":
              callbackAgentCommand = fctn;
              break;
            case "minimize":
              // note that callCallback will be in the callbackStore also
              SnapEngage.getCustomDesignUI().callbackStore.setCallback(
                "minimize",
                fctn
              );
              break;
            case "switchwidget":
              // note that callCallback will be in the callbackStore also
              SnapEngage.getCustomDesignUI().callbackStore.setCallback(
                "switchwidget",
                fctn
              );
              break;
            default:
              callbackManager.set(name, fctn);
              break;
          }
        },
        // NOTE: This returns the status of the widget.
        getAgentStatusAsync: function (fctn) {
          // Doc'd
          this.setCallback("agentOnline", fctn);
          if (agentStatusLastCheck != -1) {
            //the RPC is not already in progress
            var d = new Date();
            var now = d.getTime();
            // Only allow backend query once every 2 minutes
            if (
              agentStatusLastCheck == 0 ||
              agentStatusLastCheck + agentStatusCheckInterval * 1000 < now
            ) {
              agentStatusLastCheck = -1;
              // RPC in progress
              //agentStatusLastCheck = now;
              //agentStatusCheckInterval = agentStatusCheckInterval * 1.1; // +10% such as we slow the pace if the page stays open for days
              this.sendGetWidgetConfig(false);
            } else {
              // Handle the async agent status API response from the previous backend response if we are not in the case where the RPC is in progress (agentStatusLastCheck == -1)
              this.callCallback(
                "agentOnline",
                SnapABug.getAgentStatus() ? true : false
              );
              this.setCallback("agentOnline", null);
            }
          }
        },
        trackConversion: function (actionName) {
          // TODO implement and DOCUMENTATION (need to complete backend 1st)
          var params = "ci=" + encodeURIComponent(dbCaseId);
          if (dbCaseId == "") {
            params = "c=" + encodeURIComponent(caseId);
          }
          params += "&a=" + encodeURIComponent(actionName);
          this.rpc(
            baseURL + "/chatjs/ServiceTrackConversion?" + params,
            3,
            "trackConversion"
          );
        },
        setHideButtonAPIUsed: function (apiUsed) {
          hideButtonAPIUsed = apiUsed;
        },
        getHideButtonAPIUsed: function () {
          return hideButtonAPIUsed;
        },
        setShowButtonAPIUsed: function (apiUsed) {
          showButtonAPIUsed = apiUsed;
        },
        getShowButtonAPIUsed: function () {
          return showButtonAPIUsed;
        },
        _hideButton: function () {
          // called internally from code
          SnapABug.hideButton(true);
        },
        hideButton: function (calledInternallyFromCode) {
          // Doc'd
          if (SnapABug.isMobileEnabled() && !SnapABug.isChatInProgress()) {
            SnapABug.getMobileUI().hideTab();
          } else if (SnapABug.isCustomDesignEnabled()) {
            if (!calledInternallyFromCode) {
              SnapABug.setHideButtonAPIUsed(true);
            }
            // Now pass to the hideTab() function
            return SnapABug.getCustomDesignUI().hideTab();
          }

          var btn = document.getElementById("SnapABug_bImg");
          if (btn) {
            btn.style.display = "none";
          }
        },
        _showButton: function () {
          // called internally from code
          SnapABug.showButton(true);
        },
        showButton: function (calledInternallyFromCode) {
          // Doc'd
          if (SnapABug.isCustomDesignEnabled()) {
            // if showButton() was not called internally from code, it was called via API, so now setHideButtonAPIUsed to false (or else we won't be able to showButton)
            if (!calledInternallyFromCode) {
              SnapABug.setHideButtonAPIUsed(false);
              SnapABug.setShowButtonAPIUsed(true);
            }

            SnapABug.getCustomDesignUI().checkStatusShowButton();
          }

          var btn = document.getElementById("SnapABug_bImg");
          if (btn) {
            btn.style.display = "inline";
          }
        },
        disableLightbox: function () {
          // Doc'd
          lightboxColor = "";
        },
        // ----------------------------------- Other APIs
        updateCase: function (jsVarsInCommaSeparatedString) {
          // Not yet documented -- implemented for DealerX
          // Update the case (the JS variable values for now) while the chat is in progress
          this.sendUpdateCase(jsVarsInCommaSeparatedString);
        },
        // return values: (0: offline, 1: online, -1: invalid)
        // This function was previously an internally used function called chatAvailable()
        // but we renamed it because it actually returns the status of the widget.
        // However, we are calling it "getAgentStatus()" to be consistent with how widget status
        // is referred to in other functions / variables in this file.
        getAgentStatus: function () {
          return agentStatus;
        },
        setLanguage: function (lang) {
          // To do a setLocale() based on Zendesk languages
          var loc = "en";
          if (lang.indexOf("Dansk") !== -1) {
            loc = "da";
          } else if (lang.indexOf("Deutsch") !== -1) {
            loc = "de";
          } else if (lang.indexOf("Espa") !== -1) {
            loc = "es";
          } else if (lang.indexOf("Italiano") !== -1) {
            loc = "it";
          } else if (lang.indexOf("Suomi") !== -1) {
            loc = "fi";
          } else if (lang.indexOf("Fran") !== -1) {
            loc = "es";
          } else if (lang.indexOf("Hungarian") !== -1) {
            loc = "hu";
          } else if (lang.indexOf("Italiano") !== -1) {
            loc = "it";
          } else if (lang.indexOf("Hebrew") !== -1) {
            loc = "iw";
          } else if (lang.indexOf("Japanese") !== -1) {
            loc = "ja";
          } else if (lang.indexOf("Norsk") !== -1) {
            loc = "nb";
          } else if (lang.indexOf("Nederlands") !== -1) {
            loc = "nl";
          } else if (lang.indexOf("Polish") !== -1) {
            loc = "pl";
          } else if (lang.indexOf("Portugu") !== -1) {
            loc = "pt";
          } else if (lang.indexOf("Romana") !== -1) {
            loc = "ro";
          } else if (lang.indexOf("Slovak") !== -1) {
            loc = "sk";
          } else if (lang.indexOf("Svenska") !== -1) {
            loc = "sv";
          } else if (lang.indexOf("Turkish") !== -1) {
            loc = "tr";
          } else if (lang.indexOf("Simplified Chinese") !== -1) {
            loc = "zh";
          }
          this.setLocale(loc);
        },
        // Leaving this function as-is now that we have "shared"
        isMobile: function () {
          try {
            if (typeof window.snapengage_mobile !== "undefined") {
              return navigator.userAgent.match(
                /(iPhone|iPod|BlackBerry|Android|IEMobile)/
              );
            } else {
              return navigator.userAgent.match(
                /(iPhone|iPod|iPad|BlackBerry|Android|IEMobile)/
              );
            }
          } catch (e) {
            return false;
          }
        },
        // ----------------------------------- Legacy initialization API, from the dynamic JS days
        init: function (wId) {
          this.initWidget(wId, false, false);
        },
        initAsync: function (wId) {
          this.initWidget(wId, true, false);
        },
        addButton: function (wId, position, offset, dynamic) {
          if (
            typeof position !== "undefined" &&
            typeof offset !== "undefined" &&
            !(SnapABug.useMobileOptimized() || SnapABug.useCustomDesign())
          ) {
            switch (position) {
              case "0":
                buttonPosition = "left";
                break;
              case "1":
                buttonPosition = "right";
                break;
              case "2":
                buttonPosition = "top";
                break;
              case "3":
                buttonPosition = "bottom";
                break;
              default:
                buttonPosition = "left";
            }
            buttonOffset = offset;
          }
          this.injectButton(wId, dynamic);
          this.init(wId);
        },
        add: function (
          wId,
          locale,
          position,
          offset,
          onlineImg,
          offlineImg,
          proactiveV2
        ) {
          // TODO: Remove this after https://snapengage.atlassian.net/browse/DEV-10339 is done;
          // It will provide us a way of better configure the generated visitor JS file.
          if (typeof window.__SUPER_SECRET_SETUP_FUNCTION == "function") {
            window.__SUPER_SECRET_SETUP_FUNCTION();
          }

          this.setLocale(locale);

          if (
            position &&
            offset &&
            !(SnapABug.useMobileOptimized() || SnapABug.useCustomDesign())
          ) {
            switch (position) {
              case "0":
                buttonPosition = "left";
                break;
              case "1":
                buttonPosition = "right";
                break;
              case "2":
                buttonPosition = "top";
                break;
              case "3":
                buttonPosition = "bottom";
                break;
              default:
                buttonPosition = "left";
            }
            buttonOffset = offset;
            this.injectButton(
              wId,
              false /* the default dynamic is not used here, as we send the images */,
              true,
              onlineImg,
              offlineImg
            );
          }
          this.initWidget(wId, true, proactiveV2);
        },
        setButton: function (imgUrl, width, height) {
          buttonImgUrl = imgUrl;
          buttonWidth = width;
          buttonHeight = height;
          buttonPos = "0px";
        },
        // ----------------------------------- Private utilities
        getRpcErrorCallBack: function (name) {
          return SnapABug.RPC_ERROR_CALLBACK[name];
        },
        getBrowserIsOnline: function () {
          return window.navigator.onLine;
        },
        handleOfflineResend: function () {
          rpcSendOfflineMessage = true;
          for (var i = 0; i < SnapABug.offlineRpcArray.length; i++) {
            SnapABug.rpc(
              SnapABug.offlineRpcArray[i][0],
              SnapABug.offlineRpcArray[i][1],
              SnapABug.offlineRpcArray[i][2]
            );
          }
          SnapABug.offlineRpcArray = [];
          rpcSendOfflineMessage = false;
        },
        rpc: function (url, retries, errorCallbackName) {
          rpcUrl = url;
          if (url) {
            if (url.length > 2000) {
              rpcUrl = url.substring(0, 2000);
            }
          }
          // rpcUrl is defined globally!! and used in doRpc function
          SnapABug.rpcRetries[errorCallbackName] = retries;

          // put messages into a temp array to be sent when back online
          if (!this.getBrowserIsOnline() && errorCallbackName !== "pollChat") {
            SnapABug.offlineRpcArray.push([url, retries, errorCallbackName]);
            return;
          }
          // if we get a new message when back online and there are saved messages, add this to the end of the array
          if (
            SnapABug.offlineRpcArray.length &&
            errorCallbackName === "sendChatMessage" &&
            !rpcSendOfflineMessage
          ) {
            SnapABug.offlineRpcArray.push([url, retries, errorCallbackName]);
          }
          // now we loop through and rapid fire the messages.
          // DEV-3800 is know bug that order of messages may appear out of order for agent
          if (
            this.getBrowserIsOnline() &&
            SnapABug.offlineRpcArray.length &&
            !rpcSendOfflineMessage
          ) {
            this.handleOfflineResend();
          }
          this.doRpc(errorCallbackName);
        },
        doRpc: function (errorCallbackName, retryUrl) {
          if (retryUrl) {
            rpcUrl = retryUrl;
          }
          YAHOO.util.Get.script(rpcUrl, {
            onFailure: function (resp) {
              SnapABug.callbackError(
                true,
                errorCallbackName,
                resp.nodes[0].src
              );
            },
            onTimeout: function (resp) {
              SnapABug.callbackError(
                true,
                errorCallbackName,
                resp.nodes[0].src
              );
            },
            timeout: 55000,
          });
        },
        callbackError: function (retry, errorCallbackName, retryUrl) {
          if (retry && SnapABug.rpcRetries[errorCallbackName] > 0) {
            SnapABug.rpcRetries[errorCallbackName] =
              SnapABug.rpcRetries[errorCallbackName] - 1;
            this.doRpc(errorCallbackName, retryUrl);
          } else {
            if (SnapABug.getRpcErrorCallBack(errorCallbackName)) {
              this.populateFormStatus(6);
            }
          }
        },
        getWindowWidth: function () {
          var w = 0;
          if (window.innerWidth) {
            w = window.innerWidth;
          } else if (self.innerWidth) {
            w = self.innerWidth;
          } else if (
            document.documentElement &&
            document.documentElement.clientWidth
          ) {
            w = document.documentElement.clientWidth;
          } else if (document.body) {
            w = document.body.clientWidth;
          }
          return w;
        },
        getWindowHeight: function () {
          var h = 0;
          if (window.innerHeight) {
            h = window.innerHeight;
          } else if (self.innerHeight) {
            h = self.innerHeight;
          } else if (
            document.documentElement &&
            document.documentElement.clientHeight
          ) {
            h = document.documentElement.clientHeight;
          } else if (document.body) {
            h = document.body.clientHeight;
          }
          return h;
        },
        getOSBarHeight: function () {
          try {
            if (navigator.appVersion.indexOf("Win") !== -1) {
              return 28;
            }
            if (navigator.appVersion.indexOf("Mac") !== -1) {
              return 75;
            }
          } catch (e) {}
          return 0;
        },
        isIE6: function () {
          try {
            return navigator.userAgent.toLowerCase().indexOf("msie 6") !== -1;
          } catch (e) {
            return false;
          }
        },
        isIE7: function () {
          try {
            return navigator.userAgent.toLowerCase().indexOf("msie 7") !== -1;
          } catch (e) {
            return false;
          }
        },
        isIE8: function () {
          try {
            return navigator.userAgent.toLowerCase().indexOf("msie 8") !== -1;
          } catch (e) {
            return false;
          }
        },
        isIE: function () {
          try {
            return navigator.appVersion.indexOf("MSIE") !== -1 ? true : false;
          } catch (e) {
            return false;
          }
        },
        isIE11: function () {
          try {
            return navigator.appVersion.indexOf("Trident") !== -1 &&
              navigator.userAgent.indexOf("rv:11") !== -1
              ? true
              : false;
          } catch (e) {
            return false;
          }
        },
        isQuirksMode: function () {
          return document.compatMode !== "CSS1Compat";
        },
        isFirefox: function () {
          try {
            return navigator.userAgent.indexOf("Firefox") !== -1 ? true : false;
          } catch (e) {
            return false;
          }
        },
        isSafari: function () {
          try {
            var ua = navigator.userAgent.toLowerCase();
            return ua.indexOf("safari") != -1 && ua.indexOf("chrome") == -1;
          } catch (e) {
            return false;
          }
        },
        useMobileOptimized: function () {
          return (
            typeof window.snapengage_mobile !== "undefined" &&
            navigator.userAgent.match(
              /(iPhone|iPod|BlackBerry|Android|IEMobile)/
            )
          );
        },
        getMobileUI: function () {
          return mobileUI;
        },
        isMobileEnabled: function () {
          return mobileUI !== null;
        },
        useCustomDesign: function () {
          return typeof window.chat_custom_design !== "undefined";
        },
        getCustomDesignUI: function () {
          return customDesignUI;
        },
        isCustomDesignEnabled: function () {
          return customDesignUI !== null;
        },
        getCustomDesignIframe: function () {
          return document.getElementById(
            SnapABug.getCustomDesignUI().helpers.getIframeId()
          ).contentWindow.document;
        },
        // --------------- Add compatibility utilities for older IEs
        // Old IEs do not have `Array.prototype.indexOf` (Note: they DO have `String.prototype.indexOf`);
        isInArray: function (needle, haystack) {
          if (needle && haystack) {
            for (var i = 0; i < haystack.length; i++) {
              if (haystack[i] == needle) {
                return true;
              }
            }
          }
          return false;
        },
        // IE8 and lower do not have `String.prototype.trim`
        trim: function (stringToTrim) {
          return stringToTrim.replace(/^\s+|\s+$/g, "");
        },
        getDisplayInlineBlockCSS: function () {
          if (SnapABug.isIE7()) {
            return "display: inline;";
          } else {
            return "display: inline-block;";
          }
        },
        // chatInProgress getter/setter (gets set to true on creation of chat, false at end of chat, etc.)
        setChatInProgress: function (chatIsInProgress) {
          chatInProgress = chatIsInProgress;
        },
        isChatInProgess: function () {
          // old method name with a typo -- kept for compatibility
          return SnapABug.isChatInProgress();
        },
        isChatInProgress: function () {
          return chatInProgress;
        },
        setCursorPosition: function (node, pos) {
          try {
            if (!node) {
              return false;
            } else if (node.createTextRange) {
              var textRange = node.createTextRange();
              textRange.collapse(true);
              textRange.moveEnd(pos);
              textRange.moveStart(pos);
              textRange.select();
              return true;
            } else if (node.setSelectionRange) {
              node.setSelectionRange(pos, pos);
              return true;
            }
          } catch (err) {}
        },
        getBaseURL: function () {
          return baseURL;
        },
        getStaticBaseURL: function () {
          return staticBaseURL;
        },
        getUserEmail: function () {
          return email;
        },
        getEmailLocked: function () {
          return emailLocked;
        },
        getUserName: function () {
          return userName;
        },
        getCaseId: function () {
          return caseId;
        },
        setCaseId: function (id) {
          caseId = id;
        },
        getDbCaseId: function () {
          return dbCaseId;
        },
        getWidgetId: function () {
          return widgetId;
        },
        getCallMeButton: function () {
          return callmeButton;
        },
        setCallMePhone: function (n) {
          callmePhone = n;
        },
        getCallMePhone: function () {
          return callmePhone;
        },
        setEntryPageRefOverride: function (url) {
          entryPageRefOverride = url;
        },
        getEntryPageRef: function (forceOriginal) {
          var ref = decodeURIComponent(SnapABugChat.getCookie("SnapABugRef"));
          try {
            if (ref && ref != "") {
              var url = ref.split(" ")[1];
              if (!forceOriginal && entryPageRefOverride) {
                url = entryPageRefOverride;
              }
              return url;
            }
          } catch (e) {}
          return "";
        },
        setEntryPageUrlOverride: function (url) {
          entryPageOverride = url;
        },
        getEntryPageUrl: function (forceOriginal) {
          var ref = decodeURIComponent(SnapABugChat.getCookie("SnapABugRef"));
          try {
            if (ref && ref != "") {
              var url = ref.split(" ")[0];
              if (!forceOriginal && entryPageOverride) {
                url = entryPageOverride;
              }
              return url;
            }
          } catch (e) {}
          return "";
        },
        getChatSoundAllowed: function () {
          return chatSound;
        },
        setEnableInternationalPhoneCalls: function (enable) {
          SnapABug.enableInternationalPhoneCalls = enable;
        },
        getEnableInternationalPhoneCalls: function () {
          return SnapABug.enableInternationalPhoneCalls;
        },
        preventProactiveChat: function () {
          // SnapABug is starting in a user initiated way, so prevent the proactive chat to interupt
          if (SnapABugChat.proactiveRulesTimers.proactiveTimer) {
            clearTimeout(SnapABugChat.proactiveRulesTimers.proactiveTimer);
            proactiveMsg = "";
            proactiveNotify = false;
            SnapABugChat.proactiveRulesTimers.proactiveTimer = null;
          }
          proactiveAgentNumber = "";
          if (SnapABugChat) {
            SnapABugChat.setNoProactiveChatCookie();
            SnapABugChat.clearProactive();
          }
        },
        getNoProactiveChatDelay: function () {
          return noProactiveChatDelay;
        },
        setCvval: function (name, val) {
          cvval[name] = val;
        },
        getLocale: function () {
          return locale;
        },
        getDirection: function () {
          return direction;
        },
        setDirection: function (css) {
          direction = css;
        },
        getTags: function () {
          // Check the SnapEngageOptions object first for any tags.
          // If none are found look for any tags that we set using the SnapEngage#setTag fuction
          if (SnapABug.hasOptionsProperty("tags")) {
            return SnapEngageOptions.tags;
          } else {
            return agentTags;
          }
        },
        setTags: function (val) {
          agentTags = val;
        },
        appendTagsParameter: function (params) {
          if (SnapABug.hasOptionsProperty("tags")) {
            // If SnapEngageOptions and SnapEngageOptions.tags are present, add the tags param
            params += "&tags=" + encodeURIComponent(SnapEngageOptions.tags);
          } else if (
            SnapABug.getTags() !== null &&
            SnapABug.getTags().length > 0
          ) {
            // Otherwise perhaps the SnapEngage.setTags() API was used
            params += "&tags=" + encodeURIComponent(SnapABug.getTags());
          }

          return params;
        },
        hasOptionsProperty: function (property) {
          // checks for the existence of the specified property on the SnapEngageOptions object
          return (
            typeof SnapEngageOptions != "undefined" &&
            Object.prototype.hasOwnProperty.call(SnapEngageOptions, property)
          );
        },
        callCallback: function (name, p1, p2, p3) {
          try {
            switch (name.toLowerCase()) {
              case "open":
                return callbackOpen(p1);
              case "openproactive":
                return callbackOpenProactive(p1, p2);
              case "messagesubmit":
                return callbackMessageSubmit(p1, p2);
              case "startchat":
                return callbackStartChat(p1, p2, p3);
              case "chatmessagesent":
                return callbackChatMessageSent(p1);
              case "chatmessagereceived":
                return callbackChatMessageReceived(p1, p2);
              case "beforecallme":
                return callbackBeforeCallme(p1);
              case "startcallme":
                return callbackStartCallme(p1);
              case "agentonline":
                //this callback is triggered when the RPC returns so we have a stack of function ptr callback
                for (var i = 0; i < callbackAgentOnline.length; i++) {
                  callbackAgentOnline[i](p1);
                }
                return;
              case "agentcommand":
                return callbackAgentCommand(p1);
              default:
                return callbackManager.trigger(name, p1, p2, p3);
            }
          } catch (e) {}
        },
        openProactiveChatDo: function openProactiveChatDo(
          forced,
          offlineFallback,
          msg,
          ruleSetID
        ) {
          // Check if the user has been banned from chat
          if (SnapABugChat.getBannedCookie() == "1" || !chatAllowed) {
            return;
          }

          if (!chatInProgress) {
            if (
              forced == true ||
              (!SnapABugChat.isNoProactiveChatCookie() &&
                !SnapABugChat.getCookie("isProactiveInvite"))
            ) {
              SnapABugChat.reInit();
              if (SnapABugChat.proactiveRulesTimers.proactiveTimer) {
                clearTimeout(SnapABugChat.proactiveRulesTimers.proactiveTimer);
              }
              proactiveOfflineFallback = offlineFallback;
              if (msg) {
                proactiveMsg = msg;
              }

              SnapABug.sendGetProactiveChatAgent(
                false /* no call-me required */,
                ruleSetID
              );
            }
          }
        },
        openProactiveV2APICall: function OpenProactiveV2APICall(
          forced,
          offlineFallback,
          msg
        ) {
          // Check if the user has been banned from chat
          if (SnapABugChat.getBannedCookie() == "1" || !chatAllowed) {
            return;
          }

          if (!chatInProgress) {
            if (
              forced == true ||
              (!SnapABugChat.isNoProactiveChatCookie() &&
                !SnapABugChat.getCookie("isProactiveInvite"))
            ) {
              SnapABugChat.reInit();
              proactiveOfflineFallback = offlineFallback;
              // If message start the v1 way
              if (msg) {
                proactiveMsg = msg;
                // Pass in a -1 as ruleId param since we're now blocking this RPC in the backend when made without valid id
                SnapABug.sendGetProactiveChatAgent(
                  false /* no call-me required */,
                  -1
                );
              } else {
                if (openProactiveChatAPIRule !== null) {
                  SnapABug.executeOpenProactiveChatAPIRule(
                    forced,
                    offlineFallback,
                    openProactiveChatAPIRule
                  );
                } else if (currentEvaluationStep < 3) {
                  // If no valid rule is set, and evaluation hasn't
                  //completed set callback to try again when evaluation
                  // of all rules are done.
                  SnapABug.setProactiveChatEvaluationFinishedCallback(
                    function () {
                      SnapABug.executeOpenProactiveChatAPIRule(
                        forced,
                        offlineFallback,
                        openProactiveChatAPIRule
                      );
                    }
                  );
                }
              }
            }
          }
        },
        setProactiveChatEvaluationFinishedCallback: function (
          callbackFunction
        ) {
          proactiveChatEvaluationFinishedCallback = callbackFunction;
        },
        clearProactiveChatEvaluationFinishedCallback: function (
          callbackFunction
        ) {
          proactiveChatEvaluationFinishedCallback = null;
        },
        executeProactiveChatEvaluationFinishedCallback: function () {
          if (typeof proactiveChatEvaluationFinishedCallback === "function") {
            proactiveChatEvaluationFinishedCallback();
          }
        },
        executeOpenProactiveChatAPIRule: function executeOpenProactiveChatAPIRule(
          forced,
          offlinefallback,
          ruleSet
        ) {
          if (!waitingRPCResponce) {
            waitingRPCResponce = true;
            var ruleSetId = ruleSet && ruleSet.id ? ruleSet.id : -1;
            SnapABug.openProactiveChatDo(
              forced,
              offlinefallback,
              decodeURIComponent(ruleSet.message),
              ruleSetId
            );
          }
        },

        // ----------------------------------- Internal methods
        initWidget: function (wId, async, proactiveV2) {
          widgetId = wId;

          // If a global variable SnapABugSecureCookies is defined in the page, setup the cookies as secure (https) only
          if (typeof SnapABugSecureCookies !== "undefined") {
            SnapABugChat.setSecureCookies();
          }

          if (SnapABug.useMobileOptimized()) {
            SnapABug.initMobile();
          } else if (SnapABug.useCustomDesign()) {
            SnapABug.initCustomDesign();
          } else {
            this.injectDialog(async);
          }
          if (!this.handleChatInProgress()) {
            var chatWindowCookie = decodeURIComponent(
              SnapABugChat.getCookie("SnapABugChatWindow")
            );
            if (chatWindowCookie !== "") {
              // A chat form was minimized, no chat was started, then there was a page change or reload.
              SnapABugChat.setChatWindowCookieData("isMinimized", false);
              // Make sure *minimized* is false.
            }

            if (
              !SnapABugChat.proactiveRulesTimers.proactiveTimer &&
              !proactiveV2
            ) {
              // only starting the proactive v1 timer if we widget is not using proactive v2
              SnapABugChat.proactiveRulesTimers.proactiveTimer = setTimeout(
                "SnapABug.sendGetWidgetConfig(true);",
                14000
              );
            }
          }
          try {
            // Store the referrer and entry page
            var ref = SnapABugChat.getCookie("SnapABugRef");
            if (!ref || ref == "") {
              SnapABugChat.setCookie(
                "SnapABugRef",
                encodeURIComponent(
                  document.location.href + " " + document.referrer
                ),
                120
              );
            }
          } catch (e) {}
          if (!SnapABugChat.getVisitCookie()) {
            SnapABugChat.setHistoryCookieIncrementVisits();
            SnapABugChat.setInitialVisitCookie();
          }
          if (SnapABugChat.getCookie("isProactiveInvite")) {
            // we want to always display proactive invites as long as 'noProactiveChat' cookie does not exist
            SnapABugChat.deleteCookie("isProactiveInvite");
          }

          // cookies are available so reset variable names
          email = SnapABugChat.getUserEmailCookie();
          SnapABug.setUserEmail(email);
          SnapABug.setUserName(SnapABugChat.getUserAliasCookie());

          // Add Resize handler.
          SnapABug.addOnResizeHandler();

          // Increment pages visited
          SnapABugChat.incrementVisitCookie();
        },
        startPreChat: function () {
          this.preventProactiveChat();

          if (SnapABug.isMobileEnabled()) {
            if (expiredAccount) {
              // TODO if expiredAccount
              return;
            }

            if (!this.isChatInProgress()) {
              SnapABug.getMobileUI().showPrechat();
              SnapABug.callCallback("Open", "offline");
            } else {
              SnapABug.getMobileUI().showChat();
            }
          } else if (SnapABug.isCustomDesignEnabled()) {
            if (expiredAccount) {
              // TODO if expiredAccount
              return;
            }

            // cannot use SnapABugChat.isMinimized() because it is cleared if chat ends but may need to re-open from StarLink() so visitor can fill out survey
            if (SnapABug.getCustomDesignUI().minimizeView.isViewVisible()) {
              // update the minimize status if box was minimized but reopened with startLink()
              SnapABug.getCustomDesignUI().minimizeChatBoxToggle();
              SnapABug.getCustomDesignUI().minimizeController.minimizeClickToMaximize();
            } else if (!this.isChatInProgress()) {
              SnapABug.getCustomDesignUI().buttonController.buttonClick();
            }
          } else {
            if (expiredAccount) {
              SnapABug.populateFormStatus(-2 /* Expired */);
              return;
            }
            if (!this.isChatInProgress()) {
              if (
                this.getPreChatSearchEnabled() &&
                this.getPreChatSearch() == 1
              ) {
                SnapABug.startPreChatSearch();
                return;
              }

              if (!this.handleChatInProgress()) {
                if (startChatMessage == "") {
                  this.loadForm();
                } else {
                  this.startChat(startChatMessage);
                }
                this.handleChatInProgress();
                // Still necessary?

                callCallbackOpen = true;
              }
            }
          }
        },
        // Method to know if the Sneak Peek feature is enabled - this gets overriden in the Dynamic JS generation
        isSneakPeek: function () {
          return false;
        },
        allowVisitorChatHistory: function (allow) {
          visitorChatHistoryCookie = allow;
        },
        getPreChatSearch: function () {
          return preChatSearchStatus;
        },
        setPreChatSearch: function (pcs) {
          preChatSearchStatus = pcs;
        },
        getDomain: function () {
          return domain;
        },
        getPageChangeNotificationAllowed: function () {
          return pageChangeNotificationAllowed;
        },
        setCountry: function (code) {
          country = code;
        },
        getCountry: function () {
          return country;
        },
        setProactiveChatAutocloseTimeout: function () {
          if (SnapABugChat.proactiveRulesTimers.proactiveAutocloseTimer) {
            clearTimeout(
              SnapABugChat.proactiveRulesTimers.proactiveAutocloseTimer
            );
          }

          var timerFunction = SnapABug.isCustomDesignEnabled()
            ? "SnapABug.getCustomDesignUI().proactiveTimeout();"
            : "SnapABug.slideFormOut();";

          try {
            if (proactiveAutocloseTimerDelay) {
              SnapABugChat.proactiveRulesTimers.proactiveAutocloseTimer = setTimeout(
                timerFunction,
                proactiveAutocloseTimerDelay * 60 * 1000
              );
            }
          } catch (e) {}
        },
        clearProactiveChatAutocloseTimeout: function () {
          if (SnapABugChat.proactiveRulesTimers.proactiveAutocloseTimer) {
            clearTimeout(
              SnapABugChat.proactiveRulesTimers.proactiveAutocloseTimer
            );
            SnapABugChat.proactiveRulesTimers.proactiveAutocloseTimer = null;
          }
        },
        handleChatInProgress: function () {
          if (SnapABugChat) {
            var ccid = SnapABugChat.getCaseIdCookie();
            if (ccid != null && ccid != "" && ccid != "closed") {
              this.continueChat(ccid);
              return true;
            }
          }
          return false;
        },
        continueChat: function (ccid) {
          // Do not allow continue a chat if we have already a chat in progress
          if (caseId == "" && dbCaseId == "") {
            chatInProgress = true;
            caseId = ccid;
            SnapABugChat.restartChat(caseId, baseURL);
            this._hideButton();
          }
        },
        getVisitorCountry: function () {
          if (visitorCountry) {
            return visitorCountry;
          }
          return "";
        },
        setVisitorCountry: function (country) {
          visitorCountry = country;
        },
        setUseCustomCallMeButton: function (useCustom) {
          SnapABug.useCustomCallMeButton = useCustom;
          // true/false
        },
        getUseCustomCallMeButton: function () {
          return SnapABug.useCustomCallMeButton;
        },
        enableCallMe: function () {
          if (SnapABug.isCustomDesignEnabled()) {
            this.getCustomDesignUI().enableCallMeOption();
          } else {
            callmeButton =
              '<div style="' +
              this.getCSS(
                undefined,
                undefined,
                78,
                16,
                "overflow:hidden;cursor:pointer;cursor:hand;"
              ) +
              '" ' +
              ' onclick="SnapABug.clickedCallMe(); return true;">' +
              '<img style="position:relative;margin:0;border:none;padding:0;" src="' +
              SnapABug.getStaticBaseURL() +
              "/wbg/callme_en.png" +
              '" border="0" alt="Call me now" width="72" height="32" onmouseover="this.style.top=\'-16px\';" onmouseout="this.style.top=\'0px\';" /></div>';

            var sabcm = document.getElementById("SnapABug_CallMe");
            if (sabcm) {
              if (SnapABug.getUseCustomCallMeButton()) {
                sabcm.style.display = "block";
              } else {
                sabcm.innerHTML = callmeButton;
              }
            }
          }
        },
        disableCallMe: function () {
          if (SnapABug.isCustomDesignEnabled()) {
            SnapABug.getCustomDesignUI().removeCallMeOption();
          } else {
            callmeButton = "";
            var sabcm = document.getElementById("SnapABug_CallMe");
            if (sabcm) {
              if (SnapABug.getUseCustomCallMeButton()) {
                sabcm.style.display = "none";
              } else {
                sabcm.innerHTML = callmeButton;
              }
            }
          }
        },
        clickedCallMe: function () {
          if (!this.callCallback("BeforeCallme", "")) {
            SnapABugChat.populateCallMeForm();
          }
        },
        disableButton: function (buttonId) {
          if (document.getElementById(buttonId)) {
            document.getElementById(buttonId).disabled = true;
          }
        },
        injectDialog: function (async) {
          var styleTagContent = "";
          SnapABug.styleTag = document.getElementById("SnapABug_Style");

          if (!SnapABug.styleTag) {
            SnapABug.styleTag = document.createElement("style");
            SnapABug.styleTag.id = "SnapABug_Style";
            SnapABug.styleTag.type = "text/css";

            if (SnapABug.styleTag.styleSheet) {
              // Old IEs
              SnapABug.styleTag.styleSheet.cssText = styleTagContent;
            } else {
              // Everyone else
              SnapABug.styleTag.appendChild(
                document.createTextNode(styleTagContent)
              );
            }

            var docHead =
              document.head || document.getElementsByTagName("head")[0];

            docHead.appendChild(SnapABug.styleTag);

            // ADD CSS RESET // v0.5 -- Will need to be continually improved.
            SnapABug.addStyleRule(
              [
                "#SnapABug_WP",
                "div",
                "span",
                "iframe",
                "h1",
                "h2",
                "h3",
                "h4",
                "h5",
                "h6",
                "hr",
                "p",
                "a",
                "big",
                "em",
                "img",
                "q",
                "small",
                "strong",
                "b",
                "u",
                "i",
                "fieldset",
                "input",
                'input[type="submit"]',
                "button",
                "textarea",
                "form",
                "label",
              ],
              "margin: 0; padding: 0; border: 0; font-size: 100%; font: inherit; font-weight: normal; vertical-align: baseline; float: none;" +
                "max-width: none; max-height: none; " +
                "letter-spacing: normal; line-height: normal;" +
                "text-transform: none;" +
                "-webkit-transform: none; -moz-transform: none; -ms-transform: none; -o-transform: none; transform: none; " +
                "-webkit-transition-property: none; -moz-transition-property: none; -o-transition-property: none; transition: none;" +
                "-webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none;" +
                "font-feature-settings: normal; -webkit-font-feature-settings: normal; -moz-font-feature-settings: normal; -ms-font-feature-settings: normal; -o-font-feature-settings: normal; "
            );
            SnapABug.addStyleRule(
              ["*:before", "*:after"],
              "display:none;" // Circumvent :before and :after pseudo-element bugs/collisions.
            );
            SnapABug.addStyleRule(
              ["img"],
              "" + SnapABug.getDisplayInlineBlockCSS()
            );
            // END CSS RESET
          }

          var styleW =
            "position:fixed;_position:absolute;display:none;top:0%;_top:expression(eval(document.body.scrollTop));left:0px;width:100%;height:100%;text-align:left;z-index:2147483644;margin:0;padding:0;border-collapse:collapse;border-spacing:0;border:none;list-style:none;text-align:left;font-size:100%;font-weight:normal;outline:none;background-image:url('" +
            SnapABug.getBlankImg() +
            "');background-repeat:repeat;";
          var styleWP =
            "position:fixed;_position:absolute;display:none;z-index:2147483645;overflow:hidden;margin:0;padding:0;border-collapse:collapse;border-spacing:0;border:none;list-style:none;outline:none;";
          var contentW =
            '<div id="SnapABug_O" style="position:absolute;width:100%;height:100%;top:0px;left:0px;text-align:left;z-index:auto;-moz-opacity:0.5;opacity:.50;filter:alpha(opacity=50);background-color:' +
            lightboxColor +
            ';"></div>';
          var contentWP =
            '<div id="SnapABug_P" style="position:absolute;left:0px;top:0px;margin:0;padding:0;border:none;text-align:left;z-index:1;overflow:hidden;background-color:transparent;"></div>' +
            '<div id="SnapABug_IP" style="position:absolute;left:0px;top:0px;z-index:0;"></div>' +
            '<div id="SnapABug_DB" style="position:absolute;left:0px;top:0px;margin:0;border:0;padding:0;z-index:1;cursor:move;background-image:url(\'' +
            SnapABug.getBlankImg() +
            "');background-repeat:repeat;\"></div>";

          if (!async) {
            try {
              console.log(
                "ERROR: SnapEngage code is setup in a legacy no longer supported mode. Contact support for assistance."
              );
            } catch (e) {}
          } else {
            // In Async mode, first add the 3 top level DIVs if there are not there already
            var SnapABug_W = document.getElementById("SnapABug_W");
            if (!SnapABug_W) {
              SnapABug_W = document.createElement("div");
              SnapABug_W.id = "SnapABug_W";
              document.body.appendChild(SnapABug_W);
            }
            var SnapABug_WP = document.getElementById("SnapABug_WP");
            if (!SnapABug_WP) {
              SnapABug_WP = document.createElement("div");
              SnapABug_WP.id = "SnapABug_WP";
              document.body.appendChild(SnapABug_WP);
            }

            // Add the content and styling in the DIVs
            try {
              SnapABug_W.setAttribute("style", styleW);
              SnapABug_WP.setAttribute("style", styleWP);
            } catch (e) {}
            try {
              SnapABug_W.style.cssText = styleW;
              SnapABug_WP.style.cssText = styleWP;
            } catch (e) {}
            SnapABug_W.innerHTML = contentW;
            SnapABug_WP.innerHTML = contentWP + SnapABug.soundNotificationDiv();
          }
        },
        addStyleRule: function (selectors, cssRules) {
          if (!SnapABug.styleTag) {
            return;
            // Do nothing, the styleTag has not been initialized.
          }
          // `addRule()` automatically prepends #SnapABug_WP to all new rule selectors
          // as long as #SnapABug_WP is not the beginning of the selector string.
          // this latter allowance gives us the option to place classes on #SnapABug_WP
          // and alter the display of the chat box based on those styles. (e.g. 'minimized');
          var wpPrefix = "";
          var substrLength = 1 + "SnapABug".length + 3;
          // #SnapABug_WP
          var result = "";
          if (typeof selectors === "string") {
            wpPrefix =
              selectors.substr(0, substrLength) !== "#SnapABug_WP"
                ? "#SnapABug_WP "
                : "";
            result = wpPrefix + selectors + " { " + cssRules + " } ";
          } else if (
            typeof selectors === "object" &&
            typeof selectors.length !== "undefined"
          ) {
            // Array duck-typing.
            for (var i = 0; i < selectors.length; i++) {
              wpPrefix =
                selectors[i].substr(0, substrLength) !== "#SnapABug_WP"
                  ? "#SnapABug_WP "
                  : "";
              result += wpPrefix + selectors[i];
              if (i !== selectors.length - 1) {
                // Not the last item
                result += ", ";
              }
            }
            result += "{ " + cssRules + " } ";
          }

          if (SnapABug.styleTag.styleSheet) {
            // Old IEs
            SnapABug.styleTag.styleSheet.cssText += result;
          } else {
            // Everyone else
            SnapABug.styleTag.textContent += result;
          }
        },
        // Mobile optimzied settings override
        setMobileSettings: function (settings) {
          mobileStyle = settings;
        },
        // Initialize Mobile Optimized chat UI
        initMobile: function () {
          if (mobileUI) {
            return;
          }
          if (mobileStyle === null) {
            mobileStyle = {};
          }
          mobileStyle.staticUrl = staticBaseURL + "/m";
          mobileUI = new window.snapengage_mobile.SnapEngageMobileClient(
            mobileStyle
          );
          mobileUI.init();
          // Wait for one second before we show Button
          setTimeout(function () {
            mobileUI.showTab();
          }, 1000);

          // TODO Link up Javascript API hooks
          // SnapEngage.allowOffline(true/false)

          mobileUI.allowOffline(offlineAllowed);
        },
        // Custom Design Tool (Design Studio) settings override
        setCustomDesignSettings: function (settings) {
          customDesignStyle = settings;
        },
        // Initialize the Custom Design Tool (Design Studio) chat UI
        initCustomDesign: function () {
          if (customDesignUI) {
            return;
          }
          if (customDesignStyle === null) {
            customDesignStyle = {};
          }
          customDesignUI = new window.chat_custom_design.SnapEngageCustomDesign(
            customDesignStyle
          );
          customDesignUI.init();
        },
        soundNotificationDiv: function () {
          if (SnapABug.hasFlash()) {
            return '<div id="SnapABug_Snd" style="width:0px;height:0px;font-size:0px;margin:0;padding:0;background-color:transparent;"></div>';
          }
          SnapABug.allowChatSound(false);
          return "";
        },
        positionDragger: function (x, y, w, h) {
          var sabdb = document.getElementById("SnapABug_DB");
          sabdb.style.left = x + "px";
          sabdb.style.top = y + "px";
          sabdb.style.width = w + "px";
          sabdb.style.height = h + "px";
        },
        moveForm: function (left, top) {
          var sabwp = document.getElementById("SnapABug_WP");
          if (left < 0) {
            left = 0;
          }
          if (left > SnapABug.getWindowWidth() - sabwp.offsetWidth) {
            left = SnapABug.getWindowWidth() - sabwp.offsetWidth;
          }
          if (top < 0) {
            top = 0;
          }
          if (top > SnapABug.getWindowHeight() - sabwp.offsetHeight) {
            top = SnapABug.getWindowHeight() - sabwp.offsetHeight;
          }
          sabwp.style.left = left + "px";
          sabwp.style.top = top + "px";
          SnapABug.formPosX = left;
          SnapABug.formPosY = top;
        },
        setupDraggerHandler: function () {
          try {
            var sabwp = document.getElementById("SnapABug_WP");
            var sabdb = document.getElementById("SnapABug_DB");
            sabdb.onmousedown = function (e) {
              SnapABug.dragging = true;
              if (document.getElementById && !document.all) {
                SnapABug.dragFromX = e.pageX;
                SnapABug.dragFromY = e.pageY;
              } else {
                var truebody =
                  document.compatMode && document.compatMode != "BackCompat"
                    ? document.documentElement
                    : document.body;
                SnapABug.dragFromX = event.clientX + truebody.scrollLeft;
                SnapABug.dragFromY = event.clientY + truebody.scrollTop;
              }
              return false;
            };
            if (
              !onmouseupInstalled &&
              !onmouseupPrev &&
              document.onmouseup &&
              typeof document.onmouseup === "function"
            ) {
              onmouseupPrev = document.onmouseup;
            }
            onmouseupInstalled = true;
            document.onmouseup = function (e) {
              if (SnapABug.dragging) {
                // After dragging, save new X,Y position
                // TODO :: Make window "stick" to browser edges when dragged there.
                // If formPosX and formPosY are defined and greater than the default of -1,
                // that means the user has clicked and dragged the form, so move the form.
                // Otherwise don't move the form because the user has just clicked the form.
                if (SnapABug.formPosX > -1 || SnapABug.formPosY > -1) {
                  var dragPos = [SnapABug.formPosX, -1, SnapABug.formPosY, -1];
                  SnapABug.calculateAndSetInViewportPosition(dragPos);
                }
              }
              // Reset back to false
              SnapABug.dragging = false;
              try {
                if (onmouseupPrev) {
                  onmouseupPrev(e);
                }
              } catch (ex) {}
            };
            if (
              !onmousemoveInstalled &&
              !onmousemovePrev &&
              document.onmousemove &&
              typeof document.onmousemove === "function"
            ) {
              onmousemovePrev = document.onmousemove;
            }
            onmousemoveInstalled = true;
            document.onmousemove = function (e) {
              if (SnapABug.dragging) {
                var left = 0;
                var top = 0;
                if (document.getElementById && !document.all) {
                  left = sabwp.offsetLeft + e.pageX - SnapABug.dragFromX;
                  top = sabwp.offsetTop + e.pageY - SnapABug.dragFromY;
                  SnapABug.dragFromX = e.pageX;
                  SnapABug.dragFromY = e.pageY;
                } else {
                  var truebody =
                    document.compatMode && document.compatMode != "BackCompat"
                      ? document.documentElement
                      : document.body;
                  left =
                    sabwp.offsetLeft +
                    event.clientX +
                    truebody.scrollLeft -
                    SnapABug.dragFromX;
                  top =
                    sabwp.offsetTop +
                    event.clientY +
                    truebody.scrollTop -
                    SnapABug.dragFromY;
                  SnapABug.dragFromX = event.clientX + truebody.scrollLeft;
                  SnapABug.dragFromY = event.clientY + truebody.scrollTop;
                }
                SnapABug.moveForm(left, top);

                try {
                  if (onmousemovePrev) {
                    onmousemovePrev(e);
                  }
                } catch (ex) {}

                return false;
              } else {
                try {
                  if (onmousemovePrev) {
                    onmousemovePrev(e);
                  }
                } catch (ex) {}

                return true;
              }
            };
          } catch (e) {}
        },
        injectButton: function (wId, dynamic, async, onlineImg, offlineImg) {
          //change the online and offline image URLs from http to https if the host page is https
          if (document.location.protocol === "https:") {
            if (onlineImg) {
              onlineImg = onlineImg.replace("http://", "https://");
            }
            if (offlineImg) {
              offlineImg = offlineImg.replace("http://", "https://");
            }
          }

          var css = "";
          var offset = buttonOffset;
          var pxOffset;
          if (offset.substr(offset.length - 1, 1) == "%") {
            if (buttonPosition == "left" || buttonPosition == "right") {
              pxOffset = Math.round(
                (offset.substr(0, offset.length - 1) * this.getWindowHeight()) /
                  100
              );
            } else {
              pxOffset = Math.round(
                (offset.substr(0, offset.length - 1) * this.getWindowWidth()) /
                  100
              );
            }
          } else {
            pxOffset = offset.substr(0, offset.length - 2);
          }

          var altText = "";
          if (!dynamic && buttonImgUrl == "") {
            altText = this.getMessage(0);
          }

          if (onlineImg && offlineImg && onlineImg == offlineImg) {
            // both online and offline are the same, bypass the dynamic redirect
            buttonImgUrl = onlineImg;
            buttonWidth = -1;
            buttonHeight = -1;
          } else if (dynamic || (onlineImg && offlineImg)) {
            var params =
              "w=" +
              wId +
              "&rand=" +
              encodeURIComponent(
                Math.floor(Math.random() * 0xffffffff).toString(16)
              );
            params = SnapABug.appendTagsParameter(params);

            buttonImgUrl = baseURL + "/statusImage?" + params;
            buttonWidth = -1;
            buttonHeight = -1;
            if (onlineImg && offlineImg) {
              buttonImgUrl +=
                "&on=" +
                encodeURIComponent(onlineImg) +
                "&off=" +
                encodeURIComponent(offlineImg);
            }
          } else if (buttonImgUrl == "") {
            buttonImgUrl =
              staticBaseURL + "/btn/help_" + buttonPosition + "_" + locale;
            if (this.isIE6()) {
              buttonImgUrl += ".gif";
            } else {
              buttonImgUrl += ".png";
            }
            if (buttonPosition == "top" || buttonPosition == "bottom") {
              var w = buttonWidth;
              buttonWidth = buttonHeight;
              buttonHeight = w;
            }
          }
          switch (buttonPosition) {
            case "left":
              css +=
                "body .SnapABug_Button{cursor:pointer;cursor:hand;overflow:hidden;position:fixed;_position:absolute;display:block;top:" +
                offset +
                ";_top:expression(eval(document.body.scrollTop)+" +
                pxOffset +
                ");left:0px;z-index:2147000000;margin:0;padding:0;border-collapse:collapse;border-spacing:0;border:none;outline:none;font-size:0px;line-height:0px;}";
              break;
            case "right":
              css +=
                "body .SnapABug_Button{cursor:pointer;cursor:hand;overflow:hidden;position:fixed;_position:absolute;display:block;top:" +
                offset +
                ";_top:expression(eval(document.body.scrollTop)+" +
                pxOffset +
                ");right:0px;z-index:2147000000;margin:0;padding:0;border-collapse:collapse;border-spacing:0;border:none;outline:none;font-size:0px;line-height:0px;}";
              break;
            case "top":
              css +=
                "body .SnapABug_Button{cursor:pointer;cursor:hand;overflow:hidden;position:fixed;_position:absolute;display:block;top:0px;left:" +
                offset +
                ";_left:expression(eval(document.body.scrollLeft)+" +
                pxOffset +
                ");z-index:2147000000;margin:0;padding:0;border-collapse:collapse;border-spacing:0;border:none;outline:none;font-size:0px;line-height:0px;}";
              break;
            case "bottom":
              css +=
                "body .SnapABug_Button{cursor:pointer;cursor:hand;overflow:hidden;position:fixed;_position:absolute;display:block;bottom:0px;left:" +
                offset +
                ";_left:expression(eval(document.body.scrollLeft)+" +
                pxOffset +
                ");z-index:2147000000;margin:0;padding:0;border-collapse:collapse;border-spacing:0;border:none;outline:none;font-size:0px;line-height:0px;}";
              break;
          }
          css += " @media print{body .SnapABug_Button{display:none;}}";

          var widthheight = "";
          if (buttonWidth > 0 && buttonHeight > 0) {
            widthheight =
              'width="' + buttonWidth + '" height="' + buttonHeight + '"';
          }

          var buttonImgContent =
            '<img id="SnapABug_bImg" style="position:relative;" src="' +
            buttonImgUrl +
            '" alt="' +
            altText +
            '" border="0" ' +
            widthheight +
            ' onmouseover="SnapABug.buttonOver();" onmouseout="SnapABug.buttonOut();" />';

          if (async) {
            // style
            var head = document.getElementsByTagName("head")[0];
            var style = document.createElement("style");

            style.type = "text/css";
            if (style.styleSheet) {
              style.styleSheet.cssText = css;
            } else {
              style.appendChild(document.createTextNode(css));
            }
            head.appendChild(style);
            // button DIV
            var buttonDiv = document.getElementById("SnapABug_Button");
            if (!buttonDiv) {
              buttonDiv = document.createElement("div");
              buttonDiv.id = "SnapABug_Button";
              buttonDiv.className = "SnapABug_Button";
              buttonDiv.onclick = SnapABug.startLink;
              document.body.appendChild(buttonDiv);
            }
            buttonDiv.innerHTML = buttonImgContent;
          } else {
            try {
              console.log(
                "ERROR: SnapEngage code is setup in a legacy no longer supported mode. Contact support for assistance."
              );
            } catch (e) {}
          }
          this.buttonOut();
        },
        buttonOver: function () {
          var elemStyle = document.getElementById("SnapABug_bImg").style;
          switch (buttonPosition) {
            case "left":
              elemStyle.left = "0px";
              break;
            case "right":
              elemStyle.right = "0px";
              break;
            case "top":
              elemStyle.top = "0px";
              break;
            case "bottom":
              elemStyle.bottom = "0px";
              break;
          }
          this.preloadLoadingImg();
        },
        buttonOut: function () {
          try {
            var elemStyle = document.getElementById("SnapABug_bImg").style;
            switch (buttonPosition) {
              case "left":
                elemStyle.left = buttonPos;
                break;
              case "right":
                elemStyle.right = buttonPos;
                break;
              case "top":
                elemStyle.top = buttonPos;
                break;
              case "bottom":
                elemStyle.bottom = buttonPos;
                break;
            }
          } catch (e) {}
        },
        showForm: function (
          lightbox,
          width,
          height,
          iframeLeft,
          iframeTop,
          iframeWidth,
          iframeHeight
        ) {
          SnapABug.formWidth = width;
          SnapABug.formHeight = height;

          var p = document.getElementById("SnapABug_P");
          var ip = document.getElementById("SnapABug_IP");
          var wp = document.getElementById("SnapABug_WP");
          var w = document.getElementById("SnapABug_W");
          var o = document.getElementById("SnapABug_O");

          wp.style.width = width + "px";
          wp.style.height = height + "px";

          p.style.width = width + "px";
          p.style.height = height + "px";

          ip.style.left = iframeLeft + "px";
          ip.style.top = iframeTop + "px";
          ip.style.width = iframeWidth + "px";
          ip.style.height = iframeHeight + "px";

          wp.style.display = "block";
          p.style.display = "block";
          if (iframeWidth > 0 && iframeHeight > 0) {
            ip.style.display = "block";
          } else {
            ip.style.display = "none";
          }

          if (lightbox && lightboxColor != "") {
            // Enable the lightbox and position the form in the middle of the display
            w.style.display = "block";
            o.style.display = "block";
            o.style.width = this.getWindowWidth() + "px";
            o.style.height = this.getWindowHeight() + "px";
          } else {
            // No lightbox
            w.style.display = "none";
            o.style.display = "none";
          }

          var determinedPosition = [-1, -1, -1, -1];
          // left, right, top, bottom

          if (
            SnapABugChat.isFirstInit() &&
            SnapABug.formPosX &&
            SnapABug.formPosY
          ) {
            // We have not fired SnapABugChat.reInit() and the
            // Form has been already moved, so reuse the same position
            determinedPosition[0] = SnapABug.formPosX;
            determinedPosition[2] = SnapABug.formPosY;
          } else {
            determinedPosition = this.getDefaultChatPosition(lightbox);
          }

          ip.innerHTML =
            '<iframe width="100%" height="100%" frameborder="0" src="' +
            SnapABug.getBaseURL() +
            '/empty.html"></iframe>';

          SnapABug.positionForm(
            determinedPosition[0],
            determinedPosition[1],
            determinedPosition[2],
            determinedPosition[3]
          );
          this.setupDraggerHandler();
        },
        getDefaultChatPosition: function (useLightbox) {
          if (SnapABug.isCustomDesignEnabled()) {
            // For Design Studio users, the default position is the user's custom design settings.
            return;
          }

          var wpr = -1,
            wpl = -1,
            wpt = -1,
            wpb = -1;
          switch (SnapABug.getChatFormPosition()) {
            case "tl":
              // top left
              wpl = 0;
              wpt = 0;
              break;
            case "tr":
              // top right
              wpr = 0;
              wpt = 0;
              break;
            case "bl":
              wpl = 0;
              wpb = 0;
              break;
            case "br":
            default:
              wpr = 0;
              wpb = 0;
              break;
          }

          // If position is 'c'enter, overwrite array values.
          if (useLightbox || SnapABug.getChatFormPosition() === "c") {
            var p = document.getElementById("SnapABug_P");
            // centering is done using left and top values.
            wpr = -1;
            wpb = -1;

            wpl = Math.round(this.getWindowWidth() / 2 - p.offsetWidth / 2);
            if (wpl <= 0) {
              wpl = 0;
            }

            if (formTopPos !== 0) {
              wpt = formTopPos;
            } else {
              wpt = Math.round(this.getWindowHeight() / 2 - p.offsetHeight / 2);
              if (wpt <= 0) {
                wpt = 0;
              }
            }
          }

          return [wpl, wpr, wpt, wpb];
        },
        positionForm: function (wpl, wpr, wpt, wpb, isAnimationFrame) {
          if (SnapABug.isAnimating() && !isAnimationFrame) {
            return;
            // Don't interfere with the animation.
          }
          var wp = document.getElementById("SnapABug_WP");
          if (this.isIE6()) {
            // IE6
            var scrlt = document.documentElement.scrollTop
              ? document.documentElement.scrollTop
              : document.body.scrollTop;
            var scrll = document.documentElement.scrollLeft
              ? document.documentElement.scrollLeft
              : document.body.scrollLeft;
            if (wpt) {
              wp.style.top = scrlt + wpt + "px";
            } else {
              wp.style.top =
                scrlt +
                SnapABug.getWindowHeight() -
                wpb -
                wp.offsetHeight +
                "px";
            }
            if (wpl) {
              wp.style.left = scrll + wpl + "px";
            } else {
              wp.style.left =
                scrll + SnapABug.getWindowWidth() - wpr - wp.offsetWidth + "px";
            }
          } else {
            wp.style.top = wpt != -1 ? wpt + "px" : "";
            wp.style.bottom = wpb != -1 ? wpb + "px" : "";
            wp.style.left = wpl != -1 ? wpl + "px" : "";
            wp.style.right = wpr != -1 ? wpr + "px" : "";
          }
        },
        //[0]:left, [1]:right, [2]:top, [3]:bottom]
        getPositionArray: function () {
          var wp = document.getElementById("SnapABug_WP");
          var currentPos = [
            parseInt(wp.style.left, 10),
            parseInt(wp.style.right, 10),
            parseInt(wp.style.top, 10),
            parseInt(wp.style.bottom, 10),
          ];
          for (var i = 0; i < currentPos.length; i++) {
            if (isNaN(currentPos[i])) {
              currentPos[i] = -1;
            }
          }

          return currentPos;
        },
        debounce: function (func, wait, immediate) {
          // This is a direct copy & paste from underscore.js

          // Returns a function, that, as long as it continues to be invoked, will not
          // be triggered. The function will be called after it stops being called for
          // N milliseconds. If `immediate` is passed, trigger the function on the
          // leading edge, instead of the trailing.
          var timeout, args, context, timestamp, result;

          var later = function () {
            var last = new Date().getTime() - timestamp;

            if (last < wait && last >= 0) {
              timeout = setTimeout(later, wait - last);
            } else {
              timeout = null;
              if (!immediate) {
                result = func.apply(context, args);
                if (!timeout) {
                  context = args = null;
                }
              }
            }
          };

          return function () {
            context = this;
            args = arguments;
            timestamp = new Date().getTime();
            var callNow = immediate && !timeout;
            if (!timeout) {
              timeout = setTimeout(later, wait);
            }
            if (callNow) {
              result = func.apply(context, args);
              context = args = null;
            }

            return result;
          };
        },
        addOnResizeHandler: function () {
          // If mobileUI or customDesignUI, do not proceed!
          if (SnapABug.isMobileEnabled() || SnapABug.isCustomDesignEnabled()) {
            return;
          }

          var _this = this;
          function onResizeInViewportCheck(event) {
            if (!chatInProgress) {
              return;
            }
            var formPosition = _this.getPositionArray();
            if (_this.isOutsideViewport(formPosition)) {
              _this.calculateAndSetInViewportPosition(formPosition);
            }
          }
          // Attach the throttled function as Resize event handler.
          var throttledResizeHandler = this.debounce(
            onResizeInViewportCheck,
            100
          );
          if (window.addEventListener) {
            window.addEventListener("resize", throttledResizeHandler, 0);
          } else if (window.attachEvent) {
            window.attachEvent("onresize", throttledResizeHandler);
          } else {
            var prevResizeHandler = window.onresize;
            var resizeHandler = function (evt) {
              throttledResizeHandler(evt);
              if (prevResizeHandler) {
                prevResizeHandler(evt);
              }
            };
            window.onresize = resizeHandler;
          }
          // else: the browser does not support event listners.
        },
        isOutsideViewport: function (formPosition) {
          return (
            SnapABug.isOutsideViewportEdgeTop(formPosition) ||
            SnapABug.isOutsideViewportEdgeRight(formPosition) ||
            SnapABug.isOutsideViewportEdgeBottom(formPosition)
          );
        },
        isOutsideViewportEdgeTop: function (formPosition) {
          return (
            SnapABug.formHeight > SnapABug.getWindowHeight() ||
            formPosition[2] < -1
          );
        },
        isOutsideViewportEdgeRight: function (formPosition) {
          if (SnapABug.formWidth > SnapABug.getWindowWidth()) {
            return true;
          }

          var leftPosition = formPosition[0];
          var formEdgeRight = leftPosition + SnapABug.formWidth;

          return SnapABug.getWindowWidth() < formEdgeRight;
        },
        isOutsideViewportEdgeBottom: function (formPosition) {
          var topPosition = formPosition[2];
          var formEdgeBottom = topPosition + SnapABug.formHeight;

          return SnapABug.getWindowHeight() < formEdgeBottom;
        },
        calculateAndSetInViewportPosition: function (formPosition) {
          if (!SnapABug.isOutsideViewport(formPosition)) {
            return resolveAndSet(formPosition);
          }

          var LEFT = 0;
          var RIGHT = 1;
          var TOP = 2;
          var BOTTOM = 3;

          var newPosition = [-1, -1, -1, -1];
          //[wpLeft, wpRight, wpTop, wpBottom]
          var xSnapIsSet = false;
          var ySnapIsSet = false;

          // EDGE CASE : Very small browser window.
          // Prefer TOP and RIGHT so close buttons stay in view.
          if (SnapABug.isOutsideViewportEdgeTop(formPosition)) {
            newPosition[TOP] = 0;
            // Snap to TOP
            ySnapIsSet = true;
          }
          if (SnapABug.isOutsideViewportEdgeRight(formPosition)) {
            newPosition[RIGHT] = 0;
            // Snap to RIGHT
            xSnapIsSet = true;
          }
          if (
            !ySnapIsSet &&
            SnapABug.isOutsideViewportEdgeBottom(formPosition)
          ) {
            newPosition[BOTTOM] = 0;
            // Snap to BOTTOM
            ySnapIsSet = true;
          }

          if (!ySnapIsSet) {
            // If we don't have a new ySnap, copy old Y values.
            newPosition[TOP] = formPosition[TOP];
            newPosition[BOTTOM] = formPosition[BOTTOM];
          }
          if (!xSnapIsSet) {
            // If we don't have a new xSnap, copy old X values.
            newPosition[LEFT] = formPosition[LEFT];
            newPosition[RIGHT] = formPosition[RIGHT];
          }

          return resolveAndSet(newPosition);

          function resolveAndSet(newPosition) {
            SnapABugChat.setChatWindowCookieData(
              "chatBoxPosition",
              newPosition
            );
            SnapABug.positionForm(
              newPosition[0],
              newPosition[1],
              newPosition[2],
              newPosition[3]
            );
            return newPosition;
          }
        },
        isAnimating: function (isAnim) {
          if (typeof isAnim !== "undefined") {
            animating = isAnim;
          }
          return animating;
        },
        slideFormOut: function () {
          if (caseId || dbCaseId) {
            // Protect against sliding out and closing an ongoing chat
            return;
          }
          var windowWidth = SnapABug.getWindowWidth();
          var wp = document.getElementById("SnapABug_WP");
          var wpl = wp.offsetLeft;
          var wpt = wp.offsetTop;
          var steps = 20;
          var milliseconds = 1000;
          var pos = 0;
          for (var i = 0; i < steps; i++) {
            if (wpl > windowWidth / 2) {
              pos =
                wpl +
                (windowWidth - wpl) * (1 - Math.cos((i * Math.PI) / steps / 2));
            } else {
              pos =
                wpl -
                (wpl + SnapABug.formWidth) *
                  (1 - Math.cos((i * Math.PI) / steps / 2));
            }
            if (i == 0) {
              SnapABug.isAnimating(true);
              setTimeout("SnapABug.isAnimating(false);", milliseconds);
            }
            setTimeout(
              "SnapABug.positionForm(" + pos + ", -1, " + wpt + ", -1, true);",
              (i * milliseconds) / steps
            );
          }
          setTimeout("SnapABug.closeForm(true);", milliseconds);
        },
        slideFormIn: function () {
          var windowWidth = SnapABug.getWindowWidth();
          var wp = document.getElementById("SnapABug_WP");
          var wpl = wp.offsetLeft;
          var wpt = wp.offsetTop;
          var steps = 20;
          var milliseconds = 600;
          var pos = 0;
          for (var i = 0; i < steps; i++) {
            if (wpl > windowWidth / 2) {
              pos =
                wpl +
                (windowWidth - wpl) * (1 - Math.sin((i * Math.PI) / steps / 2));
            } else {
              pos =
                wpl -
                (wpl + SnapABug.formWidth) *
                  (1 - Math.sin((i * Math.PI) / steps / 2));
            }
            if (i == 0) {
              SnapABug.positionForm(pos, -1, wpt, -1);

              SnapABug.isAnimating(true);
              setTimeout("SnapABug.isAnimating(false);", milliseconds);

              // Snap the form into the corner so it doesn't fall off the view on browser resize
              var defPos = SnapABug.getDefaultChatPosition();
              // returns an array
              setTimeout(
                "SnapABug.positionForm(" +
                  defPos[0] +
                  "," +
                  defPos[1] +
                  "," +
                  defPos[2] +
                  "," +
                  defPos[3] +
                  ");",
                milliseconds + 1
              );
            } else {
              setTimeout(
                "SnapABug.positionForm(" +
                  pos +
                  ", -1, " +
                  wpt +
                  ", -1, true);",
                (i * milliseconds) / steps
              );
            }
          }
        },
        getCSS: function (x, y, w, h, s, c) {
          var css =
            ";position:absolute;display:block;margin:0;padding:0;border:none;float:none;clear:none;";
          if (x != undefined) {
            css += "left:" + x + "px;";
          }
          if (y != undefined) {
            css += "top:" + y + "px;";
          }
          if (w != undefined) {
            css +=
              "width:" + w + "px;max-width:" + w + "px;min-width:" + w + "px;";
          }
          if (h != undefined) {
            css +=
              "height:" +
              h +
              "px;max-height:" +
              h +
              "px;min-height:" +
              h +
              "px;";
          }
          css +=
            "z-index:2;background-color:transparent;background:none;font-style:normal;font-weight:normal;font-size:100%;line-height:normal;text-shadow:none;list-style:none;" +
            (direction == "" ? "text-align:left;" : "text-align:right;") +
            "outline:none;text-indent:0px;-moz-box-shadow:none;-webkit-box-shadow:none;" +
            direction;

          if (s != undefined) {
            css += s.replace(/"/g, "'");
          }
          if (c != undefined) {
            css += c.replace(/"/g, "'");
          }
          return css;
        },
        getSystemMessageCSS: function (x, y, w, h, s, c) {
          return (
            SnapABug.getCSS(x, y, w, h, s, c) +
            "position: relative; background-color: #D5E8EA; border: 1px solid #D5E8EA; border-radius: 4px; -moz-border-radius: 4px; -webkit-border-radius: 4px; margin: 5px 0px; font-size: .9em; display: inline-block;"
          );
        },
        getBlankImg: function () {
          if (this.isIE6()) {
            return staticBaseURL + "/wbg/blank.gif";
          } else {
            return staticBaseURL + "/wbg/blank.gif";
            // TODO switch to a PNG version to save 2/3 of the size
          }
        },
        preloadLoadingImg: function () {
          if (!waitImgLoaded) {
            waitImgLoaded = true;
            var bg = new Image();
            bg.src = staticBaseURL + "/wbg/loading.gif";
          }
        },
        showLoading: function () {
          document.getElementById("SnapABug_P").innerHTML =
            '<div style="position:absolute;left:0;top:0;z-index:1;">' +
            '<img src="' +
            staticBaseURL +
            '/wbg/loading.gif" style="' +
            this.getCSS(0, 0, 31, 31) +
            '" galleryimg="no" width="31" height="31" border="0" alt="Loading..." /></div>';
          this.showForm(true, 31, 31, 0, 0, 0, 0);
        },
        loadForm: function () {
          // Removed on 2011/05/14 - as we have an Object, no reset required
          //cvval = new Object; // Reset the object for the form custom fields
          this.showLoading();
          var bg = new Image();
          bg.onload = function () {
            SnapABug.populateForm();
          };
          bg.src = bgURL;

          return false;
        },
        getSnapABugSiteUrl: function () {
          return (
            "https://www.snapengage.com/partner?src=widget&amp;id=" +
            widgetId +
            "&amp;l=" +
            SnapABug.getLocale()
          );
        },
        getLogoClickATag: function () {
          var title = SnapABugChat.getPageTitle(false).toLowerCase();
          var follow =
            title.indexOf("live chat") != -1 ||
            title.indexOf("online chat") != -1;
          return (
            '<a href="' +
            SnapABug.getSnapABugSiteUrl() +
            '" target="_blank" style="text-indent:0px;border:none;"' +
            (follow ? "" : ' rel="nofollow"') +
            ">"
          );
        },
        logoLink: function () {
          // Temporary solution to remove our logo link on some widgets bringing us unqualified traffic
          if (
            widgetId === "e5277a72-aea3-4184-b8eb-f056273a52e9" || // gohealthinsurance
            widgetId === "e09b64f1-5bf5-415d-8fc0-1a633f5f01b5" || // gohealthinsurance
            widgetId === "40277fbf-4da8-4569-8ea2-573323e291f6" || // lifecellskin
            widgetId === "9e7310f0-e8a4-4210-9033-98d3ef28f95c" // 123contactform
          ) {
            return false;
          }
          return logoLinkEnabled;
        },
        getInvisibleDivIEFixCSS: function () {
          // Early IE Fix for invisble or transparent divs.
          return (
            "" + // Set background color so element takes click and hover events.
            "background-color: #ffffff;" + // Then set element to opacity 0 so it is still invisible.
            '-ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";' +
            "filter: alpha(opacity=0);" +
            "-moz-opacity: 0;" +
            "-khtml-opacity: 0;" +
            "opacity: 0;"
          );
        },
        initMinimizeArea: function (left, top, width, height) {
          if (SnapABug.isQuirksMode()) {
            // QuirksMode doesn't respect :hover states. So chat box menu does not work.
            return;
          }

          if (
            typeof SnapABugChat.getChatWindowCookieData("isMinimized") ===
            "undefined"
          ) {
            SnapABugChat.setChatWindowCookieData("isMinimized", false);
            // Intialize Boolean to show minimized functions are ready.
          }
          SnapABugChat.minimizedDimensions = [left, top, width, height];

          var rb = document.getElementById("SnapABug_RB");
          // Restore box;

          if (!rb) {
            // Create if it doesn't exist.
            rb = document.createElement("div");
            rb.id = "SnapABug_RB";

            SnapABug.addStyleRule(
              "#SnapABug_WP #SnapABug_RB",
              "position: absolute; z-index: 12; cursor: pointer; " +
                "left: " +
                left +
                "px; top: " +
                top +
                "px; width: " +
                width +
                "px; height: " +
                height +
                "px; " +
                "display: none;" +
                SnapABug.getInvisibleDivIEFixCSS()
            );
            SnapABug.addStyleRule(
              "#SnapABug_WP.minimized #SnapABug_RB",
              "display: block;"
            );

            try {
              rb.setAttribute("onclick", "SnapEngageChat.minimizeToggle()");
            } catch (e) {}
            try {
              rb.onclick = function () {
                SnapABugChat.minimizeToggle();
              };
            } catch (e) {}

            document.getElementById("SnapABug_WP").appendChild(rb);
          }
        },
        initMinimizeNotification: function (
          left,
          top,
          width,
          height,
          textSize,
          borderRadius,
          backgroundColor,
          textColor,
          extraCss
        ) {
          if (SnapABug.isQuirksMode()) {
            // QuirksMode doesn't respect :hover states. So chat box menu does not work.
            return;
          }

          var wp = document.getElementById("SnapABug_WP");
          var nmn = document.getElementById("SnapABug_NMN");
          // New Message Notification
          var nmni = document.getElementById("SnapABug_NMNi");
          // New Message Notification inner.

          if (!nmn) {
            // Create if it doesn't exist.
            nmn = document.createElement("div");
            nmn.id = "SnapABug_NMN";
          }
          if (!nmni) {
            nmni = document.createElement("span");
            nmni.id = "SnapABug_NMNi";
          }

          // Set up default styles in case the arguments were not provided.
          left = left ? left : 0;
          // Default to top-left corner.
          top = top ? top : 0;
          // Default to top-left corner.
          width = width ? width : 25;
          // Default width.
          height = height ? height : 20;
          // Default height.
          backgroundColor = backgroundColor ? backgroundColor : "#FF0000";
          // Default to Red.
          borderRadius = borderRadius ? borderRadius : 3;
          extraCss = extraCss ? extraCss : "";
          textSize = textSize ? textSize : 16;

          // NMNi css
          textColor = textColor ? textColor : "#FFFFFF";
          // Default to White.

          var nmnCSS =
            "display: none;" +
            " position: absolute; left:" +
            left +
            "px; top:" +
            top +
            "px; z-index: 2;" +
            " font-size:" +
            textSize +
            "px; text-align: center; cursor: pointer; " +
            " background-color: " +
            backgroundColor +
            "; color: " +
            textColor +
            "; " +
            "-webkit-border-radius:" +
            borderRadius +
            "px; border-radius:" +
            borderRadius +
            "px;" +
            extraCss;

          var nmniCSS =
            SnapABug.getDisplayInlineBlockCSS() +
            " box-sizing: border-box; " +
            " color: " +
            textColor +
            "; font-size: 1em; font-weight: bold;" +
            " padding:0 0.3em;";

          var isCircle = height === width;
          var emPerc = (height / textSize).toFixed(4);
          // example: (20/14).toFixed(4) == 1.4286

          if (isCircle) {
            nmniCSS +=
              " line-height:" + emPerc + "em; min-width:" + emPerc + "em;";
            // Leaving this out for now, until we have a better determination on when this is actually needed.
            // if (!SnapABug.isIE() && !SnapABug.isFirefox()) {
            //  nmniCSS += ' position: relative; top: -1px;'; // Browser-specific better NMNi number positioning inside circles
            // }
          } else {
            nmniCSS +=
              " line-height:" + height + "px; min-width:" + width + "px;";
          }

          try {
            nmn.setAttribute("style", nmnCSS);
            nmn.setAttribute("onclick", "SnapEngageChat.minimizeToggle()");

            nmni.setAttribute("style", nmniCSS);
          } catch (e) {}
          try {
            nmn.style.cssText = nmnCSS;
            nmn.onclick = function () {
              SnapABugChat.minimizeToggle();
            };

            nmni.style.cssText = nmniCSS;
          } catch (e) {}

          wp.appendChild(nmn);
          nmn.appendChild(nmni);
        },
        initChatBoxMenuButton: function (
          left,
          top,
          width,
          height,
          iconColor,
          backgroundColor,
          extraCss,
          spritesheetURL
        ) {
          if (
            SnapABug.isQuirksMode() ||
            SnapABug.isIE6() ||
            SnapABug.isIE7() ||
            SnapABug.isIE8()
          ) {
            // QuirksMode doesn't respect :hover states. So chat box menu does not work.
            // IE8 or lower do not support the high density handling.
            return;
          }

          var wp = document.getElementById("SnapABug_WP");

          var cbmBtn = document.getElementById("SnapABug_CBMBtn");
          // Chat Box Menu BUTTON
          var cbmBtnIcon = document.getElementById("SnapABug_CBMBtnI");
          // Chat Box Menu BUTTON ICON

          if (cbmBtn) {
            // It's already init'd, return.
            return;
          } else {
            // Create if it doesn't exist.
            cbmBtn = document.createElement("div");
            cbmBtn.id = "SnapABug_CBMBtn";
          }

          if (!cbmBtnIcon) {
            // Create if it doesn't exist.
            cbmBtnIcon = document.createElement("i");
            cbmBtnIcon.id = "SnapABug_CBMBtnI";
          }

          cbmBtn.appendChild(cbmBtnIcon);

          if (!menuButtonStylesAdded) {
            // to avoid duplicate styles in our StyleTag
            // Create the Chat Box Menu BUTTON
            // Set up default styles in case the arguments were not provided.
            left = left ? left : SnapABug.formWidth - 30;
            // Default of 20x20 _CBMBtn
            top = top ? top : 10;
            width = width ? width : 20;
            height = height ? height : 20;
            iconColor = iconColor ? iconColor : "black";
            backgroundColor = backgroundColor ? backgroundColor : "transparent";
            extraCSS = extraCss ? extraCss : "";

            SnapABugChat._chatMenuButtonHeight = height;

            if (spritesheetURL) {
              SnapABug.menuButtonIconSpriteSheetURL = spritesheetURL;
            } else {
              var defaultSpritesheetPrefix =
                SnapABug.getStaticBaseURL() + "/wbg/minBtn_sprites_v2_";
              switch (iconColor) {
                case "white":
                case "#FFFFFF":
                case "#ffffff":
                  // White icon.
                  SnapABug.menuButtonIconSpriteSheetURL =
                    defaultSpritesheetPrefix + "white2x.png";
                  break;
                case "black":
                case "#000000":
                // Black text.
                default:
                  SnapABug.menuButtonIconSpriteSheetURL =
                    defaultSpritesheetPrefix + "black2x.png";
              }
            }

            var positioningCss = "position: absolute; z-index: 2;";

            // Establish Chat Box BUTTON Style rules.
            SnapABug.addStyleRule(
              "#SnapABug_CBMBtn",
              positioningCss +
                "left:" +
                left +
                "px; top:" +
                top +
                "px; width:" +
                width +
                "px; height:" +
                height +
                "px; " +
                "cursor: pointer; display: block; background-color: " +
                backgroundColor +
                "; color: " +
                iconColor +
                "; " +
                extraCss
            );
            SnapABug.addStyleRule(
              ["#SnapABug_WP:not(.minimized) #SnapABug_CBMBtn:hover"],
              "border-bottom-left-radius: 0; border-bottom-right-radius: 0;"
            );
            SnapABug.addStyleRule(
              "#SnapABug_CBMBtn>i",
              positioningCss +
                "right:0px; top:0px; width:20px; height:20px; " +
                "background-image: url(" +
                SnapABug.menuButtonIconSpriteSheetURL +
                "); background-size: 40px 80px; background-repeat: no-repeat; background-position: " +
                SnapABug.getIconCoords("chevron-down") +
                ";"
            );
            SnapABug.addStyleRule(
              "#SnapABug_WP.minimized #SnapABug_CBMBtn>i",
              "background-position: " +
                SnapABug.getIconCoords("chevron-up") +
                ";"
            );
            SnapABug.addStyleRule(["#SnapABug_CBM"], "display:none;");
          }

          wp.appendChild(cbmBtn);
        },
        initChatBoxMenu: function (
          menuWidth,
          backgroundColor,
          textColor,
          highlightColor,
          extraCss,
          spritesheetURL
        ) {
          if (SnapABug.isQuirksMode()) {
            // QuirksMode doesn't respect :hover states. So chat box menu does not work.
            return;
          }

          var cbmBtn = document.getElementById("SnapABug_CBMBtn");
          // Chat Box Menu BUTTON
          if (!cbmBtn) {
            // Must run initChatBoxMenuButton first!
            return;
          }

          var cbm = document.getElementById("SnapABug_CBM");
          // Chat Box Menu
          if (cbm) {
            // It's already init'd, return
            return;
          } else {
            // Create if it doesn't exist.
            cbm = document.createElement("div");
            cbm.id = "SnapABug_CBM";
          }

          var cbmhh = document.getElementById("SnapABug_CBMHoverHelper");
          // Chat Box Menu Hover Hack
          // The HoverHelper is an invisible div to improve the experience and ease of
          // moving your mouse from the button down to the menu without accidentally going off-hover.
          // It is as wide as the CBM, and the same height as the CBMBtn,
          if (cbmhh) {
            // It's already init'd, return
            return;
          } else {
            // Create if it doesn't exist.
            cbmhh = document.createElement("div");
            cbmhh.id = "SnapABug_CBMHoverHelper";
          }

          if (!menuStylesAdded) {
            // to avoid duplicate styles in our StyleTag
            var defaultSpritesheetPrefix =
              SnapABug.getStaticBaseURL() + "/wbg/minBtn_sprites_v2_";
            var determinedTextColor;
            var determinedHighlightColor;
            var determinedBgColor;

            // Create the Chat Box Menu BUTTON
            // Set up default styles in case the arguments were not provided.
            menuWidth = menuWidth ? menuWidth : "";
            extraCSS = extraCss ? extraCss : "";
            textColor = textColor ? textColor : "#000000";

            // For now `textColor` must be white or black.
            switch (textColor) {
              case "white":
              case "#FFFFFF":
              case "#ffffff":
                // White text.
                determinedTextColor = "#FFFFFF";
                determinedHighlightColor = highlightColor
                  ? highlightColor
                  : "#555555";
                determinedBgColor = backgroundColor
                  ? backgroundColor
                  : "#000000";
                SnapABug.menuIconSpriteSheetURL = spritesheetURL
                  ? spritesheetURL
                  : defaultSpritesheetPrefix + "white2x.png";
                break;
              case "black":
              case "#000000":
              // Black text.
              default:
                determinedTextColor = "#000000";
                determinedHighlightColor = highlightColor
                  ? highlightColor
                  : "#EEEEEE";
                determinedBgColor = backgroundColor
                  ? backgroundColor
                  : "#FFFFFF";
                SnapABug.menuIconSpriteSheetURL = spritesheetURL
                  ? spritesheetURL
                  : defaultSpritesheetPrefix + "black2x.png";
              // Default to black
            }

            var positioningCss = "position: absolute; z-index: 2;";

            var menuRightLeftPadding = 3;
            // Establish Chat Box MENU Style rules.
            SnapABug.addStyleRule(
              [
                "#SnapABug_CBMBtn:hover #SnapABug_CBM:hover",
                "#SnapABug_CBMBtn:hover #SnapABug_CBM",
                "#SnapABug_CBMBtn #SnapABug_CBM:hover",
              ],
              "display:block;"
            );
            SnapABug.addStyleRule(
              "#SnapABug_CBM",
              positioningCss +
                (menuWidth ? "width: " + menuWidth + "; " : "") +
                "padding: 1px " +
                menuRightLeftPadding +
                "px; " +
                "border-radius: 1px;" +
                "top: " +
                SnapABugChat._chatMenuButtonHeight +
                "px; right: 0px; background: " +
                determinedBgColor +
                "; " +
                "color: " +
                determinedTextColor +
                "; " +
                "border: thin solid " +
                determinedHighlightColor +
                ";" +
                "-webkit-box-shadow: 0 1px 4px 0 " +
                determinedTextColor +
                ";" +
                "        box-shadow: 0 1px 4px 0 " +
                determinedTextColor +
                "; " +
                extraCSS
            );
            SnapABug.addStyleRule(
              ".SnapABug_CBMItem",
              "position:relative; " + "height: 20px; width: 100%;" // for Absolute positioning <i>s
            );
            SnapABug.addStyleRule(
              ".SnapABug_CBMItem:hover",
              "background-color: " + determinedHighlightColor + ";"
            );
            SnapABug.addStyleRule(
              ".SnapABug_CBMItem span",
              "font-size: 14px; white-space: nowrap; padding-left: 10px;" +
                "padding-right:26px;" // padding for icons.
            );
            SnapABug.addStyleRule(
              ".SnapABug_CBMItem i",
              "" +
                SnapABug.getDisplayInlineBlockCSS() +
                "position:absolute; top:0; right:0; height: 20px; width: 20px; background-size: 40px 80px;"
            );
            SnapABug.addStyleRule(
              ".SnapABug_CBMItemSplitter",
              "height:0; width: 90%; margin: 0px auto;  border-bottom: thin solid " +
                textColor +
                ";" +
                "clear: both;" +
                "opacity: 0.15; " +
                "-ms-filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=15);" +
                "filter: alpha(opacity=15);"
            );
            SnapABug.addStyleRule("#SnapABug_closeBtn", "margin-top: 3px;");
            SnapABug.addStyleRule("#SnapABug_minBtn", "margin-bottom: 3px;");
            SnapABug.addStyleRule(
              ["#SnapABug_CBMHoverHelper"],
              "display: block;" +
                "position: absolute;" +
                "top: -" +
                SnapABugChat._chatMenuButtonHeight +
                "px;" +
                "left: -" +
                menuRightLeftPadding +
                "px;" +
                "height: " +
                SnapABugChat._chatMenuButtonHeight +
                "px;" +
                "width: 100%;" +
                SnapABug.getInvisibleDivIEFixCSS()
            );
          }

          // Create the actual Chat Box Menu
          var newMenu = SnapABug.appendMenuItem(
            cbm,
            "SnapABug_minBtn",
            SnapABug.getMessage(36),
            "div",
            SnapABug.getIconCoords("minimize"),
            "SnapABugChat.minimizeToggle();"
          );
          if (newMenu) {
            SnapABug.appendMenuSplitter(cbm);
            // To avoid duplicating the splitter
          }
          SnapABug.appendMenuItem(
            cbm,
            "SnapABug_closeBtn",
            SnapABug.getMessage(37),
            "div",
            SnapABug.getIconCoords("close"),
            "SnapABug.closeForm();"
          );

          cbmBtn.appendChild(cbm);
          // The menu is a child of the button for positioning purposes.
          cbm.appendChild(cbmhh);
          // Append the invisibile hover hack div to improve UX.
        },
        appendMenuItem: function (
          chatBoxMenu,
          id,
          label,
          elemType,
          iconCoords,
          onClickFunc
        ) {
          if (document.getElementById(id) !== null) {
            return false;
            // Item already exists.
          }
          var newElem = document.createElement(elemType);
          var newElemLabel = document.createElement("span");
          var newElemIcon = document.createElement("i");

          newElem.id = id;
          newElem.className = "SnapABug_CBMItem";

          newElemIconCSS =
            "background-image: url('" +
            SnapABug.menuIconSpriteSheetURL +
            "'); background-repeat: no-repeat; background-position: " +
            iconCoords +
            ";";

          newElemLabel.innerHTML = label;

          try {
            newElem.setAttribute("onclick", onClickFunc);
            newElemIcon.setAttribute("style", newElemIconCSS);
          } catch (e) {}
          try {
            newElem.onclick = function () {
              eval(onClickFunc);
            };
            if (!newElemIcon.style) {
              newElemIcon.style.cssText = newElemIconCSS;
            }
          } catch (e) {}

          newElem.appendChild(newElemLabel);
          newElem.appendChild(newElemIcon);
          chatBoxMenu.appendChild(newElem);

          return true;
          // Is a new item.
        },
        appendMenuSplitter: function (chatBoxMenu) {
          var newElem = document.createElement("div");
          newElem.className = "SnapABug_CBMItemSplitter";
          chatBoxMenu.appendChild(newElem);
        },
        getIconCoords: function (iconType) {
          switch (iconType) {
            case "chevron-down":
              return "0 0";
            case "chevron-up":
              return "0 -20px";
            case "minimize":
              return "0 -40px";
            case "close":
              return "0 -60px";
            default:
              return "-100px -100px";
            // No icon, show nothing.
          }
        },
        hideChatBoxMenu: function () {
          var wp = document.getElementById("SnapABug_WP");
          var cbmBtn = document.getElementById("SnapABug_CBMBtn");
          // Chat Box Menu BUTTON
          if (cbmBtn) {
            wp.removeChild(cbmBtn);
            // This will be re-created if populateChatForm is called again.
          }
        },
        setRequiredMark: function (color, marker) {
          // Red * by default.
          requiredColor = color || "#FF0000";
          requiredMarker = marker || "*";
        },
        getRequiredMark: function () {
          if (requiredColor && requiredMarker) {
            return (
              '<span class="SnapABug_RequiredMark" style="color:' +
              requiredColor +
              ';">' +
              requiredMarker +
              "</span>"
            );
          } else {
            // Required marks are not enabled.
            return "";
          }
        },
        showRequiredMarks: function () {
          function alreadyHasRequiredMark(labelEl) {
            var childSpans = labelEl.getElementsByTagName("span");
            if (childSpans.length === 0) {
              return false;
              // No spans, no possibility of mark being present.
            }

            var hasRequiredMark = false;
            for (var i = 0; i < childSpans.length; i++) {
              if (
                childSpans[i].className.indexOf("SnapABug_RequiredMark") !== -1
              ) {
                hasRequiredMark = true;
                break;
              }
            }
            return hasRequiredMark;
          }

          if (requiredColor && requiredMarker) {
            // Required markers have been enabled.
            var emailLabel = document.getElementById("SnapABug_email");
            var descLabel = document.getElementById("SnapABug_desc");

            if (
              chatEmailRequired &&
              emailLabel &&
              !alreadyHasRequiredMark(emailLabel)
            ) {
              emailLabel.innerHTML += " " + SnapABug.getRequiredMark();
            }
            if (
              chatDescriptionRequired &&
              descLabel &&
              !alreadyHasRequiredMark(descLabel)
            ) {
              descLabel.innerHTML += " " + SnapABug.getRequiredMark();
            }
          }
        },
        //##INCLUDE##:sab_form.js
        isBranded: function () {
          // this method is overriden with the settings appended at the end of the widget JS when the form is unbranded
          return true;
        },
        // This is the prechat form function
        populateForm: function () {
          SnapABug.setRequiredMark();
          // Enable required markers. This func will set the marker to a red * by default.

          var width = 375;
          var height = 386;
          var emailRO = "";
          if (emailLocked) {
            emailRO = 'readonly="1" disabled="1"';
          }
          if (email == "" && SnapABugChat.getUserEmailCookie() != "") {
            email = SnapABugChat.getUserEmailCookie();
          }

          var html = // Background image
            '<div style="left:0;top:0;z-index:1;"><img src="' +
            bgURL +
            '" style="' +
            this.getCSS(0, 0, width, height) +
            '" galleryimg="no" width="' +
            width +
            '" height="' +
            height +
            '" /></div>' + // Help pop up about the screenshot - TODO: parametrize the BG color, and fix the z-index
            '<div id="SnapABug_H" style="position:absolute;left:37px;top:126px;width:200px;z-index:100000;font-family:arial,sans-serif;text-align:left;color:white;background-color:#67a8f3;border:4px solid white;padding:4px;font-size:9pt;display:none;"></div>' + // Title
            //+ '<div style="'+ this.getCSS(30,17,565,21,'font-family:"lucida grande","Helvetica Neue",Helvetica,Arial,sans-serif;font-size:20px;font-weight:500;color:#fff;text-shadow:0 -1px 0 #1860b1;') + '">'
            //+ 'Report a Problem'
            //+ '</div>'

            '<form name="SnapABug_Form" accept-charset="UTF-8" style="margin:0px;" action="#" onsubmit="return SnapABug.submitForm(false);">' + // Email label
            '<div id="SnapABug_email" style="' +
            this.getCSS(
              34,
              41,
              300,
              20,
              "font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;font-weight:600;color:#61656d;"
            ) +
            '">' +
            this.getMessage(1) +
            "</div>" + // Email input
            "<div><input " +
            emailRO +
            ' style="' +
            this.getCSS(
              58,
              67,
              276,
              17,
              'font-family:"lucida grande","Helvetica Neue",Helvetica,Arial,sans-serif;font-size:13px;color:black;',
              "background-image:url('" +
                this.getBlankImg() +
                "');background-repeat:repeat;"
            ) +
            '" type="text" id="email" name="email" value="' +
            email +
            '" size="10"/></div>' + // Description label
            '<div id="SnapABug_desc" style="' +
            this.getCSS(
              34,
              103,
              300,
              20,
              "font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;font-weight:600;color:#61656d;"
            ) +
            '">' +
            this.getMessage(2) +
            "</div>" + // Description input
            '<div><textarea name="description" style="' +
            this.getCSS(
              37,
              126,
              297,
              143,
              "font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;font-size:13px;color:black;",
              "background-image:url('" +
                this.getBlankImg() +
                "');background-repeat:repeat;resize:none;overflow:auto;"
            ) +
            '">' +
            description +
            "</textarea></div>";

          // These are used in the buttonStyle
          var bgcolortop = "#ffffff";
          var bgcolorbot = "#c7c9c7";
          var bdcolortop = "#a0a1a0";
          var borderradius = "10px";
          var textcolor = "#51555d";
          var textcolorover = "#303030";
          // Then buttonStyle is used in the submit buttons HTML below
          var buttonStyle =
            "font-weight:400;float:none;clear:none;width:auto;height:25px;margin:0 0px 0 4px;cursor:pointer;" +
            "border:1px solid " +
            bdcolortop +
            ";background-color:" +
            bgcolorbot +
            ";" +
            (this.isIE()
              ? "filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=" +
                bgcolortop +
                ",endColorstr=" +
                bgcolorbot +
                ");"
              : "background:-webkit-gradient(linear, left top, left bottom,from(" +
                bgcolortop +
                "),to(" +
                bgcolorbot +
                "));background:-moz-linear-gradient(top," +
                bgcolortop +
                "," +
                bgcolorbot +
                ");") +
            "padding:3px 5px;width:auto;overflow:visible;-webkit-border-radius:" +
            borderradius +
            ";-moz-border-radius:" +
            borderradius +
            ";border-radius:" +
            borderradius +
            ";" +
            "color:" +
            textcolor +
            ";font-size:12px;font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;text-decoration:none;vertical-align:middle;";

          var buttondynamics =
            "onmouseover=\"this.style.color='" +
            textcolorover +
            "';\" onmouseout=\"this.style.color='" +
            textcolor +
            "';\"";

          html += // Submit buttons
            '<div id="SnapABug_FormButtons" style="' +
            this.getCSS(100, 311, 232, 30) +
            ';text-align:right;">' +
            '<input id="SnapABug_OSB" onclick="return SnapABug.submitForm(false);" style="' +
            buttonStyle +
            'display:none;" type="button" value="' +
            this.getMessage(12) +
            '" ' +
            buttondynamics +
            " />" +
            '<input id="SnapABug_OCB" onclick="return SnapABug.submitForm(true);" style="' +
            buttonStyle +
            'display:none;font-weight:bold;" type="button" value="' +
            this.getMessage(13) +
            '" ' +
            buttondynamics +
            " />" +
            '<input id="SnapABug_SB" onclick="return SnapABug.submitForm(false);" style="' +
            buttonStyle +
            'font-weight:bold;" type="button" value="' +
            this.getMessage(12) +
            '" ' +
            buttondynamics +
            " />" +
            "</div>" +
            "</form>" + // Custom text - feedback link area
            '<div id="SnapABug_FormFbk" style="' +
            this.getCSS(
              35,
              349,
              298,
              18,
              "font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;color:#61656d;"
            ) +
            '"><span id="SnapABug_FormFbkT"></span> <a id="SnapABug_FormFbkL" target="_blank" href="#" style="color:#333;font-weight:bold;font-size:12px;"></a></div>';

          // Cancel click area
          var cancelWidth = 20;
          var cancelHeight = 20;
          html +=
            '<div style="' +
            this.getCSS(344, 10, cancelWidth, cancelHeight, "cursor:pointer;") +
            '" onclick="SnapABug.closeForm();" title="' +
            this.getMessage(10) +
            '"><img style="margin:0;border:none;padding:0;width:' +
            cancelWidth +
            "px;height:" +
            cancelHeight +
            'px;" src="' +
            this.getBlankImg() +
            '" width="' +
            cancelWidth +
            '" height="' +
            cancelHeight +
            '" alt="' +
            this.getMessage(10) +
            '" /></div>';

          if (this.isBranded()) {
            // SnapABug Logo:
            html += '<div style="' + this.getCSS(34, 311, 84, 24) + '">';
            if (this.logoLink()) {
              html += SnapABug.getLogoClickATag();
            }
            html +=
              '<img style="margin:0;border:none;padding:0;" src="' +
              staticBaseURL +
              '/wbg/logo.png" border="0" alt="powered by SnapEngage" width="84" height="24" />';
            if (this.logoLink()) {
              html += "</a>";
            }
            html += "</div>";
          }

          document.getElementById("SnapABug_P").innerHTML = html;

          this.sendGetWidgetConfig(false);
          SnapABug.positionDragger(0, 0, 338, 42);
          this.showForm(
            true,
            width,
            height,
            13,
            13,
            341,
            358 /* Flash protection iframe size */
          );

          this.showFeedback();

          this.updateFormButtons();

          var form = document.SnapABug_Form;
          if (form) {
            if (email == "") {
              form.email.focus();
            } else {
              form.description.focus();
            }
          }
          return false;
        },
        //setSkin : function(skinURL) {
        //  bgURL = skinURL;
        //},
        //##END##
        updateFormButtons: function () {
          if (expiredAccount) {
            if (
              document.getElementById("SnapABug_OCB") ||
              document.getElementById("SnapABug_OSB") ||
              document.getElementById("SnapABug_CL")
            ) {
              SnapABug.populateFormStatus(-2 /* Expired */);
            }
            return;
          }

          try {
            var sb = document.getElementById("SnapABug_SB");
            var osb = document.getElementById("SnapABug_OSB");
            var ocb = document.getElementById("SnapABug_OCB");
            if (agentStatus) {
              // Online mode
              if (sb) {
                sb.style.display = "none";
              }

              if (offlineAllowed) {
                if (osb) {
                  osb.style.display = "inline";
                }
              }

              if (ocb) {
                ocb.style.display = "inline";
              }
            } else {
              // Offline mode
              if (sb) {
                sb.style.display = "inline";
              }
              if (osb) {
                osb.style.display = "none";
              }
              if (ocb) {
                ocb.style.display = "none";
              }
            }
          } catch (e) {}
        },
        showFeedback: function () {
          try {
            var fbk = document.getElementById("SnapABug_FormFbk");
            if (fbk) {
              if (fbkText || fbkLinkText) {
                document.getElementById(
                  "SnapABug_FormFbkT"
                ).innerHTML = fbkText;
                document.getElementById("SnapABug_FormFbkL").href = fbkLink;
                document.getElementById(
                  "SnapABug_FormFbkL"
                ).innerHTML = fbkLinkText;
                fbk.style.display = "block";
              } else {
                fbk.style.display = "none";
              }
            }
          } catch (e) {}
        },
        populateFormStatus: function (state) {
          // States: 1- Doing CreateCase with with screen capture
          //         2- Taking screen capture or doing CreateCase without screen capture
          //         3- Doing Finalize
          //         4- Finalize completed
          //         5- (no longer used)
          //         6- Fatal error reported by callback
          //         7- Duplicate case
          //        -2- Expired widget

          if (SnapABug.isMobileEnabled() || SnapABug.isCustomDesignEnabled()) {
            if (state === 4 && chatInProgress && SnapABugChat) {
              SnapABugChat.startChat(caseId, baseURL);
            } else if (state === 6 || state === 7) {
              SnapABug.getCustomDesignUI().initErrorMessage();
            }
            return false;
          }
          var status = this.getMessage(9);
          var pb =
            '<div style="margin-top:30px;background:white;width:100%;border:none;text-align:left;"><div id="SnapABug_PB" style="background:#61656d;width:' +
            Math.round((state * 100) / 4) +
            '%;height:20px;border:none;text-align:left;"></div></div>';
          if (state == 1) {
            status = this.getMessage(6);
          } else if (state == 4) {
            status = this.getMessage(7);
          } else if (state == 5) {
            status = this.getMessage(7) + "..";
          } else if (state == 6) {
            status = this.getMessage(8);
          } else if (state == 7) {
            status = this.getMessage(11);
          } else if (state == -2) {
            status = "Sorry, this SnapEngage account is currently inactive";
          }

          if (state == 4 || state == 5) {
            if (chatInProgress && SnapABugChat) {
              SnapABugChat.startChat(caseId, baseURL);
              return false;
            }
          }

          var closeCall = "";
          var savedLogoLinkEnabled = logoLinkEnabled;
          if (
            state == 4 ||
            state == 5 ||
            state == 6 ||
            state == 7 ||
            state == -2
          ) {
            closeCall = "SnapABug.closeForm();";
            pb =
              '<div style="text-align:middle;margin-top:20px;"><input type="button" value="' +
              this.getMessage(10) +
              '" onclick="' +
              closeCall +
              '" style="float:none;clear:none;width:auto;height:28px;margin:0;padding:3px 5px 3px 5px;font-size:12px;font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;cursor:pointer;" /></div>';
          } else {
            // do not let the user click the logo in the middle of the screen capture
            logoLinkEnabled = false;
          }

          // Only show the progress status in non proactive chat start mode or in case of error
          if (
            (!(
              SnapABug.isMobileEnabled() || SnapABug.isCustomDesignEnabled()
            ) &&
              !chatInProgress &&
              callmePhone == "") ||
            status == 6 ||
            status == 7 ||
            status == -2
          ) {
            var htmlStatus =
              '<div style="margin:50px 20px;font-size:14px;font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;color:#61656d !important;">' +
              status +
              pb +
              "</div>";

            var savedChatFormPos = SnapABug.getChatFormPosition();
            SnapABug.setChatFormPosition("c");
            // center position
            SnapABugChat.populateSubChatForm(htmlStatus, closeCall);
            SnapABug.setChatFormPosition(savedChatFormPos);
          }
          logoLinkEnabled = savedLogoLinkEnabled;
        },
        updateFormStatusBar: function (
          state,
          increment /* between 0 and 0.99999 */
        ) {
          var pb = document.getElementById("SnapABug_PB");
          if (pb) {
            pb.style.width =
              Math.round((state * 100) / 4 + (increment * 100) / 4) + "%";
          }
        },
        closeForm: function (autoclosed) {
          var wasChat = chatInProgress;
          var type = "";
          var status = "";
          if (ready) {
            this.hideOverlay(false);
            if (chatInProgress) {
              SnapABugChat.closeChat(true);
              chatInProgress = false;
            } else {
              // Do this for proactive chats (and we do it too for offline, but that is a no-op)
              SnapABugChat.reInit();
            }
          }

          if (SnapABugChat && autoclosed != true) {
            SnapABugChat.setNoProactiveChatCookie();
          }

          // Reset the proactive chat state variables
          SnapABug.proactiveAgentNumber = "";
          SnapABugChat.clearProactive();

          if (SnapABugChat.isMinimized()) {
            SnapABugChat.unminimizeChat();
            // Undo all minimization stuff.
          }
          SnapABug.hideChatBoxMenu();
          this._showButton();

          if (autoclosed != true) {
            // Callback API
            if (SnapABug.getTypeOfChat() === "proactive") {
              type = "proactive";
            } else if (wasChat) {
              type = "chat";
            } else {
              type = "form";
            }

            if (agentStatus) {
              status = "online";
            } else {
              status = "offline";
            }

            SnapABug.callCallback("Close", type, status);
          }
        },
        getTypeOfChat: function () {
          if (SnapABug.isCustomDesignEnabled()) {
            return SnapABug.getCustomDesignUI().getTypeOfChat();
          } else {
            if (SnapABug._isReactiveChat) {
              return "manual";
            } else {
              return SnapABugChat.isProactive() ? "proactive" : "manual";
            }
          }
        },
        hideOverlay: function (keepClickProtection) {
          if (SnapABug.isCustomDesignEnabled()) {
            return;
          }

          if (!keepClickProtection) {
            document.getElementById("SnapABug_W").style.display = "none";
          }
          document.getElementById("SnapABug_O").style.display = "none";
          document.getElementById("SnapABug_P").style.display = "none";
          document.getElementById("SnapABug_WP").style.display = "none";

          // Force a window refresh (for webkit)
          window.scrollBy(1, 0);
          window.scrollBy(-1, 0);
        },
        submitForm: function (isOnlineForm) {
          // Validate the form items
          var form = document.SnapABug_Form;
          // FIXME: form is null on xhtml

          if (form) {
            webCapture = form.screenshot && form.screenshot.checked;
            sshot = 0;
            if (form.screenshot) {
              if (form.screenshot.checked) {
                sshot = 1;
              } else {
                sshot = 2;
              }
            }

            if (labelColor == "") {
              labelColor = document.getElementById("SnapABug_email").style
                .color;
            } else {
              document.getElementById(
                "SnapABug_email"
              ).style.color = labelColor;
              document.getElementById("SnapABug_desc").style.color = labelColor;
            }

            var error = false;
            if (cvvalRequired) {
              try {
                var a = cvvalRequired.split(",");
                for (var i = 0; i < a.length; i++) {
                  if (typeof cvval[a[i]] == "undefined" || cvval[a[i]] == "") {
                    document.getElementById("SnapABug_" + a[i]).style.color =
                      "red";
                    error = true;
                    form[a[i]].focus();
                  } else {
                    document.getElementById(
                      "SnapABug_" + a[i]
                    ).style.color = labelColor;
                  }
                }
              } catch (e) {}
            }

            // Need better error reporting...
            if (
              form.description.value == "" &&
              !(isOnlineForm && !chatDescriptionRequired)
            ) {
              document.getElementById("SnapABug_desc").style.color = "red";
              form.description.focus();
              error = true;
            }
            var regEmail = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            if (
              regEmail.test(form.email.value) == false &&
              !(isOnlineForm && !chatEmailRequired)
            ) {
              document.getElementById("SnapABug_email").style.color = "red";
              form.email.focus();
              error = true;
            }
            if (!error) {
              ready = false;
              // submission in progress...

              SnapABugChat.setUserEmailCookie(form.email.value);
              email = form.email.value;

              if (form.Name) {
                userName = form.Name.value;
              }

              // Create case and get the id and params
              if (
                !this.sendCreateCase(
                  form.email.value,
                  form.description.value,
                  isOnlineForm
                )
              ) {
                // Description was too long
                document.getElementById("SnapABug_desc").style.color = "red";
                form.description.focus();
                ready = true;
              }
            }
          }
          return false;
        },
        startChatGo: function () {
          if (agentStatus) {
            SnapABugChat.proactive(
              proactiveMsg,
              false,
              "",
              "",
              proactiveCommands
            );
          } else {
            startChatMessage = "";
            this.startLink();
          }
          startChatRequested = false;
          // back to normal flow
        },
        getStartChatRequested: function () {
          if (startChatRequested) {
            return proactiveMsg;
          }
        },
        sendClickToCall: function (phone, source /* offline:1,  chat:2 */) {
          var params = "ci=" + encodeURIComponent(dbCaseId);
          if (dbCaseId == "") {
            params = "c=" + encodeURIComponent(caseId);
          }
          params += "&p=" + encodeURIComponent(phone) + "&src=" + source;
          this.rpc(
            baseURL + "/chatjs/ServiceClickToCall?" + params,
            3,
            "sendClickToCall"
          );

          // Callback API
          this.callCallback("StartCallme", phone);
        },
        callbackClickToCall: function (status) {},
        sendGetCallConfig: function () {
          var params = "w=" + encodeURIComponent(widgetId);
          this.rpc(
            baseURL + "/chatjs/ServiceGetCallConfig?" + params,
            3,
            "sendGetCallConfig"
          );
        },
        callbackGetCallConfig: function (status) {
          if (status > 0) {
            SnapABugChat.populateCallMeForm();
          } else {
            // No agent available on the phone, so show the offline form
            startChatMessage = "";
            this.startLink();
          }
        },
        sendGetWidgetConfig: function (checkProactiveChat) {
          // due to DEV-8125, 'w' param has been sent as undefined.  We should never allow a request to be send without this.  Put a check in place.
          if (!widgetId) {
            console.error(
              "Cannot continue due to missing widgetId.  Please refresh and try again."
            );
            SnapEngage.setCallback("agentOnline", null);
            this.populateFormStatus(6);
            return false;
          }

          var params = "w=" + encodeURIComponent(widgetId);
          // TODO DEV-11317 Remove this check and associated `checkProactiveChat` code since it only applied to v1 of the proactive code that is no longer used.
          if (checkProactiveChat) {
            params += "&p=1";
          }

          params = SnapABug.appendTagsParameter(params);
          //params += 'u=' + encodeURIComponent( PUT URL HERE); // In case of very long URL, this might be truncated at 2K by rpc()
          this.rpc(
            baseURL + "/chatjs/ServiceGetConfig?" + params,
            3,
            "sendGetWidgetConfig"
          );
        },
        callbackGetWidgetConfig: function callbackGetWidgetConfig(
          widgetConfigStatus,
          linkHeaderText,
          linkText,
          linkURL,
          defSnapshot,
          snapshotB4Chat,
          chatEmailReq,
          chatDescriptionReq,
          proactiveChatDelay
        ) {
          // Enable the chat function (update the global agentStatus variable)
          agentStatus = widgetConfigStatus;

          // Set mobile options
          if (SnapABug.isMobileEnabled()) {
            SnapABug.getMobileUI().setRequiredFields(
              chatEmailReq,
              chatDescriptionReq
            );
          }

          if (widgetConfigStatus == -1) {
            // The widget does not exists, hide the button
            SnapABug._hideButton();
            if (SnapABug.isCustomDesignEnabled()) {
              this.callCallback(
                "agentOnline",
                widgetConfigStatus ? true : false
              );
              //null resetter inside CustomDesign callBack
            }
            return;
          }

          if (widgetConfigStatus == -2) {
            // The widget is of an expired account
            //SnapABug.hideButton();
            expiredAccount = true;
            logoLinkEnabled = false;
            if (
              document.getElementById("SnapABug_OCB") ||
              document.getElementById("SnapABug_OSB") ||
              document.getElementById("SnapABug_CL") ||
              startChatRequested
            ) {
              SnapABug.populateFormStatus(-2 /* Expired */);
            }
            return;
          }

          // Check if the user has been banned from chat
          if (SnapABugChat.getBannedCookie() == "1" || !chatAllowed) {
            agentStatus = 0;
            if (SnapABug.isCustomDesignEnabled()) {
              SnapABug.getCustomDesignUI().checkStatusShowButton();
            }
          }

          // Handle the async agent status API
          this.callCallback("agentOnline", widgetConfigStatus ? true : false);
          this.setCallback("agentOnline", null);
          var d = new Date();
          var now = d.getTime();
          agentStatusLastCheck = now;
          // time when last RPC was received such as we do not repeat before the set interval
          agentStatusCheckInterval = agentStatusCheckInterval * 1.1;
          // +10% such as we slow the pace if the page stays open for days

          if (
            proactiveChatDelay &&
            proactiveChatDelay > 0 &&
            !SnapABugChat.isNoProactiveChatCookie() &&
            !SnapEngage.getIsInstanceProactiveV2()
          ) {
            if (SnapABugChat.proactiveRulesTimers.proactiveTimer) {
              clearTimeout(SnapABugChat.proactiveRulesTimers.proactiveTimer);
            }
            if (proactiveChatDelay <= 15) {
              // Start proactive chat right away
              SnapABug.sendGetProactiveChatAgent();
            } else {
              proactiveChatDelay = proactiveChatDelay - 15;
              SnapABugChat.proactiveRulesTimers.proactiveTimer = setTimeout(
                "SnapABug.sendGetProactiveChatAgent(false);",
                proactiveChatDelay * 1000
              );
            }
          }

          if (!SnapABug.isCustomDesignEnabled()) {
            this.updateFormButtons();
          }

          chatEmailRequired = chatEmailReq;
          chatDescriptionRequired = chatDescriptionReq;

          SnapABug.showRequiredMarks();
          // Add '*'s (or whatever is configured) to required email and/or description fields.

          fbkText = linkHeaderText;
          fbkLink = linkURL;
          fbkLinkText = linkText;
          this.showFeedback();

          if (startChatRequested) {
            this.startChatGo();
            if (widgetConfigStatus) {
              // Only callback if we are online - in case we are offline we will go back to the pre-chat flow
              // which has the proper callback
              SnapABug.callCallback("Open", "online");

              if (visitorFirstMessage) {
                // As of 2014-07-22 : Only used by preChatSearch functionality.
                SnapABug.sendCreateCase("", visitorFirstMessage, true);
              }
              if (SnapABug.getPreChatSearchEnabled()) {
                SnapABug.resetPreChatSearch();
              }
            }
          }

          // Callback API
          if (
            callCallbackOpen &&
            document.getElementById(
              "SnapABug_OCB"
            ) /* verify the form is opened */
          ) {
            SnapABug.callCallback(
              "Open",
              widgetConfigStatus ? "online" : "offline"
            );
            callCallbackOpen = false;

            if (SnapABug.getPreChatSearchEnabled()) {
              SnapABug.resetPreChatSearch();
            }
          }
        },
        preReqestChatAgent: function () {
          // When the agent is online and the user is starting a new chat,
          // we need to know if the if the agent will be a bot or a human.
          if (!SnapABug.isChatInProgess() && agentStatus !== 0) {
            sendGetProactiveChatAgentForIsBotOnly = true;
            SnapABug.sendGetProactiveChatAgent();
          }
        },
        // This is a temporary function for us to get an approximation of the call stack.
        // only works on named functions.
        getFunctionStack: function getFunctionStack(functionCallee) {
          var functionCalls = [],
            func = functionCallee,
            funcName = "unknown",
            funcNameParts = [];

          while (func) {
            funcNameParts = func.toString().match(/function ([^\(]+)/);
            funcName =
              funcNameParts && funcNameParts.length > 0
                ? funcNameParts[1]
                : "unknown";
            if (func.arguments && func.arguments.length > 0) {
              funcName += "(";
              for (var i = 0; i < func.arguments.length; i++) {
                funcName += i !== 0 ? "," : "";
                funcName += func.arguments[i];
              }
              funcName += ")";
            }
            functionCalls.push(funcName);
            func =
              func.arguments && func.arguments.callee
                ? func.arguments.callee.caller
                : null;
          }

          return functionCalls.join("&");
        },
        sendGetProactiveChatAgent: function sendGetProactiveChatAgent(
          requireCallMe,
          ruleSetID,
          tags
        ) {
          var param;
          if (proactiveChatAllowed) {
            var params = "w=" + encodeURIComponent(widgetId);
            if (requireCallMe) {
              params += "&c=1";
            }
            if (typeof ruleSetID !== "undefined") {
              params += "&rid=" + ruleSetID;
            }
            if (tags && tags.length > 0) {
              params += "&tags=" + encodeURIComponent(tags.join());
            }
            // add debug information on the GET request when the evaluation leads to
            // an undefined ruleSetID in the proactive chat V2 mode
            if (
              typeof ruleSetID === "undefined" &&
              SnapEngage.getIsInstanceProactiveV2()
            ) {
              try {
                param =
                  "&debug=" +
                  encodeURIComponent(
                    SnapABug.getFunctionStack(arguments.callee)
                  );
                if (baseURL.length + params.length + param.length < 2000) {
                  params += param;
                } else {
                  params += "&too-many-chars";
                }
              } catch (e) {}
            }
            this.rpc(
              baseURL + "/chatjs/ServiceGetProactiveChatAgent?" + params,
              3,
              "sendGetProactiveChatAgent"
            );
          }
        },
        prepareProactiveMessage: function (message, agentName) {
          //Replace placeholder for proactive message
          var preparedMessage = message;
          preparedMessage = message.replace("{alias}", agentName);
          return preparedMessage;
        },
        callbackProactiveChatAgent: function (
          agentName,
          agentNumber,
          callMeOption,
          message,
          notify,
          avatarUrl,
          isBot
        ) {
          waitingRPCResponce = false;
          SnapABug.setChatHandledByBot(isBot);
          if (sendGetProactiveChatAgentForIsBotOnly) {
            sendGetProactiveChatAgentForIsBotOnly = false;
            return;
          }
          SnapABug.proactiveAgentNumber = agentNumber;
          if (callmePhone != "") {
            SnapABugChat.proactive(
              " ",
              false,
              agentName,
              avatarUrl,
              proactiveCommands
            );
            webCapture = false;
            // Just to be safe
            SnapABug.sendCreateCase(
              SnapABug.getUserEmail(),
              "Call-me request",
              true
            );
          } else {
            // The proactive message was already set, override the web service response
            if (proactiveMsg != "") {
              message = SnapABug.prepareProactiveMessage(
                proactiveMsg,
                agentName
              );
              proactiveNotify = true;
            }
            // Just setup the proactive chat for automatic start
            if (agentNumber != "" && message != "") {
              proactiveMsg = message;
              if (notify && notify == "1") {
                proactiveNotify = true;
              } else if (notify === "0") {
                proactiveNotify = false;
              }

              SnapABugChat.proactive(
                proactiveMsg,
                proactiveNotify,
                agentName,
                avatarUrl,
                proactiveCommands,
                minimizedProactiveChatBox
              );

              // Don't automatically hide button for mobile UI and custom design UI
              if (
                !SnapABug.isMobileEnabled() &&
                !SnapABug.isCustomDesignEnabled()
              ) {
                this._hideButton();
              }

              // remove ruleSetArray (proactive v2)
              if (ruleSetArray) {
                ruleSetArray.length = 0;
              }
            } else if (proactiveOfflineFallback) {
              this.startLink();
            }
          }

          if (callMeOption) {
            if (SnapABug.isCustomDesignEnabled()) {
              SnapABug.getCustomDesignUI().setAllowCallMe(callMeOption);
              return;
            }
            SnapABug.enableCallMe();
          } else {
            SnapABug.disableCallMe();
          }
        },
        setFromUrlOverride: function (newUrl) {
          fromUrlOverride = newUrl;
        },

        isPendingAjax: function () {
          return SnapEngage.pendingXHR;
        },

        sendXMLHttpRequest: function (requestOptions, xhrSuccess, xhrError) {
          if (!requestOptions) {
            return xhrError();
          }
          var method = requestOptions.method ? requestOptions.method : "GET";
          var requestURL = SnapABug.getBaseURL() + requestOptions.url;
          var xhrRetries = requestOptions.retries ? requestOptions.retries : 0;

          var xhr = new XMLHttpRequest();

          function makeAJAXRequest(method, requestURL, data) {
            function retry() {
              // TODO - log an error/warning if retry
              if (xhrRetries--) {
                return makeAJAXRequest(method, requestURL, data);
              }
            }

            xhr.open(method, requestURL);

            if (requestOptions.timeout) {
              xhr.timeout = requestOptions.timeout;
              // time in milliseconds before xhr.ontimeout runs retry.  We need to set this timeout after the xhr.open() to avoid conflicts in IE11/10
            }
            if (xhrRetries) {
              xhr.ontimeout = retry;
            }
            if (requestOptions.contentType) {
              xhr.setRequestHeader("Content-Type", requestOptions.contentType);
            }

            xhr.onload = function () {
              // at this point we know 'onload' means the XHR is completely loaded (readyState === 4) & we have received a response from server (200, 400, etc)
              try {
                var responseText = parseXhrJSON(this.responseText);

                // check for new API response shape
                if (responseText && responseText.statusCode) {
                  switch (responseText.statusCode) {
                    case statusCodes.SUCCESS:
                    case statusCodes.DUPLICATE:
                    case statusCodes.INVALID:
                    case statusCodes.NO_DATA:
                      return xhrSuccess(responseText);
                    case statusCodes.RETRY:
                      return retry();
                    default:
                      return xhrError && xhrError(responseText);
                  }
                } else {
                  // TODO, convert other APIs to use new response shape
                  if (this.status === 200) {
                    return xhrSuccess(this.responseText);
                  } else {
                    return xhrError && xhrError();
                  }
                }
              } catch (e) {
                return xhrError && xhrError();
              } finally {
                SnapEngage.pendingXHR = false;
                return false;
              }
            };

            xhr.onerror = function () {
              // at this point we know 'onerror' means the XHR is not able to complete & receive a server response to handle correctly.
              if (this.status === this.UNSENT) {
                xhrRetries = 0;
                console.warn(
                  "Please update your Content-Security-Policy to allow " +
                    SnapEngage.getBaseURL() +
                    " for a better experience."
                );
                // TODO send error logging with a widget ID so we know who this is that fails due to CSP.
                return xhrError(this);
              } else if (this.status !== 0 && this.getAllResponseHeaders()) {
                return retry();
              }
              SnapEngage.pendingXHR = false;
            };

            SnapEngage.pendingXHR = true;
            xhr.send(data ? data : null);
          }

          makeAJAXRequest(method, requestURL, requestOptions.visitorData);
        },

        sendCreateCase: function (createObj) {
          this._hideButton();

          var isOnlineForm = createObj.isOnlineForm;
          var address = createObj.address;
          var description = createObj.description;

          var inProgress = SnapABug.isChatInProgress();

          if (!visitorChatHistoryCookie) {
            // delete the cookies for the chat history and the user email address
            SnapABugChat.setCookie("SnapABugUserEmail", "", 0);
            SnapABugChat.deleteCookie("SnapABugUserEmail");
            SnapABugChat.setCookie("SnapABugHistory", "", 0);
            SnapABugChat.deleteCookie("SnapABugHistory");
          } else {
            var hist = SnapABugChat.getHistoryCookie();
            if (hist !== "" && historyCookieEnabled) {
              SnapABug.setCvval("__sehist", hist);
            }
          }
          // Record the chat start page title
          if (SnapABugChat.getPageTitle(false)) {
            SnapABug.setCvval("__sepaget", SnapABugChat.getPageTitle(false));
          }

          var tokens = SnapABugChat.getTokensCookies();
          if (tokens !== "") {
            SnapABug.setCvval("__setokens", tokens);
          }
          if (inProgress) {
            // we already have a chat in progress, do not allow another one to be created
            // important for customers using the sendCreateCase() API directly (undocumented)
            return false;
          }

          SnapABug.setChatInProgress(isOnlineForm);
          if (address === "") {
            if (email !== "") {
              address = email;
            } else if (SnapABugChat.getUserEmailCookie() !== "") {
              address = SnapABugChat.getUserEmailCookie();
            }
          }
          // trim the description (and will make a single space description an empty string)
          description = description.replace(/^\s+|\s+$/g, "");

          // disable the buttons to prevent user double-clicking & creating duplicate cases
          if (SnapABug.isCustomDesignEnabled()) {
            SnapABug.getCustomDesignUI().disableButton("prechat-start-chat");
            SnapABug.getCustomDesignUI().disableButton("offline-send-email");
            SnapABug.getCustomDesignUI().disableButton("intelliprechat-next");
          } else {
            SnapABug.disableButton("SnapABug_SB");
            // Email Us
            SnapABug.disableButton("SnapABug_OSB");
            // Email Us that appears with Chat With Us
            SnapABug.disableButton("SnapABug_OCB");
            // Chat With Us
          }

          // that this will become (online or offline).
          newCaseJSON = {
            approvalBotCookie: SnapABugChat.getCookie("SnapABugApproval").length
              ? true
              : false,
            // boolean
            description: description.replace(/\n/g, "<br />"),
            //string: initial visitor message
            emailAddress: address,
            // string: email@email.com
            entryPage: SnapABug.getEntryPageUrl(),
            // string: url
            from: !!fromUrlOverride ? fromUrlOverride : "",
            // string: url
            jsVariables: SnapABug.getJSVariables(),
            // string: "var1=value, var2=value"
            locale: locale,
            // string: "en"
            pageReferrer: SnapABug.getEntryPageRef(),
            // string: url
            proactiveAgentNumber: SnapABug.proactiveAgentNumber
              ? SnapABug.proactiveAgentNumber
              : proactiveAgentNumber
              ? proactiveAgentNumber
              : "",
            // string "1"
            proactiveChatPrompt: SnapABugChat.getProactiveChatPrompt(),
            // string: "a message"
            status: isOnlineForm ? "online" : "offline",
            // string: online vs offline
            tags: SnapABug.getTags(),
            // string: "spanish, gold"
            type: SnapABug.getTypeOfChat(),
            // string: manual vs proactive
            uniqueKey: Math.floor(Math.random() * 0xffffffff).toString(16),
            // number: 123
            userName: SnapABug.getUserName(),
            // string: "name"
            widgetPublicId: widgetId || "36db38bd-8855-4729-b20c-7d824244aef7",
            // string: 123-abc
          };

          var requestOptions = {
            visitorData: JSON.stringify(newCaseJSON),
            url: "/public/api/v2/cases",
            retries: 3,
            method: "POST",
            timeout: 70000,
            contentType: "application/json;charset=UTF-8",
          };

          SnapEngage.sendXMLHttpRequest(
            requestOptions,
            this.createSuccess.bind(this),
            this.createError.bind(this)
          );

          // Protect against HTML code that would break the local echo and history
          description = SnapABug.deactivateHTML(description);

          // should this IF block be async, based on the API response?
          if (isOnlineForm) {
            SnapABug.callCallback(
              "StartChat",
              address,
              description,
              SnapABug.getTypeOfChat()
            );
          } else {
            // Callback API
            SnapABug.callCallback("MessageSubmit", address, description);
          }

          if (SnapABug.getChatHandledByBot() && SnapABug.isChatInProgress()) {
            SnapABug.getCustomDesignUI()
              .chatView.getMessageView()
              .triggerAgentIsTyping(true);
          }
          return true;
        },

        createSuccess: function (responseData) {
          if (
            responseData.statusCode === statusCodes.DUPLICATE ||
            responseData.statusCode === statusCodes.INVALID
          ) {
            SnapABug.setChatInProgress(false);
            return SnapABug.getCustomDesignUI().initErrorMessage();
          }
          // if statusCodes is SUCCESS and AgentStatus is 0 (offline) then the offline message is sent to the agent
          var agentStatusIsZero = SnapEngage.getAgentStatus() === 0;
          if (agentStatusIsZero) {
            return SnapABugChat.stopPolling();
          }
          if (responseData.statusCode === statusCodes.SUCCESS) {
            caseId = responseData.data.casePublicId;
            dbCaseId = responseData.data.dbCaseId;
            SnapABug.setChatInProgress(true);
            // Report the customer interaction history
            // Updating the history cookie after the chat started
            SnapABugChat.updateHistoryCookieForLastCase(caseId);

            SnapABugChat.startChat(caseId, baseURL);
            // no need to send baseURL??

            // We need to dismiss the new proactiveInvite settings now, based on successfull callback, so that the agent proactive message appears in Hub/Portal & transcript.  Otherwise, the proactiveAgentNumber is cleared too soon.
            if (SnapABug.getCustomDesignUI().getTypeOfChat() === "proactive") {
              SnapABug.getCustomDesignUI().proactiveController.clearInvite();
            }
            SnapABugChat.startPolling();

            if (SnapABug.getCallMePhone() !== "") {
              SnapABug.sendClickToCall(SnapABug.getCallMePhone(), 2);
              SnapABug.setCallMePhone("");
            }
          }
          newCaseJSON = {};
        },

        createError: function (responseData) {
          SnapABug.getCustomDesignUI().initErrorMessage();
          newCaseJSON = {};
        },

        sendUpdateCase: function (jsVarsInCommaSeparatedString) {
          // we must be in an active chat
          if (caseId || dbCaseId) {
            // reset the variables coming from the custom form pre-chat to not send them over again
            cvval = {};
            // reset the JS variables already instrumented
            vval = "";

            jsvars = jsVarsInCommaSeparatedString;
            var params = "c=" + encodeURIComponent(caseId);
            if (dbCaseId) {
              // prefer the case Long id if available
              params = "ci=" + encodeURIComponent(dbCaseId);
            }
            // getJSVariables() does the evaluation of the variables in jsvars
            params += "&vjs=" + encodeURIComponent(this.getJSVariables());
            this.rpc(
              baseURL + "/chatjs/ServiceUpdateCase?" + params,
              3,
              "sendUpdateCase"
            );
          }
        },
        callbackUpdateCase: function callbackCheckPhone(updateOk) {
          // nothing to do
        },
        sendCheckPhone: function (phoneNumber) {
          var params =
            "w=" +
            encodeURIComponent(widgetId) +
            "&p=" +
            encodeURIComponent(phoneNumber);
          this.rpc(
            baseURL + "/chatjs/ServiceCheckPhone?" + params,
            3,
            "sendCheckPhone"
          );
        },
        callbackCheckPhone: function callbackCheckPhone(numberOk) {
          if (numberOk) {
            if (caseId || dbCaseId) {
              // We are in a chat session already
              SnapABug.sendClickToCall(callmePhone, 2 /* chat */);
            } else {
              // Find an agent with a phone number before we start the call
              this.sendGetProactiveChatAgent(true);
            }
            SnapABug.disableCallMe();
            SnapABugChat.formCallMeDone();
          } else {
            if (!SnapABug.isCustomDesignEnabled()) {
              SnapABugChat.populateCallMeForm(true, this.getCallMePhone());
            }
          }
        },
        thankYouNote: function () {
          ready = true;
          this.populateFormStatus(4);
        },
        showHelp: function () {
          try {
            h = document.getElementById("SnapABug_H");
            h.innerHTML = this.getMessage(5);
            h.style.display = "block";
          } catch (e) {}
          return false;
        },
        hideHelp: function () {
          try {
            document.getElementById("SnapABug_H").style.display = "none";
          } catch (e) {}
        },
        // ----------------------------------- Flash Version detection
        getFlashVersion: function () {
          // Following Javascript based on Flash Player Version Detection - Rev 1.6
          // Copyright(c) 2005-2006 Adobe Macromedia Software, LLC. All rights
          // reserved.
          var isIE = navigator.appVersion.indexOf("MSIE") !== -1 ? true : false;
          var isWin =
            navigator.appVersion.toLowerCase().indexOf("win") !== -1
              ? true
              : false;
          var isOpera =
            navigator.userAgent.indexOf("Opera") !== -1 ? true : false;

          function ControlVersion() {
            var version = "";
            var axo;
            try {
              axo = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");
              version = axo.GetVariable("$version");
            } catch (e) {}
            if (!version) {
              try {
                axo = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");
                version = "WIN 6,0,21,0";
                axo.AllowScriptAccess = "always";
                version = axo.GetVariable("$version");
              } catch (e) {}
            }
            if (!version) {
              try {
                axo = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");
                version = axo.GetVariable("$version");
              } catch (e) {}
            }
            if (!version) {
              try {
                axo = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");
                version = "WIN 3,0,18,0";
              } catch (e) {}
            }
            if (!version) {
              try {
                axo = new ActiveXObject("ShockwaveFlash.ShockwaveFlash");
                version = "WIN 2,0,0,11";
              } catch (e) {}
            }
            return version;
          }
          try {
            var flashVer = "none";
            if (navigator.plugins != null && navigator.plugins.length > 0) {
              if (
                navigator.plugins["Shockwave Flash 2.0"] ||
                navigator.plugins["Shockwave Flash"]
              ) {
                var swVer2 = navigator.plugins["Shockwave Flash 2.0"]
                  ? " 2.0"
                  : "";
                var flashDescription =
                  navigator.plugins["Shockwave Flash" + swVer2].description;
                var descArray = flashDescription.split(" ");
                var tempArrayMajor = descArray[2].split(".");
                var versionMajor = tempArrayMajor[0];
                var versionMinor = tempArrayMajor[1];
                var versionRevision = descArray[3];
                if (versionRevision == "") {
                  versionRevision = descArray[4];
                }
                if (versionRevision[0] == "d") {
                  versionRevision = versionRevision.substring(1);
                } else if (versionRevision[0] == "r") {
                  versionRevision = versionRevision.substring(1);
                  if (versionRevision.indexOf("d") > 0) {
                    versionRevision = versionRevision.substring(
                      0,
                      versionRevision.indexOf("d")
                    );
                  }
                }
                flashVer =
                  versionMajor + "." + versionMinor + "." + versionRevision;
              }
            } else if (
              navigator.userAgent.toLowerCase().indexOf("webtv/2.6") !== -1
            ) {
              flashVer = 4;
            } else if (
              navigator.userAgent.toLowerCase().indexOf("webtv/2.5") !== -1
            ) {
              flashVer = 3;
            } else if (
              navigator.userAgent.toLowerCase().indexOf("webtv") !== -1
            ) {
              flashVer = 2;
            } else if (isIE && isWin && !isOpera) {
              flashVer = ControlVersion();
            }
            return flashVer.replace(/,/g, ".");
          } catch (e) {
            return "none";
          }
        },
        hasFlash: function () {
          var fv = SnapABug.getFlashVersion();
          if (fv != "none" && fv != "") {
            return true;
          }
          return false;
        },
        getJSVariables: function () {
          try {
            vval = "";
            for (var item in cvval) {
              // TODO add/test: .hasOwnProperty check
              this.setVarVal(item + "=" + cvval[item]);
            }
            if (jsvars != "") {
              var a = jsvars.split(",");
              for (var i = 0; i < a.length; i++) {
                if (a[i] != "") {
                  // Eval the var only if it was not set by in the custom form variables
                  if (typeof cvval[a[i]] === "undefined") {
                    eval(
                      "if(typeof " +
                        a[i] +
                        '=== "undefined"){SnapABug.setVarVal("' +
                        a[i] +
                        '=undefined");}else{SnapABug.setVarVal("' +
                        a[i] +
                        '="+' +
                        a[i] +
                        ");};"
                    );
                  }
                }
              }
            }
            return vval;
          } catch (e) {
            return "E";
          }
        },
        setVarVal: function (v) {
          try {
            v = v.replace(/,/g, "&#44;");
            if (vval != "") {
              vval += ",";
            }
            vval += v;
          } catch (e) {}
        },
        getMessage: function (msgId) {
          // 0:btnHelp
          // 1:frmEmail
          // 2:frmDescription
          // 3:frmSnapshot
          // 4:frmSend
          // 5:frmSendDetails
          // 6:frmPreparing
          // 7:frmThankYou
          // 8:frmCannotSend
          // 9:frmUploading
          //10:frmClose
          //11:frmDupMessage
          //12:frmEmailBtn
          //13:frmChatBtn
          //14:frmChatTypeHere
          //15:frmChatMe
          //16:preChatSearchInstn1
          //17:preChatSearchInstn2
          //18:preChatSearchBtn
          //19:preChatSearchBackBtn
          //20:preChatSearchHelpBtn
          //21:chatSurveyQuestion
          //22:chatSurveyQuestionWithAgent
          //23:chatSurveyComments
          //24:chatSurveySubmitButton
          //25:chatSurveyCancelButton
          //26:chatSurveyResults
          //27:chatSurvey_0_0_text
          //28:chatSurvey_0_1_text
          //29:chatSurvey_0_2_text
          //30:chatSurvey_0_3_text
          //31:chatSurvey_0_4_text
          //32:chatSurvey_1_0_text
          //33:chatSurvey_1_1_text
          //34:chatSurvey_1_2_text
          //35:frmChatWait // Message comes from server, only here for numerical consistency.
          //36:frmChatMinimize
          //37:frmChatEndChat
          //38:callMeFromComputer
          //39:callMeOnPhone
          //40:returnToChat
          //41:callMeBtn
          //42:cancelUpload
          //43:secureDataReceived
          //44:frmAgentBusy
          //45:fromAgentSays
          //46:frmEndChatQuestion
          //47:frmEndChatMessage
          //48:frmEndChatOk
          //49:frmEndChatCancel
          //50:preChatSearchSearchBtn
          //51:preChatSearchAgainBtn
          //52:preChatSearchProceedToAgentBtn
          //53:preChatSearchNoResultsFound
          //54:preChatSearchSearchingInKnowledgebase
          //55:ds_frmEndChatEndedText
          //56:ds_fileUploadMessageText
          //57:ds_fileUploadButton
          //58:ds_frmChatIdleButtonClose
          //59:chatBye
          //60:frmChatIdleBye
          //61:ds_cobrowseRequestText
          //62:ds_cobrowseAcceptBtn
          //63:ds_cobrowseDeclineBtn
          //64:ds_cobrowseAcceptedText
          //65:ds_cobrowseDeclinedText
          //66:ds_isTyping
          //67:ds_emailTranscriptInviteMessage
          //68:ds_emailTranscriptErrorMessage
          //69:ds_emailTranscriptCancelButton
          //70:ds_emailTranscriptConfirmationButton
          //71:ds_emailTranscriptConfirmationMessage
          //72:ds_visitorActionsMenuRequestEmailTranscript
          //73:chatSurveyGracePeriod

          var loc = SnapABug.getLocale();
          var ltr = loc === "ar" || loc === "iw" ? "direction:rtl;" : "";
          SnapABug.setDirection(ltr);
          // Set direction to rtl if needed, otherwise do nothing.

          // If our messagesObj has not yet been initialized, do it.
          if (typeof SnapABug.messagesObj === "undefined") {
            SnapABug.messagesDefaultInit();
          }

          // If the message does not exist in the particular language, fall back to the 'en' message.
          var result = "";
          if (SnapABug.messagesObj[loc] && SnapABug.messagesObj[loc][msgId]) {
            result = SnapABug.messagesObj[loc][msgId];
          } else {
            result = SnapABug.messagesObj["en"][msgId]
              ? SnapABug.messagesObj["en"][msgId]
              : "Message not found. msgId: " + msgId;
          }
          return result;
        },
        messagesDefaultInit: function () {
          SnapABug.messagesObj = {
            en: {
              // Default fallback
              "0": "Help",
              // Button alt text
              "1": "Your email:",
              "2": "Your question:",
              "3": "Include a snapshot of the current page",
              "4": "Send",
              "5":
                "Send a screen shot of what I am seeing on the web page so that the support team can provide a fast answer.",
              "6":
                'Preparing for snapshot...<br /><br />Please click "Run" or "Allow" to let our applet send a snapshot of the web page to the support team.',
              "7": "Thank you,<br />Your message has been sent.",
              "8":
                "Sorry, your message couldn't be sent.<br />We are investigating the issue.<br />Please try again later.",
              "9": "Uploading...",
              "10": "Close",
              "11": "You have already submitted this case to the support team.",
              "12": "Email us",
              "13": "Chat with us",
              "14": "Type your message here and press [enter] to send...",
              "15": "me",
              "16": "How can we help?",
              "17": "Do any of these help?",
              "18": "Next",
              "19": "Back",
              "20": "None of these helped...",
              "21": "How would you rate your chat?",
              "22": "How would you rate your chat with {alias}?",
              "23": "Any comments you wish to add?",
              "24": "Submit",
              "25": "or Cancel",
              "26": "Thank you for your feedback!",
              "27": "Not helpful",
              "28": "Needs work",
              "29": "So-so",
              "30": "Helpful",
              "31": "Very helpful",
              "32": "Poor",
              "33": "Ok",
              "34": "Great",
              // '35': 'Just a moment...', // Not used in-file, comes from the server. This is here for numerical consistency.
              "36": "Minimize",
              "37": "End Chat",
              "38": "Call from my computer",
              "39": "Call me on my phone",
              "40": "Return to chat",
              "41": "Call me",
              "42": "Cancel",
              "56": "Please click the UPLOAD button below.",
              "57": "UPLOAD",
              "58": "Close",
              "59":
                "<b>Thank you for contacting us.</b><br>Chat session disconnected.",
              "60":
                "<br><b>Thank you for contacting us.</b><br>Your chat session was disconnected because it was idle for too long.",
              "61":
                "Accept Co-Browsing? Only this browser tab will be shared with {alias}.",
              "62": "ACCEPT",
              "63": "DECLINE",
              "64": "This browser tab will now be shared live with {alias}.",
              "65": "Invitation to Co-Browse declined.",
              "66": "is typing...",
              "67":
                "Enter an email address below to receive a transcript of this chat.",
              "68": "Invalid email",
              "69": "Cancel",
              "70": "Okay",
              "71":
                "A transcript will be sent to {email} at the end of this chat.",
              "72": "Request email transcript",
              "73": "Comment box will close in {X} minutes",
              // NOTE: We don't need to hardcode messages here since they come from the backend (MessagesBundle.properties)
              // However, for local development and tests, these hard-coded messages are helpful.
              // For a list of message codes and associated numbers scroll up to top of this function.
            },
          };
        },

        // PROACTIVE V2 FUNCTIONS
        prepareEventHandling: function () {
          if (document.addEventListener) {
            // DOM model event handling
            SnapABug.addEvent = function (elem, type, fn) {
              elem.addEventListener(type, fn, false);
              return fn;
            };

            SnapABug.removeEvent = function (elem, type, fn) {
              elem.removeEventListener(type, fn, false);
            };
          } else if (document.attachEvent) {
            // Handle IE
            SnapABug.addEvent = function (elem, type, fn) {
              // Enforce correct context for IE
              var bound = function () {
                return fn.apply(elem, arguments);
                // Enforce context
              };
              elem.attachEvent("on" + type, bound);
              return bound;
            };

            SnapABug.removeEvent = function (elem, type, fn) {
              elem.detachEvent("on" + type, fn);
            };
          }
        },
        sendGetProactiveGeoData: function () {
          if (!geoRPCSent) {
            geoRPCSent = true;
            var params = "w=" + encodeURIComponent(widgetId);
            this.rpc(
              baseURL + "/chatjs/servicegetproactivegeodata?" + params,
              3,
              "sendGetProactiveGeoData"
            );
          }
        },
        setProactiveChatEventListener: function (
          type,
          pageRule,
          eventIdentifier
        ) {
          if (proactiveEventListenersAdded) return;
          eventIdentifier = [eventIdentifier];
          switch (type.toLowerCase()) {
            case "scroll":
              SnapABug.addEvent(window, "scroll", function (e) {
                // var yPos = window.pageYOffset || document.documentElement.scrollyPos;
                // var height = window.innerHeight || document.documentElement.offsetHeight;
                var bottomPos =
                  (window.pageYOffset || document.documentElement.scrollyPos) +
                  (window.innerHeight || document.documentElement.offsetHeight);
                // Evaluate rule, if true send as true to evaluateProactiveRule
                if (
                  SnapABug.evaluateProactiveRule("intrule", pageRule, bottomPos)
                ) {
                  SnapABug.proactiveChatEvaluateCallback(true, eventIdentifier);
                }
              });
              break;
            case "click":
              SnapABug.addEvent(document, "click", function () {
                visitorClicks++;
                if (
                  SnapABug.evaluateProactiveRule(
                    "intrule",
                    pageRule,
                    visitorClicks
                  )
                ) {
                  SnapABug.proactiveChatEvaluateCallback(true, eventIdentifier);
                }
              });
              break;
            case "exit":
              SnapABug.addEvent(document, "mouseout", function (e) {
                e = e ? e : window.event;
                var from = e.relatedTarget || e.toElement;
                var exitY = e.pageY || e.clientY;
                if (!from || from.nodeName == "HTML") {
                  if (exitY != -1 && exitY < 150) {
                    SnapABug.proactiveChatEvaluateCallback(
                      true,
                      eventIdentifier
                    );
                  }
                }
              });
              break;
          }
        },
        prepareForRegexMatch: function (rx) {
          return rx
            .replace(/[-[\]{}()+?.,\\^$|#\s]/g, "\\$&")
            .replace(/\*+/g, ".*");
        },
        evaluateProactiveRule: function (type, ruleProperty, value) {
          switch (type.toLowerCase()) {
            case "stringrule":
              var pattern;
              switch (ruleProperty.operator.toLowerCase()) {
                case "equals":
                  pattern = new RegExp(
                    "^" +
                      SnapABug.prepareForRegexMatch(
                        decodeURIComponent(ruleProperty.value)
                      ) +
                      "$"
                  );
                  return pattern.test(value);
                case "notequals":
                  pattern = new RegExp(
                    "^" +
                      SnapABug.prepareForRegexMatch(
                        decodeURIComponent(ruleProperty.value)
                      ) +
                      "$"
                  );
                  return !pattern.test(value);
                case "contains":
                  pattern = new RegExp(
                    SnapABug.prepareForRegexMatch(
                      decodeURIComponent(ruleProperty.value)
                    )
                  );
                  return pattern.test(value);
                case "notcontains":
                  pattern = new RegExp(
                    SnapABug.prepareForRegexMatch(
                      decodeURIComponent(ruleProperty.value)
                    )
                  );
                  return !pattern.test(value);
                case "in":
                  pattern = new RegExp(
                    SnapABug.prepareForRegexMatch(decodeURIComponent(value))
                  );
                  return pattern.test(ruleProperty.value);
                case "beginswith":
                  pattern = new RegExp(
                    "^" +
                      SnapABug.prepareForRegexMatch(
                        decodeURIComponent(ruleProperty.value)
                      )
                  );
                  return pattern.test(value);
                case "endwith":
                  pattern = new RegExp(
                    SnapABug.prepareForRegexMatch(
                      decodeURIComponent(ruleProperty.value)
                    ) + "$"
                  );
                  return pattern.test(value);
                case "matchregex":
                  pattern = new RegExp(decodeURIComponent(ruleProperty.value));
                  return pattern.test(value);
              }
              break;
            case "intrule":
              switch (ruleProperty.operator.toLowerCase()) {
                case "equals":
                  return value == ruleProperty.value;
                case "notequals":
                  return value != ruleProperty.value;
                case "greater":
                  return value > ruleProperty.value;
                case "less":
                  return value < ruleProperty.value;
                case "greaterequal":
                  return value >= ruleProperty.value;
                case "lessequal":
                  return value <= ruleProperty.value;
              }
              break;
            case "boolrule":
              return (
                SnapABug.booleanToString(value) ==
                SnapABug.booleanToString(ruleProperty.value)
              );
            case "timeofdayrule":
              var toDate = new Date(ruleProperty.toEpoch);
              var fromDate = new Date(ruleProperty.fromEpoch);
              var currentDate = new Date(value);

              var inTime = false;
              var inDay = false;

              for (var i = ruleProperty.days.length; i >= 0; i--) {
                if (ruleProperty.days[i] == currentDate.getUTCDay()) {
                  inDay = true;
                }
              }

              if (!inDay) {
                // If we're not in an active day, skip processing the rest.
                return false;
              }

              if (fromDate.getUTCHours() === currentDate.getUTCHours()) {
                if (fromDate.getUTCMinutes() <= currentDate.getUTCMinutes()) {
                  inTime = true;
                }
              }

              if (currentDate.getUTCHours() === toDate.getUTCHours()) {
                if (currentDate.getUTCMinutes() <= toDate.getUTCMinutes()) {
                  inTime = true;
                }
              }

              if (inTime) {
                // If we're already inTime, skip processing the rest.
                return true;
              }

              var toHourIsTomorrow =
                toDate.getUTCHours() < fromDate.getUTCHours();

              if (toHourIsTomorrow) {
                if (fromDate.getUTCHours() < currentDate.getUTCHours()) {
                  // currentHour & fromHour are in the same day
                  inTime = true;
                } else {
                  // currentHour is smaller than fromHour
                  if (currentDate.getUTCHours() < toDate.getUTCHours()) {
                    inTime = true;
                  }
                }
              } else {
                // fromHour && toHour are within the same GMT day.
                if (
                  fromDate.getUTCHours() < currentDate.getUTCHours() &&
                  currentDate.getUTCHours() < toDate.getUTCHours()
                ) {
                  inTime = true;
                }
              }
              return inTime;
          }
        },
        booleanToString: function (boolValue) {
          // Make sure that the boolean is a string for evaluation.
          if (typeof boolValue === "boolean") {
            return boolValue.toString();
          }
          return boolValue;
        },
        getSearchParamsFromUrl: function (searchUrl) {
          // TODO Error handling & compare with server side
          var searchKeyWords = [];
          var hash;
          var searchEngines = ["google", "bing", "ask", "msn", "yahoo"];
          var searchQString = "q";
          var isSearchEngine = false;

          var i = 0;
          for (i = 0; i < searchEngines.length; i++) {
            if (searchUrl.indexOf(searchEngines[i]) !== -1) {
              isSearchEngine = true;
              if (searchEngines[i] === "yahoo") {
                searchQString = "p";
              }
            }
          }

          if (isSearchEngine) {
            var hashes = searchUrl.slice(searchUrl.indexOf("?") + 1).split("&");
            for (i = 0; i < hashes.length; i++) {
              hash = hashes[i].split("=");
              searchKeyWords.push(hash[0]);
              searchKeyWords[hash[0]] = hash[1];
            }
          }

          if (searchKeyWords[searchQString] !== undefined) {
            return decodeURIComponent(
              searchKeyWords[searchQString].replace(/\+/g, " ")
            );
          } else {
            return "";
          }
        },
        // To be able to add proactive chat V2 and at the same allow our users to call the 'openProactiveChat' api call with no parameters.
        // We had to add this part of the logic, use this method when you want to set a rule that if the 'openProactiveChat' with no parameters
        // This will be called.
        setOpenProactiveChatAPIRule: function (ruleSet) {
          if (
            openProactiveChatAPIRule === null &&
            !SnapABug.isRuleSetAgentRouted(ruleSet)
          ) {
            openProactiveChatAPIRule = ruleSet;
          }
        },
        proactiveChatRuleEvalStep1: function proactiveChatRuleEvalStep1() {
          // first pass on the proactive rules to drop all rules that are not going to be met
          // and to see if in the remaining rules we have to evaluate the country, city, states, or time
          //if (we need the country, city, states, or time)  {
          // make the RPC call (rpc call will call back evalProactiveChatStep2() when ready)
          var ruleSet,
            ruleSetType,
            ruleArray,
            rule,
            result,
            ignore,
            requireRPC = false,
            isAcceptableOpenProactiveChatAPIRule;

          currentEvaluationStep = 1;
          // In this first pass, we evaluate
          requireRPC = false;

          var ruleSetIndex = ruleSetArray.length;
          while (ruleSetIndex-- > 0) {
            ruleSet = ruleSetArray[ruleSetIndex];
            isAcceptableOpenProactiveChatAPIRule =
              SnapABug.isRuleSetAgentRouted(ruleSet) ||
              SnapABug.isRuleSetTagRouted(ruleSet)
                ? false
                : true;
            ruleSetType = ruleSet.operator;
            ruleArray = ruleSet.pageRules;
            var ruleIndex = ruleArray.length;
            ruleLoop: while (ruleIndex-- > 0) {
              rule = ruleArray[ruleIndex];
              ignore = false;
              // Evaluate first subset of rules

              switch (rule.name.toLowerCase()) {
                //
                case "pageurl":
                  result = SnapABug.proactiveUrlEvaluation(
                    rule.ruleProperty,
                    window.location.href
                  );
                  break;
                case "entryurl":
                  result = SnapABug.proactiveUrlEvaluation(
                    rule.ruleProperty,
                    SnapABug.getEntryPageUrl(true)
                  );
                  break;
                case "comingfrom":
                  result = SnapABug.proactiveUrlEvaluation(
                    rule.ruleProperty,
                    SnapABug.getEntryPageRef(true)
                  );
                  break;
                case "keywords":
                  result = SnapABug.evaluateProactiveRule(
                    "stringrule",
                    rule.ruleProperty,
                    SnapABug.getSearchParamsFromUrl(
                      SnapABug.getEntryPageRef(true)
                    )
                  );
                  break;
                case "jsvar":
                  result = SnapABug.evaluateProactiveRule(
                    "stringrule",
                    rule.ruleProperty,
                    SnapABug.getJSVarValue(rule.ruleProperty.jsVar)
                  );
                  break;
                case "newvisitor":
                  result = SnapABug.evaluateProactiveRule(
                    "boolrule",
                    rule.ruleProperty,
                    SnapABugChat.getVisitorIsFirstTimeVisiting()
                  );
                  isAcceptableOpenProactiveChatAPIRule = false;
                  break;
                case "chattedbefore":
                  result = SnapABug.evaluateProactiveRule(
                    "boolrule",
                    rule.ruleProperty,
                    SnapABugChat.getVisitorNumberOfPreviousChats() > 0
                  );
                  isAcceptableOpenProactiveChatAPIRule = false;
                  break;
                case "pagesvisited":
                  result = SnapABug.evaluateProactiveRule(
                    "intrule",
                    rule.ruleProperty,
                    SnapABugChat.getVisitorNumberOfPagesVisited()
                  );
                  break;
                // If any of
                case "lang":
                case "timeofday":
                case "country":
                case "state":
                case "city":
                case "region":
                  requireRPC = true;
                default:
                  ignore = true;
                  break;
              }
              if (!ignore) {
                if (ruleSetType === "any") {
                  if (result) {
                    if (isAcceptableOpenProactiveChatAPIRule) {
                      SnapABug.setOpenProactiveChatAPIRule(ruleSet);
                    }
                    SnapABug.openProactiveV2Chat(ruleSetIndex);
                    return;
                  }
                } else {
                  // ruleSetType == 'all'
                  if (!result) {
                    // A false result means that ruleSet have failed
                    ruleSetArray.splice(ruleSetIndex, 1);
                    break ruleLoop;
                  } else {
                    if (ruleArray.length > 1) {
                      // If rule count > 1 remove current rule from array
                      // Remove current index
                      ruleSetArray[ruleSetIndex].pageRules.splice(ruleIndex, 1);
                    } else {
                      // Execute rule (only 1 rule remained and it was true => all == true)
                      if (isAcceptableOpenProactiveChatAPIRule) {
                        SnapABug.setOpenProactiveChatAPIRule(ruleSet);
                      }
                      SnapABug.openProactiveV2Chat(ruleSetIndex);
                      return;
                    }
                  }
                }
              }
            }
          }
          // If any of the rules require RPC call then fire RPC call (callback will continue evaluation)
          if (requireRPC) {
            SnapABug.sendGetProactiveGeoData();
          } else {
            // If RPC is not necessary skip to final evaluation
            SnapABug.proactiveChatRuleEvalStep3();
          }
        },
        proactiveUrlEvaluation: function (ruleProperty, inputValue) {
          if (!inputValue || !ruleProperty) {
            return false;
          }
          var result = SnapABug.evaluateProactiveRule(
            "stringrule",
            ruleProperty,
            inputValue
          );
          // If we do a not equals we do that because we want to disable a rule if we find the correct url
          // so here we need to think about it inversely.
          // 'equals' => www.website.com compared with www.website.com/ would render a false, so we give it another try
          // adding or removing a '/' at the end.
          //
          // for not equals however we want a true response if the rule isn't equal because a true means that the rule is still acceptable
          // so
          // 'notequals' => www.website.com compared with www.website.com would give a false, we would retry with www.website.com compared with www.website.com/
          // which would give a true and it would be false, so in the case of 'notequals' rule we do  (ruleProperty.operator.toLowerCase() === 'notequals' && result)
          if (
            (ruleProperty.operator.toLowerCase() !== "notequals" && !result) ||
            (ruleProperty.operator.toLowerCase() === "notequals" && result)
          ) {
            // If result was false, do a second check by adding or removing a trailing slash
            var newInputValue = "";
            var lastCharacter = inputValue.charAt(inputValue.length - 1);
            if (lastCharacter === "/") {
              newInputValue = inputValue.substring(0, inputValue.length - 1);
            } else {
              newInputValue = inputValue + "/";
            }
            result = SnapABug.evaluateProactiveRule(
              "stringrule",
              ruleProperty,
              newInputValue
            );
          }
          return result;
        },
        callbackGetProactiveGeoData: function (
          geoCountry,
          geoRegion,
          geoCity,
          geoLocalTime,
          languages
        ) {
          // RPC Callback,
          visitorCountry = geoCountry;
          visitorRegion = geoRegion;
          visitorCity = geoCity;
          visitorLocalTime = geoLocalTime * 1000;
          // RPC send's time without msecs to be more effective.
          visitorLanguages = languages;
          SnapABug.proactiveChatRuleEvalStep2();
        },
        proactiveChatRuleEvalStep2: function proactiveChatRuleEvalStep2() {
          // here we do the 2nd pass of rule reduction
          // based on the geo and time data
          // Evaluate and reduce
          var ruleSet,
            ruleSetType,
            ruleArray,
            rule,
            result,
            ignore,
            isAcceptableOpenProactiveChatAPIRule;

          currentEvaluationStep = 2;

          var ruleSetIndex = ruleSetArray.length;
          while (ruleSetIndex-- > 0) {
            ruleSet = ruleSetArray[ruleSetIndex];
            isAcceptableOpenProactiveChatAPIRule =
              SnapABug.isRuleSetAgentRouted(ruleSet) ||
              SnapABug.isRuleSetTagRouted(ruleSet)
                ? false
                : true;
            ruleSetType = ruleSet.operator;
            ruleArray = ruleSet.pageRules;
            var ruleIndex = ruleArray.length;
            ruleLoop: while (ruleIndex-- > 0) {
              rule = ruleArray[ruleIndex];
              ignore = false;
              // Evaluate adn reduce second subset of rules

              switch (rule.name.toLowerCase()) {
                case "timeofday":
                  result = SnapABug.evaluateProactiveRule(
                    "timeofdayrule",
                    rule.ruleProperty,
                    visitorLocalTime
                  );
                  break;
                case "country":
                  result = SnapABug.evaluateProactiveRule(
                    "stringrule",
                    rule.ruleProperty,
                    visitorCountry
                  );
                  break;
                case "region":
                  result = SnapABug.evaluateProactiveRule(
                    "stringrule",
                    rule.ruleProperty,
                    visitorCountry
                  );
                  break;
                case "state":
                  result = SnapABug.evaluateProactiveRule(
                    "stringrule",
                    rule.ruleProperty,
                    visitorRegion
                  );
                  break;
                case "city":
                  result = SnapABug.evaluateProactiveRule(
                    "stringrule",
                    rule.ruleProperty,
                    visitorCity
                  );
                  break;
                case "lang":
                  result = SnapABug.evaluateProactiveRule(
                    "stringrule",
                    rule.ruleProperty,
                    visitorLanguages
                  );
                  break;
                // Ignore all other rules
                default:
                  ignore = true;
                  break;
              }
              if (!ignore) {
                if (ruleSetType === "any") {
                  if (result) {
                    if (isAcceptableOpenProactiveChatAPIRule) {
                      SnapABug.setOpenProactiveChatAPIRule(ruleSet);
                    }
                    SnapABug.openProactiveV2Chat(ruleSetIndex);
                    return;
                  }
                } else {
                  // ruleSetType == 'all'
                  if (!result) {
                    // A false result means that ruleSet have failed
                    ruleSetArray.splice(ruleSetIndex, 1);
                    break ruleLoop;
                  } else {
                    if (ruleArray.length > 1) {
                      // If rule count > 1 remove current rule from array
                      // Remove current index
                      ruleSetArray[ruleSetIndex].pageRules.splice(ruleIndex, 1);
                    } else {
                      // Execute rule (only 1 rule remained and it was true => all == true)
                      if (isAcceptableOpenProactiveChatAPIRule) {
                        SnapABug.setOpenProactiveChatAPIRule(ruleSet);
                      }
                      SnapABug.openProactiveV2Chat(ruleSetIndex);
                      return;
                    }
                  }
                }
              }
            }
          }
          SnapABug.proactiveChatRuleEvalStep3();

          // then we continue the normal flow
        },
        proactiveChatRuleEvalStep3: function () {
          var ruleSet,
            ruleArray,
            rule,
            isAcceptableOpenProactiveChatAPIRule,
            ruleSetIndex = ruleSetArray.length,
            timeSiteMap = {},
            timePageMap = {};
          function copyArray(array) {
            var copy = [];
            for (var i = 0; i < array.length; i++) {
              copy.push(array[i]);
            }
            return copy;
          }

          function addRuleToTimerMap(timerMap, rule) {
            // No events exist for this time value, create an array to contain the eventID's for this time (we do this to bundle together proactive chats that should fire at the same time)
            if (typeof timerMap[rule.ruleProperty.value] === "undefined") {
              timerMap[rule.ruleProperty.value] = [];
              // Current rule has the same time as this one so add another eventID to be evaluated at this time.
            }
            timerMap[rule.ruleProperty.value].push(rule.eventID);
          }

          if (currentEvaluationStep < 3) {
            SnapABug.prepareEventHandling();
            firstPass = true;
            currentEvaluationStep = 3;
          }

          while (ruleSetIndex-- > 0) {
            ruleSet = ruleSetArray[ruleSetIndex];

            ruleArray = ruleSet.pageRules;
            // Prepare result cache
            var ruleIndex = ruleArray.length;

            isAcceptableOpenProactiveChatAPIRule =
              SnapABug.isRuleSetAgentRouted(ruleSet) ||
              SnapABug.isRuleSetTagRouted(ruleSet)
                ? false
                : true;
            while (ruleIndex-- > 0) {
              rule = ruleArray[ruleIndex];
              // Since it's the first pass
              if (firstPass) {
                rule["eventID"] = "eventID" + ruleSetIndex + ruleIndex;
              }
              switch (rule.name.toLowerCase()) {
                // Evaluated on event trigger
                case "visitorclicks":
                  if (firstPass) {
                    SnapABug.setProactiveChatEventListener(
                      "click",
                      rule.ruleProperty,
                      rule.eventID
                    );
                    isAcceptableOpenProactiveChatAPIRule = false;
                  }
                  break;
                case "scrolldown":
                  if (firstPass) {
                    SnapABug.setProactiveChatEventListener(
                      "scroll",
                      rule.ruleProperty,
                      rule.eventID
                    );
                    isAcceptableOpenProactiveChatAPIRule = false;
                  }
                  break;
                case "visitorexits":
                  if (firstPass) {
                    SnapABug.setProactiveChatEventListener(
                      "exit",
                      rule.ruleProperty,
                      rule.eventID
                    );
                    isAcceptableOpenProactiveChatAPIRule = false;
                  }
                  break;
                // Evaluated on timer execution
                case "timesite":
                  addRuleToTimerMap(timeSiteMap, rule);
                  break;
                case "timepage":
                  addRuleToTimerMap(timePageMap, rule);
                  break;
              }
              // Rule is not eventBased, so well save it it in memory for openProactiveChat to access.
              if (
                firstPass &&
                isAcceptableOpenProactiveChatAPIRule &&
                ruleIndex === 0
              ) {
                SnapABug.setOpenProactiveChatAPIRule(ruleSet);
              }
            }
          }
          proactiveEventListenersAdded = true;
          SnapABug.executeProactiveChatEvaluationFinishedCallback();
          if (!SnapABugChat.proactiveRulesTimers.proactiveChatRules) {
            SnapABugChat.proactiveRulesTimers.proactiveChatRules = [];
          }
          for (timeSiteTimeout in timeSiteMap) {
            if (timeSiteMap.hasOwnProperty(timeSiteTimeout)) {
              var siteTimer = window.setTimeout(
                (function (eventIds) {
                  return function () {
                    SnapABug.proactiveChatEvaluateCallback(true, eventIds);
                  };
                })(copyArray(timeSiteMap[timeSiteTimeout])),
                (timeSiteTimeout - SnapABugChat.getVisitorTimeOnSite()) * 1000
              );
              SnapABugChat.proactiveRulesTimers.proactiveChatRules.push(
                siteTimer
              );
            }
          }
          for (timePageTimeout in timePageMap) {
            if (timePageMap.hasOwnProperty(timePageTimeout)) {
              var pageTimer = window.setTimeout(
                (function (eventIds) {
                  return function () {
                    SnapABug.proactiveChatEvaluateCallback(true, eventIds);
                  };
                })(copyArray(timePageMap[timePageTimeout])),
                (timePageTimeout - SnapABugChat.getVisitorTimeOnPage()) * 1000
              );
              SnapABugChat.proactiveRulesTimers.proactiveChatRules.push(
                pageTimer
              );
            }
          }
        },
        proactiveChatEvaluateCallback: function proactiveChatEvaluateCallback(
          result,
          eventIdentifier
        ) {
          var ruleSet, ruleArray, ruleSetType;
          var ruleSetIndex = ruleSetArray.length;
          while (ruleSetIndex-- > 0) {
            ruleSet = ruleSetArray[ruleSetIndex];
            ruleArray = ruleSet.pageRules;
            ruleSetType = ruleSet.operator;
            // Prepare result cache
            var ruleIndex = ruleArray.length;
            while (ruleIndex-- > 0) {
              if (
                SnapABug.isInArray(
                  ruleArray[ruleIndex].eventID,
                  eventIdentifier
                )
              ) {
                if (ruleSetType === "any") {
                  if (result) {
                    // If operator == any open proactive on first true result
                    SnapABug.openProactiveV2Chat(ruleSetIndex);
                  }
                } else {
                  // ruleSetType == 'all'
                  if (!result) {
                    // A false result means that ruleSet have failed
                    ruleSetArray.splice(ruleSetIndex, 1);
                  } else {
                    if (ruleArray.length > 1) {
                      // If rule count > 1 remove current rule from array
                      // Remove current index
                      ruleSetArray[ruleSetIndex].pageRules.splice(ruleIndex, 1);
                    } else {
                      // Execute rule (only 1 rule remained and it was true => all == true)
                      SnapABug.openProactiveV2Chat(ruleSetIndex);
                    }
                  }
                }
              }
            }
          }
        },
        openProactiveV2Chat: function openProactiveV2Chat(ruleSetIndex) {
          var ruleSet = ruleSetArray[ruleSetIndex];
          minimizedProactiveChatBox = ruleSet.minimizedChatBox;
          if (!waitingRPCResponce) {
            waitingRPCResponce = true;
            if (
              SnapABug.isRuleSetAgentRouted(ruleSet) ||
              SnapABug.isRuleSetTagRouted(ruleSet)
            ) {
              SnapABug.setRoutingList(ruleSetIndex);
              // execute with agent routing
              return SnapABug.openProactiveChatWithAgentRouting(ruleSetIndex);
            }
            // Execute without agent routing
            SnapABug.openProactiveChatDo(
              false,
              false,
              decodeURIComponent(ruleSet.message),
              ruleSet.id ? ruleSet.id : ruleSetIndex
            );
          }
        },
        isRuleSetAgentRouted: function (ruleSet) {
          if (ruleSet.advanced.agents) {
            if (
              ruleSet.advanced.agents instanceof Array &&
              ruleSet.advanced.agents.length > 0
            ) {
              return true;
            }
          }
          return false;
        },
        isRuleSetTagRouted: function (ruleSet) {
          if (ruleSet.advanced.tags) {
            if (
              ruleSet.advanced.tags instanceof Array &&
              ruleSet.advanced.tags.length > 0
            ) {
              return true;
            }
          }
          return false;
        },
        setRoutingList: function (ruleSetIndex) {
          // run isRuleSetAgentRouted on rule before running this
          var ruleSet = ruleSetArray[ruleSetIndex];
          var ruleRoutingList =
            ruleSet.advanced.agents || ruleSet.advanced.tags;
          routingList = [];
          for (var i = 0; i < ruleRoutingList.length; i++) {
            routingList.push(ruleRoutingList[i]);
          }
        },
        getRoutingList: function () {
          return routingList;
        },
        openProactiveChatWithAgentRouting: function (ruleSetIndex) {
          var ruleSet = ruleSetArray[ruleSetIndex];
          proactiveChatAgentRoutingRuleSetIndex = ruleSetIndex;
          // Check if the user has been banned from chat
          if (SnapABugChat.getBannedCookie() == "1" || !chatAllowed) {
            return;
          }

          if (!chatInProgress) {
            if (!SnapABugChat.isNoProactiveChatCookie()) {
              SnapABugChat.reInit();

              proactiveMsg = decodeURIComponent(ruleSet.message);

              if (ruleSet.botMessage) {
                proactiveMsg = decodeURIComponent(
                  decodeURIComponent(ruleSet.botMessage[0])
                );
                proactiveCommands = [ruleSet.botMessage[1]];
              }

              SnapABug.sendGetAvailableAgentList();
            }
          }
        },
        sendGetAvailableAgentList: function sendGetAvailableAgentList() {
          // first check cache
          if (
            this.getRoutingAvailabilityCache(routingAvailabilityCacheLifetime)
          ) {
            return this.handleProactiveChatRouting();
          }
          // t=1 means that we're expecing tags to be returned from the callback in the new JSON format rather
          // we'll always pass this so to keep backend compatibility with clients that don't update JS.
          var params = "w=" + encodeURIComponent(widgetId) + "&t=1";
          params = SnapABug.appendTagsParameter(params);

          this.rpc(
            baseURL + "/chatjs/servicegetallavailableagents?" + params,
            3,
            "sendGetAvailableAgentList"
          );
        },
        setRoutingAvailabilityCache: function (routingData) {
          routingAvailabilityCache = {
            timestamp: new Date().getTime(),
            data: routingData,
          };
        },
        getRoutingAvailabilityCache: function (cacheLifetime) {
          if (
            routingAvailabilityCache &&
            routingAvailabilityCache.data &&
            routingAvailabilityCache.timestamp + cacheLifetime >
              new Date().getTime()
          ) {
            return routingAvailabilityCache.data;
          }
          return null;
        },
        callbackGetAvailableAgentList: function (routingAvailabilityJSON) {
          // example json '{0:{"name":"agent1","tags":["encryptedTag_1"]},1:{"name":"agent1","tags":["encryptedTag_2"]}}'
          var routingAvailability = {};
          if (routingAvailabilityJSON) {
            routingAvailability = eval("(" + routingAvailabilityJSON + ")");
          }
          // Set cache so that for subsequent calls we can
          this.setRoutingAvailabilityCache(routingAvailability);
          this.handleProactiveChatRouting();
        },
        handleProactiveChatRouting: function handleProactiveChatRouting() {
          var tagRoutings = [];
          // Check for each routing if an agent or a tag is available
          var routingAvailabilityCache = this.getRoutingAvailabilityCache(
            routingAvailabilityCacheLifetime
          );
          if (
            routingAvailabilityCache === {} ||
            (Object.keys(routingAvailabilityCache).length === 0 &&
              routingAvailabilityCache.constructor === Object)
          ) {
            // If we have an empty response (noone is available) we'll just end execution here since nothing will be able to happen.
            // This also occurs when the agent tags "Set chat to offline" setting is turned on.
            // For example, when the website has a "spanish" tag, and the backend finds an agent
            // that does not have the "spanish" tag, we do not want a proactive message to fire with
            // that agent, we just prevent proactive from firing at all.
            return;
          }
          for (var i = 0; i < routingList.length; i++) {
            var routing = routingList[i];
            // For each agent number check name and tags
            for (var agentNumber in routingAvailabilityCache) {
              if (routingAvailabilityCache.hasOwnProperty(agentNumber)) {
                // Check if this agents name is what we're looking for
                if (routingAvailabilityCache[agentNumber].name === routing) {
                  return SnapABug.sendProactiveRoutingHashAndNumber(
                    routingAvailabilityCache[agentNumber].name,
                    agentNumber
                  );
                }
                // Check if this agents tags are what we're looking for
                if (routingAvailabilityCache[agentNumber].tags) {
                  for (
                    var j = 0;
                    j < routingAvailabilityCache[agentNumber].tags.length;
                    j++
                  ) {
                    var tag = routingAvailabilityCache[agentNumber].tags[j];
                    if (tag === routing) {
                      // Push agent tag routing data
                      tagRoutings.push(tag);
                    }
                  }
                }
              }
            }
            // Check if any tag routings are found
            if (tagRoutings.length > 0) {
              return SnapABug.sendGetProactiveChatAgent(
                false /* no call-me required */,
                proactiveChatAgentRoutingRuleSetIndex,
                tagRoutings
              );
            }
          }
          // Nothing found continue evaluating rules as we did before
          SnapABug.proactiveChatWithAgentRoutingErrorFallback();
        },
        proactiveChatWithAgentRoutingErrorFallback: function () {
          waitingRPCResponce = false;
          SnapABug.clearProactiveChatEvaluationFinishedCallback();
          if (proactiveChatAgentRoutingRuleSetIndex != -1) {
            ruleSetArray.splice(proactiveChatAgentRoutingRuleSetIndex, 1);
            proactiveChatAgentRoutingRuleSetIndex = -1;
          }
          routingAvailabilityCache = {};
          routingList = [];
          switch (currentEvaluationStep) {
            case 1:
              SnapABug.proactiveChatRuleEvalStep1();
              break;
            case 2:
              SnapABug.proactiveChatRuleEvalStep2();
              break;
            case 3:
              SnapABug.proactiveChatRuleEvalStep3();
              break;
          }
        },
        sendProactiveRoutingHashAndNumber: function (hash, nr) {
          var params = "w=" + encodeURIComponent(widgetId);
          params += "&h=" + encodeURIComponent(hash);
          params += "&nr=" + encodeURIComponent(nr);
          this.rpc(
            baseURL + "/chatjs/servicegetproactivedatafromnrhash?" + params,
            3,
            "sendProactiveRoutingHashAndNumber"
          );
          if (proactiveChatAgentRoutingRuleSetIndex != -1) {
            ruleSetArray.splice(proactiveChatAgentRoutingRuleSetIndex, 1);
          }
        },
        proactiveChatInitialize: function (proactiveRulesJSON) {
          if (!proactiveRulesJSON) {
            proactiveRulesJSON = previousProactiveRulesJSON;
          } else {
            previousProactiveRulesJSON = proactiveRulesJSON;
          }
          // proactiveChatInitialize always fires from the DynamicJSTools appended javascript,
          // before the `callbackGetWidgetConfig` settings are returned,
          // so we need to assume this widget is proactive V2 at this time.
          SnapEngage.setIsInstanceProactiveV2(true);

          if (!SnapABugChat.isNoProactiveChatCookie() && proactiveRulesJSON) {
            // Parse JSON
            var proactiveObj = JSON.parse(proactiveRulesJSON);
            ruleSetArray = proactiveObj.ruleSets.reverse();
            ruleSetArrayOperator = proactiveObj.operator;
            // Start evaluation

            if (proactiveObj.proactiveDisableTime) {
              SnapABug.setNoProactiveChatDelay(
                proactiveObj.proactiveDisableTime
              );
            }

            if (proactiveObj.newVisitorCookieLifeTime) {
              // Set visit cookie lifetime variable
              SnapABug.setVisitorCookieLifeTime(
                proactiveObj.newVisitorCookieLifeTime
              );
              // Set current coookie to new lifetime variable
              if (SnapABugChat.getVisitCookie()) {
                var cookie = SnapABugChat.getVisitCookie();
                var visitorTimeOnSiteInMinutes = Math.floor(
                  SnapABugChat.getVisitorTimeOnSite() / 60
                );
                var remainingCookieLifetime =
                  SnapABug.getVisitorCookieLifeTime() -
                  visitorTimeOnSiteInMinutes;
                // If we're getting a negative value here we assume that something has been changed,
                // i.e. the lifetime has been decreased. To avoid setting a session cookie we set it to 1
                if (remainingCookieLifetime < 0) {
                  remainingCookieLifetime = 1;
                }
                SnapABugChat.setCookie(
                  "SnapABugVisit",
                  cookie,
                  remainingCookieLifetime
                );
              }
            }

            SnapABug.proactiveChatRuleEvalStep1();
          }
        },
        getJSVarValue: function (jsVarName) {
          var evaluatedVal = this.getJSVariables();
          var jsKeyValue = evaluatedVal.split(",");
          var jsVarValue = "";
          var foundItem = jsKeyValue
            .filter(function (keyVal) {
              return keyVal.indexOf(jsVarName) >= 0;
            })[0]
            .split("=");

          if (foundItem) {
            jsVarValue = foundItem[1];
          }
          return jsVarValue;
        },
        messagesInit: function (newMessagesJSON) {
          var newMessagesObj = eval("(" + newMessagesJSON + ")");
          SnapABug.messagesObj = newMessagesObj;

          if (SnapABug.messagesObj) {
            // Overwrite the getMessage function.
            SnapABug.getMessage = function (msgId) {
              if (SnapABug.messagesObj.isSingle) {
                // Avoid problems by disabling .setLocale on isSingle messageBundles.
                SnapABug.setLocale = function () {
                  return false;
                };
              }
              var loc = SnapABug.getLocale();
              var ltr = loc === "ar" || loc === "iw" ? "direction:rtl;" : "";
              SnapABug.setDirection(ltr);
              // Set direction to rtl if needed, otherwise do nothing.

              return SnapABug.messagesObj[loc][msgId];
            };
          }
        },
        setPreChatSearchEnabled: function (enable) {
          this.enablePreChatSearch = enable;
          if (enable == true) {
            // loose equality, any truthy values
            // If we're enabling preChatSearch, also set the flag to use preChatSearch on the next `startLink` call
            this.setPreChatSearch(1);
          }
        },
        getPreChatSearchEnabled: function () {
          return this.enablePreChatSearch;
        },
        resetPreChatSearch: function () {
          preChatSearchQuestion = "";
          SnapABug.setPreChatSearch(1);
        },
        startPreChatSearch: function () {
          var preChatSearchContainer =
            '<div id="preChatSearchContainer"></div>';
          SnapEngageChat.populateSubChatForm(
            preChatSearchContainer,
            "SnapABug.closeForm();"
          );
          SnapEngage._hideButton();
          // remove the border from the surrounding div
          var cmElement = document.getElementById("SnapABug_CM");
          if (cmElement) {
            cmElement.parentNode.style.borderColor = "white";
          }

          SnapABug.preChatSearchShowSearchForm();
        },
        preChatSearchShowSearchForm: function () {
          var el_preChatSearchContainer = document.getElementById(
            "preChatSearchContainer"
          );
          var preChatSearchHTML =
            "" +
            '<div style="padding: 0px 5px 0px 5px; text-align: left;"> ' +
            "  <div id=\"preChatSearchInstructions\" style=\"padding-bottom: 10px; font-style: normal; line-height: normal; text-shadow: none; list-style: none; text-align: left; outline: none; text-indent: 0px; -moz-box-shadow: none; -webkit-box-shadow: none; font-family: 'lucida grande', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 12px; font-weight: 600; color: #61656d;\">" +
            "    " +
            SnapABug.getMessage(16) +
            "  </div> " +
            '  <div id="preChatSearchQuestionForm"> ' +
            '    <textarea id="preChatSearchQuestionTextArea" autofocus maxlength="500" style="width: 100%;resize: none; outline: none; border: 1px solid #999999 !important; box-shadow:none !important; font-family: arial,sans-serif; font-size: 12px; font-weight: normal; font-style: normal; line-height: normal; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box;"></textarea> ' +
            '    <div id="preChatSearchSubmitArea" style="padding-top: 15px; width:100%; text-align: right; ' +
            SnapABug.getDisplayInlineBlockCSS() +
            '"> ' +
            '      <a id="preChatSearchNextButton" href="#" style="color: #999; text-decoration: none; cursor: pointer; outline: none; border: 1px solid rgb(160, 161, 160); background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, from(rgb(255, 255, 255)), to(rgb(199, 201, 199))); padding: 3px 8px 3px 8px; width: auto; overflow: visible; border-radius: 10px; color: rgb(81, 85, 93); font-size: 12px; font-family: \'Helvetica Neue\', Helvetica, \'lucida grande\', Arial, sans-serif; text-decoration: none; font-weight: bold; ' +
            SnapABug.getDisplayInlineBlockCSS() +
            '">' +
            "        " +
            SnapABug.getMessage(18) +
            "      </a>" +
            "    </div> " +
            "  </div> " +
            "</div> ";
          el_preChatSearchContainer.innerHTML = preChatSearchHTML;

          var el_preChatSearchInstructions = document.getElementById(
            "preChatSearchInstructions"
          );
          var el_preChatSearchQuestionTextArea = document.getElementById(
            "preChatSearchQuestionTextArea"
          );
          var el_preChatSearchSubmitArea = document.getElementById(
            "preChatSearchSubmitArea"
          );
          var el_preChatSearchNextButton = document.getElementById(
            "preChatSearchNextButton"
          );

          el_preChatSearchNextButton.onclick = function () {
            SnapABug.preChatSearchSubmit();
            return false;
          };

          function setPreChatSearchInitialHeights() {
            var subChatContainer = document.getElementById("SnapABug_CM")
              .parentNode;

            var subChatContainerHeight = parseInt(
              subChatContainer.style.height,
              10
            );

            var headlineContainerHeight =
              el_preChatSearchInstructions.offsetHeight;
            var submitAreaContainerHeight =
              el_preChatSearchSubmitArea.offsetHeight;

            var determinedTextAreaHeight =
              subChatContainerHeight -
              headlineContainerHeight -
              submitAreaContainerHeight -
              20;
            // leave 20px of padding at bottom
            el_preChatSearchQuestionTextArea.style.height =
              determinedTextAreaHeight + "px";
          }
          setPreChatSearchInitialHeights();

          el_preChatSearchQuestionTextArea.value = preChatSearchQuestion
            ? preChatSearchQuestion
            : "";
          el_preChatSearchQuestionTextArea.focus();

          el_preChatSearchQuestionTextArea.onkeyup = function (e) {
            // run the search if the "enter" key is used
            if (e && e.keyCode == 13) {
              // add undefined check for old IE
              SnapABug.preChatSearchSubmit();
            }
          };
        },
        preChatSearchSubmit: function () {
          // disable the button on submit, to prevent user double-clicking
          SnapABug.disableButton("preChatSearchNextButton");

          var el_preChatSearchContainer = document.getElementById(
            "preChatSearchContainer"
          );
          var preChatSearchingHTML =
            "" +
            '<div id="preChatSearchSearching" style="text-align: center; display: block; line-height: 200px;">' +
            "  <img src='" +
            staticBaseURL +
            "/wbg/loading.gif'/>" +
            "</div> ";

          // Grab the question
          preChatSearchQuestion = document.getElementById(
            "preChatSearchQuestionTextArea"
          ).value;
          // Then replace content with loader while we send the RPC
          el_preChatSearchContainer.innerHTML = preChatSearchingHTML;

          var url =
            baseURL +
            "/chatjs/preChatSearch?criteria=" +
            encodeURIComponent(preChatSearchQuestion) +
            "&widget=" +
            SnapABug.getWidgetId() +
            "&locale=" +
            SnapABug.getLocale();
          SnapABug.rpc(url, 3, "preChatSearchSubmit");
        },
        callbackSearchAction: function (results) {
          if (SnapABug.isCustomDesignEnabled()) {
            SnapABug.getCustomDesignUI().intelliPrechatController.callbackSearchResults(
              results
            );
            return;
          }
          if (!results || results.length <= 0) {
            SnapABug.preChatSearchStartChat();
            return;
          }

          function setPreChatSearchResultsListHeight() {
            var subChatContainer = document.getElementById("SnapABug_CM")
              .parentNode;

            var subChatContainerHeight = parseInt(
              subChatContainer.style.height,
              10
            );

            var headlineContainerHeight = el_preChatResultsHeader.offsetHeight;
            var submitAreaContainerHeight =
              el_preChatSearchResultsSubmitArea.offsetHeight;

            var determinedTextAreaHeight =
              subChatContainerHeight -
              headlineContainerHeight -
              submitAreaContainerHeight -
              20;
            // leave 20px of padding at bottom
            el_preChatSearchSearchResults.style.height =
              determinedTextAreaHeight + "px";
          }

          var el_preChatSearchContainer = document.getElementById(
            "preChatSearchContainer"
          );
          var preChatSearchResultsHTML =
            "" +
            '<div style="padding: 0px 5px 0px 5px; text-align: left;"> ' +
            "  <div id=\"preChatResultsHeader\" style=\"padding-bottom: 10px; font-style: normal; line-height: normal; text-shadow: none; list-style: none; text-align: left; outline: none; text-indent: 0px; -moz-box-shadow: none; -webkit-box-shadow: none; font-family: 'lucida grande', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 12px; font-weight: 600; color: #61656d;\">" +
            "    " +
            SnapABug.getMessage(17) +
            "  </div>" +
            '  <div id="preChatSearchResultsForm"> ' +
            '    <div id="preChatSearchSearchResults" style="outline: 1px solid #dddddd; overflow-y: scroll; overflow-x: hidden;"></div> ' +
            "  </div> " +
            '  <div id="preChatSearchResultsSubmitArea" style="width:100%;"> ' +
            '    <div style="padding-top: 15px; text-align: left; ' +
            SnapABug.getDisplayInlineBlockCSS() +
            '"> ' +
            '      <a id="preChatSearchBackButton" href="#" style="color: #999; text-decoration: none; height: 1.5em;">' +
            "        " +
            SnapABug.getMessage(19) +
            "      </a>" +
            "    </div> " +
            '    <div style="padding-top: 10px; float: right; ' +
            SnapABug.getDisplayInlineBlockCSS() +
            '"> ' +
            '      <a id="preChatSearchHelpButton" href="#" style="color: #999; text-decoration: none; cursor: pointer; outline: none; border: 1px solid rgb(160, 161, 160); background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, from(rgb(255, 255, 255)), to(rgb(199, 201, 199))); padding: 3px 8px 3px 8px; width: auto; overflow: visible; border-radius: 10px; color: rgb(81, 85, 93); font-size: 12px; font-family: \'Helvetica Neue\', Helvetica, \'lucida grande\', Arial, sans-serif; text-decoration: none; font-weight: bold; ' +
            SnapABug.getDisplayInlineBlockCSS() +
            '">' +
            "        " +
            SnapABug.getMessage(20) +
            "      </a>" +
            "    </div> " +
            "  </div> " +
            "</div> ";
          el_preChatSearchContainer.innerHTML = preChatSearchResultsHTML;

          var el_preChatResultsHeader = document.getElementById(
            "preChatResultsHeader"
          );
          var el_preChatSearchSearchResults = document.getElementById(
            "preChatSearchSearchResults"
          );
          var el_preChatSearchResultsSubmitArea = document.getElementById(
            "preChatSearchResultsSubmitArea"
          );
          var el_preChatSearchBackButton = document.getElementById(
            "preChatSearchBackButton"
          );
          var el_preChatSearchHelpButton = document.getElementById(
            "preChatSearchHelpButton"
          );

          el_preChatSearchBackButton.onclick = function () {
            SnapABug.preChatSearchShowSearchForm();
            return false;
          };

          el_preChatSearchHelpButton.onclick = function () {
            SnapABug.preChatSearchStartChat();
            return false;
          };

          var searchResultsList =
            '<ul style="list-style-type: none; padding: 0; margin: 0px;">';
          for (var i = 0; i < results.length; i += 1) {
            searchResultsList =
              searchResultsList +
              "<li>" +
              '  <div style="white-space: nowrap; padding: 5px; cursor: pointer;" onclick="window.open(\'' +
              results[i].link +
              "', '_blank');\" onmouseover=\"this.style.backgroundColor='#e0ecfd';\" onmouseout=\"this.style.backgroundColor='white';\" style=\"background-color: white;\"> " +
              '    <img style="padding-right: 3px;" height="12" width="12" src="' +
              baseURL +
              '/img/document.png"/>' +
              "    <span style=\"font-family: 'lucida grande', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 12px; font-weight: bold; text-overflow: ellipsis;\">" +
              '      <a target="_blank" style="color: #5d7584; text-decoration: none;" href="' +
              results[i].link +
              '">' +
              results[i].title +
              "</a>" +
              "    </span>" +
              "    <div style=\"font-family: 'lucida grande', 'Helvetica Neue', Helvetica, Arial,sans-serif; font-size: 11px; white-space: normal; line-height: normal;\">" +
              results[i].summary +
              "</div>" +
              "  </div>" +
              '  <div style="padding-top: 3px; border-bottom: 1px solid #d0d0d0; margin-bottom:' +
              (i !== results.length - 1 ? "3px" : "none") +
              ';"></div>' +
              "</li>";
          }
          searchResultsList = searchResultsList + "</ul>";
          el_preChatSearchSearchResults.innerHTML = searchResultsList;

          setPreChatSearchResultsListHeight();
        },
        preChatSearchStartChat: function () {
          // disable pre chat search make sure we don't get caught in a loop
          SnapABug.setPreChatSearch(0);

          // show the (non-intelligent) pre-chat form if it has been enabled
          if (startChatMessage == "") {
            var posit = [-1, -1, -1, -1];
            // left, right, top, bottom

            if (SnapABug.formPosX && SnapABug.formPosY) {
              // Form has been already moved, reuse the same position
              posit[0] = SnapABug.formPosX;
              posit[2] = SnapABug.formPosY;
            } else {
              posit = SnapABug.getDefaultChatPosition();
            }

            SnapABug.setDescription(preChatSearchQuestion);
            SnapABug.loadForm();
            SnapABug.positionForm(posit[0], posit[1], posit[2], posit[3]);
          } else {
            // populate the question if one has been asked, this needs to be done before the chat is started
            if (preChatSearchQuestion) {
              SnapABug.setDescription(preChatSearchQuestion);
              SnapABug.setStartChat(preChatSearchQuestion);
            }

            visitorFirstMessage = preChatSearchQuestion
              ? preChatSearchQuestion
              : "n/a";
            SnapEngage.startChat(preChatSearchQuestion, true);
          }
        },
        deactivateHTML: function (text) {
          return text
            .replace(/>/g, "&gt;")
            .replace(/</g, "&lt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#x27;");
        },
        removeHTMLTags: function (text) {
          return text.replace(/<[^>]*>/g, " ").replace(/\s{2,}/g, " ");
        },
        setJSVariables: function (jsVars) {
          jsvars = jsVars;
        },
        /*
    MARKED AS DEPRECATED APIs:
    */
        setSecureConnection: function () {
          return;
        },
        setSecureConnexion: function () {
          return;
        },
      };
    })();

    window.SnapABugChat = (function () {
      var caseId = "";
      var baseURL = "";
      var timer = null;
      // The JavaScript timer used for the message polling
      var proactiveRulesTimers = {};
      var pollCount = 0;
      var totalPollCount = 0;
      var lastTypedText = "";
      var _useStaticAgentName = false;
      // Set a boolean. Checking for the element is insufficient.
      var _useStaticAgentAvatar = false;
      // Set a boolean. Checking for the element is insufficient.
      var nickname = "";
      var prevNickname = "";
      var avatarURL = "";
      var botButtonOptions = "";
      var prevAvatarURL = "";
      var prevMsgFrom = "";
      // Used to track from who was the previous message
      var readonly = false;
      var webCapInProgress = false;
      var history = "";
      var userInput = "";
      var introMsg = true;
      var customIntroMsg = "";
      var question = "";
      // Initial question coming from the SnapABug form
      var questionKeptForCanceledChat = "";
      // Initial question coming from the SnapABug form, kept in case the user cancel the chat
      var chatview = "";
      // Random id to detect multiple browser windows opened
      // on the same chat session
      var pollId = 0;
      var chatAnswered = false;
      // has the chat been answered by the agent yet
      var transcriptAgentCSS = "color:#75A7fE;";
      var transcriptVisitorCSS = "color:#A1A1A3;";
      var transcriptTextCSS = "color:black;";
      var transcriptPadding = 7;

      var minimized;
      // Helper boolean, undefined when minimize has not been initiated.
      var minimizedDimensions = [0, 0, 0, 0];
      // [left, top, width, height] // stored as *int*s
      var _chatMenuButtonHeight;

      var _isFirstInit = true;
      // Flag for edge case positioning bug.

      //##INCLUDE##:sabchat_vars.js
      var bgURL = SnapABug.getStaticBaseURL() + "/wbg/snapengage_chat_form.png";
      //transcriptAgentCSS = 'color:#75A7fE;';
      //transcriptVisitorCSS = 'color:#A1A1A3;';
      //transcriptTextCSS = 'color:black;';
      //##END##
      //##INCLUDE##:sabsubchat_vars.js
      var bgCallMeURL =
        SnapABug.getStaticBaseURL() + "/wbg/snapengage_chat_form.png";
      //##END##
      var pageTitle = document.title;

      var proactiveMsg = "";
      // Message to displayed when the chat form is displayed in the proactive mode
      var proactiveCommands = [];

      var msgIdLst = null;

      var postChatIframeURL = "";
      // custom survey to be iframized in the post chat window
      var postChatHTML = "";
      // Html content to show in the chat form when the chat is closed
      var proactiveMessageBuffer = "";
      // Used to store incoming messages before a case is created
      var pageInitTime = +new Date();

      var reassignDelay;
      var reassignmentTimerId;
      var approvedDate;

      var secureCookies = false;
      // Setting to set the cookies to be https only (only for customers having all web properties on https)

      // PostChat Survey
      var chatAgentSurvey = null;
      var surveyGracePeriod = -1;
      var selectedAgentSurveyRating = null;

      // File upload
      var fileUploadInProgress = false;

      // Secure data transfer
      var secureDataTransferInProgress = false;

      var WAGTTimeout;

      // Approval Bot specific variables
      var isApprovalBotChat = false;
      var isHumanResponded = false;

      var typingDiv;

      var SYSTEM_COMMANDS = {
        AUTO_TRANSLATE: "TRSL",
      };

      return {
        // start
        // caseID setter & getter
        // for now used for testing purposes, but can be used in future PRs
        setCaseId: function (id) {
          caseId = id;
        },
        // end
        getCaseId: function () {
          return caseId;
        },
        proactiveRulesTimers: proactiveRulesTimers,
        resetPageInitTime: function () {
          pageInitTime = +new Date();
        },
        reInitProactiveRules: function () {
          SnapABugChat.resetPageInitTime();

          Object.keys(proactiveRulesTimers).forEach(function (key) {
            if (Array.isArray(proactiveRulesTimers[key])) {
              proactiveRulesTimers[key].forEach(function (rulesTimer) {
                clearTimeout(rulesTimer);
                delete proactiveRulesTimers[key][rulesTimer];
              });
              return;
            }
            clearTimeout(proactiveRulesTimers[key]);
            delete proactiveRulesTimers[key];
          });
          SnapABug.proactiveChatInitialize();
        },
        //end
        startChat: function (cid, burl) {
          this.initChat(cid, burl);
        },
        restartChat: function (cid, burl) {
          introMsg = false;
          this.initChat(cid, burl);
          if (SnapABug.getPageChangeNotificationAllowed()) {
            this.sendChatMessage(7 /* new page URL */, window.location.href);
          } else {
            this.sendChatMessage(
              7 /* new page URL */,
              "" /* no URL passed, only get the history */
            );
          }
          this.setReadOnly(false);
          this.setPreviousChatWindowState();
          // If the chat was prev. minimized, it should still be so after page change.
          this.startPolling();

          if (!SnapABugChat.isMinimized()) {
            // Only set the focus if the chat is not minimized!
            var form = document.SnapABug_Form;
            if (form) {
              form.chat.focus();
              // Set focus on chat input area on restart.
            }
          }
        },
        getProactiveChatPrompt: function () {
          return proactiveMessageBuffer;
        },

        preloadChatFormImg: function () {
          if (
            !(SnapABug.isMobileEnabled() || SnapABug.isCustomDesignEnabled())
          ) {
            var bg = new Image();
            bg.src = bgURL;
          }
        },
        getNickname: function () {
          return nickname;
        },
        setIsApprovalBotChat: function (approvalBotChat) {
          isApprovalBotChat = approvalBotChat;
        },
        getIsApprovalBotChat: function () {
          return isApprovalBotChat;
        },
        setIsHumanResponded: function (humanResponded) {
          // Now that we are sending messages from the backend from bots rather than human agents,
          // we need to know when a chat has been responded to by a human rather than just a bot.
          isHumanResponded = humanResponded;
        },
        getIsHumanResponded: function () {
          return isHumanResponded;
        },
        proactive: function (
          msg,
          notify,
          agent,
          avatar,
          proactiveCommands,
          minimizedProactiveChatBox
        ) {
          if (SnapEngage.isIE11()) {
            // Disable minimized proactive view feature on IE11
            minimizedProactiveChatBox = false;
          }
          if (SnapABug.isMobileEnabled()) {
            SnapABug.getMobileUI().proactive(
              msg,
              notify,
              agent,
              avatar,
              proactiveCommands
            );
            proactiveMessageBuffer = msg;
          } else if (SnapABug.isCustomDesignEnabled()) {
            SnapABug.getCustomDesignUI().proactive(
              msg,
              agent,
              avatar,
              proactiveCommands,
              minimizedProactiveChatBox
            );
            proactiveMessageBuffer = msg;
            nickname = agent;
            if (notify) {
              this.newMessageNotification();
            }
          } else {
            baseURL = SnapABug.getBaseURL();
            avatarURL = avatar;
            // Proactive chat only starts if no real chat is in progress
            if (caseId == "") {
              // Order is important here:
              // 1. Show form. (Which sets static avatar / name booleans.)
              // 2. Determine proactive message.
              // 3. Add proactive message to history.
              // 4. Run `SnapABugChat.displayHistory()`
              // 5. Animate the form slideIn.

              nickname = agent;
              this.showFormChat();
              if (msg != " ") {
                if (msg.substr(0, 6) == "/info ") {
                  proactiveMsg = msg.substr(6);
                } else {
                  if (avatar) {
                    // set the avatarURL again as it may have been unset when used for the transcript line creation
                    // in showFormChat() --> displayHistory() --> createTranscriptLine
                    avatarURL = avatar;
                  }
                  proactiveMsg = this.createTranscriptLine(agent, msg);
                  proactiveMessageBuffer = msg;
                }
              } else {
                proactiveMsg = " ";
              }
              history = proactiveMsg;
              SnapABugChat.displayHistory();
              SnapABug.slideFormIn();
              if (notify) {
                this.newMessageNotification();
              }
              this.setReadOnly(false);

              // Callback API
              if (agent != "") {
                // A proactive should have an agent name, else we are using the proactive path for the startChat()
                SnapABug.callCallback("OpenProactive", agent, msg);
              }
              // Start the timer that will close the proactive chat window if no activity for 2 mins
              SnapABug.setProactiveChatAutocloseTimeout();
            }
          }
        },
        chatStarting: function () {
          if (
            !document.getElementById("SnapABug_CL") &&
            !(SnapABug.isMobileEnabled() || SnapABug.isCustomDesignEnabled())
          ) {
            // To show the chat form while the RPCs are creating the case and chat (only if not already shown)
            baseURL = SnapABug.getBaseURL();
            this.showFormChat();
            this.setReadOnly(true);
          }
        },
        setSecureCookies: function () {
          secureCookies = true;
        },
        // ---------- Local functions ----------
        initChat: function (cid, burl) {
          caseId = cid;
          baseURL = burl;
          pollCount = 0;
          pollId = 0;
          nickname = "";
          readonly = false;
          webCapInProgress = false;
          chatAnswered = false;
          //history = '';  // Should not need to reset history here, done on reInit() instead
          //prevMsgFrom = '';
          msgIdLst = {};

          var form = document.SnapABug_Form;
          if (form && form.chat) {
            userInput = form.chat.value;
          } else {
            userInput = "";
          }

          if (history == "" && proactiveMsg != "") {
            history = proactiveMsg;
          }
          proactiveMsg = "";
          // Turn the proactive mode off
          SnapABug.disableCallMe();
          // Turn the call me mode off
          this.setCaseIdCookie();
          this.setChatViewCookie();

          if (
            !(SnapABug.isMobileEnabled() || SnapABug.isCustomDesignEnabled())
          ) {
            this.showFormChat();
          }
        },
        setCustomIntroMsg: function (msg) {
          customIntroMsg = msg;
        },
        isFirstInit: function () {
          return _isFirstInit;
        },
        reInit: function () {
          // Things to do when a chat has been closed to prepare for another chat session
          _isFirstInit = false;
          avatarURL = "";
          prevAvatarURL = "";
          prevNickname = "";
          proactiveMessageBuffer = "";
          history = "";
          prevMsgFrom = "";
          this.setReadOnly(true);
          if (window.clearChatReassignmentTimer) {
            window.clearChatReassignmentTimer();
          }
          approvedDate = undefined;
          if (!SnapABug.isCustomDesignEnabled()) {
            SnapABug.formPosY = -1;
            SnapABug.formPosX = -1;
          }

          // Clear all positioning, newmessagecount, minimized state, etc.
          // Let these things be re-established on the next chat.
          SnapABugChat.resetChatWindowCookieData();

          // Reset Approval Bot specific variables
          SnapABugChat.setIsApprovalBotChat(false);
          SnapABugChat.setIsHumanResponded(false);
        },
        isProactive: function () {
          return proactiveMsg != "";
        },
        clearProactive: function () {
          proactiveMsg = "";
          proactiveCommands = [];
          SnapEngage.proactiveAgentNumber = "";
          SnapABug.clearProactiveChatAutocloseTimeout();
        },
        formatRpcUrl: function (rpcURL) {
          var formatedRpcUrl = snapEngageUtils.formatRpcUrl(rpcURL);
          return formatedRpcUrl;
        },
        setReassignmentTimerAfterRestartChat: function (interval) {
          window.setChatReassignmentTimer(interval);
        },
        isAgentTyping: function () {
          var isTypingElement = SnapABug.getCustomDesignUI().chatView.messageView.iframe.getElementById(
            "agent-is-typing"
          );
          return !!isTypingElement;
        },
        callAssignNewAgent: function () {
          window.requestChatReassignment(SnapABugChat.isAgentTyping());
        },
        callbackAssignNewAgent: function (isAssigned) {
          if (isAssigned) {
            window.clearChatReassignmentTimer();
          }
        },
        soundNotificationDiv: function () {
          return "";
        },
        //##INCLUDE##:sabchat_form.js
        populateChatForm: function () {
          var width = 350;
          var height = 370;

          // // Minimize area init: Minimize message notification init.
          // var fontStack = 'font-family: lucida grande, Helvetica Neue, Helvetica, Arial, sans-serif; ';
          // var chatFontStack = 'font-family: Arial, sans-serif; ';
          // SnapABug.initChatBoxMenuButton(310, 17, 25, 20, 'black', 'white', 'border-top-right-radius:10px; border-bottom-right-radius: 10px;', ''); // (left, top, width, height, iconColor, backgroundColor, extraCss, spritesheetURL) {
          // SnapABug.initChatBoxMenu('', 'white', 'black', '', '', ''); //(menuWidth, backgroundColor, textColor, highlightColor, extraCss, spritesheetURL) {
          // SnapABug.initMinimizeArea(0, 0, 370, 37); // Dimension array is the same as getCSS (left, top, width, height)
          // SnapABug.initMinimizeNotification(10, 10, 20, 20, '', 40, '', '', fontStack); //(left, top, width, height, textSize, borderRadius, backgroundColor, textColor, extraCss)

          // Set true to use static name / avatar location on chat form
          // SnapABugChat.setUseStaticAgentName(true); // *If true: Don't forget to add an <div id="SnapABug_AName"/> to the form HTML!
          // SnapABugChat.setUseStaticAgentAvatar(true); // *If true: Don't forget to add an <img id="SnapABug_AAvatar"/> to the form HTML!

          var html = // Background image
            '<div style="left:0;top:0;z-index:1;"><img src="' +
            bgURL +
            '" style="' +
            SnapABug.getCSS(0, 0, width, height) +
            '" galleryimg="no" width="' +
            width +
            '" height="' +
            height +
            '" /></div>' + // Uncomment to TEST static agent name / avatar (Note: These are ugly on this form. ONLY FOR TESTOING)
            // + '<div id="SnapABug_AAvatarContainer" style="' + SnapABug.getCSS(0,0,53,53) + '">'
            // + '  <img id="SnapABug_AAvatar" />'
            // + '</div>'
            // + '<div id="SnapABug_AName" style="' + SnapABug.getCSS(58,18,100,25) + '"></div>'

            // Chat transcript area
            '<div id="SnapABug_CL" style="' +
            SnapABug.getCSS(
              37,
              38,
              265 - transcriptPadding,
              228,
              "background:none;font-family:arial,sans-serif;font-size:12px;font-weight:normal;color:black;",
              "overflow:auto;margin-left:" + transcriptPadding + "px;"
            ) +
            '"></div>' +
            '<form name="SnapABug_Form" accept-charset="UTF-8" action="#" onsubmit="return SnapABugChat.submitChat();">' + // Chat input area
            '<textarea id="SnapABug_CE" style="' +
            SnapABug.getCSS(
              39,
              280,
              262,
              46,
              "font-family:arial,sans-serif;font-size:12px;font-weight:normal;color:black;",
              "vertical-align:top;resize:none;background-image:url('" +
                SnapABug.getBlankImg() +
                "');background-repeat:repeat;overflow:auto;"
            ) +
            '" type="text" name="chat" onkeydown="return SnapABugChat.keyDownHandler(event);" onclick="return SnapABugChat.keyDownHandler(event);"></textarea>' +
            "</form>";

          // Cancel click area
          var cancelWidth = 23;
          var cancelHeight = 23;
          html +=
            '<div style="' +
            SnapABug.getCSS(
              311,
              15,
              cancelWidth,
              cancelHeight,
              "cursor:pointer;"
            ) +
            '" onclick="SnapABug.closeForm();" title="' +
            SnapABug.getMessage(10) +
            '"><img style="margin:0;border:none;padding:0;width:' +
            cancelWidth +
            "px;height:" +
            cancelHeight +
            'px;" src="' +
            SnapABug.getBlankImg() +
            '" width="' +
            cancelWidth +
            '" height="' +
            cancelHeight +
            '" alt="' +
            SnapABug.getMessage(10) +
            '" /></div>' + // Sound notification
            this.soundNotificationDiv();

          if (SnapABug.isBranded()) {
            // Vertical SnapEngage Logo:
            html += '<div style="' + SnapABug.getCSS(305, 128, 16, 138) + '">';
            if (SnapABug.logoLink()) {
              html += SnapABug.getLogoClickATag();
            }
            html +=
              '<img style="margin:0;border:none;padding:0;" src="' +
              SnapABug.getStaticBaseURL() +
              '/wbg/logo_chat_vertical.png" border="0" alt="powered by SnapEngage" width="16" height="138" />';
            if (SnapABug.logoLink()) {
              html += "</a>";
            }
            html += "</div>";
          }

          // SnapABug Call Me Now button site:
          html +=
            '<div id="SnapABug_CallMe" style="' +
            SnapABug.getCSS(36, 332, 78, 16) +
            '">' +
            SnapABug.getCallMeButton() +
            "</div>";

          document.getElementById("SnapABug_P").innerHTML = html;
          SnapABug.positionDragger(25, 16, 282, 21);
          SnapABug.showForm(
            false,
            width,
            height,
            19,
            18,
            304,
            331 /* Flash protection iframe size */
          );
        },
        //setSkin : function(skinURL) {
        //  bgURL = skinURL;
        //  if (caseId) {
        //    this.showFormChat();
        //  }
        //},
        //##END##
        //##INCLUDE##:sabsubchat_form.js
        populateSubChatForm: function (content, closeButtonCode) {
          var width = 350;
          var height = 370;
          var bgcolor = "white";
          var bordercolor = "#8e8e8e";

          var html = // Background image
            '<div style="left:0;top:0;z-index:1;"><img src="' +
            bgCallMeURL +
            '" style="' +
            SnapABug.getCSS(0, 0, width, height) +
            '" galleryimg="no" width="' +
            width +
            '" height="' +
            height +
            '" /></div>' + // Main container, not IDed; if you need to access, find SnapABug_CM and go to parentNode
            '<div style="' +
            SnapABug.getCSS(
              36,
              37,
              266,
              290,
              "z-index:2;background-color:" +
                bgcolor +
                ";font-family:arial,sans-serif;font-size:12px;font-weight:normal;color:black;overflow:hidden;border:1px solid " +
                bordercolor +
                ";text-align:center;"
            ) +
            '">' +
            '<div id="SnapABug_CM" style="position:relative;text-align:center;">' +
            content + // End the main container
            "</div></div>";

          // Cancel click area
          var cancelWidth = 23;
          var cancelHeight = 23;
          if (closeButtonCode) {
            html +=
              '<div style="' +
              SnapABug.getCSS(
                311,
                15,
                cancelWidth,
                cancelHeight,
                "cursor:pointer;"
              ) +
              '" onclick="' +
              closeButtonCode +
              '" title="' +
              SnapABug.getMessage(10) +
              '"><img style="margin:0;border:none;padding:0;width:' +
              cancelWidth +
              "px;height:" +
              cancelHeight +
              'px;" src="' +
              SnapABug.getBlankImg() +
              '" width="' +
              cancelWidth +
              '" height="' +
              cancelHeight +
              '" alt="' +
              SnapABug.getMessage(10) +
              '" /></div>';
          }

          // Sound notification to receive messages while the call-me form is up
          html += this.soundNotificationDiv();

          if (SnapABug.isBranded()) {
            // Vertical SnapEngage Logo:
            html += '<div style="' + SnapABug.getCSS(305, 128, 16, 138) + '">';
            if (SnapABug.logoLink()) {
              html += SnapABug.getLogoClickATag();
            }
            html +=
              '<img style="margin:0;border:none;padding:0;" src="' +
              SnapABug.getStaticBaseURL() +
              '/wbg/logo_chat_vertical.png" border="0" alt="powered by SnapEngage" width="16" height="138" />';
            if (SnapABug.logoLink()) {
              html += "</a>";
            }
            html += "</div>";
          }

          document.getElementById("SnapABug_P").innerHTML = html;
          SnapABug.positionDragger(25, 16, 282, 21);
          SnapABug.showForm(
            false,
            width,
            height,
            19,
            18,
            304,
            331 /* Flash protection iframe size */
          );
        },
        //setSkinSubChat : function(skinURL) {
        //  bgCallMeURL = skinURL;
        //},
        //##END##
        populateCallMeForm: function (showPhoneForm, phoneNumber) {
          var btnWidth;
          var formInputWidth;

          // Dynamically get the width of the transcript area
          if (document.getElementById("SnapABug_CL")) {
            btnWidth = SnapABugChat.getChatTranscriptWidth() + "px";
            formInputWidth =
              Math.round(SnapABugChat.getChatTranscriptWidth() * 0.75) + "px";
          } else if (document.getElementById("SnapABug_CM")) {
            btnWidth = SnapABugChat.getPostChatWidth() + "px";
            formInputWidth =
              Math.round(SnapABugChat.getPostChatWidth() * 0.75) + "px";
          } else {
            // Fallback to original non-dynamic widths
            btnWidth = "230px";
            formInputWidth = "172px";
          }

          var textcolor = "#4d4d4d";
          var textcolorOver = "#FFFFFF";

          var btnCallPhoneSrc =
            SnapABug.getStaticBaseURL() + "/wbg/callme_phone_grey.png";
          var btnCallPhoneOverSrc =
            SnapABug.getStaticBaseURL() + "/wbg/callme_phone_black.png";
          var btnCallWebSrc =
            SnapABug.getStaticBaseURL() + "/wbg/callme_web_grey.png";
          var btnCallWebOverSrc =
            SnapABug.getStaticBaseURL() + "/wbg/callme_web_black.png";

          var callFromComputer = SnapABug.getMessage(38);
          var callMeOnMyPhone = SnapABug.getMessage(39);
          var returnToChat = SnapABug.getMessage(40);

          var html = "";

          var ie8orLower =
            SnapABug.isIE6() || SnapABug.isIE7() || SnapABug.isIE8();

          var populate = function () {
            if (!showPhoneForm && caseId) {
              // Show dialog where user can choose phone/web call
              // Web phone call button
              var SnapABug_CMWOnMouseOver =
                "document.getElementById(&apos;SnapABug_CMW&apos;).style.backgroundImage=&apos;url(" +
                btnCallWebOverSrc +
                ")&apos;;";
              SnapABug_CMWOnMouseOver +=
                "document.getElementById(&apos;SnapABug_CMW&apos;).style.color=&apos;" +
                textcolorOver +
                "&apos;;";

              var SnapABug_CMWOnMouseOut =
                "if (document.getElementById(&apos;SnapABug_CMW&apos;)) {";
              SnapABug_CMWOnMouseOut +=
                "document.getElementById(&apos;SnapABug_CMW&apos;).style.backgroundImage=&apos;url(" +
                btnCallWebSrc +
                ")&apos;;";
              SnapABug_CMWOnMouseOut +=
                "document.getElementById(&apos;SnapABug_CMW&apos;).style.color=&apos;" +
                textcolor +
                "&apos;;";
              SnapABug_CMWOnMouseOut += "}";

              var SnapABug_CMWStyle =
                "width:" +
                btnWidth +
                ";height:86px;margin:20px auto 0 auto;background-image:url(" +
                btnCallWebSrc +
                ");";
              SnapABug_CMWStyle +=
                "background-repeat: no-repeat no-repeat;background-position:center;cursor:pointer;position:relative;color:" +
                textcolor +
                ";";

              var SnapABug_CMWInnerStyle =
                "width:" +
                btnWidth +
                ";position:absolute;bottom:5px;margin-top:3px;font-family:arial,sans-serif;font-size:12px;font-weight:normal;font-weight:bold;";

              var SnapABug_CMPonmouseover =
                "document.getElementById(&apos;SnapABug_CMP&apos;).style.backgroundImage=&apos;url(" +
                btnCallPhoneOverSrc +
                ")&apos;;";
              SnapABug_CMPonmouseover +=
                "document.getElementById(&apos;SnapABug_CMP&apos;).style.color=&apos;" +
                textcolorOver +
                "&apos;;";

              var SnapABug_CMPonmouseout =
                "if (document.getElementById(&apos;SnapABug_CMP&apos;)) {";
              SnapABug_CMPonmouseout +=
                "document.getElementById(&apos;SnapABug_CMP&apos;).style.backgroundImage=&apos;url(" +
                btnCallPhoneSrc +
                ")&apos;;";
              SnapABug_CMPonmouseout +=
                "document.getElementById(&apos;SnapABug_CMP&apos;).style.color=&apos;" +
                textcolor +
                "&apos;};";

              var SnapABug_CMPstyle =
                "width:" +
                btnWidth +
                ";height:86px;margin:20px auto 0 auto;background-image:url(" +
                btnCallPhoneSrc +
                "); background-repeat: no-repeat no-repeat;background-position:center;cursor:pointer;position:relative;color:" +
                textcolor +
                ";";
              var SnapABug_CMPInnerstyle =
                "width:" +
                btnWidth +
                ";position:absolute;bottom:5px;margin-top:3px;font-family:arial,sans-serif;font-size:12px;font-weight:normal;font-weight:bold;";

              var callFromComputerHtml =
                '<div id="SnapABug_CMW" onclick="SnapABugChat.submitFormCallMe(true, true)" onmouseover="' +
                SnapABug_CMWOnMouseOver +
                '" onmouseout="' +
                SnapABug_CMWOnMouseOut +
                '"' +
                'style="' +
                SnapABug_CMWStyle +
                '">';
              callFromComputerHtml +=
                '<div style="' +
                SnapABug_CMWInnerStyle +
                '">' +
                callFromComputer +
                "</div>";
              callFromComputerHtml += "</div>";

              // v1.2 of the Twilio library requires a WebRTC/ORTC compatiable browser or Flash when working with IE or Safari
              if (SnapABug.isIE() || SnapABug.isSafari()) {
                if (SnapABug.hasFlash()) {
                  html += callFromComputerHtml;
                }
              } else {
                html += callFromComputerHtml;
              }

              html +=
                '<div id="SnapABug_CMP" onclick="SnapABugChat.populateCallMeForm(true);" onmouseover="' +
                SnapABug_CMPonmouseover +
                '" onmouseout="' +
                SnapABug_CMPonmouseout +
                '" ' +
                'style="' +
                SnapABug_CMPstyle +
                '">';
              html +=
                '<div style="' +
                SnapABug_CMPInnerstyle +
                '">' +
                callMeOnMyPhone +
                "</div>";
              html += "</div>";
            } else {
              // Show phone number input dialog
              if (!phoneNumber) {
                phoneNumber = "";
              }
              showPhoneForm = true;
              // By now we're absolutely sure that we will want the i18n-phone to be loaded

              var SnapABug_CMPFORMStyle =
                "width:" +
                btnWidth +
                ";margin:20px auto;padding:10px 0px;border-radius:10px;-moz-border-radius:10px;-webkit-border-radius:10px;background-color:white;";
              var SnapABug_phoneStyle =
                "margin-top:6px;margin-bottom:6px;font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;font-weight:default;color:grey;";
              var SnapABug_FormStyle = "margin:0px;";
              var SnapABug_FormInputStyle =
                "height:30px;max-width:" +
                formInputWidth +
                ";margin-top:0px;margin-top:0px;font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;font-size:13px;color:black;border:2px inset;" +
                (phoneNumber ? "border-color:red;" : "");
              var SnapABug_CallMeSubmitInputStyle =
                "width:auto;height:28px;margin:0;margin-top:6px;padding:3px 5px 3px 5px;font-size:12px;font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;cursor:pointer;font-weight:bold;";

              html +=
                '<div id="SnapABug_CMPFORM" style="' +
                SnapABug_CMPFORMStyle +
                '">';
              html +=
                '<div id="SnapABug_phone" style="' +
                SnapABug_phoneStyle +
                '">Enter your phone number</div>';
              html +=
                '<form name="SnapABug_Form" id="SnapABug_Form" accept-charset="UTF-8" style="' +
                SnapABug_FormStyle +
                '" action="#">';
              html +=
                '<input style="' +
                SnapABug_FormInputStyle +
                '" type="text" id="phonenumber" name="phonenumber" value="' +
                phoneNumber +
                '" size="16"/><br />';
              html +=
                '<span id="SnapABug_CallMeSubmit"><input onclick="return SnapABugChat.submitFormCallMe(true);" style="' +
                SnapABug_CallMeSubmitInputStyle +
                '" type="submit" value="Call Me Now" /></span>';
              html += "</form>";
              html += "</div>";
            }

            // Close link - if we have a proactive prompt or chat in progress only (something in the history)
            if (history) {
              html +=
                '<div onclick="return SnapABugChat.submitFormCallMe(false);" style="color:grey;width:' +
                btnWidth +
                ';height:28px;margin:20px auto;padding:10px 0px;font-size:12px;font-family:lucida grande,Helvetica Neue,Helvetica,Arial,sans-serif;text-align:left;cursor:pointer;">' +
                returnToChat +
                "</div>";
            }

            SnapABugChat.populateSubChatForm(
              html,
              "SnapABugChat.submitFormCallMe(false);"
            );

            if (showPhoneForm && !ie8orLower) {
              // Initialize the i18n-phone, this wraps elements around the input and builds the i18n dropdown
              SnapABug.phonePicker.init(
                "phonenumber",
                SnapABug.getVisitorCountry()
              );
              SnapABugChat.selectPhoneInputCountry(
                SnapABug.getVisitorCountry()
              );
              SnapABug.phonePicker.setCountryListWindowHeight(150);
            }
            // Center the content verticaly
            var cm = document.getElementById("SnapABug_CM");
            cm.style.top = Math.round((290 - cm.offsetHeight) / 2) + "px";
          };

          if (!SnapABug.phonePicker) {
            // Since we have the i18nphonepicker in another spearate js we don't overwrite this with SnapABug in the build process
            // so we set create a variable that references SnapABug and in i18njs we extend _1a058890_5788_4457_aa0e_3453f3f878a0
            window._1a058890_5788_4457_aa0e_3453f3f878a0 = SnapABug;

            var phoneLib = document.createElement("script");
            phoneLib.type = "text/javascript";
            phoneLib.src =
              SnapABug.getBaseURL() +
              "/js/i18nphonepicker/i18nphonepicker-min.js";
            phoneLib.onload = function () {
              var phoneLibCSS = document.createElement("link");
              phoneLibCSS.rel = "stylesheet";
              phoneLibCSS.type = "text/css";
              phoneLibCSS.href =
                SnapABug.getBaseURL() +
                "/js/i18nphonepicker/css/intlTelInput.css";
              document.getElementsByTagName("head")[0].appendChild(phoneLibCSS);
              populate();
            };
            document.getElementsByTagName("head")[0].appendChild(phoneLib);
          } else {
            populate();
          }
        },
        selectPhoneInputCountry: function (isoCountryCode) {
          if (
            typeof isoCountryCode === "string" ||
            isoCountryCode instanceof String
          ) {
            isoCountryCode = isoCountryCode.toLowerCase();
          }
          if (SnapABug.phonePicker) {
            var countryData = SnapABug.phonePicker.getCountryData();
            if (countryData.countries && isoCountryCode) {
              for (var i = 0; i < countryData.countries.length; i++) {
                if (isoCountryCode === countryData.countries[i].iso2) {
                  SnapABug.phonePicker.selectCountry(isoCountryCode);
                }
              }
            }
          }
        },
        isPhoneNumberValid: function () {
          var form;
          if (SnapABug.isCustomDesignEnabled()) {
            form = SnapABug.getCustomDesignIframe().getElementById(
              "callme-form"
            );
          } else {
            form = document.getElementById("SnapABug_Form");
          }
          if (form) {
            if (form.phonenumber) {
              if (form.phonenumber.value) {
                return (
                  /^\+{0,1}[\d \(\)-.]+[xX]{0,1}[wW]*[\d \(\)\-]+$/.test(
                    form.phonenumber.value
                  ) && form.phonenumber.value.length > 5
                );
              }
            }
          }
          return false;
        },
        submitFormCallMe: function (call, webphone) {
          if (call) {
            SnapABug.disableCallMe();
            if (webphone) {
              // open a popup on https only (Chrome no longer allows mic/cam access on http window)
              // this will become a non-issue when we are using https only from the JS side (TODO early 2016)
              window.open(
                SnapABug.getBaseURL().replace(/http\:/, "https:") +
                  "/voice/webphone.jsp?c=" +
                  SnapABug.getCaseId(),
                "webphone",
                "left=20,top=20,width=310,height=260,toolbar=0,location=0,directories=0,status=0,menubar=0,scrollbars=0,resizable=1"
              );
              SnapABug.callCallback("StartCallme", "");
              if (caseId) {
                SnapABugChat.formCallMeDone();
              } else {
                SnapABug.hideOverlay(false);
              }
            } else {
              var phone = "";
              var form;
              if (SnapABug.isCustomDesignEnabled()) {
                form = SnapABug.getCustomDesignIframe().getElementById(
                  "callme-form"
                );
              } else {
                form = document.getElementById("SnapABug_Form");
              }
              if (form) {
                if (form.phonenumber) {
                  if (form.phonenumber.value) {
                    if (SnapABugChat.isPhoneNumberValid()) {
                      phone = form.phonenumber.value.replace(/[^+0-9xX]*/g, "");
                    } else {
                      SnapABug.callbackCheckPhone(false);
                      return;
                    }
                  }
                }
              }
              if (phone != "") {
                SnapABug.setCallMePhone(phone);
                SnapABug.sendCheckPhone(phone);
                // Show the spinning wheel instead of the submit button
                if (!SnapABug.isCustomDesignEnabled()) {
                  document.getElementById("SnapABug_CallMeSubmit").innerHTML =
                    "Please wait...";
                }
              } else {
                // Need to show the phone is required
                //this.populateCallMeForm(true, phone);
              }
            }
          } else {
            SnapABug.enableCallMe();
            if (caseId || SnapABugChat.isProactive()) {
              SnapABugChat.formCallMeDone();
            } else {
              SnapABug.hideOverlay(false);
            }
          }
          return false;
        },
        showFormChat: function () {
          if (
            !(SnapABug.isMobileEnabled() || SnapABug.isCustomDesignEnabled())
          ) {
            // Word break css to avoid horizontal scrollbar.
            var wordbreakCSS =
              "" +
              "word-wrap: break-word;" +
              "-ms-word-break: keep-all;" +
              "word-break: keep-all;" +
              "word-break: break-word;" + // Non standard for webkit
              "-webkit-hyphens: auto;" +
              "-moz-hyphens: auto;" +
              "-ms-hyphens: auto;" +
              "hyphens: auto;" +
              "white-space: pre-wrap;";

            SnapABug.addStyleRule(
              [
                "#SnapABug_CL .SnapABug_transcriptLine", // Affect the result of "createTranscriptLine()"
              ],
              wordbreakCSS
            );

            this.populateChatForm();
          }
          if (this.isProactive()) {
            history = proactiveMsg;
            this.setReadOnly(false);
          }

          if (history != "") {
            this.displayHistory();
          } else {
            this.setReadOnly(true);
          }

          var form = document.SnapABug_Form;
          if (form) {
            if (userInput != "") {
              form.chat.value = userInput;
              userInput = "";
            } else if (question != "" && question != "(none)") {
              if (history == "") {
                // For proactive chat, the initial text is in the history
                this.appendTextToChat(
                  SnapABug.getMessage(15),
                  question + "<br />",
                  false,
                  false,
                  false
                );
              }
              question = "";
            }
            if (introMsg) {
              if (customIntroMsg != "") {
                form.chat.value = customIntroMsg;
              } else {
                form.chat.value = unescape(SnapABug.getMessage(14));
              }
            } else {
              // If minimized, we cannot focus the input.
              if (!SnapABugChat.isMinimized()) {
                // Put the focus on the chat input
                form.chat.focus();
              }
            }

            if (this.getMessageCookie() != "") {
              introMsg = false;
              form.chat.value = this.getMessageCookie();
              this.setMessageCookie("");
            }
          }
        },
        displayHistory: function () {
          var logid = document.getElementById("SnapABug_CL");
          try {
            logid.innerHTML =
              history + this.createTranscriptLine(nickname, "", true);
            this.scrollDown();
          } catch (e) {}
        },
        startPolling: function () {
          if (timer) {
            this.stopPolling();
          }
          timer = setInterval("SnapABugChat.pollChat()", 2000);
          var _this = this;
          SnapABugChat.pollChat();
        },
        stopPolling: function () {
          clearInterval(timer);
        },
        keyDownHandler: function (evt) {
          var e = evt || window.event;
          var k = e.keyCode || e.which;
          var form;
          if (e) {
            if (k == 13) {
              if (e.ctrlKey) {
                form = document.SnapABug_Form;
                if (form) {
                  form.chat.value = form.chat.value + "\n";
                }
              } else if (!readonly) {
                if (!caseId) {
                  // If proactive chat prompt, stop the timer to close the window for innactivity
                  // as we are starting the chat now
                  SnapABug.clearProactiveChatAutocloseTimeout();
                }
                this.submitChat();
              }
              if (e.stopPropagation) {
                e.stopPropagation();
              }
              if (e.preventDefault) {
                e.preventDefault();
              }
              if (e.cancelBubble) {
                e.cancelBubble = true;
              }
              if (e.returnValue) {
                e.returnValue = false;
              }
              return false;
            }
          }
          if (introMsg) {
            form = document.SnapABug_Form;
            if (form) {
              form.chat.value = "";
            }
            introMsg = false;
          }

          // If proactive chat prompt, reset the timer to close the window for innactivity
          // as there was some activity
          if (!caseId) {
            SnapABug.setProactiveChatAutocloseTimeout();
          }

          return true;
        },
        submitChat: function () {
          var form = document.SnapABug_Form;
          if (form) {
            var text = form.chat.value;
            // Prevent sending the default "press enter" text
            if (introMsg) {
              if (form) {
                form.chat.value = "";
              }
              introMsg = false;
            } else {
              if (text != "") {
                this.appendTextToChat(
                  SnapABug.getMessage(15),
                  SnapABug.deactivateHTML(text),
                  false,
                  false,
                  false
                );
                if (this.isProactive()) {
                  SnapABug.sendCreateCase(
                    SnapABug.getUserEmail(),
                    text,
                    true,
                    false
                  );
                  this.setReadOnly(true);
                } else {
                  this.sendChatMessage(
                    1 /* message */,
                    SnapABug.deactivateHTML(text)
                  );
                }
                form.chat.value = "";
                lastTypedText = "";
              }
            }
            // Put the focus on the chat input
            form.chat.focus();
          }
          return false;
        },
        setReadOnly: function (ro) {
          readonly = ro;
          try {
            var eb = document.getElementById("SnapABug_CE");
            if (eb) {
              if (readonly) {
                eb.setAttribute("readOnly", "readonly");
              } else {
                eb.removeAttribute("readOnly");
              }
            }
          } catch (e) {}
        },
        callbackChatPosted: function (posted) {},
        parseEmoji: function (text) {
          // look for the following pattern: ":emoji|hex:"
          var emojiRex = /(:[^:\s]{1,}\|[^:\s]{4,}:)/g;

          if (text.match(emojiRex)) {
            text = text.replace(emojiRex, function replacer(match) {
              var splits = match.split("|");

              // remove trailing ":"
              var hex = splits[1];
              hex = hex.substring(0, hex.length - 1);

              // remove leading ":"
              var alias = splits[0].substring(1);

              var parsed =
                '<img src="' +
                SnapABug.getStaticBaseURL() +
                "/img/emoji/twemoji/2/72x72/" +
                hex +
                '.png" alt=":' +
                alias +
                ':" width="16" height="16" />';
              return parsed;
            });
          }

          return text;
        },
        appendTextToChat: function (
          from,
          text,
          historyOnly,
          systemMessage,
          isHtml,
          isLastMessageFlag
        ) {
          this.setCaseIdCookie();
          text = text.replace(/\&\#41\;/g, ")");
          text = text.replace(/\&\#40\;/g, "(");

          text = text.replace(/\\n/g, "<br />");
          text = text.replace(/\n/g, "<br />");
          text = text.replace(/&lt; *br *\/*&gt;/g, "<br />");
          text = text.replace(/&lt; *BR *\/*&gt;/g, "<br />");

          if (
            !(SnapABug.isMobileEnabled() || SnapABug.isCustomDesignEnabled())
          ) {
            //let mobile client handle the emoticon styles

            // replace the emoticon shorthand for the emoji :alias|hex: notation which will then be processed by parseEmoji
            text = text.replace(/(\s|^):\)/g, " :slightly_smiling_face|1f642:");
            text = text.replace(/(\s|^);\)/g, " :wink|1f609:");
            text = text.replace(/(\s|^):D/g, " :grinning|1f600:");
            text = text.replace(/(\s|^):\(/g, " :slightly_frowning_face|2639:");
            text = text.replace(/(\s|^):o/g, " :open_mouth|1f62e:");
            text = text.replace(
              /(\s|^):\-\)/g,
              " :slightly_smiling_face|1f642:"
            );
            text = text.replace(/(\s|^);\-\)/g, " :wink|1f609:");
            text = text.replace(/(\s|^):\-D/g, " :grinning|1f600:");
            text = text.replace(
              /(\s|^):\-\(/g,
              " :slightly_frowning_face|2639:"
            );
            text = text.replace(/(\s|^):\-o/g, " :open_mouth|1f62e:");

            SnapABugChat.handleDataTransferInProgress();
          }

          text = this.parseEmoji(text);

          if (SnapABug.isMobileEnabled()) {
            SnapABug.getMobileUI().updateChat(
              text,
              from == SnapABug.getMessage(15),
              historyOnly
            );
          } else if (SnapABug.isCustomDesignEnabled()) {
            SnapABug.getCustomDesignUI().updateChat(
              text,
              from == SnapABug.getMessage(15),
              historyOnly,
              systemMessage,
              isHtml,
              isLastMessageFlag
            );
          } else {
            var logid = document.getElementById("SnapABug_CL");

            history += this.createTranscriptLine(from, text, false);
            prevMsgFrom = from;

            if (historyOnly != true) {
              if (logid) {
                logid.innerHTML =
                  history + this.createTranscriptLine(nickname, "", true);
                this.scrollDown();
              }
            }
          }
          systemMsgId = null;
        },
        setUseStaticAgentAvatar: function (doUse) {
          _useStaticAgentAvatar = doUse;
        },
        staticAgentAvatarEl: function () {
          return document.getElementById("SnapABug_AAvatar");
        },
        populateStaticAgentAvatar: function () {
          var staticAgentAvatar = this.staticAgentAvatarEl();
          if (staticAgentAvatar && staticAgentAvatar.src !== avatarURL) {
            staticAgentAvatar.src = avatarURL;
          }
        },
        setUseStaticAgentName: function (doUse) {
          _useStaticAgentName = doUse;
        },
        staticAgentNameEl: function () {
          return document.getElementById("SnapABug_AName");
        },
        populateStaticAgentName: function () {
          var staticAgentName = this.staticAgentNameEl();
          if (staticAgentName && prevNickname !== nickname) {
            staticAgentName.innerHTML = nickname;
          }
        },
        createTranscriptLine: function (
          from,
          text,
          typing /* create a special hidden transcript line to show typing activity*/
        ) {
          var ret = "";
          var head = "";
          var isAgentMsg = from === nickname;

          if (!history) {
            ret += '<div style="height:' + transcriptPadding + 'px;"></div>';

            if (_useStaticAgentAvatar) {
              this.populateStaticAgentAvatar();
            }
          }

          if (!typing && avatarURL !== "" && isAgentMsg) {
            // Prevent showing the avatar again in case we have different agents with the same nickname but different avatar URLs
            // And: do not show the avatar if we're using a static avatar element.
            if (
              !_useStaticAgentAvatar &&
              (prevNickname == "" || prevNickname != nickname)
            ) {
              head +=
                '<img src="' +
                avatarURL +
                '" style="float:left;margin-right:5px;padding:1px;border:1px solid #888;background-color:#fff;" width="53" height="53" />';
            }
            // TODO -- support the avatar being displayed in fixed location (updating DIV/SPAN of avatar and name)
            prevAvatarURL = avatarURL;
            prevNickname = nickname;
          }
          // All bot aliases are hard-coded to "Chat Bot". This allows us to look for that value and not display it since our current best practices state that bots don't
          // have a name that is displayed to the visitor.
          if (from !== "" && from !== "Chat Bot" && from != prevMsgFrom) {
            var fromcolor = isAgentMsg
              ? transcriptAgentCSS
              : transcriptVisitorCSS;

            head +=
              '<span style="' +
              fromcolor +
              "font-weight:bold;" +
              SnapABug.getDirection() +
              '">' +
              from +
              ":</span> ";
          }
          if (!typing && avatarURL !== "" && isAgentMsg) {
            head += "<br />";
            avatarURL = "";
            // Reset the avatar URL to track that we have shown the image already
          }

          // creating the special "is typing..." transcript line
          var typingid = "";
          var typingstyle = "";
          if (typing) {
            typingid = 'id="SnapABug_Typing" ';
            typingstyle = "visibility:hidden;";
            text =
              '<img src="' +
              baseURL +
              '/img/typing.gif" alt="[...]" width="24" height="8" />';
          } else if (!isAgentMsg) {
            text = SnapABug.deactivateHTML(text);
          }

          var transcriptLineClass = 'class="SnapABug_transcriptLine" ';
          // finally assemble the pieces together to create one transcript line DIV
          if (from != prevMsgFrom) {
            if (history != "") {
              // No spacer on the first message
              ret += '<div style="height:7px;"></div>';
            }
            ret +=
              "<div " +
              typingid +
              transcriptLineClass +
              'style="clear:left;line-height:normal;' +
              transcriptTextCSS +
              typingstyle +
              SnapABug.getDirection() +
              '">' +
              head +
              text +
              "</div>";
          } else {
            ret +=
              "<div " +
              typingid +
              transcriptLineClass +
              'style="line-height:normal;' +
              transcriptTextCSS +
              typingstyle +
              SnapABug.getDirection() +
              '">' +
              head +
              text +
              "</div>";
          }
          return ret;
        },
        isTyping: function (typing) {
          if (SnapABug.isMobileEnabled() && typing) {
            SnapABug.getMobileUI().triggerIsTyping();
          } else if (SnapABug.isCustomDesignEnabled()) {
            SnapABug.getCustomDesignUI().triggerIsTyping(typing);
          } else {
            typingDiv = document.getElementById("SnapABug_Typing");
            if (typingDiv) {
              if (typing) {
                typingDiv.style.visibility = "visible";
              } else {
                typingDiv.style.visibility = "hidden";
              }
            }
          }
        },
        scrollDown: function () {
          var logid = document.getElementById("SnapABug_CL");
          if (logid) {
            logid.scrollTop = logid.scrollHeight;
          }
        },
        // This is used to slowly autoscroll down when the survey appears after a chat is ended.
        // Prior to this, the survey was appended but the box didn't scroll down to view the whole survey.
        animateScrollDown: function (scrollArea, start, duration) {
          // Initialize time
          var currentTime = 0;
          // Increment by 20ms
          var increment = 20;
          // change = The difference between the bottom and the starting location
          var change = scrollArea.scrollHeight - start;
          // Set the scrollTop to your current scroll location
          scrollArea.scrollTop = start;

          // Recursive animation (tiny incremental scrolls, repeated)...
          var animateScroll = function () {
            // Update the time
            currentTime += increment;
            // Get the scroll amount
            var scrollAmount = (change / duration) * 100;
            scrollArea.scrollTop += scrollAmount;
            // Recursion stops when the currentTime = duration
            if (currentTime < duration) {
              // Call animateScroll after increment (20)
              setTimeout(animateScroll, increment);
            }
          };
          animateScroll();
        },
        // Recursive function to incrementally fade the element's opacity
        animateFadeOut: function (element) {
          if (!element) return false;
          // Recursive fade function
          var fade = function () {
            // Fade the opacity by .03 each time
            element.style.opacity -= 0.03;
            // If the opacity is greater than 0, allow the animation to occur
            if (element.style.opacity > 0) {
              (window.requestAnimationFrame && requestAnimationFrame(fade)) ||
                setTimeout(fade, 20);
            } else {
              // When the opacity reaches 0 or goes below 0, now it's ok to remove the whole element.
              // Removing the element will cause the the above content to come back into view.
              element.parentNode.removeChild(element);
            }
          };

          // If opacity is not able to parse as a number (i.e.  opacity is not set)
          if (isNaN(parseInt(element.style.opacity))) {
            // Set opacity to 1
            element.style.opacity = 1.0;
          }
          // Then recursively fade the opacity from 1 or what opacity was set to
          fade();
        },
        waitingForAgentMessage: function (message) {
          // If it's an Approval Bot chat, chatAnswered is always true because of the bot messages sent
          // from the backend, so we instead need to check if this chat has been responded to by a
          // human, not just a bot. If so, we do NOT want to show the auto responder message.
          if (SnapEngageChat.getIsApprovalBotChat()) {
            if (SnapEngageChat.getIsHumanResponded()) {
              return;
            }
          } else {
            if (SnapEngageChat.getChatAnsweredStatus()) {
              return;
            }
          }

          if (SnapEngage.getCaseId() == "") {
            return;
          }

          systemMsgId = "WAGT_AUTO_RESPOND";
          if (SnapABug.isCustomDesignEnabled()) {
            this.appendTextToChat("", message, false, systemMsgId, false);
          } else {
            // replace the double brackets with a button
            // TODO
            message = message.replace(
              /\[\[/g,
              '<a href="#" onclick="SnapABugChat.cancelChat(); return false;">'
            );
            message = message.replace(/\]\]/g, "</a>");
            // replace the single brackets with a link
            message = message.replace(
              /\[/g,
              '<a href="#" onclick="SnapABugChat.cancelChat(); return false;">'
            );
            message = message.replace(/\]/g, "</a>");

            this.appendTextToChat(
              "",
              "<br />" + message,
              false,
              systemMsgId,
              false
            );
          }
          clearTimeout(WAGTTimeout);
        },
        isVisitorTyping: function () {
          if (SnapABug.isMobileEnabled()) {
            return SnapABug.getMobileUI().isVisitorTyping();
          } else if (SnapABug.isCustomDesignEnabled()) {
            return SnapABug.getCustomDesignUI().isVisitorTyping();
          }
          var typing = false;
          var textTyped = "";
          var form = document.SnapABug_Form;
          if (form && form.chat) {
            textTyped = form.chat.value;
            if (!introMsg && textTyped && lastTypedText != textTyped) {
              typing = true;
            }
          }
          lastTypedText = textTyped;
          return typing;
        },
        pollChat: function () {
          if (!this.isChatViewCookieValid() || caseId == "") {
            // Terminate the chat in this window
            this.stopPolling();
            if (SnapABug.isCustomDesignEnabled()) {
              SnapABug.getCustomDesignUI().destroy();
            } else {
              SnapABug.hideOverlay(false);
            }
            SnapABug.setChatInProgress(false);
            return;
          }
          this.refreshChatViewCookie();
          if (pollCount == 0) {
            // pollCount is to avoid having several poll requests in-flight
            var params =
              "c=" +
              encodeURIComponent(caseId) +
              "&i=" +
              this.getPollIdCookie();
            // Add a time stamp to the request to avoid having the browsing caching (issue with Safari)
            var now = new Date();
            params += "&t=" + now.getTime();
            if (totalPollCount % 2 == 0) {
              params += "&gt";
              // get the is typing status from agent
              if (this.isVisitorTyping()) {
                params += "&st";
                // send that the visitor is typing
              }

              // send the current content of the chat input
              // area for the sneak peek feature
              if (SnapABug.isSneakPeek()) {
                var peek = "";
                // For mobile-optimized
                if (SnapABug.isMobileEnabled()) {
                  peek = SnapABug.getMobileUI().getVisitorTyping();
                } else if (SnapABug.isCustomDesignEnabled()) {
                  peek = SnapABug.getCustomDesignUI().getVisitorTyping();
                } else {
                  var form = document.SnapABug_Form;
                  peek = form && form.chat ? form.chat.value : "";
                }
                if (peek !== "" && !SnapABugChat.introMsg) {
                  params += "&tt=" + encodeURIComponent(peek);
                  // send what the visitor is typing
                }
              }
            }
            SnapABug.rpc(
              baseURL + "/chatjs/ServiceChatPoll?" + params,
              0,
              "pollChat"
            );
          }
          pollCount++;
          if (pollCount > 3) {
            pollCount = 0;
          }
          totalPollCount++;
        },
        callbackPolling: function (textMsg, id, typing) {
          if (id === -1 || msgIdLst[id] != 1) {
            // check if it is a system message outside the polling order
            // or we are receiving a new message from polling (duplicate prevention)
            msgIdLst[id] = 1;

            if (id != -1) {
              this.setPollIdCookie(id);
            }
            this.callbackMessage(true, textMsg, false);
          }
          if (typing == 1) {
            // the agent is typing
            this.isTyping(true);
          } else if (typing == 2 && !SnapABug.getChatHandledByBot()) {
            // the agent is not typing
            this.isTyping(false);
          }
          pollCount = 0;
        },
        sendChatMessage: function (action, message, options) {
          // Action types:
          // 1: regular text message
          // 2: close chat
          // 3: *deprecated*
          // 4: screenshot taken and uploaded successfully *deprecated*
          // 5: cannot take screenshot *deprecated*
          // 6: event API message
          // 7: page reloaded
          // 8: cancel chat not yet responded
          var params = "a=" + action + "&c=" + encodeURIComponent(caseId);
          var now = new Date();
          params += "&t=" + now.getTime();
          if (message != "") {
            params += "&m=" + encodeURIComponent(message);
          }
          if (options) {
            if (options.buttonId) {
              params += "&i=" + encodeURIComponent(options.buttonId);
            }
          }
          var rpcURL = baseURL + "/chatjs/ServiceChatMessage?" + params;
          if (rpcURL.length > 2000) {
            // the message will be truncated, let's warn the agent
            params = "a=" + action + "&c=" + encodeURIComponent(caseId);
            params += "&t=" + now.getTime();
            params +=
              "&m=" + encodeURIComponent("[truncated message] " + message);
            rpcURL = baseURL + "/chatjs/ServiceChatMessage?" + params;
          }
          rpcURL = this.formatRpcUrl(rpcURL);
          SnapABug.rpc(rpcURL, 3, "sendChatMessage");

          if (action == 1 /* chat message */) {
            // Callback API
            SnapABug.callCallback("ChatMessageSent", message);
            if (SnapABug.getChatHandledByBot() && SnapABug.isChatInProgress()) {
              SnapABug.getCustomDesignUI()
                .chatView.getMessageView()
                .triggerAgentIsTyping(true);
            }
          }
        },
        handleNewMessageFormat: function (msg, fromAgent, replay, historyOnly) {
          var messageHandlers = {
            inline_buttons: handleButtonMessage,
            text: handleTextMessage,
            cards: handleSearchResultsMessage,
            link_text: handleLinkTextMessage,
          };
          try {
            return messageHandlers[msg.type](
              msg,
              fromAgent,
              replay,
              historyOnly
            );
          } catch (e) {
            allowedDomains = ["timzon000", "localhost"];
            for (var i = 0; i < allowedDomains.length; i++) {
              if (document.location.href.indexOf(allowedDomains[i]) > 0) {
                console.log("Error: ", e);
              }
            }
          }
        },

        getSecureDataTransferURL: function (type) {
          return (
            SnapABug.getBaseURL() +
            "/secureDataTransferRequest?casePublicId=" +
            SnapABug.getCaseId() +
            "&type=" +
            type
          );
        },

        callbackMessage: function (fromAgent, textMsg, replay, historyOnly) {
          if (typeof textMsg !== "string") {
            this.handleNewMessageFormat(
              textMsg,
              fromAgent,
              replay,
              historyOnly
            );
            return;
          }
          if (textMsg != "") {
            textMsg = decodeURIComponent(textMsg).replace(/\%20/g, " ");
            var from = nickname;
            var cmd = textMsg.substr(0, 4);
            switch (cmd) {
              case "/BYE":
                if (!replay) {
                  systemMsgId = "BYE_BYE";
                  this.appendTextToChat(
                    "",
                    textMsg.substr(5),
                    false,
                    systemMsgId,
                    false
                  );
                  this.setReadOnly(true);
                  // The closeChat() does it already
                  this.closeChat();
                  SnapABug.disableCallMe();
                  if (SnapABug.isMobileEnabled()) {
                    SnapABug.getMobileUI().endChat();
                  } else if (SnapABug.isCustomDesignEnabled()) {
                    SnapABug.getCustomDesignUI().endChat(false);
                  }
                }
                break;
              case "/NIC":
                nickname = textMsg.substr(5);
                if (SnapABug.isMobileEnabled()) {
                  SnapABug.getMobileUI().updateAgentName(nickname);
                } else if (SnapABug.isCustomDesignEnabled()) {
                  SnapABug.getCustomDesignUI().setAgentName(nickname);
                } else {
                  if (_useStaticAgentName) {
                    this.populateStaticAgentName();
                  }
                }
                break;
              case "/GO2":
                if (!replay) {
                  this.redirectBrowser(textMsg.substr(5));
                }
                break;
              case "/WAI":
                this.setReadOnly(true);
                systemMsgId = "WAI_WAITING";
                this.appendTextToChat(
                  "",
                  textMsg.substr(5),
                  false,
                  systemMsgId,
                  false
                );
                break;
              case "/NFO":
                systemMsgId = "NFO_INITIAL";
                if (SnapABug.isMobileEnabled()) {
                  //set flag that this is initial message, so we can remove later
                  SnapABug.getMobileUI().isInitAgentMsg(textMsg.substr(5));
                }
                this.setReadOnly(false);

                this.appendTextToChat(
                  "",
                  textMsg.substr(5),
                  false,
                  systemMsgId,
                  false
                );
                break;
              case "/CAL":
                var optionCallMeValue = textMsg.substr(5);
                if (optionCallMeValue.indexOf("1") != -1) {
                  if (SnapABug.isCustomDesignEnabled()) {
                    SnapABug.getCustomDesignUI().setAllowCallMe(true);
                  }
                  SnapABug.enableCallMe();
                } else {
                  SnapABug.disableCallMe();
                }
                break;
              case "/BAN":
                this.setBannedCookie();
                SnapABug.allowChat(false);
                break;
              case "/AVA":
                avatarURL = textMsg.substr(5);
                if (_useStaticAgentAvatar) {
                  this.populateStaticAgentAvatar();
                } else {
                  // store the avatar in a cookie
                  this.setCookie("SnapABugAgentAvatar", avatarURL);

                  if (SnapABug.isMobileEnabled()) {
                    SnapABug.getMobileUI().updateAgentAvatar(avatarURL);
                  } else if (SnapABug.isCustomDesignEnabled()) {
                    SnapABug.getCustomDesignUI().setAgentAvatar(avatarURL);
                  }
                }
                break;
              case "/BTM":
                buttonOptions = textMsg.substr(5);
                var buttons = JSON.parse(buttonOptions);
                var convertedMessage = {
                  type: MESSAGE_TYPES.BUTTON,
                  buttons: buttons,
                };
                this.handleNewMessageFormat(convertedMessage);
                break;
              case "/SYS":
                // System settings through the chat message stream
                var payload = textMsg.substr(5);
                var syscmd = payload.substr(0, 4);
                var systemMsg = "";
                if (syscmd == "PURL") {
                  // Post chat iframized URL (for post chat survey)
                  postChatIframeURL = payload.substr(5);
                } else if (syscmd === SYSTEM_COMMANDS.AUTO_TRANSLATE) {
                  var customDesignUi = SnapABug.getCustomDesignUI();

                  if (payload.indexOf("ON") > -1) {
                    customDesignUi.chatView.showGoogleLogo();
                  } else if (payload.indexOf("OFF") > -1) {
                    customDesignUi.chatView.removeGoogleLogo();
                  }
                } else if (syscmd == "PTXT") {
                  // Post chat content to be shown (for post chat survey)
                  postChatHTML = decodeURIComponent(payload.substr(5)).replace(
                    /\%20/g,
                    " "
                  );
                } else if (syscmd == "WAGT") {
                  // In chat message if no agent answer before a set time (with optional link to cancel chat)
                  // get the message and delay in second
                  if (!SnapABug.isMobileEnabled()) {
                    // FIXME what do we do in the SnapABug.isCustomDesignEnabled() case?
                    var message = decodeURIComponent(payload.substr(5)).replace(
                      /\%20/g,
                      " "
                    );
                    var delay = message.substring(0, message.indexOf(","));
                    message = message.substring(message.indexOf(",") + 1);
                    WAGTTimeout = window.setTimeout(
                      'SnapABugChat.waitingForAgentMessage("' +
                        message.replace(/\"/g, '\\"') +
                        '");',
                      delay * 1000
                    );
                  }
                } else if (syscmd == "EMAI") {
                  var payload = decodeURIComponent(payload.substr(5)).replace(
                    /\%20/g,
                    " "
                  );
                  SnapABug.setUserEmail(payload);
                  SnapABugChat.setUserEmailCookie(payload);
                } else if (syscmd == "REAS") {
                  var reassignDelay = payload.substr(5);
                  SnapABugChat.setReassignmentTimerAfterRestartChat(
                    reassignDelay
                  );
                } else if (syscmd == "RERY" && !historyOnly) {
                  SnapABugChat.updateHistoryCookieForLastCase(
                    SnapABug.getCaseId()
                  );
                } else if (syscmd == "SRVY") {
                  chatAgentSurvey = eval("(" + payload.substr(5) + ")");
                } else if (syscmd == "GRCP") {
                  surveyGracePeriod = parseInt(payload.substr(5)) * 60;
                  // secs
                } else if (syscmd == "XSRV") {
                  // new command for no survey available
                  chatAgentSurvey = null;
                } else if (syscmd == "IBOT") {
                  // new command for no survey available
                  SnapABug.setChatHandledByBot(payload.substr(5) == "true");
                } else if (syscmd == "FURV") {
                  // FURV = File Upload Request to Visitor
                  // When agent selects "Request A File" from the dropdown in the Hub, the visitor is presented with this.
                  // NOTE: Does not get stored in transcript history!

                  // TODO: This is a message to the agent, but we don't have a good way to i18n
                  SnapABugChat.sendChatMessage(
                    6,
                    "Visitor has received the file request."
                  );

                  // Set fileUpload variable so we know how to handle interruptions in appendTextToChat
                  SnapABugChat.setFileUploadInProgress(true);

                  if (SnapABug.isMobileEnabled()) {
                    // Show upload icon, then mobile code takes over from here
                    SnapABug.getMobileUI().showUploadButtons();
                    return;
                  } else if (SnapABug.isCustomDesignEnabled()) {
                    SnapABug.getCustomDesignUI().enableFileUploadButtons();
                    return;
                  }

                  SnapABugChat.loadVisitorIframe(
                    SnapABug.getBaseURL() +
                      "/chatFileUpload?widgetPublicId=" +
                      SnapABug.getWidgetId() +
                      "&casePublicId=" +
                      SnapABug.getCaseId(),
                    "SnapABugChat.cancelVisitorRequest();",
                    120
                  );
                } else if (syscmd == "FUMV") {
                  // FUM = File Upload Message to Visitor
                  // Whenever anyone uploads a file (whether visitor or agent), the visitor is presented with this

                  // Get the json object
                  var json = textMsg.substr(9);

                  // Find all the weird characters that had been replaced the quotes, and replace with quotes again
                  var re = new RegExp("&#34;", "g");
                  json = json.replace(re, '"');

                  // Convert the string to a JSON object
                  json = JSON.parse(json);

                  var fileName = SnapABugChat.fileNamePretty(json[0].fileName);

                  // Create a random ID for the file div
                  var randomId = SnapABugChat.createRandomId();

                  // If file is of these types, request a thumbnail from server and account for its height (to later scrolldown)
                  var thumbnailImg = "";
                  var thumbnailDivHeight = "";
                  if (
                    json[0].mimeType.indexOf("/png") > -1 ||
                    json[0].mimeType.indexOf("/jpeg") > -1 ||
                    json[0].mimeType.indexOf("/bmp") > -1
                  ) {
                    thumbnailImg =
                      '<img src="' +
                      json[0].url +
                      '?thumbnail" style="position: relative; display: block;"/>';
                    thumbnailDivHeight = "min-height:100px; max-height:130px;";
                  } else if (json[0].mimeType.indexOf("/gif") > -1) {
                    thumbnailImg =
                      '<img src="' +
                      json[0].url +
                      '" height="130px" width="130px" style="position: relative; display: block;"/>';
                    thumbnailDivHeight = "min-height:100px; max-height:130px;";
                  }

                  // Build out the system message
                  if (SnapABug.isMobileEnabled()) {
                    systemMsg =
                      '<img style="display:inline;height:32px;" src="' +
                      json[0].mimeTypeUrl +
                      '" /><a href="' +
                      json[0].url +
                      '" target="_blank"><span style="font-weight: 800">' +
                      fileName +
                      '</span></a><a href="' +
                      json[0].url +
                      '" target="_blank"><div style="' +
                      thumbnailDivHeight +
                      '">' +
                      thumbnailImg +
                      "</div></a>";
                  } else if (SnapABug.isCustomDesignEnabled()) {
                    systemMsg =
                      '<img style="display:inline;height:32px;" src="' +
                      json[0].mimeTypeUrl +
                      '" /><a href="' +
                      json[0].url +
                      '" target="_blank"><span style="font-weight: 800">' +
                      fileName +
                      '</span></a><a href="' +
                      json[0].url +
                      '" target="_blank"><div style="' +
                      thumbnailDivHeight +
                      '">' +
                      thumbnailImg +
                      "</div></a>";
                  } else {
                    systemMsg = // The system message
                      '<div id="systemMsg" style="' +
                      SnapABug.getCSS(
                        0,
                        5,
                        SnapABugChat.getChatTranscriptWidth(),
                        ""
                      ) +
                      'position: relative; background-color: #D5E8EA; border: 1px solid #D5E8EA; border-radius: 4px; -moz-border-radius: 4px; -webkit-border-radius: 4px; margin: 5px 0px; font-size: .9em; display: inline-block; ">' + // Opaque overlay on top
                      ' <div id="' +
                      randomId +
                      "\" onmouseenter=\"SnapABugChat.viewOrDownload('mouseenter', this.id,  '" +
                      json[0].url +
                      "')\" onmouseleave=\"SnapABugChat.viewOrDownload('mouseleave', this.id , '" +
                      json[0].url +
                      '\')" style="' +
                      SnapABug.getCSS(0, 0) +
                      'position: absolute; border: 1px solid #D5E8EA; border-radius: 4px; -moz-border-radius: 4px; -webkit-border-radius: 4px; width: 100%; height: 100%;"></div>' + // Text, filetype icon, and (if there is one) image thumbnail
                      ' <div style="float:left; margin:10px;height:32px;"><img style="display: inline" src="' +
                      json[0].mimeTypeUrl +
                      '" /></div><div style="margin:10px;">File uploaded: <span style="font-weight: 800"><br />' +
                      fileName +
                      '</span></div><div style="margin:14px;' +
                      thumbnailDivHeight +
                      '">' +
                      thumbnailImg +
                      "</div>" + // Close of systemMsg
                      "</div>";

                    // Save any text the visitor has typed into the textarea, it will restore during showFormChat()
                    SnapABugChat.saveUserInput();

                    // Now set the chatbox back to normal (put the textarea back if it was removed in /FURV):
                    SnapABugChat.showFormChat();
                  }

                  // If authorType is 1 (agent), from = agent nickname, else from = 'Me'
                  if (json[0].authorType === 1) {
                    from = nickname;
                  } else {
                    from = SnapABug.getMessage(15);
                  }

                  // Append systemMsg to chat
                  SnapABugChat.appendTextToChat(
                    from,
                    systemMsg,
                    false,
                    false,
                    true,
                    false
                  );

                  // Now reset fileUploadInProgress back to false
                  SnapABugChat.setFileUploadInProgress(false);

                  if (SnapABug.isMobileEnabled()) {
                    // Scroll to the bottom
                    SnapABug.getMobileUI().updateScroll();
                  }
                } else if (syscmd == "SDR_") {
                  // SDR_ = Secure Data Request to Visitor.  What follows the _ will determine the type

                  if (SnapABug.isMobileEnabled()) {
                    // TODO: Add support for this feature within mobile optimized code
                    SnapABugChat.sendChatMessage(
                      6,
                      "Sorry, this feature is not yet available for mobile visitors."
                    );
                    break;
                  }
                  // When agent selects "Secure Data Transfer" from the dropdown in the chat portal, the visitor is presented with this.
                  // TODO: This is a message to the agent, but we don't have a good way to i18n
                  SnapABugChat.sendChatMessage(
                    6,
                    "Visitor has received the Secure Data Transfer request."
                  );

                  // Set secureData variable so we know how to handle interruptions in appendTextToChat
                  secureDataTransferInProgress = true;

                  // Unfortunately, due to cross domain issues, we can't compute the height of the rendered iframe, so we need to
                  // hardcode these heights here.  These should be adjusted if changes are made to the HTML within secureDataTransferRequest.jsp
                  var iframeHeight = 150;
                  if (payload === "SDR_CC") {
                    iframeHeight = 230;
                  } else if (payload === "SDR_CCZ") {
                    iframeHeight = 280;
                  } else if (payload === "SDR_SSN") {
                    iframeHeight = 132;
                  } else if (payload === "SDR_SN") {
                    iframeHeight = 180;
                  }

                  SnapABugChat.loadVisitorIframe(
                    SnapABugChat.getSecureDataTransferURL(payload),
                    "SnapABugChat.cancelVisitorRequest();",
                    iframeHeight
                  );
                } else if (syscmd == "COBR") {
                  // COBR = Cobrowsing Request To Visitor
                  // When agent selects "Screen Sharing" from the menu in the Hub,
                  // the visitor is presented with this.
                  var cobrParams = payload.split(" ");
                  var customDesignUI = SnapABug.getCustomDesignUI();
                  var CobrowseLoader = window.Cobrowse;

                  if (!!CobrowseLoader) {
                    handleCobrowseSysCmd(
                      cobrParams[1],
                      cobrParams[2],
                      nickname,
                      replay,
                      SnapABug.isCustomDesignEnabled(),
                      customDesignUI,
                      SnapEngage,
                      SnapEngageChat,
                      CobrowseLoader
                    );
                  }

                  if (!CobrowseLoader) {
                    SnapEngageChat.sendChatMessage(
                      6,
                      "Visitor browser does not have cobrowsing present."
                    );
                  }

                  return;
                } else if (syscmd == "SDTM") {
                  // SDTM = Secure Data Transfer Message to Visitor
                  // Whenever a visitor uploads data from a secure data transfer request, the visitor is presented with this
                  if (SnapABug.isCustomDesignEnabled()) {
                    if (replay) {
                      // we don't want to run anything if page is reloaded.  callbackHistory() passes replay = true on reloading.
                      return;
                    }

                    SnapABug.getCustomDesignUI().secureDataController.submitSecureDataClick();
                    //Cannot create click event on the submit button inside controller, so linking straight to the function after successful system message is returned from callbackPolling.

                    systemMsg = // The system message
                      '<div id="SnapABug_SystemMsg">' + // Text and lock icon
                      ' <div style="float:left; margin:0 5px 0 0;height:20px;"><img style="display:inline; height:20px;" src="' +
                      SnapABug.getBaseURL() +
                      '/img/securedata/fa-lock.png" /></div><div style="display:inline;">Thank you.  Your secure data has been received.</div>' + //TODO - update configurabel message.
                      // Close of systemMsg
                      "</div>";
                  } else {
                    // Set the chatbox back to normal (put the textarea back):
                    SnapABugChat.showFormChat();

                    systemMsg = // The system message
                      '<div id="SnapABug_SystemMsg" style="' +
                      SnapABug.getSystemMessageCSS(
                        0,
                        5,
                        SnapABugChat.getChatTranscriptWidth(),
                        ""
                      ) +
                      '">' + // Text and lock icon
                      ' <div style="float:left; margin:5px;height:32px;"><img style="display: inline" src="' +
                      SnapABug.getBaseURL() +
                      '/img/securedata/fa-lock.png" /></div><div style="margin-top:15px;display:inline-block;">' +
                      SnapABug.getMessage(43) +
                      "</div>" + // Close of systemMsg
                      "</div>";
                  }

                  systemMsgId = "SDTM_SECURE_DATA";
                  // Append systemMsg to chat
                  SnapABugChat.appendTextToChat(
                    "",
                    systemMsg,
                    false,
                    systemMsgId,
                    true,
                    false
                  );

                  // Now reset secureDataTransferInProgress back to false
                  secureDataTransferInProgress = false;
                } else if (syscmd == "APRV") {
                  // APRV = Approval Bot JSON settings

                  // we are not handling this unless Design Studio enabled
                  if (!SnapABug.isCustomDesignEnabled()) {
                    return false;
                  }

                  // This is the first time we can tell that this is an Approval Bot chat, so store
                  // that flag for elsewhere
                  SnapEngageChat.setIsApprovalBotChat(true);

                  // convert payload string into JSON
                  var payloadJSON = JSON.parse(payload.substr(5));
                  if (payloadJSON.approved) {
                    approvedDate = new Date();

                    if (!SnapABugChat.getCookie("SnapABugApproval")) {
                      SnapABugChat.setCookie(
                        "SnapABugApproval",
                        true,
                        365 * 24 * 60 /* 1 year */
                      );
                    }
                  } else {
                    if (SnapABugChat.getCookie("SnapABugApproval")) {
                      SnapABugChat.deleteCookie("SnapABugApproval");
                    }
                  }
                } else if (syscmd == "EMTR") {
                  // EMTR = Email Transcript Request

                  // only for Design Studio enabled forms
                  if (SnapABug.isCustomDesignEnabled()) {
                    // JSON.parse() parses string "true" into boolean true
                    var enabled = JSON.parse(payload.substr(5));
                    if (enabled) {
                      SnapABug.getCustomDesignUI().enableEmailTranscriptRequest();
                    }
                  }
                } else if (syscmd === "MSG2") {
                  this.isTyping(false);
                  var searchResultsString = payload.substr(5);
                  var searchResultsData = JSON.parse(searchResultsString);
                  this.handleNewMessageFormat(searchResultsData);
                }
                break;
              default:
                this.setReadOnly(false);
                if (!fromAgent) {
                  from = SnapABug.getMessage(15);
                } else {
                  chatAnswered = true;
                  if (SnapABug.getChatHandledByBot()) {
                    SnapABug.getCustomDesignUI()
                      .chatView.getMessageView()
                      .triggerAgentIsTyping(false);
                  }
                  // On page reload & fromAgent system command, chatAnswered does not get reloaded/updated until very late, so we then run the enable callme buttons again.
                }
                this.appendTextToChat(from, textMsg, historyOnly, false, false);
                if (!replay) {
                  this.newMessageNotification();

                  if (fromAgent) {
                    // If we're currently minimized, ++ the new message notifier.
                    if (SnapABugChat.isMinimized()) {
                      SnapABugChat.newMinimizedMessageReceived();
                    }

                    // Callback API
                    SnapABug.callCallback(
                      "ChatMessageReceived",
                      nickname,
                      textMsg
                    );
                  }
                }
                break;
            }
          }
          pollCount = 0;
        },
        loadVisitorIframe: function (iframeUrl, cancelOnclick, iframeHeight) {
          if (SnapABug.isMobileEnabled()) {
            return;
          } else if (SnapABug.isCustomDesignEnabled()) {
            SnapABug.getCustomDesignUI().initSecureFileDataTransfer(
              iframeUrl,
              iframeHeight
            );
            return;
          }

          // Save any text the visitor has typed into the textarea, it will restore during showFormChat()
          SnapABugChat.saveUserInput();

          // Store the transcript so that we can keep it in view
          var transcript = document.getElementById("SnapABug_CL");

          // Use the transcript's current position in the DOM
          transcript.style.position = "static";

          // Replace the textarea with the transcript
          SnapABugChat.populateSubChatForm(
            transcript.outerHTML,
            "SnapABug.closeForm()"
          );

          // Create iframe
          var div = document.createElement("div");
          div.setAttribute("id", "SnapABug_VisitorIframeDiv");
          div.setAttribute("display", "inline-block");
          div.innerHTML = // Upload iframe which uses chatFileUpload.jsp
            '<iframe id="SnapABug_VisitorIframe" src="' +
            iframeUrl +
            '" height="' +
            iframeHeight +
            'px" style="' +
            SnapABug.getCSS(0, 10, SnapABugChat.getChatTranscriptWidth()) +
            'display: inline-block; position: relative; padding: 5px;" scrolling="no" horizontalscrolling="no" verticalscrolling="no"></iframe>' + // Cancel button outside of iframe, which redraws the chatbox.  IE8 wants to draw the cancel text under the iframe, so push them down a bit with the <br/>
            '<br/><br/><a href="#" id="SnapABug_IframeCancel" style="float: left; font-style: italic; text-decoration: underline; color: gray; font-size: .9em; margin: 0px 10px 10px 0px;" onclick="' +
            cancelOnclick +
            '">' +
            SnapABug.getMessage(42) +
            "</a>";

          // Append the iframe and cancel button
          document.getElementById("SnapABug_CL").appendChild(div);

          // Get the full height of the chatbox, and enlarge SnapABug_CL to this full height
          var chatBoxHeight = SnapABugChat.getChatBoxHeight();
          document.getElementById(
            "SnapABug_CL"
          ).style.maxHeight = chatBoxHeight;
          document.getElementById(
            "SnapABug_CL"
          ).style.minHeight = chatBoxHeight;

          // Force browser to focus on the iframe
          document.getElementById("SnapABug_VisitorIframe").focus();

          // Scroll down to the new bottom of SnapABug_CL
          SnapABugChat.scrollDown();
        },
        cancelVisitorRequest: function () {
          // Send a message so the agent knows the request was cancelled (and this will be logged in the transcript)
          // TODO: i18n
          SnapABugChat.sendChatMessage(6, "Visitor has cancelled the request.");
          // Reset visitor requests to false
          SnapABugChat.setFileUploadInProgress(false);
          secureDataTransferInProgress = false;
          if (SnapABug.isCustomDesignEnabled()) {
            // restore form from within Custom Design files.
            return;
          }

          SnapABugChat.showFormChat();
        },
        createRandomId: function () {
          return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(
            /[xy]/g,
            function (c) {
              var r = (Math.random() * 16) | 0,
                v = c === "x" ? r : (r & 0x3) | 0x8;
              return v.toString(16);
            }
          );
        },
        // On mouseenter of the element, offer options to view or download
        // fileName is a parameter because it acts as the element's unique ID
        viewOrDownload: function (mouseAction, targetId, fileLink) {
          // Specify a target div in order to allow this function to perform on multiple elements
          var target = document.getElementById(targetId);

          // When mouse enters this element...
          if (mouseAction === "mouseenter") {
            // Make the target div opaque
            target.style.background = "rgba(0,0,0,0.3)";
            target.style.border = "rgba(0,0,0,0.3)";

            // Get the vertical center of the target div
            var iconHeight = 30;
            var top = Math.round((target.offsetHeight - iconHeight) / 2);

            // Append the view/download links to the target div
            var links = document.createElement("div");
            links.innerHTML =
              '<div id="links" style="margin: 0 auto; text-align: center">' + // View icon/link, Content-Disposition is empty here but set to 'inline' within FileUploadServlet.java,
              // which tells browser to view the file
              '   <a href="' +
              fileLink +
              '" target="_blank"><img id="view" src="' +
              SnapABug.getBaseURL() +
              '/img/fileupload/view.png" style="position: relative; top:' +
              top +
              'px; margin: 0 3px 0 0" alt="View" /></a>' + // Download icon/link, here Content-Disposition is set to 'attachment', which tells browser to download the file
              '   <a href="' +
              fileLink +
              '?contentDisposition=attachment"><img id="download" src="' +
              SnapABug.getBaseURL() +
              '/img/fileupload/download.png" style="position: relative; top:' +
              top +
              'px; margin: 0 0 0 3px;" alt="Download" /></a>' + // End of links div
              "</div>";

            target.appendChild(links);
          }

          // When mouse leaves this element...
          if (mouseAction === "mouseleave") {
            // Remove links parent node
            document
              .getElementById("links")
              .parentNode.removeChild(document.getElementById("links"));
            // Reset the background and border
            target.style.background = "";
            target.style.border = "";
          }
        },
        saveUserInput: function () {
          // Use this to save any text that the visitor has typed into the textarea
          // The userInput variable gets recalled again in SnapABugChat.showFormChat()
          var form = document.SnapABug_Form;
          if (form) {
            userInput = form.chat.value;
          }
        },
        callbackHistory: function (data, isChatAnswered, typeOfChat) {
          if (typeOfChat && SnapEngage.isCustomDesignEnabled()) {
            var mappedType = SnapEngage.getCustomDesignUI().TYPEOFCHAT[
              typeOfChat
            ];
            SnapEngage.getCustomDesignUI().setTypeOfChat(mappedType);
          }

          // The data is an array [fromAgent1,message1,id1,fromAgent2,message2,id2, etc.]
          // The messages are usual textual messages from agent or visitor, or a /NIC
          if (data && data.length > 0) {
            msgIdLst = {};
            var nextMessage = 0;
            for (var i = 0; i < data.length / 3; i++) {
              var fromAgent = data[i * 3];
              var message = data[i * 3 + 1];
              var id = data[i * 3 + 2];

              this.callbackMessage(fromAgent, message, true, true);

              if (id != -1) {
                msgIdLst[id] = 1;
                nextMessage = id;
              }
            }
            chatAnswered = isChatAnswered;
            this.displayHistory();
            this.setPollIdCookie(nextMessage);
          }
          pollCount = 0;
        },
        fileNamePretty: function (fileName) {
          if (fileName.length > 15) {
            var arr = fileName.split(".");
            var extension = arr[arr.length - 1];
            arr = arr.splice(0, arr.length - 1).join(".");
            // Truncate the middle of the filename
            arr = arr.substr(0, 6) + "..." + arr.substr(arr.length - 6, 6);
            return arr + "." + extension;
          } else {
            return fileName;
          }
        },
        cancelSecureDataRequest: function () {
          // Send a message so the agent knows the request was cancelled (and this will be logged in the transcript)
          //TODO: i18n
          SnapABugChat.sendChatMessage(
            6,
            "Visitor has cancelled the Secure Data Transfer request."
          );
          SnapABugChat.showFormChat();
        },
        newMessageNotification: function () {
          if (!SnapABug.isCustomDesignEnabled()) {
            document.title = this.getPageTitle(true);
            if (!proactiveRulesTimers.documentTitles) {
              proactiveRulesTimers.documentTitles = [];
            }
            proactiveRulesTimers.documentTitle.push(
              window.setTimeout(
                "document.title=SnapABugChat.getPageTitle(false);",
                1000
              )
            );
            proactiveRulesTimers.documentTitle.push(
              window.setTimeout(
                "document.title=SnapABugChat.getPageTitle(true);",
                1500
              )
            );
            proactiveRulesTimers.documentTitle.push(
              window.setTimeout(
                "document.title=SnapABugChat.getPageTitle(false);",
                2500
              )
            );
            proactiveRulesTimers.documentTitle.push(
              window.setTimeout(
                "document.title=SnapABugChat.getPageTitle(true);",
                3000
              )
            );
            proactiveRulesTimers.documentTitle.push(
              window.setTimeout(
                "document.title=SnapABugChat.getPageTitle(false);",
                4000
              )
            );
            proactiveRulesTimers.documentTitle.push(
              window.setTimeout(
                "document.title=SnapABugChat.getPageTitle(true);",
                4500
              )
            );
            proactiveRulesTimers.documentTitle.push(
              window.setTimeout(
                "document.title=SnapABugChat.getPageTitle(false);",
                5500
              )
            );
          } else {
            var favTitleStates = {
              state1: this.getPageTitle(true),
              state2: this.getPageTitle(false),
            };
            SnapABug.getCustomDesignUI().setVisitorNotification(favTitleStates);
          }

          if (SnapABug.getChatSoundAllowed()) {
            this.playSound();
          }
        },
        playSound: function () {
          var mp3 = SnapABug.getBaseURL() + "/sounds/chatmsg.mp3";
          var ogg = SnapABug.getBaseURL() + "/sounds/chatmsg.ogg";
          try {
            // TODO Would be better to load only once? Also, maybe preload?
            var a;
            if (SnapABug.isFirefox()) {
              a = new Audio(ogg);
            } else {
              a = new Audio(mp3);
            }
            a.play();
          } catch (e) {
            try {
              var sndDiv = document.getElementById("SnapABug_Snd");
              if (sndDiv) {
                sndDiv.innerHTML =
                  '<iframe src="' +
                  baseURL +
                  '/sounds/chatmsg.html" allowtransparency="true" frameborder="0" />';
              } else {
                return;
              }
            } catch (err) {}
          }
        },
        getPageTitle: function (says) {
          if (says) {
            // Get the message from admin settings, swap {alias} with nickname
            return SnapABug.getMessage(45).replace("{alias}", nickname);
            // 45: "{alias} says..."
          }
          if (pageTitle) {
            return pageTitle;
          }
          return document.domain;
        },
        getChatTranscriptWidth: function () {
          // Find out the width of the transcript area inside the chatbox, with a little breathing room
          return (
            document.getElementById("SnapABug_CL").offsetWidth -
            3 * transcriptPadding
          );
        },
        getPostChatWidth: function () {
          // Find out the width of the postchat area inside the chatbox, with a little breathing room
          return (
            document.getElementById("SnapABug_CM").offsetWidth -
            3 * transcriptPadding
          );
        },
        getChatBoxHeight: function () {
          // Get the entire height of the chatbox (SnapABug_CL + textarea)
          return (
            document.getElementById("SnapABug_CM").parentNode.offsetHeight +
            "px"
          );
        },
        setQuestion: function (text) {
          question = text;
          if (text != "(none)") {
            questionKeptForCanceledChat = text;
          }
        },
        cancelChat: function () {
          if (chatAnswered) {
            SnapABugChat.closeChat(true);
          } else {
            this.sendChatMessage(8 /* cancel chat */, "");
            caseId = "";
            // to avoid the closeForm() calling the case closure service
          }
          SnapABug.closeForm(true);
          SnapABug.setDescription(questionKeptForCanceledChat);
          SnapABug.allowChat(false);
          SnapABug.startLink();
        },
        closeChat: function (userClosed) {
          if (SnapABug.isCustomDesignEnabled()) {
            return;
          }

          this.stopPolling();
          if (userClosed && caseId) {
            // 2 = close chat
            this.sendChatMessage(2, "");
          }

          if (
            !SnapABug.isMobileEnabled() &&
            !SnapABug.isCustomDesignEnabled()
          ) {
            // If survey is not shown, show it
            // surveyShown boolean checks to see if the survey is already shown (so no duplicating)
            if (document.getElementById("chatSurvey") === null) {
              // Show the chat agent survey if enabled and the visitor has not been banned
              if (chatAgentSurvey && !SnapABugChat.getBannedCookie()) {
                this.populateChatAgentSurvey();
              } else if (postChatIframeURL) {
                var params =
                  "?agent=" +
                  encodeURIComponent(nickname) +
                  "&case=" +
                  encodeURIComponent(
                    SnapABug.getBaseURL() + "/viewcase?c=" + caseId
                  );
                var html =
                  '<iframe src="' +
                  postChatIframeURL +
                  params +
                  '" frameborder="0" width="100%" height="100%" style="overflow:hidden"></iframe>';
                this.populateSubChatForm(html, "SnapABug.closeForm();");
                postChatIframeURL = "";
              } // Post chat custom text/html
              else if (postChatHTML) {
                // special substitution done locally in the browser but most substitutions are done server side
                postChatHTML = postChatHTML.replace(
                  /\{alias\}/g,
                  encodeURIComponent(nickname)
                );
                postChatHTML = postChatHTML.replace(
                  /\{case\}/g,
                  encodeURIComponent(
                    SnapABug.getBaseURL() + "/viewcase?c=" + caseId
                  )
                );
                this.populateSubChatForm(postChatHTML, "SnapABug.closeForm();");
                postChatHTML = "";
              }
            }
          }

          caseId = "";
          this.deleteChatCookies();
          this.reInit();
        },

        resetCaseIdFromCustomDesign: function () {
          caseId = "";
        },

        redirectBrowser: function (url) {
          // TODO cancel the redirect and send message to agent if cookies can not be written
          var form = document.SnapABug_Form;
          if (form) {
            userInput = form.chat.value;

            if (userInput != "") {
              try {
                var whitespaceRegEx = new RegExp(/^\s+$/);
                if (!whitespaceRegEx.test(userInput)) {
                  this.setMessageCookie(
                    userInput.replace(/^\s*/, "").replace(/\s*$/, "")
                  );
                }
              } catch (e) {}
            }
          }
          systemMsgId = "GO2_REDIRECT";
          this.appendTextToChat(
            "",
            "redirecting...",
            false,
            systemMsgId,
            false
          );

          var changeDomain = false;

          // Check if the URL is changing the hostname, to then continue the chat on the hosted chat page
          try {
            var currentServer = document.location.hostname;
            if (url.indexOf("http") === 0 && url.indexOf("://") !== -1) {
              var destinationServer = url.substring(url.indexOf("://") + 3);
              if (destinationServer.indexOf("/") !== -1) {
                // We have a path after the hostname, remove it
                destinationServer = destinationServer.substring(
                  0,
                  destinationServer.indexOf("/")
                );
                if (destinationServer.indexOf(":") !== -1) {
                  // We have a port number after the hostname, remove it
                  destinationServer = destinationServer.substring(
                    0,
                    destinationServer.indexOf(":")
                  );
                }
              }

              if (
                url.indexOf(SnapABug.getBaseURL() + "/chat?c=") === 0 ||
                url.indexOf(
                  SnapABug.getBaseURL().replace("http:", "https:") + "/chat?c="
                ) === 0
              ) {
                // handle the case of redirecting to the legacy iframizer /chat?c=... (i.e. for join.me)
                // do nothing more, as the url already has everything for chat continuation
                changeDomain = true;
              } else if (
                destinationServer != "" &&
                currentServer != destinationServer &&
                (SnapABug.getDomain() == "" ||
                  destinationServer.indexOf(SnapABug.getDomain()) === -1)
              ) {
                // cross-domain redirect, send to the iframizer instead
                var iframizer = SnapABug.getBaseURL() + "/chatcrossdomain?c=";

                if (url.indexOf("http://") === 0) {
                  // the destination URL is http, not https, ensure the iframizer is also on http,
                  // as an https page can not load an iframe with a http URL
                  iframizer = iframizer.replace("https://", "http://");
                }

                url =
                  iframizer +
                  SnapABug.getCaseId() +
                  "&u=" +
                  encodeURIComponent(url) +
                  "&w=" +
                  SnapABug.getWidgetId();
                changeDomain = true;

                // Delete the chat session cookie such as we do not risk ending up with chat in top and bottom frame
                this.deleteChatCookies();
              }
            }
          } catch (e) {}

          if (changeDomain && top && top.frames && top.frames.length > 0) {
            proactiveRulesTimers.changeLocation = setTimeout(
              'top.location.href = "' + url + '"',
              100
            );
          } else {
            proactiveRulesTimers.changeLocation = setTimeout(
              'window.location.href = "' + url + '"',
              100
            );
          }
        },
        formCallMeDone: function () {
          this.showFormChat();
          //this.startPolling();
        },
        setCaseIdCookie: function () {
          if (caseId) {
            this.setCookie("SnapABugChatSession", caseId, 16);
          }
        },
        getCaseIdCookie: function () {
          return this.getCookie("SnapABugChatSession");
        },
        setNoProactiveChatCookie: function () {
          // NoProactiveChat cookie should only be set if the window was closed, proactiveTimeout fires, or the visitor has chatted before
          this.setCookie(
            "SnapABugNoProactiveChat",
            "no",
            SnapABug.getNoProactiveChatDelay()
          );
        },
        isNoProactiveChatCookie: function () {
          return (
            this.getCookie("SnapABugNoProactiveChat") == "no" ||
            !this.isCookieEnabled()
          );
        },
        // We need to know if someone has used the "forced" parameter when calling SnapEngage.openProactiveChat() API,
        // when we are inside the Custom Design code
        setIsForcedProactive: function (isForcedProactive) {
          this.isForcedProactive = isForcedProactive;
        },
        getIsForcedProactive: function () {
          return this.isForcedProactive;
        },
        setPollIdCookie: function (pollId) {
          if (caseId != "") {
            this.setCookie("SnapABugChatPoll" + caseId, pollId, 16);
          }
        },
        getPollIdCookie: function () {
          var oldPollId = pollId;
          if (caseId != "") {
            pollId = parseInt(this.getCookie("SnapABugChatPoll" + caseId));
            if (isNaN(pollId)) {
              pollId = oldPollId;
            }
          }
          return pollId;
        },
        setMessageCookie: function (msg) {
          this.setCookie("SnapABugChatMessage", encodeURIComponent(msg), 16);
        },
        getMessageCookie: function () {
          return decodeURIComponent(this.getCookie("SnapABugChatMessage"));
        },
        setAgentAvatarCookie: function (avatar) {
          this.setCookie("SnapABugAgentAvatar", encodeURIComponent(avatar), 16);
        },
        getAgentAvatarCookie: function () {
          return decodeURIComponent(this.getCookie("SnapABugAgentAvatar"));
        },
        setChatViewCookie: function () {
          chatview = Math.random();
          this.setCookie("SnapABugChatView", chatview, 16);
        },
        refreshChatViewCookie: function () {
          this.setCookie("SnapABugChatView", chatview, 16);
        },
        isChatViewCookieValid: function () {
          var cvc = this.getCookie("SnapABugChatView");
          if (chatview == cvc || cvc == "") {
            return true;
          } else {
            return false;
          }
        },

        removeDupeCookies: function (keyWord) {
          var existingCookies = getAllCookies().split(";");
          var dupes = [];
          existingCookies.forEach(function (cookie, i) {
            if (cookie.indexOf(keyWord) >= 0) {
              dupes.push(cookie.trim());
            }
          });

          dupes.pop();
          dupes.forEach(
            function (dupe) {
              if (this.getCookie("SnapABugHistory") === dupe.split("=")[1]) {
                this.deleteCookie(keyWord);
              }
            }.bind(this)
          );
        },

        updateHistoryCookieForLastCase: function (caseId) {
          this.removeDupeCookies("SnapABugHistory", true);

          if (!caseId) {
            return;
          }

          try {
            var history = new SnapABugHistory(
              this.getCookie("SnapABugHistory")
            );
            var date = new Date();
            var time = date.getTime();

            var cases = history.cases();
            if (cases.length) {
              var lastCase = cases[cases.length - 1].split(":")[0];
              if (lastCase === caseId) {
                return;
              }
            }
            history.addNewCaseData(caseId, time);
            var newCookieValue = history.getAsString();

            this.setCookie(
              "SnapABugHistory",
              newCookieValue,
              365 * 24 * 60 /* 1 year */
            );
          } catch (e) {
            this.setCookie("SnapABugHistory", "0#", 365 * 24 * 60 /* 1 year */);
          }
        },
        setHistoryCookieIncrementVisits: function () {
          try {
            var hist = this.getCookie("SnapABugHistory");
            if (hist == "") {
              hist = "1#";
            } else {
              // TODO - try/catch this
              var a = hist.split("#");
              var count = parseInt(a[0]) + 1;
              a[0] = count;
              hist = a[0] + "#" + a[1];
            }
            this.setCookie("SnapABugHistory", hist, 365 * 24 * 60 /* 1 year */);
          } catch (e) {
            this.setCookie("SnapABugHistory", "0#", 365 * 24 * 60 /* 1 year */);
          }
        },
        getHistoryCookie: function () {
          return this.getCookie("SnapABugHistory");
        },
        getHistoryCookieLastCase: function () {
          try {
            var hist = this.getCookie("SnapABugHistory");
            var countCases = hist.split("#");
            var cases = countCases[1].split("!");
            return cases[cases.length - 2].split(":");
          } catch (e) {}
        },
        getTokensCookies: function () {
          var tokens = "";
          var hubspotCookie = this.getCookie("hubspotutk");
          if (hubspotCookie) {
            tokens += "28#" + hubspotCookie + "!";
          }
          return tokens;
        },
        getVisitorIsFirstTimeVisiting: function () {
          try {
            var hist = this.getCookie("SnapABugHistory");

            var a = hist.split("#");
            var count = parseInt(a[0]);
            if (count <= 1) {
              return true;
            } else {
              return false;
            }
          } catch (e) {
            return true;
            //Assume that an exception was thrown because of missing x# in string, I assume this is because cookie hasn't been set => first visit
          }
        },
        getVisitorNumberOfPreviousChats: function () {
          try {
            var hist = this.getCookie("SnapABugHistory");

            var a = hist.split("#");
            return (a[1].match(/!/g) || []).length;
          } catch (e) {
            return 0;
            //Assume that an exception was thrown because string don't have correct format, I assume this is because cookie hasn't been set => first visit => no chats
          }
        },
        // Visit cookie format: nbVisits#timeOfFirstVisit
        setInitialVisitCookie: function () {
          // Stores time of arrival, pages visited
          if (!SnapABugChat.getVisitCookie()) {
            SnapABugChat.setCookie(
              "SnapABugVisit",
              "0#" + Math.round(new Date().getTime() / 1000),
              SnapABug.getVisitorCookieLifeTime()
            );
          }
        },
        getVisitCookie: function () {
          return SnapABugChat.getCookie("SnapABugVisit");
        },
        incrementVisitCookie: function () {
          // Stores time of arrival, pages visited
          if (SnapABugChat.getVisitCookie()) {
            // Visit cookie format: nbVisits#timeOfFirstVisit
            var values = SnapABugChat.getVisitCookie().split("#");
            var incrementedVisitCookieValue =
              parseInt(values[0]) + 1 + "#" + values[1];
            SnapABugChat.setCookie(
              "SnapABugVisit",
              incrementedVisitCookieValue,
              SnapABug.getVisitorCookieLifeTime()
            );
          }
        },
        getVisitorTimeOnSite: function () {
          if (SnapABugChat.getVisitCookie()) {
            // Visit cookie format: nbVisits#timeOfFirstVisit
            return (
              Math.round(new Date().getTime() / 1000) -
              SnapABugChat.getVisitCookie().split("#")[1]
            );
          } else {
            return 0;
          }
        },
        getVisitorTimeOnPage: function () {
          var currentTime = +new Date();
          return (currentTime - pageInitTime) / 1000;
        },
        getVisitorNumberOfPagesVisited: function () {
          if (SnapABugChat.getVisitCookie()) {
            // Visit cookie format: nbVisits#timeOfFirstVisit
            return SnapABugChat.getVisitCookie().split("#")[0];
          } else {
            return "";
          }
        },
        // Proactive v2 -- end
        setUserEmailCookie: function (email) {
          this.deleteCookie("SnapABugUserEmail");
          var xoredEmail = "";
          for (var i = 0; i < email.length; ++i) {
            xoredEmail += String.fromCharCode(6 ^ email.charCodeAt(i));
          }
          this.setCookie(
            "SnapABugUserEmail",
            encodeURIComponent("#" + xoredEmail),
            365 * 24 * 60
          );
        },
        getUserEmailCookie: function () {
          var xoredEmail = decodeURIComponent(
            this.getCookie("SnapABugUserEmail")
          );
          var email = "";
          if (xoredEmail.charAt(0) == "#") {
            for (var i = 1; i < xoredEmail.length; i++) {
              email += String.fromCharCode(6 ^ xoredEmail.charCodeAt(i));
            }
          } else {
            // Old format, non xor'ed
            email = xoredEmail;
          }
          return email;
        },
        // Deprecated due to DEV-9307 / DEV-9262
        // Use setUserAliasCookie() instead
        setUserNameCookie: function (name) {
          this.deleteCookie("SnapABugUserName");
          var xoredUserName = "";
          for (var i = 0; i < name.length; ++i) {
            xoredUserName += String.fromCharCode(6 ^ name.charCodeAt(i));
          }
          this.setCookie(
            "SnapABugUserName",
            encodeURIComponent("#" + xoredUserName),
            365 * 24 * 60
          );
        },
        // Deprecated due to DEV-9307 / DEV-9262
        // Use getUserAliasCookie() instead
        getUserNameCookie: function () {
          var xoredUserName = decodeURIComponent(
            this.getCookie("SnapABugUserName")
          );
          var name = "";
          if (xoredUserName.charAt(0) == "#") {
            for (var i = 1; i < xoredUserName.length; i++) {
              name += String.fromCharCode(6 ^ xoredUserName.charCodeAt(i));
            }
          } else {
            // Old format, non xor'ed
            name = xoredUserName;
          }
          return name;
        },
        setUserAliasCookie: function (name) {
          this.deleteCookie("SnapABugUserAlias");
          var xoredUserName = "";
          for (var i = 0; i < name.length; ++i) {
            xoredUserName += String.fromCharCode(6 ^ name.charCodeAt(i));
          }
          this.setCookie(
            "SnapABugUserAlias",
            encodeURIComponent("#" + xoredUserName),
            365 * 24 * 60
          );
        },
        getUserAliasCookie: function () {
          var xoredUserName = decodeURIComponent(
            this.getCookie("SnapABugUserAlias")
          );
          var name = "";
          if (xoredUserName.charAt(0) == "#") {
            for (var i = 1; i < xoredUserName.length; i++) {
              name += String.fromCharCode(6 ^ xoredUserName.charCodeAt(i));
            }
          } else {
            // Old format, non xor'ed
            name = xoredUserName;
          }
          return name;
        },
        setBannedCookie: function () {
          this.setCookie("SnapABugBanned", "1", 30 * 24 * 60);
        },
        getBannedCookie: function () {
          return this.getCookie("SnapABugBanned");
        },
        /**
         * Deletes all cookies that are individual to each chat session.
         * This is called at the close of a chat.
         */
        deleteChatCookies: function () {
          // set cookies to blank string
          this.setCookie("SnapABugChatSession", "", 16);
          this.setCookie("SnapABugChatView", "", 16);
          this.setCookie("SnapABugChatMessage", "", 16);
          this.setCookie("SnapABugAgentAvatar", "", 16);

          // then delete the cookies
          this.deleteCookie("SnapABugChatSession");
          this.deleteCookie("SnapABugChatView");
          this.deleteCookie("SnapABugChatMessage");
          this.deleteCookie("SnapABugAgentAvatar");
        },
        setCookie: function (key, val, ttlInMinutes) {
          var expires = "";
          if (ttlInMinutes > 0) {
            var date = new Date();
            date.setTime(date.getTime() + ttlInMinutes * 60 * 1000);
            expires = "; expires=" + date.toGMTString();
          }
          var domain = "";
          if (SnapABug.getDomain()) {
            domain = "; domain=" + SnapABug.getDomain();
          }
          var other = "";
          if (secureCookies) {
            other = "; Secure";
          }
          document.cookie =
            key + "=" + val + expires + "; path=/;" + domain + other;
        },
        deleteCookie: function (key) {
          var domain = "";
          if (SnapABug.getDomain()) {
            domain = "; domain=" + SnapABug.getDomain();
          }
          document.cookie =
            key +
            "=; expires=Thu, 01-Jan-70 00:00:01 GMT;" +
            "; path=/;" +
            domain;
        },
        getCookie: function (key) {
          var ca = document.cookie.split(";");
          for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == " ") {
              c = c.substring(1, c.length);
            }
            if (c.indexOf(key) == 0) {
              return c.substring(key.length + 1, c.length);
            }
          }
          return "";
        },
        isCookieEnabled: function () {
          var cookieEnabled = navigator.cookieEnabled ? true : false;
          if (
            typeof navigator.cookieEnabled === "undefined" &&
            !cookieEnabled
          ) {
            // the flag is not available, so we must do a real cookie test; luckily our
            // visit cookie is set during the init so must be there and not empty
            cookieEnabled = SnapABugChat.getVisitCookie() != "";
          }
          return cookieEnabled;
        },
        getSystemCommandsCustomDesign: function () {
          // for Custom Design forms that need system command variables
          // get scmd objects: chatAgentSurvey, postChatHTML, caseId, & nickname, and return to CustomDesign which handle logic to determine which survey to be used.
          return {
            chatAgentSurvey: chatAgentSurvey,
            nickname: nickname,
            postChatHTML: postChatHTML,
            caseId: caseId,
            timeOut: surveyGracePeriod,
          };
        },
        getChatAnsweredStatus: function () {
          // FIXME this cannot be relied on, as it seems chatAnswered doesn't always get reset after an answered chat is closed
          return chatAnswered;
        },
        populateChatAgentSurvey: function () {
          if (SnapABug.isMobileEnabled()) {
            return;
            // No survey on mobile, avoid console error.
          }

          SnapABug.hideChatBoxMenu();

          // Scope vars.
          var el_chatSurvey;
          var el_chatSurveyRatingContainer;
          var el_chatSurveyRating;
          var el_chatSurveyQuestion;
          var el_chatSurveyCommentsContainer;
          var el_chatSurveyComments;
          var el_chatSurveySubmitContainer;
          var el_chatSurveySubmitButton;
          var el_chatSurveyCancelButton;
          var el_chatSurveyResults;

          function setCommentsHeight() {
            var subChatContainer = document.getElementById("SnapABug_CM")
              .parentNode;

            var subChatContainerHeight = parseInt(
              subChatContainer.style.height,
              10
            );
            // QUESTION: why are we using the style.height instead of the element computed height?

            var headerHeight = el_chatSurveyRatingContainer.offsetHeight;
            el_chatSurveyCommentsContainer.style.display = "block";
            // Set temporarily to block so we can get an accurate height.
            var submitAreaHeight = el_chatSurveySubmitContainer.offsetHeight;
            el_chatSurveyCommentsContainer.style.display = "none";
            // Re-hide after getting height.

            var determinedTextAreaHeight =
              subChatContainerHeight - headerHeight - submitAreaHeight - 24;
            // 24px of extra padding for bottom;
            el_chatSurveyComments.style.height =
              determinedTextAreaHeight + "px";
          }

          if (chatAgentSurvey) {
            var chatSurveyHtml =
              "" +
              '<div id="chatSurvey" style="text-align: center; margin: 5px ' +
              transcriptPadding +
              'px 5px 0px;"> ' +
              '  <div id="chatSurveyRatingContainer"> ' +
              '    <div id="chatSurveyQuestion" style="padding: 5px 5px 5px 5px;">' +
              SnapABug.getMessage(21) +
              "</div> " +
              '    <div id="chatSurveyRating" style="height: 36px;"></div> ' +
              '    <div id="chatSurveyRatingText" style="height: 20px;" ></div> ' +
              "  </div> " +
              '  <div id="chatSurveyCommentsContainer" style="padding: 5px; display: none;"> ' +
              '    <textarea id="chatSurveyComments" maxlength="500" style="width: 100%; padding: 5px; height: auto; resize: none; outline: none; border: 1px solid #999999 !important; -webkit-border-radius: 2px; -moz-border-radius: 2px; border-radius: 2px; box-shadow:none !important; font-family: arial,sans-serif; font-size: 12px; font-weight: normal; font-style: normal; line-height: normal; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box;">' +
              SnapABug.getMessage(23) +
              "</textarea> " +
              '    <div id="chatSurveySubmitContainer"> ' +
              '      <div style="' +
              SnapABug.getDisplayInlineBlockCSS() +
              ' padding: 5px 0 0 0;">' +
              '        <input id="chatSurveySubmitButton" value="' +
              SnapABug.getMessage(24) +
              '" type="button" style="clear: none; height: 25px; width: inherit; margin: 0px 0px 0px 4px; cursor: pointer; outline: none; border: 1px solid rgb(160, 161, 160); background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, from(rgb(255, 255, 255)), to(rgb(199, 201, 199))); padding: 3px 5px; width: auto; overflow: visible; border-top-left-radius: 10px; border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-bottom-left-radius: 10px; color: rgb(81, 85, 93); font-size: 12px; font-family: \'lucida grande\', \'Helvetica Neue\', Helvetica, Arial, sans-serif; text-decoration: none; font-weight: bold;">' +
              "      </div> " +
              '      <div style="' +
              SnapABug.getDisplayInlineBlockCSS() +
              ' padding: 5px 0 0 0;">' +
              '        <a id="chatSurveyCancelButton" style="color: #999; text-decoration: none;" href="#">' +
              SnapABug.getMessage(25) +
              "</a>" +
              "      </div> " +
              "    </div> " +
              "  </div> " +
              "</div> " +
              '<div id="chatSurveyResults" style="padding-top: 0px; padding-bottom: 10px; font-weight: 800; text-align: center; display: none;">' +
              SnapABug.getMessage(26) +
              "</div>";

            // store the transcript so that we can keep it in view when the survey is populated
            var transcript = document.getElementById("SnapABug_CL");

            SnapABugChat.populateSubChatForm(
              transcript.outerHTML,
              "SnapABug.closeForm();"
            );

            // This is where the survey div gets created
            var surveyDiv = document.createElement("div");
            surveyDiv.innerHTML = chatSurveyHtml;

            document.getElementById("SnapABug_CL").appendChild(surveyDiv);
            document.getElementById("SnapABug_CL").style.position = "static";
            // Get the height of CM's parent div
            var boxHeight =
              document.getElementById("SnapABug_CM").parentNode.offsetHeight +
              "px";
            var boxWidth =
              document.getElementById("SnapABug_CM").parentNode.offsetWidth -
              transcriptPadding +
              "px";
            // Set the height of the chatbox to be this height (this is important for custom forms)
            document.getElementById("SnapABug_CL").style.maxHeight = boxHeight;
            document.getElementById("SnapABug_CL").style.minHeight = boxHeight;
            document.getElementById("SnapABug_CL").style.maxWidth = boxWidth;
            document.getElementById("SnapABug_CL").style.minWidth = boxWidth;

            el_chatSurvey = document.getElementById("chatSurvey");
            el_chatSurveyRatingContainer = document.getElementById(
              "chatSurveyRatingContainer"
            );
            el_chatSurveyRating = document.getElementById("chatSurveyRating");
            el_chatSurveyQuestion = document.getElementById(
              "chatSurveyQuestion"
            );
            el_chatSurveyCommentsContainer = document.getElementById(
              "chatSurveyCommentsContainer"
            );
            el_chatSurveyComments = document.getElementById(
              "chatSurveyComments"
            );
            el_chatSurveySubmitContainer = document.getElementById(
              "chatSurveySubmitContainer"
            );
            el_chatSurveySubmitButton = document.getElementById(
              "chatSurveySubmitButton"
            );
            el_chatSurveyCancelButton = document.getElementById(
              "chatSurveyCancelButton"
            );
            el_chatSurveyResults = document.getElementById("chatSurveyResults");

            // Populate the rating area (stars, smileys, whatever)
            var chatRatingHtml = "";
            var ratings = chatAgentSurvey.ratings;
            for (var i = 0; i < ratings.length; i++) {
              chatRatingHtml =
                chatRatingHtml +
                '<img id="' +
                ratings[i].id +
                '" alt="' +
                ratings[i].text +
                '" src="' +
                SnapABug.getBaseURL() +
                ratings[i].defaultImg +
                '" style="cursor: pointer;" onmouseover="SnapABugChat.mouseoverChatAgentSurveyRating(this.id);" onmouseout="SnapABugChat.mouseoutChatAgentSurveyRating(this.id);" onmousedown="SnapABugChat.setChatAgentSurveyRating(this.id)" />';
            }
            el_chatSurveyRating.innerHTML = chatRatingHtml;
            setCommentsHeight();

            // Animated scroll down to bottom of comment box
            var chatLog = document.getElementById("SnapABug_CL");
            // start = height - size of chat window. Can't use scrollTop because it is set to 0 by the scrollDown func
            var scrollStart =
              chatLog.scrollHeight -
              document.getElementById("SnapABug_CM").parentNode.offsetHeight;
            SnapABugChat.animateScrollDown(chatLog, scrollStart, 3000);

            if (nickname.length > 0) {
              var chatSurveyQuestion = SnapABug.getMessage(22);
              chatSurveyQuestion = chatSurveyQuestion.replace(
                "{alias}",
                nickname
              );
              el_chatSurveyQuestion.innerHTML = chatSurveyQuestion;
            } else {
              el_chatSurveyQuestion.innerHTML = SnapABug.getMessage(21);
            }

            el_chatSurveyComments.onfocus = function () {
              // only clear out the comments if they haven't changed fromt the default text
              if (this.value === SnapABug.getMessage(23)) {
                this.value = "";
              }
            };

            el_chatSurveySubmitButton.onclick = function () {
              // Fade out the survey
              SnapABugChat.animateFadeOut(
                document.getElementById("chatSurvey")
              );
              el_chatSurveyResults.style.display = "";
              // thank the visitor for the feedback
              // Autofocus on the transcript (for ability to scroll without having to select it)
              document.getElementById("SnapABug_CL").focus();
              chatAgentSurvey = null;
              SnapABugChat.sendChatAgentSurveyRating();
            };

            // On click of the cancel button, close the survey
            // but keep the chat box and transcript in view.
            el_chatSurveyCancelButton.onclick = function () {
              SnapABugChat.closeChatAgentSurvey();
              return false;
            };

            // automatically close the form 10 minutes after the survey is shown
            setTimeout(function () {
              SnapABugChat.closeChatAgentSurvey();
            }, 1000 * 60 * 60 * 10);
          }
        },
        // On any mouseover of a particular ratings icon, collect the rating and comments.
        mouseoverChatAgentSurveyRating: function (currentId) {
          if (chatAgentSurvey) {
            var fiveStar = 0;
            var oneToTen = 2;
            var ratings = chatAgentSurvey.ratings;
            for (var i = 0; i < ratings.length; i++) {
              // change rating up to, and including the current one, if it's a multiple selection type of chatAgentSurvey
              if (
                chatAgentSurvey.type == fiveStar ||
                chatAgentSurvey.type == oneToTen
              ) {
                // Get the ratings element
                document.getElementById(ratings[i].id).src =
                  SnapABug.getBaseURL() + ratings[i].selectedImg;
                // Get the ratings comment element
                document.getElementById("chatSurveyRatingText").innerHTML =
                  ratings[i].text;
              }

              if (ratings[i].id == currentId) {
                document.getElementById(ratings[i].id).src =
                  SnapABug.getBaseURL() + ratings[i].selectedImg;
                document.getElementById("chatSurveyRatingText").innerHTML =
                  ratings[i].text;
                break;
              }
            }
          }
        },
        // On mouseout of the current icon, clear all past ratings,
        mouseoutChatAgentSurveyRating: function (currentId) {
          if (chatAgentSurvey) {
            // clear the ratings beyond the past the current one
            var ratings = chatAgentSurvey.ratings;
            for (var i = ratings.length - 1; i >= 0; i--) {
              document.getElementById(ratings[i].id).src =
                SnapABug.getBaseURL() + ratings[i].defaultImg;
            }
            // if a rating has been selected change ratings up to the point of the selected one
            if (selectedAgentSurveyRating) {
              SnapABugChat.mouseoverChatAgentSurveyRating(
                selectedAgentSurveyRating.id
              );
            } else {
              document.getElementById("chatSurveyRatingText").innerHTML = "";
            }
          }
        },
        // This happens on mousedown (click) of the ratings icon
        setChatAgentSurveyRating: function (currentId) {
          if (chatAgentSurvey) {
            // The ratings get stored in mouseover/mouseout
            var ratings = chatAgentSurvey.ratings;
            for (var i = 0; i < ratings.length; i++) {
              if (ratings[i].id == currentId) {
                // set the selected rating
                selectedAgentSurveyRating = ratings[i];
                // record rating
                SnapABugChat.sendChatAgentSurveyRating();
                // change ratings up to the selected one
                // This function fires even if the user hasn't moused out of the star
                SnapABugChat.mouseoutChatAgentSurveyRating(
                  selectedAgentSurveyRating.id
                );
                break;
              }
            }
            // This is where the comments box is triggered (display = '' means revert to default display)
            document.getElementById(
              "chatSurveyCommentsContainer"
            ).style.display = "";
            // Animated scroll down to bottom of the chatbox
            var chatLog = document.getElementById("SnapABug_CL");

            SnapABugChat.animateScrollDown(chatLog, chatLog.scrollTop, 3000);
          }
        },
        // Send the rating if it has been selected by the user (i.e. send even if the user hasn't hit Submit)
        sendChatAgentSurveyRating: function () {
          if (selectedAgentSurveyRating) {
            var url =
              SnapABug.getBaseURL() +
              "/chatjs/postChat/recordSurvey?publicCaseId=" +
              SnapABug.getCaseId() +
              "&rating=" +
              selectedAgentSurveyRating.id;
            // Get the comments from the survey
            var comments = document.getElementById("chatSurveyComments").value;
            if (comments != SnapABug.getMessage(23)) {
              url =
                url +
                "&comments=" +
                encodeURIComponent(SnapABug.trim(comments));
            }
            SnapABug.rpc(url, 3, "sendChatAgentSurveyRating");
          }
        },
        callbackRecordSurveyAction: function () {
          // this function is called as part of the recordSurvey response but doesn't currently do anything
        },
        closeChatAgentSurvey: function () {
          // clear the survey so we don't get caught in a loop
          chatAgentSurvey = null;
          // Instead of closing the whole form we just want to remove/fade out the survey
          var chatSurvey = document.getElementById("chatSurvey");
          // Recursive call to incrementally fade out the chat survey
          SnapABugChat.animateFadeOut(chatSurvey);
          // Now autofocus the chatbox transcript (for ability to scroll without having to select it))
          document.getElementById("SnapABug_CL").focus();
        },
        isMinimized: function () {
          return SnapABugChat.getChatWindowCookieData("isMinimized");
        },
        minimizeToggle: function () {
          // This is added to the minimize button's onclick
          var isMinimized = SnapABugChat.isMinimized();
          if (typeof isMinimized === "undefined") {
            return;
            // Minimization function not initialized.
          }

          if (SnapABug.isChatInProgress()) {
            SnapABug.sendTextToChat(
              "Visitor has " +
                (isMinimized ? "un-" : "") +
                "minimized the Chat Box."
            );
            // Needs Translation eventually.
            if (isMinimized) {
              SnapABugChat.unminimizeChat();
              return false;
            } else {
              SnapABugChat.minimizeChat();
              return true;
            }
          }
        },
        minimizeChat: function (onPageLoad) {
          if (SnapABugChat.isMinimized() === "undefined") {
            return;
            // Not initialized.
          }

          SnapABugChat.setChatWindowCookieData("isMinimized", true);

          // if user minimizes a proactive chatbox with no chat started yet,
          // prevent proactive from popping up again after page reload/navigation
          if (!SnapABugChat.getCookie("isProactiveInvite")) {
            SnapABugChat.setNoProactiveChatCookie();
          }

          if (SnapABug.isCustomDesignEnabled()) {
            return;
          }

          var wp = document.getElementById("SnapABug_WP");

          if (wp.className.indexOf("minimized") === -1) {
            // If _WP does not have the minimized class
            wp.className += " minimized";
            // Then add it.
          }

          var nmni = document.getElementById("SnapABug_NMNi");
          // New Message Notification

          nmni.innerHTML = SnapABugChat.getChatWindowCookieData(
            "newMinimizedMessageCount"
          );

          var minDim = SnapABugChat.minimizedDimensions;
          var cbPos = [];
          var i = 0;

          if (typeof onPageLoad === "undefined" || !onPageLoad) {
            // Save current Chat Box Position
            // Only if this call is not coming from setPreviousChatWindowState()
            cbPos = [
              parseInt(wp.style.left, 10),
              parseInt(wp.style.right, 10),
              parseInt(wp.style.top, 10),
              parseInt(wp.style.bottom, 10),
            ];
            for (i = 0; i < cbPos.length; i++) {
              if (isNaN(cbPos[i]) || cbPos[i] === 0) {
                cbPos[i] = -1;
              }
            }
            SnapABugChat.setChatWindowCookieData("chatBoxPosition", cbPos);
          }

          // Shrink to size determined in the minimizedDimensions
          wp.style.width = minDim[2] + "px";
          wp.style.height = minDim[3] + "px";

          // Pin to bottom right or left.
          var middleOfWindow = SnapABug.getWindowWidth() / 2;
          var halfWidthOfElement = minDim[2] / 2;

          // If we have a value in SnapABugChat.getChatWindowCookieData('chatBoxPosition')[0] (0 => left) then we'll use that, because we have either just set it or we're reloading the page. If we don't have one we'll use the chat windows current position.
          var elementHorizontalMidCoordinate =
            (SnapABugChat.getChatWindowCookieData("chatBoxPosition")[0] === -1
              ? wp.offsetLeft
              : SnapABugChat.getChatWindowCookieData("chatBoxPosition")[0]) +
            halfWidthOfElement;
          wp.style.bottom = wp.style.right = wp.style.top = wp.style.left = "";
          // Clear all position styles.
          if (elementHorizontalMidCoordinate < middleOfWindow) {
            wp.style.left = "0";
          } else {
            wp.style.right = "0";
          }

          wp.style.bottom = "0";

          // Offset based on the minimizedDimensions
          if (minDim[0] !== 0 || minDim[1] !== 0) {
            var p = document.getElementById("SnapABug_P");
            // form container.
            p.style.left = minDim[0] + "px";
            p.style.top = minDim[1] + "px";
          }

          document.getElementById("SnapABug_DB").style.display = "none";
          // Hide the position dragger.

          // Remove ability to tab into _WP elements. (Causes internal elements to scroll (which is bad).)
          var tiNodeArray = [];
          // Tab Index Node Array
          var wpa = wp.getElementsByTagName("a");

          for (i = 0; i < wpa.length; i++) {
            tiNodeArray.push(wpa[i]);
          }
          var wpta = wp.getElementsByTagName("textarea");
          for (i = 0; i < wpta.length; i++) {
            tiNodeArray.push(wpta[i]);
          }
          if (SnapEngage.isIE()) {
            var wpi = wp.getElementsByTagName("iframe");
            for (i = 0; i < wpi.length; i++) {
              tiNodeArray.push(wpi[i]);
            }
          }
          for (i = 0; i < tiNodeArray.length; i++) {
            tiNodeArray[i].setAttribute("tabIndex", "-1");
          }
        },
        unminimizeChat: function () {
          if (SnapABugChat.isMinimized() === "undefined") {
            return;
            // Minimization function not initialized.
          }

          SnapABugChat.setChatWindowCookieData("isMinimized", false);

          if (SnapABug.isCustomDesignEnabled()) {
            return;
          }

          var wp = document.getElementById("SnapABug_WP");

          // if wp has class 'minimized', remove it
          wp.className = wp.className.replace(/(\s|)minimized(\s|)/, "");

          var nmni = document.getElementById("SnapABug_NMNi");
          // New Message Notification
          if (!nmni) {
            SnapABug.initMinimizeNotification();
            nmni = document.getElementById("SnapABug_NMNi");
          }
          nmni.innerHTML = "";

          // Restore height & width to previous
          var minDim = SnapABugChat.minimizedDimensions;

          document.getElementById("SnapABug_NMN").style.display = "none";
          SnapABugChat.setChatWindowCookieData("newMinimizedMessageCount", 0);

          wp.style.width = SnapABug.formWidth + "px";
          wp.style.height = SnapABug.formHeight + "px";

          // If we have offset the form, reset the offset to original.
          if (minDim[0] !== 0 || minDim[1] !== 0) {
            var p = document.getElementById("SnapABug_P");
            // form container.
            p.style.left = "0";
            p.style.top = "0";
          }

          document.getElementById("SnapABug_DB").style.display = "block";
          // Reveal/reactivate the position dragger.

          // Re-enable tab-ability to elements
          var tiNodeArray = [];
          // Tab Index Node Array
          var wpa = wp.getElementsByTagName("a");
          var i = 0;
          for (i = 0; i < wpa.length; i++) {
            if (wpa[i].getAttribute("tabIndex") !== null) {
              tiNodeArray.push(wpa[i]);
            }
          }
          var wpta = wp.getElementsByTagName("textarea");
          for (i = 0; i < wpta.length; i++) {
            if (wpta[i].getAttribute("tabIndex") !== null) {
              tiNodeArray.push(wpta[i]);
            }
          }
          if (SnapEngage.isIE()) {
            var wpi = wp.getElementsByTagName("iframe");
            for (i = 0; i < wpi.length; i++) {
              if (wpi[i].getAttribute("tabIndex") !== null) {
                tiNodeArray.push(wpi[i]);
              }
            }
          }
          for (i = 0; i < tiNodeArray.length; i++) {
            tiNodeArray[i].removeAttribute("tabIndex");
          }

          // Determine unminimize position
          var cbPos = SnapABugChat.getChatWindowCookieData("chatBoxPosition");
          // [left, right, top, bottom]

          // Check if the form has been moved, if so: try to use that position.
          var hasBeenDragged = false;
          // If it has been dragged, left and top will be >= 0, while right and bottom will be -1
          hasBeenDragged =
            cbPos[0] >= 0 &&
            cbPos[2] >= 0 &&
            cbPos[1] === -1 &&
            cbPos[3] === -1;
          // Check if the drag position is off screen.
          var isOffscreen = false;
          if (hasBeenDragged) {
            isOffscreen =
              cbPos[0] + SnapABug.formWidth > SnapABug.getWindowWidth();
            if (!isOffscreen) {
              // If X was not offscreen, check Y
              isOffscreen =
                cbPos[2] + SnapABug.formHeight > SnapABug.getWindowHeight();
            }
          }

          if (hasBeenDragged && !isOffscreen) {
            SnapABug.positionForm(cbPos[0], cbPos[1], cbPos[2], cbPos[3]);
            SnapABugChat.setChatWindowCookieData("chatBoxPosition", [
              cbPos[0],
              cbPos[1],
              cbPos[2],
              cbPos[3],
            ]);
            return;
          }

          // Fall through, set to original chat box position (Note: if 'center', this goes to bottom right)
          var posit = SnapABug.getDefaultChatPosition();
          SnapABug.positionForm(posit[0], posit[1], posit[2], posit[3]);
          SnapABugChat.setChatWindowCookieData("chatBoxPosition", [
            posit[0],
            posit[1],
            posit[2],
            posit[3],
          ]);
          var cbPosFromCookie = SnapABugChat.getChatWindowCookieData(
            "chatBoxPosition"
          );
          // [left, right, top, bottom]
          SnapABug.calculateAndSetInViewportPosition(cbPosFromCookie);
          return;
        },
        newMinimizedMessageReceived: function () {
          var nmn = document.getElementById("SnapABug_NMN");
          var nmni = document.getElementById("SnapABug_NMNi");
          if (nmn) {
            nmn.style.display = "block";
            // Reveal if hidden.
            var currCount = SnapABugChat.getChatWindowCookieData(
              "newMinimizedMessageCount"
            );
            nmni.innerHTML = ++currCount;
            // Update message count Display.

            SnapABugChat.setChatWindowCookieData(
              "newMinimizedMessageCount",
              currCount
            );
          }
        },
        setPreviousChatWindowState: function () {
          // Called on page change while a chat is in progress.
          if (SnapABug.isMobileEnabled()) {
            return;
          } else if (SnapABug.isCustomDesignEnabled()) {
            // Not using this for Custom Design as we are saving the cookie inside the app.
            return;
          }

          var chatWindowCookieVals = decodeURIComponent(
            SnapABugChat.getCookie("SnapABugChatWindow")
          ).split("|");

          if (chatWindowCookieVals.length === 0) {
            return;
          }

          if (SnapABugChat.isMinimized()) {
            var nmn = document.getElementById("SnapABug_NMN");
            // If we have new messages, show the NMN, otherwise keep it hidden.
            if (nmn) {
              var currCount = SnapABugChat.getChatWindowCookieData(
                "newMinimizedMessageCount"
              );
              nmn.style.display = currCount > 0 ? "block" : "none";
            }
            SnapABugChat.minimizeChat(true);
          } else {
            // If we're not minimized, re-position using previous page's position.
            var cbPosFromCookie = SnapABugChat.getChatWindowCookieData(
              "chatBoxPosition"
            );
            // Grab the old chat box position.
            SnapABug.calculateAndSetInViewportPosition(cbPosFromCookie);
          }
        },
        resetChatWindowCookieData: function () {
          if (this.getChatWindowCookieData("isMinimized")) {
            this.setChatWindowCookieData("minimize", "false");
          }
          if (this.getChatWindowCookieData("newMinimizedMessageCount")) {
            this.setChatWindowCookieData("newMinimizedMessageCount", "0");
          }
          if (this.getChatWindowCookieData("chatBoxPosition")) {
            this.setChatWindowCookieData(
              "chatBoxPosition",
              SnapABug.getDefaultChatPosition()
            );
          }
        },
        setChatWindowCookieData: function (valName, newVal) {
          // If the cookie doesn't exist: Create it first.
          // If no arguments provided: Only create the cookie.

          // With arguments: alter a single value and re-create the cookie with the new value string.
          //`cookieIndex` =  `valName`                  : `Type of value` *All are strings due to being stored in a cookie
          // 0            = 'isMinimized'               : `String-Boolean` 'true' || 'false' || 'undefined'
          // 1            = 'newMinimizedMessageCount'  : `String-int`
          // 2            = 'chatBoxPosition'           : `Comma-delimited String-int array` 'left, right, top, bottom'  // same order as .positionForm()

          var currCookieStr = decodeURIComponent(
            SnapABugChat.getCookie("SnapABugChatWindow")
          );
          var newCookieVals = [];

          if (currCookieStr === "" || currCookieStr.split("|").length < 3) {
            // If it doesn't exist, or it is wrong: Create it with filler values
            newCookieVals[0] = undefined;
            newCookieVals[1] = 0;

            if (!SnapEngage.isCustomDesignEnabled()) {
              newCookieVals[2] = [-1, 0, -1, 0];
              // bottom right
            }
          } else {
            newCookieVals = currCookieStr.split("|");
          }

          if (!valName) {
            // If no arguments provided: Only create the cookie.
            SnapABugChat.setCookie(
              "SnapABugChatWindow",
              encodeURIComponent(newCookieVals.join("|")),
              30
            );
            return;
          } else {
            switch (valName) {
              case "isMinimized":
                newCookieVals[0] = newVal;
                break;
              case "newMinimizedMessageCount":
                newCookieVals[1] = newVal;
                break;
              case "chatBoxPosition":
                newCookieVals[2] = newVal;
                break;
              default:
                break;
            }

            SnapABugChat.setCookie(
              "SnapABugChatWindow",
              encodeURIComponent(newCookieVals.join("|")),
              30
            );
          }
        },
        getChatWindowCookieData: function (valName) {
          if (!valName) {
            return false;
          }

          var currCookieVals = decodeURIComponent(
            SnapABugChat.getCookie("SnapABugChatWindow")
          ).split("|");

          if (currCookieVals === "") {
            SnapABugChat.setChatWindowCookieData();
            // Create the cookie.
            currCookieVals = decodeURIComponent(
              SnapABugChat.getCookie("SnapABugChatWindow")
            ).split("|");
            return;
          }

          var result;
          switch (valName) {
            case "isMinimized":
              if (
                typeof currCookieVals[0] === "undefined" ||
                currCookieVals[0] === "undefined"
              ) {
                result = undefined;
              } else {
                result = currCookieVals[0] === "true";
              }
              break;

            case "newMinimizedMessageCount":
              result = currCookieVals[1] ? parseInt(currCookieVals[1], 10) : 0;
              break;

            case "chatBoxPosition":
              if (currCookieVals[2]) {
                var cbPosVals = currCookieVals[2].split(",");
                for (var i = 0; i < cbPosVals.length; i++) {
                  cbPosVals[i] = parseInt(cbPosVals[i], 10);
                }
                result = cbPosVals;
              } else {
                return SnapABug.getDefaultChatPosition();
              }
              break;

            default:
              result = undefined;
              break;
          }

          return result;
        },
        handleDataTransferInProgress: function () {
          // If these aren't in progress, return
          if (
            !SnapABugChat.isFileUploadInProgress() &&
            !secureDataTransferInProgress
          ) {
            return;
          }

          var requestType = "";
          if (SnapABugChat.isFileUploadInProgress()) {
            requestType = "File upload";
          } else if (secureDataTransferInProgress) {
            requestType = "Secure data";
          }

          // If in the middle of a data request to visitor, return chatbox to normal
          if (
            (SnapABugChat.isFileUploadInProgress() &&
              document.getElementById("SnapABug_CM")) ||
            (secureDataTransferInProgress &&
              document.getElementById("SnapABug_CM"))
          ) {
            // Save any text the visitor has typed into the textarea, it will restore during showFormChat()
            SnapABugChat.saveUserInput();

            // Set the chatbox back to normal (put the textarea back)
            SnapABugChat.showFormChat();

            // Reset the setter back to false
            switch (requestType) {
              case "File upload":
                SnapABugChat.setFileUploadInProgress(false);
                break;
              case "Secure data":
                secureDataTransferInProgress = false;
                break;
              default:
                return;
            }

            // Let agent know they need to send the request again
            // TODO: i18n
            SnapABugChat.sendChatMessage(
              6,
              requestType + " request interrupted; please send request again."
            );
          }
        },
        setFileUploadInProgress: function (isVisitor) {
          fileUploadInProgress = isVisitor;
        },
        isFileUploadInProgress: function () {
          return fileUploadInProgress;
        },
      };
    })();

    var SnapEngage = SnapABug;
    var SnapEngageChat = SnapABugChat;

    window.SnapABug = SnapABug;
    window.SnapEngage = SnapEngage;
    window.SnapEngageChat = SnapEngageChat;

    window.handleCobrowseSysCmd = function (
      cobrowseKey,
      widgetId,
      nickname,
      replay,
      isCustomDesignEnabled,
      customDesignUI,
      SnapEngage,
      SnapEngageChat,
      Cobrowse
    ) {
      if (Cobrowse.isSupported() && isCustomDesignEnabled && !replay) {
        customDesignUI.updateChat(
          SnapEngage.getMessage(61).replace("{alias}", nickname),
          false,
          false,
          "COBR_COBROWSE_INVITE",
          false,
          false
        );
        customDesignUI.updateScroll();
        customDesignUI.enableCobrowsingButtons(cobrowseKey, widgetId);
      }

      if (!Cobrowse.isSupported()) {
        SnapEngageChat.sendChatMessage(
          6,
          "Visitor browser does not support cobrowsing."
        );
      }

      if (!isCustomDesignEnabled) {
        SnapEngageChat.sendChatMessage(
          6,
          "Visitor browser does not have custom design enabled."
        );
      }

      if (replay) {
        SnapEngageChat.sendChatMessage(
          6,
          "Visitor browser will resume the current cobrowsing session."
        );
      }
    };

    window.parseXhrJSON = function (response) {
      try {
        var jsonResponse = JSON.parse(response);

        if (jsonResponse.hasOwnProperty("statusCode")) {
          return jsonResponse;
        }
        return null;
      } catch (e) {
        return null;
      }
    };

    window.getAllCookies = function () {
      return document.cookie;
    };

    window.SnapABugHistory = function (historyCookie) {
      var splitData = historyCookie.split("#").filter(Boolean);
      var caseData = "";
      return {
        cases: function () {
          return (
            (splitData[1] && splitData[1].split("!").filter(Boolean)) || []
          );
        },
        count: function () {
          return splitData[0] || "1";
        },
        addNewCaseData: function (caseId, time) {
          // limit of last 5 rolling cases to avoid cookie header payload
          if (this.cases().length >= 5) {
            this.removeFirst();
          }
          var existing = splitData[1];
          if (existing) {
            caseData += existing;
          }
          caseData += caseId + ":" + time + "!";
        },
        getAsString: function () {
          return this.count() + "#" + caseData;
        },
        removeFirst: function () {
          var originalCases = this.cases();
          originalCases.shift(0, 1);

          splitData[1] = originalCases.join("!") + "!";
        },
      };
    };

    // Callback Handler Module
    function CallbackManager() {
      this.set = setCallback;
      this.trigger = triggerCallback;
      this.events = {
        INLINE_BUTTON_CLICKED: "InlineButtonClicked",
        CLOSE: "Close",
      };

      // Internals
      var callbacksMap = initializeCallbackMap(this.events);
      Object.freeze(this.events);

      function triggerCallback(key) {
        var callbackFn = callbacksMap[key.toLowerCase()];

        if (typeof callbackFn === "function") {
          var argumentsAsArray = Array.prototype.slice.call(arguments);
          callbackFn.apply(null, argumentsAsArray.slice(1));
        }
      }

      function setCallback(key, callbackFn) {
        var event = key.toLowerCase();

        if (!callbacksMap[event]) {
          console.info("Invalid callback event: ", key);
          return;
        }

        if (typeof callbackFn !== "function") {
          console.info("Callback must be a function.");
          return;
        }

        callbacksMap[event] = callbackFn;
      }

      function initializeCallbackMap(events) {
        var callbackMap = {};

        for (var key in events) {
          if (events.hasOwnProperty(key)) {
            var event = events[key].toLowerCase();
            callbackMap[event] = function noOp() {};
          }
        }

        return callbackMap;
      }
    }
    window.CallbackManager = CallbackManager;

    window.MESSAGE_TYPES = {
      TEXT: "text",
      BUTTON: "inline_buttons",
      CARDS: "cards",
      OFFLINE: "link_text",
    };

    // Message handlers,
    // once we have modules we can move it outside this closure
    window.handleButtonMessage = function (msg) {
      if (SnapABug.isCustomDesignEnabled()) {
        SnapABug.getCustomDesignUI().showButtonUI(msg.buttons);
      }
    };
    window.handleTextMessage = function (msg, fromAgent, replay, historyOnly) {
      this.callbackMessage(fromAgent, msg.text, replay, historyOnly);
    };

    window.handleSearchResultsMessage = function (searchResultsData) {
      SnapABug.getCustomDesignUI().initSearchResultsView(searchResultsData);
    };

    window.handleLinkTextMessage = function (msg) {
      var textLinkMessageTypes = {
        offlineForm: "offline_form",
      };
      if (msg.action.type === textLinkMessageTypes.offlineForm) {
        SnapABug.getCustomDesignUI().initTextLinkView(msg);
      } else {
        console.log("action type is unsupported: ", msg.action.type);
      }
    };
    if (typeof SnapEngageNoInit == "undefined") {
      SnapEngage.setStartChat([
        {
          type: "text",
          text: "Dzie dobry, w czym mog pomc?",
        },
      ]);
      if (typeof SnapEngage.setEnableInternationalPhoneCalls !== "undefined") {
        SnapEngage.setEnableInternationalPhoneCalls(true);
      }
      if (typeof SnapEngage.messagesInit !== "undefined") {
        SnapEngage.messagesInit(
          '{"isSingle":true,"pl":{"0":"Pomoc","1":"Adres email:","2":"Tre pytania:","3":"Zacz zrzut ekranu biecej strony","4":"Wylij","5":"Prosz wysa zrzut ekranu biecej strony, aby otrzyma jak najszybsz odpowied.","6":"Przygotowanie do zrobienia zrzutu ekranu...\u003cbr /\u003e\u003cbr /\u003eAplikacja Java przetwarza tre wiadomoci.","7":"Dzikujemy za wiadomo. Odpowiemy na ni tak szybko, jak to moliwe.","8":"Przepraszamy, wiadomo nie zostaa wysana.\u003cbr /\u003eNasz zesp analizuje przyczyn problemu.\u003cbr /\u003eProsz sprbowa ponownie pniej.","9":"adowanie...","10":"Zamknij","11":"You have already submitted this case to the support team.","12":"Wylij email","13":"Wejd na chat","14":"Po powitaniu konsultanta, prosz wpisa tre pytania i wcisn enter.","15":"Ja","16":"How can we help?","17":"Do any of these help?","18":"Next","19":"Back","20":"None of these helped...","21":"Czy jeste zadowolony z pomocy jak uzyskae od obsugi klienta HBO GO?","22":"Czy jeste zadowolony z pomocy jak uzyskae od konsultanta ({alias})?","23":"Czy chciaby co jeszcze doda?","24":"Potwierd","25":"lub Anuluj","26":"Dzikujemy za powicenie czasu na usprawnienie naszej obsugi klienta. yczymy wielu przyjemnych chwil z HBO GO.","27":"Bardzo niezadowolony","28":"Niezadowolony","29":"rednio zadowolony","30":"Zadowolony","31":"Bardzo zadowolony","32":"Poor","33":"Ok","34":"Great","35":"Jeszcze chwila","36":"Minimize","37":"End Chat","38":"Zadzwo z komputera","39":"Zadzwo na telefon","40":"Wr do czatu","41":"Start a voice call","42":"anuluj","43":"Odebrano zabezpieczone dane","44":"Obecnie wszyscy konsultanci s zajci. Poczymy Ci najszybciej jak to moliwe.","45":"{alias} pisze...","46":"Zakoczy czat?","47":"Prowadzisz rozmow z konsultantem. Zamknicie czatu zakoczy rozmow i nie bdziesz mg do niej powrci.","48":"Zakocz czat","49":"Kontynuuj czat","50":"Search","51":"Search Again","52":"Next","53":"No results found, please try again, or click button below to continue contacting agent.","54":"I was searching in the Knowledge Base for","55":"Twoja rozmowa na czacie zostaa zakoczona.","56":"Kliknij przycisk WYLIJ PLIK poniej","57":"WYLIJ PLIK","58":"Zamknij","59":"\u003cb\u003eDzikujemy za kontakt.\u003c/b\u003e\u003cbr\u003eCzat zosta zakoczony.","60":"\u003cbr\u003e\u003cb\u003eDzikujemy za kontakt.\u003c/b\u003e\u003cbr\u003eCzat zosta zakoczony z powodu braku aktywnoci przez dugi czas.","61":"Accept Co-Browsing? Only this browser tab will be shared with {alias}.","62":"ACCEPT","63":"DECLINE","64":"This browser tab will now be shared live with {alias}.","65":"Invitation to Co-Browse declined.","66":"...","67":"Enter an email address below to receive a transcript of this chat.","68":"Invalid email","69":"Cancel","70":"Okay","71":"A transcript will be sent to {email} at the end of this chat.","72":"","73":""}}'
        );
      }
      if (typeof SnapEngage.allowVisitorChatHistory !== "undefined") {
        SnapEngage.allowVisitorChatHistory(false);
      }
      SnapEngage.setCustomDesignSettings({
        id: 6002137486721024,
        name: "PL design",
        orgId: 5268310651437056,
        baseFont: "'Lato', sans-serif|300|Light|import",
        baseFontColor: "#000000",
        linkDefaultColor: null,
        linkVisitedColor: null,
        linkHoverColor: null,
        linkActiveColor: null,
        linkUnderlined: null,
        staticUrl: "https://www.snapengage.com/studio",
        logoUrl: "https://www.snapengage.com/partner?src=widget&id={0}&l={1}",
        useDesktopOnlineButtonSettings: null,
        useDesktopOfflineButtonSettings: null,
        onlineButton: {
          fontSize: "14",
          borderWidth: "1",
          borderRadius: "5",
          position: "bottom",
          offset: "right",
          offsetValue: "10",
          offsetUnit: "px",
          text: "Rozpocznij czat!",
          imageUrl: null,
          imageWidth: null,
          imageHeight: null,
          svgIcon: null,
          fontColor: "#ffffff",
          bgColor: "#333333",
          borderColor: "#ffffff",
          notifyFontColor: "#FFFFFF",
          notifyBgColor: "#CB4437",
          notifyBorderColor: "#FFFFFF",
        },
        offlineButton: {
          fontSize: "14",
          borderWidth: "1",
          borderRadius: "5",
          position: "bottom",
          offset: "right",
          offsetValue: "10",
          offsetUnit: "px",
          text: null,
          imageUrl: null,
          imageWidth: null,
          imageHeight: null,
          svgIcon: null,
          fontColor: "#ffffff",
          bgColor: "#333333",
          borderColor: "#ffffff",
          notifyFontColor: "#FFFFFF",
          notifyBgColor: "#9c9c9c",
          notifyBorderColor: "#FFFFFF",
        },
        mobileOnlineButton: null,
        mobileOfflineButton: null,
        placement: "right-bottom",
        height: "500",
        width: "380",
        padding: "0",
        fontColor: null,
        bgColor: "#333333",
        bgImageUrl: null,
        bgImageRepeat: null,
        bgPatternUrl: null,
        bgOpacity: "100",
        borderColor: "#000000",
        borderWidth: "0",
        borderRadius: "0",
        boxShadow: "0 0 0.688em 0 rgba(0,0,0,0.5)",
        showPoweredBy: false,
        poweredByPosition: "center",
        logoPlacement: "footer",
        logoPosition: "left",
        logoPadding: "0",
        logoImageUrl: null,
        showMinimize: true,
        minimizeIcon: "minimize_thin",
        showClose: true,
        closeIcon: "close_thin",
        prechatHeader: {
          text: "CHAT WITH US",
          fontColor: "#ffffff",
          fontSize: "16",
          fontWeight: "normal",
          bgColor: "#333333",
          svgIcon: "comments",
          svgIconPosition: "left",
        },
        chatHeader: {
          text: "CZAT",
          fontColor: "#ffffff",
          fontSize: "16",
          fontWeight: "normal",
          bgColor: "#333333",
          svgIcon: "comments",
          svgIconPosition: "left",
        },
        offlineHeader: {
          text: "Contact Us",
          fontColor: "#ffffff",
          fontSize: "16",
          fontWeight: "normal",
          bgColor: "#333333",
          svgIcon: "paper-plane-o",
          svgIconPosition: "left",
        },
        chatTextarea: {
          type: "textarea",
          bgColor: "#333333",
          fontColor: "#cccccc",
          fontSize: "14",
          borderColor: "#888888",
          borderWidth: "1",
          borderRadius: "0",
          isTopBorderOnly: true,
          padding: "10",
          placeholder: "Napisz wiadomo",
          placeholderColor: "#888888",
        },
        chatSendButton: {
          text: "SEND",
          svgIcon: "icn-send-outline",
          fontColor: "#FFFFFF",
          bgColor: "#888888",
          borderColor: "#000000",
          borderWidth: "0",
          borderRadius: "4",
          padding: "10",
        },
        chatCancelFileUploadButton: {
          text: "CANCEL",
          svgIcon: null,
          fontColor: "#FFFFFF",
          bgColor: "#FF9900",
          borderColor: "#000000",
          borderWidth: "0",
          borderRadius: "4",
          padding: "10",
        },
        chatCloseButton: {
          text: "CLOSE",
          svgIcon: null,
          fontColor: "#FFFFFF",
          bgColor: "#FF9900",
          borderColor: "#000000",
          borderWidth: "0",
          borderRadius: "4",
          padding: "10",
        },
        chatCallMeButton: {
          text: "ZADZWO DO MNIE",
          svgIcon: null,
          fontColor: "#ffffff",
          bgColor: "#888888",
          borderColor: "#000000",
          borderWidth: "0",
          borderRadius: "0",
          padding: "10",
        },
        chatPrimaryButton: null,
        chatSecondaryButton: null,
        inlineMessagePrimaryButton: null,
        agentMessage: {
          bubble: true,
          avatarBorderRadius: "20",
          avatarPadding: "0",
          avatarPosition: null,
          bgColor: "#888888",
          borderColor: "#000000",
          borderWidth: "0",
          borderRadius: "20",
          fontColor: "#333333",
          fontSize: "14",
        },
        visitorMessage: {
          bubble: true,
          avatarBorderRadius: "20",
          avatarPadding: "0",
          avatarPosition: null,
          bgColor: "#cccccc",
          borderColor: "#000000",
          borderWidth: "0",
          borderRadius: "20",
          fontColor: "#333333",
          fontSize: "14",
        },
        visitorName: "Ja",
        fieldBorderWidth: "1",
        fieldBorderRadius: "5",
        fieldBgColor: "#cccccc",
        fieldBorderColor: "#cccccc",
        fieldFontColor: "#333333",
        fieldLabelColor: "#cccccc",
        fieldPlaceholderColor: "#888888",
        offlineFields: [
          {
            type: "email",
            label: "Adres e-mail",
            name: "email",
            placeholder: "Adres e-mail",
            required: true,
            requiredMessage: null,
            options: null,
          },
          {
            type: "textarea",
            label: "",
            name: "description",
            placeholder: "Dzie dobry, w czym mog pomc?",
            required: true,
            requiredMessage: null,
            options: null,
          },
        ],
        offlineSendEmailButton: {
          text: "Zapisz",
          svgIcon: "envelope-o",
          fontColor: "#ffffff",
          bgColor: "#333333",
          borderColor: "#ff9a00",
          borderWidth: "0",
          borderRadius: "0",
          padding: "10",
        },
        prechatFields: [
          {
            type: "email",
            label: "Email",
            name: "email",
            placeholder: "Enter your email address",
            required: false,
            requiredMessage: null,
            options: null,
          },
        ],
        prechatSendEmailButton: null,
        prechatChatButton: {
          text: "START CHAT",
          svgIcon: "envelope-o",
          fontColor: "#ffffff",
          bgColor: "#333333",
          borderColor: "#ff9a00",
          borderWidth: "0",
          borderRadius: "0",
          padding: "10",
        },
      });
      SnapEngage.add(
        "36db38bd-8855-4729-b20c-7d824244aef7",
        "pl",
        "0",
        "55%",
        "https://storage.googleapis.com/code.snapengage.com/btn/chat_green_left_en.png",
        "https://storage.googleapis.com/code.snapengage.com/btn/help_green_left_en.png",
        false
      );
    }
  </script>
</html>
